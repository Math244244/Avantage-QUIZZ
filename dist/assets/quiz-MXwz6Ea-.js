const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/admin-MwW8t9Ay.js","assets/services-B8oy3dvD.js","assets/main-BRz1ijU6.js","assets/micro-interactions-CO1fend8.js","assets/micro-interactions-Da1vdbyN.css","assets/main-DaFhL-Ce.css"])))=>i.map(i=>d[i]);
import{a as $,b as ze,i as C,l as q,t as g,_ as v,s as qe,u as I,e as x,d as Z,g as ke}from"./admin-MwW8t9Ay.js";import{query as X,collection as J,where as b,getDocs as ee}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";import{s as u,k as te}from"./services-B8oy3dvD.js";import{getAnalytics as _e,setUserId as Me,setUserProperties as Te,logEvent as j}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";const Ce={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},_=typeof window<"u",Re=typeof document<"u",Se=typeof navigator<"u",Le=typeof import.meta<"u"&&!!import.meta.vitest,De=typeof import.meta<"u"&&Ce&&!1,se=Le||De,$e=Se&&"serviceWorker"in navigator;let f=null;function ne(){return _&&window.location?{path:window.location.pathname,href:window.location.href}:{path:"/test",href:"https://localhost/test"}}function oe(){try{return f||(_&&$e||se?(f=_e(ze),console.log("‚úÖ Firebase Analytics initialis√©")):console.warn("‚ö†Ô∏è Firebase Analytics non disponible dans cet environnement"),f)}catch(e){return console.error("‚ùå Erreur initialisation Analytics:",e),null}}function U(e,t={}){if(!f){console.log(`[Analytics] ${e}`,t);return}try{const{path:r}=ne();j(f,e,{...t,timestamp:Date.now(),page:r}),console.log(`üìä Event tracked: ${e}`,t)}catch(r){console.error("‚ùå Erreur tracking √©v√©nement:",r)}}function Ie(e,t={}){if(!f){console.error("[Analytics Error]",e,t);return}try{j(f,"exception",{description:e.message||"Unknown error",fatal:!1,error_type:e.name||"Error",error_stack:e.stack?.substring(0,500)||"",...t}),console.error("üìä Error tracked:",e.message)}catch(r){console.error("‚ùå Erreur tracking erreur:",r)}}function ie(e){if(f)try{Me(f,e),console.log("‚úÖ Analytics user set:",e)}catch(t){console.error("‚ùå Erreur d√©finition utilisateur Analytics:",t)}}function ae(e){if(f)try{Te(f,e),console.log("‚úÖ Analytics user properties set:",e)}catch(t){console.error("‚ùå Erreur d√©finition propri√©t√©s utilisateur:",t)}}function Qe(e,t){if(!f){console.log(`[Analytics PageView] ${e} - ${t}`);return}try{const{path:r,href:s}=ne();j(f,"page_view",{page_title:e,page_location:s,page_path:t||r}),console.log(`üìä Page view tracked: ${e}`)}catch(r){console.error("‚ùå Erreur tracking page view:",r)}}function le(e,t){U("quiz_start",{module_id:e,month:t})}function ce(e,t,r,s){U("quiz_complete",{module_id:e,score:t,time_elapsed:r,total_questions:s,passed:t>=60})}const Be=_||se;if(Be){const e=()=>{try{oe(),$&&typeof $.onAuthStateChanged=="function"&&$.onAuthStateChanged(t=>{t&&(ie(t.uid),ae({email:t.email||"",display_name:t.displayName||""}))})}catch(t){console.warn("‚ö†Ô∏è Analytics auto-init skipped:",t.message)}};Re&&document.readyState==="loading"&&_?document.addEventListener("DOMContentLoaded",e):_&&setTimeout(e,0)}const Oe=Object.freeze(Object.defineProperty({__proto__:null,initAnalytics:oe,setAnalyticsUser:ie,setAnalyticsUserProperties:ae,trackError:Ie,trackEvent:U,trackPageView:Qe,trackQuizComplete:ce,trackQuizStart:le},Symbol.toStringTag,{value:"Module"}));var Pe={};class P extends Error{constructor(t){super(`Trop de requ√™tes. Veuillez patienter ${Math.ceil(t/1e3)} secondes.`),this.name="RateLimitError",this.waitTimeMs=t}}class ue{constructor(t,r){this.maxRequests=t,this.windowMs=r,this.requests=[]}_cleanup(t=Date.now()){this.requests=this.requests.filter(r=>t-r<this.windowMs)}canExecute(){const t=Date.now();return this._cleanup(t),this.requests.length<this.maxRequests?(this.requests.push(t),!0):!1}getRemainingTime(){const t=Date.now();if(this._cleanup(t),this.requests.length===0)return 0;const r=this.requests[0];return Math.max(0,this.windowMs-(t-r))}async check(){if(this.canExecute())return;const t=this.getRemainingTime()||this.windowMs;throw new P(t)}reset(){this.requests=[]}getRemainingRequests(){return this._cleanup(),Math.max(0,this.maxRequests-this.requests.length)}}const Ve=()=>typeof window<"u"&&typeof window.happyDOM<"u",Ne=()=>typeof globalThis<"u"&&!!globalThis.__vitest_worker__;function de(){return!!(Ve()||Ne()||typeof navigator<"u"&&/happy\s?dom|jsdom/i.test(navigator.userAgent||"")||typeof globalThis<"u"&&globalThis.__vitest_browser__||typeof import.meta<"u"&&import.meta.vitest||typeof process<"u"&&Pe?.npm_lifecycle_event==="test")}function me(){return de()?1e3:6e4}let Q=null,B=null;function je(){return Q||(Q=new ue(100,me())),Q}function Ue(){return B||(B=new ue(50,me())),B}function Fe(e){return e<=0?Promise.resolve():new Promise(t=>setTimeout(t,e))}async function pe(e,t={}){const r=t.isWrite?Ue():je(),s=t.maxRetry??5;let n=0;const i=de();for(;n<=s;)try{return await r.check(),await e()}catch(o){if(o instanceof P){console.warn("‚ö†Ô∏è Rate limit atteint:",o.message),n+=1;const l=i?Math.min(o.waitTimeMs,1e3):o.waitTimeMs;await Fe(l);continue}throw o}throw new P(r.getRemainingTime()||r.windowMs)}async function Rt(e){return pe(e,{isWrite:!1})}async function St(e){return pe(e,{isWrite:!0})}const h={NETWORK:"NETWORK",FIRESTORE:"FIRESTORE",AUTH:"AUTH",VALIDATION:"VALIDATION",UNKNOWN:"UNKNOWN"};class We{constructor(){this.errorLog=[],this.maxLogSize=100,this.setupGlobalHandlers()}setupGlobalHandlers(){window.addEventListener("error",t=>{this.handleError({message:t.message,filename:t.filename,lineno:t.lineno,colno:t.colno,error:t.error,type:h.UNKNOWN},"Global error handler")}),window.addEventListener("unhandledrejection",t=>{this.handleError({message:t.reason?.message||"Unhandled promise rejection",error:t.reason,type:h.UNKNOWN},"Unhandled promise rejection")})}handleError(t,r="Unknown",s={}){const n=this.normalizeError(t,r,s);return this.logError(n),s.showToUser!==!1&&this.showUserMessage(n,s),s.critical&&!C()&&this.sendToFirestore(n).catch(i=>{q.error("Impossible d'envoyer l'erreur √† Firestore:",i)}),n}normalizeError(t,r,s){const n={message:t?.message||String(t)||"Erreur inconnue",stack:t?.stack,context:r,type:this.detectErrorType(t),timestamp:new Date().toISOString(),url:window.location.href,userAgent:navigator.userAgent,...s.metadata};return t?.code&&(n.code=t.code),t?.name&&(n.name=t.name),n}detectErrorType(t){if(!t)return h.UNKNOWN;const r=(t.message||"").toLowerCase(),s=t.code||"";return s==="unavailable"||s==="deadline-exceeded"||r.includes("network")||r.includes("fetch")?h.NETWORK:s==="permission-denied"||s==="unauthenticated"||r.includes("auth")?h.AUTH:s==="invalid-argument"||s==="failed-precondition"||r.includes("validation")?h.VALIDATION:r.includes("firestore")||s.startsWith("firestore")?h.FIRESTORE:h.UNKNOWN}logError(t){this.errorLog.push(t),this.errorLog.length>this.maxLogSize&&this.errorLog.shift();const r=`[${t.type}] ${t.context}: ${t.message}`;t.type===h.NETWORK?q.warn(r,t):q.error(r,t)}showUserMessage(t,r){let s=r.userMessage;if(!s)switch(t.type){case h.NETWORK:s="Probl√®me de connexion. V√©rifiez votre connexion internet.";break;case h.AUTH:s="Erreur d'authentification. Veuillez vous reconnecter.";break;case h.VALIDATION:s="Donn√©es invalides. Veuillez v√©rifier vos informations.";break;case h.FIRESTORE:s="Erreur lors de l'acc√®s aux donn√©es. Veuillez r√©essayer.";break;default:s="Une erreur est survenue. Veuillez r√©essayer."}const n=r.duration||(t.type===h.NETWORK?8e3:5e3);g.error(s,n)}async sendToFirestore(t){try{const{trackError:r}=await v(async()=>{const{trackError:s}=await Promise.resolve().then(()=>Oe);return{trackError:s}},void 0);r(new Error(t.message),{error_type:t.type,error_source:t.source,user_id:t.userId||"anonymous"})}catch{console.warn("Analytics non disponible pour tracking erreur")}try{const{db:r}=await v(async()=>{const{db:a}=await import("./admin-MwW8t9Ay.js").then(c=>c.y);return{db:a}},__vite__mapDeps([0,1])),{collection:s,addDoc:n,Timestamp:i}=await v(async()=>{const{collection:a,addDoc:c,Timestamp:d}=await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");return{collection:a,addDoc:c,Timestamp:d}},[]),{isCurrentUserAdmin:o}=await v(async()=>{const{isCurrentUserAdmin:a}=await import("./services-B8oy3dvD.js").then(c=>c.r);return{isCurrentUserAdmin:a}},__vite__mapDeps([1,0]));if(!await o())return;await n(s(r,"errorLogs"),{...t,timestamp:i.now()})}catch(r){console.error("Impossible d'envoyer l'erreur √† Firestore:",r)}}getRecentErrors(t=10){return this.errorLog.slice(-t)}clearErrorLog(){this.errorLog=[]}}const He=new We,Ke={maxRetries:3,initialDelay:1e3,maxDelay:3e4,backoffMultiplier:2,retryableErrors:["unavailable","deadline-exceeded","internal","aborted"],onRetry:null};function re(e,t){if(!e)return!1;const r=e.code||"",s=(e.message||"").toLowerCase();return r==="unavailable"||r==="deadline-exceeded"||s.includes("network")||s.includes("fetch failed")?!0:t.some(n=>r===n||s.includes(n.toLowerCase()))}function Ye(e,t,r,s){const n=t*Math.pow(s,e);return Math.min(n,r)}function Ge(e){return new Promise(t=>setTimeout(t,e))}async function Ze(e,t={}){const r={...Ke,...t};let s;try{return await e()}catch(n){if(s=n,!re(n,r.retryableErrors))throw n}for(let n=0;n<r.maxRetries;n++){const i=Ye(n,r.initialDelay,r.maxDelay,r.backoffMultiplier);r.onRetry?r.onRetry(n+1,i,s):q.warn(`Nouvelle tentative ${n+1}/${r.maxRetries} dans ${i}ms...`),await Ge(i);try{return await e()}catch(o){if(s=o,!re(o,r.retryableErrors))throw o;if(n===r.maxRetries-1)throw He.handleError(o,"Retry handler - Max retries reached",{showToUser:!0,userMessage:`√âchec apr√®s ${r.maxRetries} tentatives. Veuillez r√©essayer plus tard.`}),o}}throw s}async function Xe(e,t={}){return Ze(e,{...t,retryableErrors:["unavailable","deadline-exceeded","internal","aborted","resource-exhausted"],onRetry:t.onRetry||((r,s)=>{q.warn(`Retry Firestore ${r}/${t.maxRetries||3} dans ${s}ms...`)})})}function Je(){const e=document.createElement("canvas");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.pointerEvents="none",e.style.zIndex="9999",document.body.appendChild(e);const t=e.getContext("2d");e.width=window.innerWidth,e.height=window.innerHeight;const r=[],s=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F7DC6F","#BB8FCE","#85C1E2"];for(let i=0;i<150;i++)r.push({x:Math.random()*e.width,y:e.height+Math.random()*100,size:Math.random()*8+4,speedY:-(Math.random()*3+3),speedX:Math.random()*6-3,color:s[Math.floor(Math.random()*s.length)],rotation:Math.random()*360,rotationSpeed:Math.random()*10-5,gravity:.15,opacity:1});function n(){t.clearRect(0,0,e.width,e.height);let i=0;r.forEach((o,l)=>{o.speedY+=o.gravity,o.y+=o.speedY,o.x+=o.speedX,o.rotation+=o.rotationSpeed,o.y>e.height-100&&(o.opacity-=.02),o.opacity>0&&o.y<e.height+50&&(i++,t.save(),t.translate(o.x,o.y),t.rotate(o.rotation*Math.PI/180),t.globalAlpha=o.opacity,t.fillStyle=o.color,t.fillRect(-o.size/2,-o.size/2,o.size,o.size),t.restore())}),i>0?requestAnimationFrame(n):e.remove()}n()}const V={auto:{name:"AT-AVE-AVEX",color:"indigo",label:"Auto"},loisir:{name:"VTT, Motoneige, etc.",color:"cyan",label:"Loisir"},vr:{name:"V√©hicules R√©cr√©atifs",color:"orange",label:"VR"},tracteur:{name:"√âquipement Agricole",color:"green",label:"Tracteur"}},y=()=>u.get("currentQuiz"),et=e=>u.set("currentQuiz",e),M=()=>u.get("currentQuestionIndex"),ge=e=>u.set("currentQuestionIndex",e),E=()=>u.get("userAnswers"),he=e=>u.set("userAnswers",e),N=()=>u.get("startTime"),tt=e=>u.set("startTime",e),rt=()=>u.get("timerInterval"),fe=e=>u.set("timerInterval",e),st=()=>u.get("questionStartTime"),xe=e=>u.set("questionStartTime",e),nt=()=>u.get("currentStreak"),ve=e=>u.set("currentStreak",e),F=()=>u.get("isPaused"),T=e=>u.set("isPaused",e),W=()=>u.get("pausedDuration"),R=e=>u.set("pausedDuration",e),H=()=>u.get("pauseStartedAt"),z=e=>u.set("pauseStartedAt",e),k=()=>u.get("currentModule"),ot=e=>u.set("currentModule",e),A=()=>u.get("currentMonth"),it=e=>u.set("currentMonth",e),O=()=>u.get("currentYear"),at=e=>u.set("currentYear",e),lt=()=>u.get("hasCurrentQuestionBeenAnswered"),S=e=>u.set("hasCurrentQuestionBeenAnswered",e),ct=()=>u.get("quizEventDelegationInitialized"),ut=e=>u.set("quizEventDelegationInitialized",e),K={indigo:{bg:"bg-ap-red-primary",text:"text-ap-red-primary",border:"border-ap-red-primary"},cyan:{bg:"bg-ap-gold",text:"text-ap-gold",border:"border-ap-gold"},orange:{bg:"bg-orange-600",text:"text-orange-600",border:"border-orange-600"},green:{bg:"bg-green-600",text:"text-green-600",border:"border-green-600"}};async function dt(e,t,r){console.log(`üì• Chargement des questions: module=${e}, mois=${t}, ann√©e=${r}`);const s=n=>{const i=n.data();return{id:n.id,question:i.question,options:i.options.map((o,l)=>({id:String.fromCharCode(65+l),text:o,correct:l===i.correctAnswer})),explanation:i.explanation||"Pas d'explication disponible",reference:i.reference||"",tags:i.tags||[]}};if(C()){console.log("üìù Mode d√©mo : Chargement des questions simul√©es pour le quiz...");const i=localStorage.getItem("avantage-quizz-demo-questions");let o=[];if(i)try{const l=JSON.parse(i);console.log(`üíæ ${l.length} questions charg√©es depuis localStorage`),o=l.map(a=>({id:a.id,question:a.question,options:a.options.map((c,d)=>({id:String.fromCharCode(65+d),text:c,correct:d===a.correctAnswer})),explanation:a.explanation||"Pas d'explication disponible",reference:a.reference||"",tags:a.tags||[]})),o=o.filter(a=>{const c=!e||l.find(m=>m.id===a.id)?.module===e,d=!t||l.find(m=>m.id===a.id)?.month===t;return c&&d})}catch{console.warn("‚ö†Ô∏è Erreur lecture localStorage, utilisation questions par d√©faut")}return o.length===0&&(console.log("üì¶ Utilisation questions par d√©faut (aucune en localStorage)"),o=[{id:"demo-1",question:"Quelle est la vitesse maximale autoris√©e sur une autoroute au Qu√©bec ?",options:[{id:"A",text:"100 km/h",correct:!1},{id:"B",text:"110 km/h",correct:!1},{id:"C",text:"120 km/h",correct:!1},{id:"D",text:"100 km/h (conditions normales)",correct:!0}],explanation:"La vitesse maximale sur autoroute au Qu√©bec est de 100 km/h, sauf indication contraire.",reference:"Code de la s√©curit√© routi√®re du Qu√©bec",tags:["vitesse","autoroute"]},{id:"demo-2",question:"√Ä quelle distance minimale devez-vous vous arr√™ter derri√®re un autobus scolaire dont les feux clignotent ?",options:[{id:"A",text:"3 m√®tres",correct:!1},{id:"B",text:"5 m√®tres",correct:!0},{id:"C",text:"10 m√®tres",correct:!1},{id:"D",text:"15 m√®tres",correct:!1}],explanation:"Vous devez vous arr√™ter √† au moins 5 m√®tres d'un autobus scolaire.",reference:"Article 460 CSR",tags:["autobus","s√©curit√©"]},{id:"demo-3",question:"Quel est le taux d'alcool√©mie maximal pour conduire au Qu√©bec ?",options:[{id:"A",text:"0.05",correct:!1},{id:"B",text:"0.08",correct:!0},{id:"C",text:"0.10",correct:!1},{id:"D",text:"0.00",correct:!1}],explanation:"Le taux maximal est de 0.08 pour conducteurs exp√©riment√©s.",reference:"Code criminel du Canada",tags:["alcool","s√©curit√©"]},{id:"demo-4",question:"Combien de points d'inaptitude entra√Æne un exc√®s de vitesse de 30 km/h ?",options:[{id:"A",text:"2 points",correct:!1},{id:"B",text:"3 points",correct:!0},{id:"C",text:"4 points",correct:!1},{id:"D",text:"5 points",correct:!1}],explanation:"Un exc√®s de 21 √† 30 km/h entra√Æne 3 points.",reference:"SAAQ",tags:["vitesse","points"]},{id:"demo-5",question:"Quelle est la distance de s√©curit√© recommand√©e entre v√©hicules ?",options:[{id:"A",text:"1 seconde",correct:!1},{id:"B",text:"2 secondes",correct:!0},{id:"C",text:"3 secondes",correct:!1},{id:"D",text:"5 secondes",correct:!1}],explanation:"La r√®gle des 2 secondes est recommand√©e.",reference:"Guide SAAQ",tags:["distance","s√©curit√©"]}]),console.log(`‚úÖ ${o.length} questions d√©mo charg√©es pour le quiz`),o}try{let n=X(J(Z,"questions"),b("module","==",e),b("month","==",t),b("year","==",r)),i=await ee(n);if(!i.empty){const d=[];return i.forEach(m=>d.push(s(m))),console.log(`‚úÖ ${d.length} questions (mois num√©rique)`),d}const l=["janvier","f√©vrier","mars","avril","mai","juin","juillet","ao√ªt","septembre","octobre","novembre","d√©cembre"][t-1],a=l.charAt(0).toUpperCase()+l.slice(1).toLowerCase();let c=X(J(Z,"questions"),b("module","==",e),b("month","==",a),b("year","==",r));if(i=await ee(c),!i.empty){const d=[];return i.forEach(m=>d.push(s(m))),console.log(`‚úÖ ${d.length} questions (mois texte)`),d}return console.warn("‚ö†Ô∏è Aucune question trouv√©e pour ces crit√®res (num√©rique/texte)"),[]}catch(n){throw console.error("‚ùå Erreur lors du chargement des questions:",n),n}}async function mt(e,t,r){try{const s=await fetch("/test-questions-valides.json");if(!s.ok)return[];const n=await s.json(),o=["janvier","f√©vrier","mars","avril","mai","juin","juillet","ao√ªt","septembre","octobre","novembre","d√©cembre"][t-1];return n.filter(a=>a.module===e&&a.year===r&&(a.month===o||a.month===t)).map((a,c)=>({id:`demo-${e}-${c}`,question:a.question,options:a.options.map((d,m)=>({id:String.fromCharCode(65+m),text:d,correct:m===a.correctAnswer})),explanation:a.explanation||"Pas d'explication disponible",reference:a.reference||"",tags:a.tags||[]}))}catch(s){return console.warn("Demo questions fallback error:",s),[]}}async function pt(e){const t=V[e];if(!t){console.error("Module de quiz non trouv√©:",e),g.error("Module non trouv√©. Veuillez r√©essayer.");return}const r=qe(`Chargement du quiz ${t.label}...`);gt(t.label);try{const{getCurrentMonthNumber:s,getCurrentYear:n,normalizeMonthFormat:i}=await v(async()=>{const{getCurrentMonthNumber:m,getCurrentYear:L,normalizeMonthFormat:D}=await import("./services-B8oy3dvD.js").then(p=>p.q);return{getCurrentMonthNumber:m,getCurrentYear:L,normalizeMonthFormat:D}},__vite__mapDeps([1,0])),o=s(),l=n(),a=i(o,l);it(a),at(l),ot(e);try{window.__QUIZ_ACTIVE=!0}catch{}let c=await dt(e,o,l);if(c.length===0&&C()&&(console.log("‚ÑπÔ∏è Mode D√©mo: chargement des questions locales de test"),c=await mt(e,o,l)),c.length===0){I(r,"Aucune question disponible","error");const m=A();g.error(`Aucune question trouv√©e pour ${t.label} en ${m}.

Contactez l'administrateur.`,5e3);return}const d=A();et({name:`Quiz ${t.label} - ${d}`,module:t.name,color:t.color,questions:c}),ge(0),he([]),tt(Date.now()),xe(Date.now()),le(e,A()),ve(0),T(!1),R(0),z(null),S(!1),ht(),ye(),Et(),G(),Y(),I(r,`${c.length} questions charg√©es !`,"success")}catch(s){w(),console.error("‚ùå Erreur lors du d√©marrage du quiz:",s),I(r,"Erreur de chargement","error"),g.error("Erreur lors du chargement du quiz. Veuillez r√©essayer.",4e3)}}function gt(e){const t=we();t.innerHTML=`
        <div class="min-h-screen flex items-center justify-center">
            <div class="text-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-ap-red-primary mx-auto mb-6"></div>
                        <h2 class="text-2xl font-bold text-slate-900 mb-2">Chargement du quiz ${x(e)}</h2>
                <p class="text-slate-600">R√©cup√©ration des questions...</p>
            </div>
        </div>
    `,t.classList.remove("view-hidden")}function ht(){document.getElementById("dashboard-view")?.classList.add("view-hidden"),document.getElementById("module-selection-view")?.classList.add("view-hidden"),document.getElementById("login-view")?.classList.add("view-hidden"),we().classList.remove("view-hidden")}function we(){let e=document.getElementById("quiz-view");return e||(e=document.createElement("div"),e.id="quiz-view",document.querySelector("main").appendChild(e)),ft(e),e}function ft(e){ct()||!e||(e.addEventListener("click",t=>{const r=t.target.closest(".option-button");if(r&&!r.disabled){const l=r.dataset.optionId;l&&xt(l);return}if(t.target.closest("#next-question-btn")){t.preventDefault(),wt();return}if(t.target.closest("#quit-quiz-btn")){t.preventDefault(),confirm("Voulez-vous vraiment quitter le quiz ? Votre progression sera perdue.")&&be();return}if(t.target.closest("#focus-mode-btn")){t.preventDefault(),At();return}if(t.target.closest("#pause-btn")){t.preventDefault(),zt();return}}),ut(!0))}function ye(){const e=y(),t=M(),r=e.questions[t],s=document.getElementById("quiz-view"),n=K[e.color];S(!1),s.innerHTML=`
        <!-- En-t√™te du quiz -->
        <div class="bg-white border-b border-gray-200 shadow-sm">
            <div class="max-w-5xl mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-xl font-bold text-slate-900">${x(e.name)}</h1>
                        <p class="text-sm text-slate-500">Question ${t+1} sur ${e.questions.length}</p>
                    </div>
                    <div class="flex items-center gap-6">
                        <button id="focus-mode-btn" class="text-sm font-medium text-slate-600 hover:text-slate-900 flex items-center gap-1" aria-pressed="false" aria-label="Activer le mode focus">
                            <svg aria-hidden="true" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                            Focus
                        </button>
                        <button id="pause-btn" class="text-sm font-medium text-slate-600 hover:text-slate-900 flex items-center gap-1" aria-pressed="false" aria-label="Mettre le quiz en pause">
                            <svg aria-hidden="true" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Pause
                        </button>
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5 text-ap-red-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span id="quiz-score" class="text-sm font-bold text-ap-red-primary">Score: 0%</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span id="quiz-timer" class="text-sm font-medium text-slate-600">0:00</span>
                        </div>
                        <button id="quit-quiz-btn" class="text-sm font-medium text-slate-600 hover:text-slate-900">
                            Quitter
                        </button>
                    </div>
                </div>
                
                <!-- Barre de progression - ROUGE AVANTAGE PLUS PROFESSIONNEL -->
                <div class="mt-4 w-full bg-gray-300 rounded-full h-4 overflow-hidden border-2 border-gray-700 shadow-inner" style="background-color: #D1D5DB !important; border-color: #374151 !important;">
                    <div id="quiz-progress-bar" class="h-full rounded-full transition-all duration-500 ease-out" style="background: linear-gradient(135deg, #C41E3A 0%, #A01A2E 50%, #8B1429 100%) !important; width: ${Math.max(0,Math.min(100,(t+1)/e.questions.length*100))}%; box-shadow: 0 2px 6px rgba(196, 30, 58, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.25);"></div>
                </div>
            </div>
        </div>

        <!-- Contenu de la question -->
        <div class="max-w-5xl mx-auto px-6 py-8">
            <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
                
                <!-- En-t√™te de question -->
                <div class="px-8 py-6 bg-gradient-to-r from-slate-50 to-white border-b border-gray-100">
                    <div class="mb-4">
                        <span class="text-sm font-medium ${n.text}">Question ${t+1} sur ${e.questions.length}</span>
                    </div>
                    
                    <h2 class="text-2xl font-bold text-slate-900 leading-relaxed">
                        ${x(r.question)}
                    </h2>
                    
                    <!-- Tags -->
                    ${r.tags&&r.tags.length>0?`
                        <div class="flex flex-wrap gap-2 mt-4">
                            ${r.tags.map(i=>`
                                <span class="px-3 py-1 bg-slate-100 text-slate-600 text-xs font-medium rounded-full">
                                    ${x(i)}
                                </span>
                            `).join("")}
                        </div>
                    `:""}
                </div>

                <!-- Options de r√©ponse -->
                <div class="p-8">
                    <div class="space-y-3">
                        ${r.options.map(i=>`
                            <button data-option-id="${x(i.id)}" 
                                    class="option-button w-full text-left px-6 py-5 rounded-xl border-2 border-gray-200 hover:border-ap-red-primary hover:bg-ap-red-50 transition-all duration-200 group">
                                <div class="flex items-center gap-4">
                                    <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-ap-red-100 flex items-center justify-center group-hover:bg-ap-red-primary group-hover:text-white transition-all">
                                        <span class="text-lg font-bold text-ap-red-primary group-hover:text-white">${x(i.id)}</span>
                                    </div>
                                    <span class="text-lg text-slate-700 group-hover:text-slate-900 font-medium">
                                        ${x(i.text)}
                                    </span>
                                </div>
                            </button>
                        `).join("")}
                    </div>
                </div>

                <!-- Zone d'explication (cach√©e initialement) -->
                <div id="explanation-area" class="hidden px-8 py-6 bg-slate-50 border-t border-gray-200">
                    <!-- Sera rempli apr√®s la r√©ponse -->
                </div>

                <!-- Bouton suivant (cach√© initialement) -->
                <div id="next-button-area" class="hidden px-8 py-6 border-t border-gray-200">
                    <div class="flex justify-between items-center">
                        <p class="text-sm text-slate-500">Question suivante dans quelques secondes...</p>
                        <button id="next-question-btn" class="bg-ap-red-primary hover:bg-ap-red-dark text-white px-6 py-3 rounded-lg font-semibold transition-all flex items-center gap-2 shadow-ap-md hover:shadow-ap-lg transform hover:-translate-y-1">
                            Question suivante
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `,G(),Y()}function Y(){const e=y();if(!e||!e.questions||e.questions.length===0)return;const t=M(),r=e.questions.length,s=Math.max(0,Math.min(100,(t+1)/r*100)),n=document.getElementById("quiz-progress-bar");n&&(n.style.width=`${s}%`,n.style.background="linear-gradient(135deg, #C41E3A 0%, #A01A2E 50%, #8B1429 100%)",n.style.setProperty("background","linear-gradient(135deg, #C41E3A 0%, #A01A2E 50%, #8B1429 100%)","important"),console.log(`üìä Barre de progression mise √† jour: ${s.toFixed(1)}% (Question ${t+1}/${r})`))}function xt(e){if(lt())return;const t=y(),r=M(),s=st(),n=t.questions[r],i=n.options.find(c=>c.id===e),o=Math.floor((Date.now()-s)/1e3);S(!0);const l=E();l.push({questionId:n.id,question:n.question,selectedAnswer:e,correctAnswer:n.options.find(c=>c.correct).id,isCorrect:i.correct,timeSpent:o}),he(l);let a=nt();i.correct?a++:a=0,ve(a),document.querySelectorAll(".option-button").forEach(c=>{c.disabled=!0,c.classList.remove("hover:border-ap-red-primary","hover:bg-ap-red-50")}),vt(e,i.correct,n),G(),setTimeout(()=>{document.getElementById("next-button-area")?.classList.remove("hidden")},1e3)}function vt(e,t,r){const s=y();K[s.color];const n=r.options.find(o=>o.correct);document.querySelectorAll(".option-button").forEach(o=>{const l=o.dataset.optionId;l===n.id?(o.classList.add("border-green-500","bg-green-50"),o.classList.remove("border-gray-200")):l===e&&!t&&(o.classList.add("border-red-500","bg-red-50"),o.classList.remove("border-gray-200"))});const i=document.getElementById("explanation-area");i&&(i.innerHTML=`
            <div class="flex items-start gap-4">
                ${t?'<div class="flex-shrink-0 w-12 h-12 rounded-full bg-green-100 flex items-center justify-center"><svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div>':'<div class="flex-shrink-0 w-12 h-12 rounded-full bg-red-100 flex items-center justify-center"><svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></div>'}
                <div class="flex-1">
                    <h3 class="text-lg font-bold ${t?"text-green-700":"text-red-700"} mb-2">
                        ${t?"‚úÖ Bonne r√©ponse !":"‚ùå R√©ponse incorrecte"}
                    </h3>
                    <p class="text-slate-700 mb-2"><strong>Explication :</strong> ${x(r.explanation)}</p>
                    ${r.reference?`<p class="text-sm text-slate-500"><strong>R√©f√©rence :</strong> ${x(r.reference)}</p>`:""}
                </div>
            </div>
        `,i.classList.remove("hidden"))}function wt(){xe(Date.now());const e=M();ge(e+1);const t=y();M()<t.questions.length?(ye(),Y()):yt()}async function yt(){w();try{window.__QUIZ_ACTIVE=!1}catch{}const e=E();if(e.length===0){console.error("‚ùå Aucune r√©ponse enregistr√©e - quiz invalide"),g.error("Aucune r√©ponse enregistr√©e. Le quiz ne peut pas √™tre compl√©t√©.");return}const{calculateScore:t}=await v(async()=>{const{calculateScore:p}=await Promise.resolve().then(()=>Ee);return{calculateScore:p}},void 0),r=t(e);if(isNaN(r)||r<0||r>100){console.error("‚ùå Score invalide calcul√©:",r),g.error("Erreur de calcul du score. Contactez le support.");return}const s=W(),n=F(),i=H();let o=s;n&&i&&(o+=Date.now()-i);const l=N(),a=Math.max(0,Math.floor((Date.now()-l-o)/1e3));T(!1),z(null),R(0);const c=Math.floor(a/60),d=a%60;bt(r,a);const m=y();if(!m){console.error("‚ùå currentQuiz non d√©fini dans showResults"),g.error("Erreur: Impossible d'afficher les r√©sultats. Veuillez r√©essayer.");return}K[m.color];const L=document.getElementById("quiz-view");L.innerHTML=`
        <div class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 py-12 px-4">
            <div class="max-w-4xl mx-auto">
                <!-- Carte de r√©sultat principale -->
                <div class="bg-white rounded-3xl shadow-2xl overflow-hidden mb-8 border-t-4 border-ap-gold">
                    <!-- Header avec score - GRADIENT AVANTAGE PLUS -->
                    <div class="px-8 py-12 text-center text-white" style="background: ${r>=80?"linear-gradient(135deg, #28A745 0%, #D4AF37 100%)":"var(--ap-gradient-primary)"};">
                        <h1 class="text-4xl font-bold mb-4">Quiz Termin√© ! üéâ</h1>
                        <div class="text-8xl font-bold mb-4" style="text-shadow: 0 4px 20px rgba(0,0,0,0.2);">${r}%</div>
                        <p class="text-xl opacity-90">${e.filter(p=>p.isCorrect).length} / ${e.length} bonnes r√©ponses</p>
                        <p class="text-lg opacity-75 mt-2">Temps total : ${c}:${d.toString().padStart(2,"0")}</p>
                    </div>
                    
                    <!-- Message de feedback -->
                    <div class="px-8 py-8 text-center border-b border-gray-200">
                        ${r>=90?'<h2 class="text-3xl font-bold text-green-600 mb-2">üèÜ Excellent !</h2><p class="text-slate-600 text-lg">Performance exceptionnelle ! Vous ma√Ætrisez parfaitement ce module.</p>':r>=75?'<h2 class="text-3xl font-bold text-blue-600 mb-2">üëè Tr√®s bien !</h2><p class="text-slate-600 text-lg">Bon travail ! Quelques r√©visions et vous serez au top.</p>':r>=60?`<h2 class="text-3xl font-bold text-yellow-600 mb-2">üìö Pas mal !</h2><p class="text-slate-600 text-lg">C'est un bon d√©but. Continuez √† r√©viser pour am√©liorer votre score.</p>`:'<h2 class="text-3xl font-bold text-red-600 mb-2">üí™ Continuez !</h2><p class="text-slate-600 text-lg">Ne vous d√©couragez pas. R√©visez les points faibles et r√©essayez !</p>'}
                    </div>
                    
                    <!-- D√©tails des r√©ponses -->
                    <div class="px-8 py-6">
                        <h3 class="text-xl font-bold text-slate-900 mb-4">D√©tails de vos r√©ponses :</h3>
                        <div class="space-y-3 max-h-96 overflow-y-auto">
                            ${e.map((p,Ae)=>`
                                <div class="flex items-center justify-between p-4 rounded-lg ${p.isCorrect?"bg-green-50":"bg-red-50"}">
                                    <div class="flex items-center gap-3 flex-1">
                                        <span class="${p.isCorrect?"text-green-600":"text-red-600"} text-2xl">
                                            ${p.isCorrect?"‚úÖ":"‚ùå"}
                                        </span>
                                        <div class="flex-1">
                                            <p class="font-medium text-slate-900">Question ${Ae+1}</p>
                                            <p class="text-sm text-slate-600">${p.question}</p>
                                            ${p.isCorrect?"":`<p class="text-xs text-slate-500 mt-1">Votre r√©ponse : ${p.selectedAnswer} | Correcte : ${p.correctAnswer}</p>`}
                                        </div>
                                    </div>
                                    <span class="text-sm text-slate-500">${p.timeSpent}s</span>
                                </div>
                            `).join("")}
                        </div>
                    </div>
                    
                    <!-- Boutons d'action -->
                    <div class="px-8 py-6 flex gap-4">
                        <button id="retry-quiz-btn" class="flex-1 bg-ap-red-primary hover:bg-ap-red-dark text-white px-6 py-3 rounded-xl font-semibold transition-all transform hover:-translate-y-1 shadow-ap-md hover:shadow-ap-lg">
                            Refaire le quiz
                        </button>
                        <button id="return-dashboard-btn" class="flex-1 border-2 border-ap-red-primary text-ap-red-primary px-6 py-3 rounded-xl font-semibold hover:bg-ap-red-50 transition-all">
                            Retour au tableau de bord
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `,r>=80&&setTimeout(()=>Je(),500);const D=Math.floor((Date.now()-N())/1e3);ce(k(),r,D,m?.questions?.length||0),document.getElementById("retry-quiz-btn")?.addEventListener("click",()=>{const p=k();p?pt(p):g.error("Erreur: Impossible de red√©marrer le quiz.")}),document.getElementById("return-dashboard-btn")?.addEventListener("click",be)}async function bt(e,t){try{if(!ke()){console.log("Aucun utilisateur - r√©sultat non sauvegard√©"),w();return}if(C()){console.log("Mode d√©mo - r√©sultat non sauvegard√© dans Firestore"),g.info("Mode D√©mo : les r√©sultats ne sont pas sauvegard√©s"),w();return}const s=k(),n=A(),i=O(),o=y(),l=E(),a=V[s]||{},c={moduleId:s,moduleName:a.name||o.module||s,score:e,correctAnswers:l.filter(d=>d.isCorrect).length,totalQuestions:o.questions.length,timeElapsed:t,answers:l,month:n,year:i};await Xe(()=>te(c),{maxRetries:3,onRetry:(d,m)=>{g.info(`Nouvelle tentative de sauvegarde ${d}/3...`,3e3)}}),g.success("R√©sultat sauvegard√© avec succ√®s !",3e3),console.log("‚úÖ R√©sultat sauvegard√© dans Firestore")}catch(r){console.error("‚ùå Erreur lors de la sauvegarde:",r),w(),g.error("Erreur lors de la sauvegarde. Le r√©sultat sera sauvegard√© localement et synchronis√© plus tard.",8e3);try{const s=k(),n=A(),i=O(),o=E(),l={moduleId:s,moduleName:V[s]?.name||s,score:e,correctAnswers:o.filter(c=>c.isCorrect).length,totalQuestions:o.length,timeElapsed:t,answers:o,month:n,year:i},{syncQueue:a}=await v(async()=>{const{syncQueue:c}=await import("./main-BRz1ijU6.js").then(d=>d.s);return{syncQueue:c}},__vite__mapDeps([2,3,4,0,1,5]));await a.add("quizResult",async c=>{await te(c)},l),console.log("‚úÖ R√©sultat ajout√© √† la file d'attente de synchronisation")}catch(s){console.error("‚ùå Erreur ajout √† la file d'attente:",s);try{const n=`quiz_result_${Date.now()}`;localStorage.setItem(n,JSON.stringify({score:e,totalTime:t,moduleId:k(),month:A(),year:O(),userAnswers:E(),timestamp:Date.now()}))}catch(n){console.error("‚ùå Erreur sauvegarde locale de secours:",n)}}}}function Et(){w();const e=setInterval(()=>{const t=N();if(t===null)return;const r=W(),s=F(),n=H();let i=r;s&&n&&(i+=Date.now()-n);const o=Date.now()-t-i,l=Math.max(0,Math.floor(o/1e3)),a=Math.floor(l/60),c=l%60,d=document.getElementById("quiz-timer");d&&(d.textContent=`${a}:${c.toString().padStart(2,"0")}`)},1e3);fe(e)}function w(){const e=rt();e&&(clearInterval(e),fe(null)),z(null)}window.addEventListener("beforeunload",()=>{w()});document.addEventListener("visibilitychange",()=>{});async function G(){const e=E();if(e.length===0)return;const{calculateScore:t}=await v(async()=>{const{calculateScore:n}=await Promise.resolve().then(()=>Ee);return{calculateScore:n}},void 0),r=t(e),s=document.getElementById("quiz-score");s&&(s.textContent=`Score: ${r}%`)}function At(){document.body.classList.toggle("focus-mode")}function zt(){const e=document.getElementById("pause-btn");if(!e)return;if(!F())T(!0),z(Date.now()),e.setAttribute("aria-pressed","true"),e.setAttribute("aria-label","Reprendre le quiz"),e.innerHTML='<svg aria-hidden="true" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Reprendre',g.warning('Quiz en pause. Cliquez sur "Reprendre" pour continuer.',3e3);else{T(!1);const r=H();if(r){const s=W();R(s+(Date.now()-r))}z(null),e.setAttribute("aria-pressed","false"),e.setAttribute("aria-label","Mettre le quiz en pause"),e.innerHTML='<svg aria-hidden="true" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Pause',g.success("Quiz repris !",2e3)}}function be(){w();try{window.__QUIZ_ACTIVE=!1}catch{}T(!1),R(0),z(null),S(!1),document.getElementById("quiz-view")?.classList.add("view-hidden"),document.getElementById("dashboard-view")?.classList.remove("view-hidden"),document.querySelectorAll(".nav-link").forEach(e=>{e.classList.remove("bg-ap-red-dark","text-white"),e.classList.add("text-white")}),document.getElementById("nav-dashboard")?.classList.add("bg-ap-red-dark","text-white"),g.info("Retour au tableau de bord",2e3),setTimeout(()=>window.location.reload(),500)}function qt(e){if(!e||e.length===0)return 0;const t=e.filter(s=>s.isCorrect).length,r=Math.round(t/e.length*100);return isNaN(r)||r<0||r>100?(console.error("‚ùå Score invalide calcul√©:",r),0):r}function kt(e,t,r=null){return e<t?r!==null?"completed":"incomplete":e===t?"active":"locked"}const Ee=Object.freeze(Object.defineProperty({__proto__:null,calculateScore:qt,getMonthlyQuizStatus:kt},Symbol.toStringTag,{value:"Module"}));export{St as a,pt as b,Ee as q,Rt as s,Qe as t};
//# sourceMappingURL=quiz-MXwz6Ea-.js.map
