import{t as D,n as p,w as s,x as r,z as R,y as $}from"./auth-BI1mSI3H.js";import{s as k,d as T}from"./skeleton-bh2HAV7A.js";import{getDocs as w,query as x,collection as f,where as C,orderBy as j,addDoc as U,deleteDoc as M,doc as S}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";let a=[],u=[],m=!1;const N={guides:{name:"Guides",icon:"üìñ",color:"blue"},manuels:{name:"Manuels",icon:"üìã",color:"green"},reglements:{name:"R√®glements",icon:"üõ°Ô∏è",color:"orange"},formulaires:{name:"Formulaires",icon:"üìù",color:"purple"},videos:{name:"Vid√©os",icon:"üé•",color:"red"}},V={tous:"Tous les modules",auto:"AT-AVE-AVEX",loisir:"VTT, Motoneige, etc.",vr:"V√©hicules R√©cr√©atifs",tracteur:"√âquipement Agricole"};document.addEventListener("DOMContentLoaded",async()=>{D(async e=>{if(!e){window.location.href="/index.html";return}F(e),await q(e.uid),await h()}),document.getElementById("logout-btn")?.addEventListener("click",I),document.getElementById("signout-link")?.addEventListener("click",I),document.getElementById("search-input")?.addEventListener("input",g),document.getElementById("filter-category")?.addEventListener("change",g),document.getElementById("filter-module")?.addEventListener("change",g),document.getElementById("reset-filters-btn")?.addEventListener("click",z),document.getElementById("upload-btn")?.addEventListener("click",H),document.getElementById("cancel-upload-btn")?.addEventListener("click",L),document.getElementById("upload-form")?.addEventListener("submit",O)});function F(e){document.getElementById("user-name")&&(document.getElementById("user-name").textContent=e.displayName||e.email),document.getElementById("user-photo")&&(document.getElementById("user-photo").src=e.photoURL||`https://ui-avatars.com/api/?name=${encodeURIComponent(e.displayName||e.email)}`),document.getElementById("user-display-name")&&(document.getElementById("user-display-name").textContent=e.displayName||e.email),document.getElementById("user-avatar")&&(document.getElementById("user-avatar").src=e.photoURL||`https://ui-avatars.com/api/?name=${encodeURIComponent(e.displayName||e.email)}`)}async function q(e){try{const t=await w(x(f(p,"users"),C("uid","==",e)));t.empty||(m=t.docs[0].data().role==="admin",m&&(document.getElementById("admin-section")?.classList.remove("hidden"),document.getElementById("nav-admin-item")?.classList.remove("hidden"),document.getElementById("admin-badge-nav")?.classList.remove("hidden")))}catch(t){console.error("Erreur lors de la v√©rification du r√¥le:",t)}}async function h(){console.log("üì• Chargement des ressources...");try{document.getElementById("resources-container")&&k("resources-container",T(6));const t=x(f(p,"resources"),j("createdAt","desc")),o=await w(t);a=[],o.forEach(n=>{a.push({id:n.id,...n.data(),createdAt:n.data().createdAt?.toDate()})}),console.log(`‚úÖ ${a.length} ressources charg√©es`),a.length===0?y():(u=[...a],v()),document.getElementById("resources-loading")?.classList.add("hidden")}catch(e){console.error("‚ùå Erreur lors du chargement des ressources:",e),s.error("Erreur lors du chargement des ressources"),y(),document.getElementById("resources-loading")?.classList.add("hidden")}}function v(){const e=document.getElementById("resources-container");if(e.classList.remove("hidden"),u.length===0){y();return}document.getElementById("no-resources")?.classList.add("hidden"),e.innerHTML=u.map(t=>{const o=N[t.category]||{name:t.category,icon:"üìÑ",color:"gray"},n=t.createdAt?new Date(t.createdAt).toLocaleDateString("fr-FR"):"Date inconnue",d=r(t.title||""),c=r(t.description||"Aucune description"),l=r(o.name),i=r(V[t.module]||t.module||""),b=r(n),A=r(t.id),E=r(t.url||"#"),B=t.downloads?r(String(t.downloads)):"";return`
            <div class="file-card bg-white rounded-xl shadow-md hover:shadow-xl transition-all overflow-hidden fade-in">
                <div class="p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div class="file-icon text-4xl">${o.icon}</div>
                        ${m?`
                            <button onclick="deleteResource('${A}')" class="text-red-600 hover:text-red-800 transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        `:""}
                    </div>
                    
                    <h3 class="text-lg font-bold text-slate-900 mb-2">${d}</h3>
                    <p class="text-sm text-slate-600 mb-4 line-clamp-2">${c}</p>
                    
                    <div class="flex flex-wrap gap-2 mb-4">
                        <span class="px-3 py-1 bg-${o.color}-100 text-${o.color}-700 text-xs font-medium rounded-full">
                            ${l}
                        </span>
                        <span class="px-3 py-1 bg-slate-100 text-slate-700 text-xs font-medium rounded-full">
                            ${i}
                        </span>
                    </div>
                    
                    <div class="flex items-center justify-between text-xs text-slate-500 mb-4">
                        <span>üìÖ ${b}</span>
                        ${B?`<span>‚¨áÔ∏è ${B} t√©l√©chargements</span>`:""}
                    </div>
                    
                    <div class="flex gap-2">
                        <a href="${E}" target="_blank" rel="noopener noreferrer" 
                           class="flex-1 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors font-medium text-center text-sm">
                            üì• T√©l√©charger
                        </a>
                        <a href="${E}" target="_blank" rel="noopener noreferrer" 
                           class="px-4 py-2 border-2 border-indigo-600 text-indigo-600 rounded-lg hover:bg-indigo-50 transition-colors font-medium text-center text-sm">
                            üëÅÔ∏è
                        </a>
                    </div>
                </div>
            </div>
        `}).join("")}function g(){const e=document.getElementById("search-input").value.toLowerCase(),t=document.getElementById("filter-category").value,o=document.getElementById("filter-module").value;u=a.filter(n=>{const d=!e||n.title.toLowerCase().includes(e)||n.description&&n.description.toLowerCase().includes(e),c=!t||n.category===t,l=!o||n.module===o;return d&&c&&l}),v()}function z(){document.getElementById("search-input").value="",document.getElementById("filter-category").value="",document.getElementById("filter-module").value="",u=[...a],v()}window.filterByCategory=function(e){document.getElementById("filter-category").value=e,g()};function H(){document.getElementById("upload-modal")?.classList.remove("hidden")}function L(){document.getElementById("upload-modal")?.classList.add("hidden"),document.getElementById("upload-form")?.reset()}async function O(e){if(e.preventDefault(),!m){s.error("Acc√®s refus√© : vous devez √™tre administrateur");return}const t=document.getElementById("doc-title").value,o=document.getElementById("doc-description").value,n=document.getElementById("doc-category").value,d=document.getElementById("doc-module").value,c=document.getElementById("doc-url").value;if(!t||!n||!d||!c){s.error("Veuillez remplir tous les champs obligatoires");return}const l=s.showLoadingToast("Ajout du document...");try{console.log("üì§ Ajout d'une nouvelle ressource...");const i=R();await U(f(p,"resources"),{title:t,description:o,category:n,module:d,url:c,downloads:0,createdAt:new Date,createdBy:i.uid}),console.log("‚úÖ Ressource ajout√©e avec succ√®s"),s.updateLoadingToast(l,"Document ajout√© avec succ√®s !","success"),L(),await h()}catch(i){console.error("‚ùå Erreur lors de l'ajout de la ressource:",i),s.updateLoadingToast(l,"Erreur d'ajout","error"),s.error("Erreur lors de l'ajout du document",4e3)}}window.deleteResource=async function(e){if(!m){s.error("Acc√®s refus√©");return}if(!confirm("Voulez-vous vraiment supprimer ce document ?")){s.info("Suppression annul√©e",2e3);return}const t=s.showLoadingToast("Suppression du document...");try{console.log("üóëÔ∏è Suppression de la ressource:",e),await M(S(p,"resources",e)),console.log("‚úÖ Ressource supprim√©e"),s.updateLoadingToast(t,"Document supprim√© avec succ√®s !","success"),await h()}catch(o){console.error("‚ùå Erreur lors de la suppression:",o),s.updateLoadingToast(t,"Erreur de suppression","error"),s.error("Erreur lors de la suppression",4e3)}};function y(){document.getElementById("resources-container")?.classList.add("hidden"),document.getElementById("no-resources")?.classList.remove("hidden")}async function I(){try{await $(),window.location.href="/"}catch(e){console.error("Erreur lors de la d√©connexion:",e)}}
//# sourceMappingURL=resources-BSs6rBl9.js.map
