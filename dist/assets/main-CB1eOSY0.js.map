{"version":3,"mappings":"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","names":["DB_NAME","DB_VERSION","STORE_NAME","db","initDB","resolve","reject","request","event","database","store","SyncQueue","type","operation","data","queueItem","id","getRequest","item","updateRequest","error","operationHandlers","pendingItems","successCount","failedCount","handler","items","stats","i","sevenDaysAgo","deletedCount","cursor","listener","syncQueue","OfflineManager","response","toast","saveQuizResult","__vitePreload","n","result","initIndexPage","googleBtn","handleGoogleSignIn","loadingToast","showLoadingToast","user","signInWithGoogle","updateLoadingToast","errorMessage","observer","mainContent","currentMonthIndex","getCurrentMonthIndex","MONTH_NAMES_IMPORTED","MONTH_NAMES","stateManager","name","views","elements","showView","viewId","view","forceWhiteBackground","updateActiveNavLink","navId","link","activeLink","createCompletedCard","month","score","style","safeMonth","escapeHtml","safeScore","createLockedCard","createIncompleteCard","createActiveCard","createHeroCard","completedCount","annualProgressPercent","calculateStreak","monthsData","streak","loadDashboardData","getCurrentUserUnified","userProfile","getUserProfile","showAdminUIIfAdmin","progress","getAnnualProgress","currentYear","getCurrentYear","index","monthKey","normalizeMonthFormat","updateStreak","streakCountElement","initializeDashboard","getMonthlyQuizStatus","currentMonthsData","heroCardInserted","activeMonthName","status","heroCardHtml","cardHtml","streakBadge","initializeDashboardEventDelegation","createSkillsRadarChart","createScoresTrendChart","createActivityHeatmap","ctx","completedMonths","m","value","context","container","weeksInYear","daysInWeek","heatmapHTML","week","day","dayIndex","intensity","navigationListenersAttached","attachNavigationListeners","e","activeMonth","target","moduleCard","module","startQuiz","updateUserProfile","firstName","monthName","initializeTheme","savedTheme","updateThemeButton","theme","sunIcon","moonIcon","themeText","toggleTheme","newTheme","themeBtn","isDark","trackPageView","signOutUser","onAuthChange"],"ignoreList":[],"sources":["../../js/sync-queue.js","../../js/offline-manager.js","../../js/index-init.js","../../js/dashboard.js"],"sourcesContent":["/**\r\n * File d'attente globale pour synchronisation offline\r\n * \r\n * ‚úÖ CORRECTION SECTION 8 : Gestion Offline Compl√®te\r\n * \r\n * G√®re toutes les op√©rations Firestore en file d'attente avec IndexedDB\r\n * pour la persistance et la synchronisation automatique √† la reconnexion.\r\n */\r\n\r\nconst DB_NAME = 'avantage-quizz-sync';\r\nconst DB_VERSION = 1;\r\nconst STORE_NAME = 'sync-queue';\r\n\r\nlet db = null;\r\n\r\n/**\r\n * Initialiser IndexedDB\r\n */\r\nasync function initDB() {\r\n    if (db) return db;\r\n    \r\n    return new Promise((resolve, reject) => {\r\n        const request = indexedDB.open(DB_NAME, DB_VERSION);\r\n        \r\n        request.onerror = () => reject(request.error);\r\n        request.onsuccess = () => {\r\n            db = request.result;\r\n            resolve(db);\r\n        };\r\n        \r\n        request.onupgradeneeded = (event) => {\r\n            const database = event.target.result;\r\n            if (!database.objectStoreNames.contains(STORE_NAME)) {\r\n                const store = database.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });\r\n                store.createIndex('timestamp', 'timestamp', { unique: false });\r\n                store.createIndex('type', 'type', { unique: false });\r\n                store.createIndex('status', 'status', { unique: false });\r\n            }\r\n        };\r\n    });\r\n}\r\n\r\n/**\r\n * Classe pour g√©rer la file d'attente de synchronisation\r\n */\r\nclass SyncQueue {\r\n    constructor() {\r\n        this.isProcessing = false;\r\n        this.listeners = new Set();\r\n    }\r\n    \r\n    /**\r\n     * Ajouter une op√©ration √† la file d'attente\r\n     * @param {string} type - Type d'op√©ration (quizResult, userUpdate, etc.)\r\n     * @param {Function} operation - Fonction async √† ex√©cuter\r\n     * @param {Object} data - Donn√©es √† sauvegarder\r\n     * @returns {Promise<string>} ID de l'op√©ration\r\n     */\r\n    async add(type, operation, data = {}) {\r\n        await initDB();\r\n        \r\n        const queueItem = {\r\n            type,\r\n            operation: this.serializeOperation(operation),\r\n            data,\r\n            timestamp: Date.now(),\r\n            status: 'pending',\r\n            retries: 0,\r\n            maxRetries: 3\r\n        };\r\n        \r\n        return new Promise((resolve, reject) => {\r\n            const transaction = db.transaction([STORE_NAME], 'readwrite');\r\n            const store = transaction.objectStore(STORE_NAME);\r\n            const request = store.add(queueItem);\r\n            \r\n            request.onsuccess = () => {\r\n                const id = request.result;\r\n                console.log(`üì• Op√©ration ajout√©e √† la file d'attente: ${type} (ID: ${id})`);\r\n                this.notifyListeners('added', { id, type });\r\n                resolve(id);\r\n            };\r\n            \r\n            request.onerror = () => reject(request.error);\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * S√©rialiser une fonction pour le stockage (limitation : on stocke seulement les donn√©es)\r\n     * Note: Les fonctions ne peuvent pas √™tre s√©rialis√©es, donc on stocke les donn√©es\r\n     * et on reconstruit l'op√©ration lors du traitement\r\n     */\r\n    serializeOperation(operation) {\r\n        // On ne peut pas s√©rialiser une fonction, donc on stocke les m√©tadonn√©es\r\n        // L'op√©ration sera reconstruite lors du traitement bas√© sur le type\r\n        return {\r\n            name: operation.name || 'anonymous',\r\n            // On stocke les param√®tres n√©cessaires pour reconstruire l'op√©ration\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Obtenir toutes les op√©rations en attente\r\n     */\r\n    async getAll() {\r\n        await initDB();\r\n        \r\n        return new Promise((resolve, reject) => {\r\n            const transaction = db.transaction([STORE_NAME], 'readonly');\r\n            const store = transaction.objectStore(STORE_NAME);\r\n            const index = store.index('status');\r\n            const request = index.getAll('pending');\r\n            \r\n            request.onsuccess = () => resolve(request.result);\r\n            request.onerror = () => reject(request.error);\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Marquer une op√©ration comme compl√©t√©e\r\n     */\r\n    async markCompleted(id) {\r\n        await initDB();\r\n        \r\n        return new Promise((resolve, reject) => {\r\n            const transaction = db.transaction([STORE_NAME], 'readwrite');\r\n            const store = transaction.objectStore(STORE_NAME);\r\n            const getRequest = store.get(id);\r\n            \r\n            getRequest.onsuccess = () => {\r\n                const item = getRequest.result;\r\n                if (item) {\r\n                    item.status = 'completed';\r\n                    const updateRequest = store.put(item);\r\n                    updateRequest.onsuccess = () => {\r\n                        console.log(`‚úÖ Op√©ration compl√©t√©e: ${item.type} (ID: ${id})`);\r\n                        this.notifyListeners('completed', { id, type: item.type });\r\n                        resolve();\r\n                    };\r\n                    updateRequest.onerror = () => reject(updateRequest.error);\r\n                } else {\r\n                    resolve();\r\n                }\r\n            };\r\n            \r\n            getRequest.onerror = () => reject(getRequest.error);\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Marquer une op√©ration comme √©chou√©e\r\n     */\r\n    async markFailed(id, error) {\r\n        await initDB();\r\n        \r\n        return new Promise((resolve, reject) => {\r\n            const transaction = db.transaction([STORE_NAME], 'readwrite');\r\n            const store = transaction.objectStore(STORE_NAME);\r\n            const getRequest = store.get(id);\r\n            \r\n            getRequest.onsuccess = () => {\r\n                const item = getRequest.result;\r\n                if (item) {\r\n                    item.retries++;\r\n                    if (item.retries >= item.maxRetries) {\r\n                        item.status = 'failed';\r\n                        item.error = error?.message || 'Unknown error';\r\n                    } else {\r\n                        item.status = 'pending'; // R√©essayer\r\n                    }\r\n                    const updateRequest = store.put(item);\r\n                    updateRequest.onsuccess = () => {\r\n                        if (item.status === 'failed') {\r\n                            console.error(`‚ùå Op√©ration √©chou√©e d√©finitivement: ${item.type} (ID: ${id})`);\r\n                            this.notifyListeners('failed', { id, type: item.type, error });\r\n                        } else {\r\n                            console.warn(`‚ö†Ô∏è Op√©ration √©chou√©e, r√©essai ${item.retries}/${item.maxRetries}: ${item.type} (ID: ${id})`);\r\n                        }\r\n                        resolve();\r\n                    };\r\n                    updateRequest.onerror = () => reject(updateRequest.error);\r\n                } else {\r\n                    resolve();\r\n                }\r\n            };\r\n            \r\n            getRequest.onerror = () => reject(getRequest.error);\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Supprimer une op√©ration de la file\r\n     */\r\n    async remove(id) {\r\n        await initDB();\r\n        \r\n        return new Promise((resolve, reject) => {\r\n            const transaction = db.transaction([STORE_NAME], 'readwrite');\r\n            const store = transaction.objectStore(STORE_NAME);\r\n            const request = store.delete(id);\r\n            \r\n            request.onsuccess = () => {\r\n                console.log(`üóëÔ∏è Op√©ration supprim√©e: ID ${id}`);\r\n                resolve();\r\n            };\r\n            \r\n            request.onerror = () => reject(request.error);\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Traiter toutes les op√©rations en attente\r\n     * @param {Object} operationHandlers - Map des handlers par type d'op√©ration\r\n     */\r\n    async processQueue(operationHandlers = {}) {\r\n        if (this.isProcessing) {\r\n            console.log('‚è≥ Traitement d√©j√† en cours...');\r\n            return;\r\n        }\r\n        \r\n        if (!navigator.onLine) {\r\n            console.log('üì¥ Hors ligne, synchronisation report√©e');\r\n            return;\r\n        }\r\n        \r\n        this.isProcessing = true;\r\n        console.log('üîÑ D√©but du traitement de la file d\\'attente...');\r\n        \r\n        try {\r\n            const pendingItems = await this.getAll();\r\n            \r\n            if (pendingItems.length === 0) {\r\n                console.log('‚úÖ Aucune op√©ration en attente');\r\n                this.isProcessing = false;\r\n                return { success: 0, failed: 0 };\r\n            }\r\n            \r\n            console.log(`üìã ${pendingItems.length} op√©ration(s) en attente`);\r\n            \r\n            let successCount = 0;\r\n            let failedCount = 0;\r\n            \r\n            for (const item of pendingItems) {\r\n                try {\r\n                    // Reconstruire l'op√©ration bas√©e sur le type\r\n                    const handler = operationHandlers[item.type];\r\n                    if (!handler) {\r\n                        console.warn(`‚ö†Ô∏è Aucun handler pour le type: ${item.type}`);\r\n                        await this.markFailed(item.id, new Error(`No handler for type: ${item.type}`));\r\n                        failedCount++;\r\n                        continue;\r\n                    }\r\n                    \r\n                    // Ex√©cuter l'op√©ration\r\n                    await handler(item.data);\r\n                    \r\n                    // Marquer comme compl√©t√©e et supprimer\r\n                    await this.markCompleted(item.id);\r\n                    await this.remove(item.id);\r\n                    successCount++;\r\n                    \r\n                } catch (error) {\r\n                    console.error(`‚ùå Erreur traitement op√©ration ${item.id}:`, error);\r\n                    await this.markFailed(item.id, error);\r\n                    failedCount++;\r\n                }\r\n            }\r\n            \r\n            console.log(`‚úÖ Traitement termin√©: ${successCount} r√©ussies, ${failedCount} √©chou√©es`);\r\n            this.notifyListeners('processed', { success: successCount, failed: failedCount });\r\n            \r\n            return { success: successCount, failed: failedCount };\r\n            \r\n        } catch (error) {\r\n            console.error('‚ùå Erreur traitement file d\\'attente:', error);\r\n            throw error;\r\n        } finally {\r\n            this.isProcessing = false;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Obtenir les statistiques de la file\r\n     */\r\n    async getStats() {\r\n        await initDB();\r\n        \r\n        return new Promise((resolve, reject) => {\r\n            const transaction = db.transaction([STORE_NAME], 'readonly');\r\n            const store = transaction.objectStore(STORE_NAME);\r\n            const request = store.getAll();\r\n            \r\n            request.onsuccess = () => {\r\n                const items = request.result;\r\n                const stats = {\r\n                    total: items.length,\r\n                    pending: items.filter(i => i.status === 'pending').length,\r\n                    completed: items.filter(i => i.status === 'completed').length,\r\n                    failed: items.filter(i => i.status === 'failed').length\r\n                };\r\n                resolve(stats);\r\n            };\r\n            \r\n            request.onerror = () => reject(request.error);\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Nettoyer les op√©rations compl√©t√©es (plus de 7 jours)\r\n     */\r\n    async cleanCompleted() {\r\n        await initDB();\r\n        \r\n        const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);\r\n        \r\n        return new Promise((resolve, reject) => {\r\n            const transaction = db.transaction([STORE_NAME], 'readwrite');\r\n            const store = transaction.objectStore(STORE_NAME);\r\n            const index = store.index('timestamp');\r\n            const request = index.openCursor();\r\n            \r\n            let deletedCount = 0;\r\n            \r\n            request.onsuccess = (event) => {\r\n                const cursor = event.target.result;\r\n                if (cursor) {\r\n                    const item = cursor.value;\r\n                    if (item.status === 'completed' && item.timestamp < sevenDaysAgo) {\r\n                        cursor.delete();\r\n                        deletedCount++;\r\n                    }\r\n                    cursor.continue();\r\n                } else {\r\n                    console.log(`üßπ ${deletedCount} op√©ration(s) compl√©t√©e(s) nettoy√©e(s)`);\r\n                    resolve(deletedCount);\r\n                }\r\n            };\r\n            \r\n            request.onerror = () => reject(request.error);\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * S'abonner aux √©v√©nements de la file\r\n     */\r\n    subscribe(listener) {\r\n        this.listeners.add(listener);\r\n        return () => this.listeners.delete(listener);\r\n    }\r\n    \r\n    /**\r\n     * Notifier les listeners\r\n     */\r\n    notifyListeners(event, data) {\r\n        this.listeners.forEach(listener => {\r\n            try {\r\n                listener(event, data);\r\n            } catch (error) {\r\n                console.error('Erreur listener:', error);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n// Instance singleton\r\nexport const syncQueue = new SyncQueue();\r\n\r\n// Initialiser au chargement\r\ninitDB().catch(error => {\r\n    console.error('‚ùå Erreur initialisation IndexedDB:', error);\r\n});\r\n\r\n","/**\r\n * Gestionnaire de d√©tection offline/online\r\n * \r\n * ‚úÖ CORRECTION SECTION 8 : Gestion Offline Compl√®te\r\n * \r\n * D√©tecte l'√©tat de connexion et affiche des notifications/indicateurs visuels\r\n */\r\n\r\nimport { toast } from './toast.js';\r\nimport { syncQueue } from './sync-queue.js';\r\n\r\nclass OfflineManager {\r\n    constructor() {\r\n        this.isOnline = navigator.onLine;\r\n        this.listeners = new Set();\r\n        this.indicatorElement = null;\r\n        this.setupEventListeners();\r\n        this.createIndicator();\r\n    }\r\n    \r\n    /**\r\n     * Configurer les event listeners pour online/offline\r\n     */\r\n    setupEventListeners() {\r\n        window.addEventListener('online', () => this.handleOnline());\r\n        window.addEventListener('offline', () => this.handleOffline());\r\n        \r\n        // V√©rifier p√©riodiquement (toutes les 30 secondes)\r\n        setInterval(() => this.checkConnection(), 30000);\r\n    }\r\n    \r\n    /**\r\n     * V√©rifier manuellement la connexion\r\n     */\r\n    async checkConnection() {\r\n        try {\r\n            // Tenter une requ√™te l√©g√®re vers Firebase\r\n            const response = await fetch('https://firestore.googleapis.com', { \r\n                method: 'HEAD',\r\n                mode: 'no-cors',\r\n                cache: 'no-cache'\r\n            });\r\n            \r\n            if (!this.isOnline) {\r\n                this.handleOnline();\r\n            }\r\n        } catch (error) {\r\n            if (this.isOnline) {\r\n                this.handleOffline();\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * G√©rer le passage en ligne\r\n     */\r\n    async handleOnline() {\r\n        if (this.isOnline) return; // D√©j√† en ligne\r\n        \r\n        this.isOnline = true;\r\n        console.log('üåê Connexion r√©tablie');\r\n        \r\n        this.updateIndicator();\r\n        this.notifyListeners('online');\r\n        \r\n        // Afficher notification\r\n        toast.success('Connexion r√©tablie. Synchronisation en cours...', 3000);\r\n        \r\n        // Synchroniser la file d'attente\r\n        try {\r\n            // Import dynamique pour √©viter d√©pendance circulaire\r\n            const { saveQuizResult } = await import('./firestore-service.js');\r\n            \r\n            const stats = await syncQueue.getStats();\r\n            if (stats.pending > 0) {\r\n                console.log(`üì§ Synchronisation de ${stats.pending} op√©ration(s) en attente...`);\r\n                \r\n                // D√©finir les handlers pour chaque type d'op√©ration\r\n                const operationHandlers = {\r\n                    quizResult: async (data) => {\r\n                        await saveQuizResult(data);\r\n                    },\r\n                    // Ajouter d'autres types si n√©cessaire\r\n                };\r\n                \r\n                const result = await syncQueue.processQueue(operationHandlers);\r\n                \r\n                if (result.success > 0) {\r\n                    toast.success(`${result.success} op√©ration(s) synchronis√©e(s) avec succ√®s`, 3000);\r\n                }\r\n                if (result.failed > 0) {\r\n                    toast.warning(`${result.failed} op√©ration(s) n'ont pas pu √™tre synchronis√©es`, 3000);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('‚ùå Erreur synchronisation:', error);\r\n            toast.error('Erreur lors de la synchronisation', 3000);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * G√©rer le passage hors ligne\r\n     */\r\n    handleOffline() {\r\n        if (!this.isOnline) return; // D√©j√† hors ligne\r\n        \r\n        this.isOnline = false;\r\n        console.log('üì¥ Connexion perdue');\r\n        \r\n        this.updateIndicator();\r\n        this.notifyListeners('offline');\r\n        \r\n        // Afficher notification\r\n        toast.warning('Connexion perdue. Les donn√©es seront sauvegard√©es localement.', 5000);\r\n    }\r\n    \r\n    /**\r\n     * Cr√©er l'indicateur visuel de connexion\r\n     */\r\n    createIndicator() {\r\n        // Cr√©er l'√©l√©ment indicateur\r\n        this.indicatorElement = document.createElement('div');\r\n        this.indicatorElement.id = 'offline-indicator';\r\n        this.indicatorElement.className = 'fixed bottom-4 right-4 z-50 flex items-center gap-2 px-4 py-2 rounded-lg shadow-lg transition-all duration-300';\r\n        this.indicatorElement.style.display = 'none';\r\n        \r\n        // Ajouter au body\r\n        document.body.appendChild(this.indicatorElement);\r\n        \r\n        // Mettre √† jour l'apparence initiale\r\n        this.updateIndicator();\r\n    }\r\n    \r\n    /**\r\n     * Mettre √† jour l'indicateur visuel\r\n     */\r\n    updateIndicator() {\r\n        if (!this.indicatorElement) return;\r\n        \r\n        if (this.isOnline) {\r\n            this.indicatorElement.style.display = 'none';\r\n        } else {\r\n            this.indicatorElement.style.display = 'flex';\r\n            this.indicatorElement.className = 'fixed bottom-4 right-4 z-50 flex items-center gap-2 px-4 py-2 rounded-lg shadow-lg bg-yellow-500 text-white transition-all duration-300';\r\n            this.indicatorElement.innerHTML = `\r\n                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414\"></path>\r\n                </svg>\r\n                <span class=\"text-sm font-medium\">Mode hors ligne</span>\r\n            `;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Obtenir l'√©tat actuel\r\n     */\r\n    getStatus() {\r\n        return {\r\n            isOnline: this.isOnline,\r\n            timestamp: Date.now()\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * S'abonner aux changements d'√©tat\r\n     */\r\n    subscribe(listener) {\r\n        this.listeners.add(listener);\r\n        return () => this.listeners.delete(listener);\r\n    }\r\n    \r\n    /**\r\n     * Notifier les listeners\r\n     */\r\n    notifyListeners(event) {\r\n        this.listeners.forEach(listener => {\r\n            try {\r\n                listener(event, this.getStatus());\r\n            } catch (error) {\r\n                console.error('Erreur listener offline:', error);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n// Instance singleton\r\nexport const offlineManager = new OfflineManager();\r\n\r\n// Exporter une fonction utilitaire pour v√©rifier l'√©tat\r\nexport function isOnline() {\r\n    return offlineManager.isOnline;\r\n}\r\n\r\n// Exporter une fonction pour attendre la reconnexion\r\nexport function waitForOnline() {\r\n    return new Promise((resolve) => {\r\n        if (offlineManager.isOnline) {\r\n            resolve();\r\n            return;\r\n        }\r\n        \r\n        const unsubscribe = offlineManager.subscribe((event) => {\r\n            if (event === 'online') {\r\n                unsubscribe();\r\n                resolve();\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n","// Initialisation de la page d'accueil (index.html)\r\nimport { signInWithGoogle } from './auth.js';\r\nimport { showErrorToast, showSuccessToast, showLoadingToast, updateLoadingToast } from './toast.js';\r\n// Import des gestionnaires d'erreurs centralis√©s (Section 1 - Architecture)\r\nimport { errorHandler, withErrorHandling } from './error-handler.js';\r\nimport { withRetry, withFirestoreRetry } from './retry-handler.js';\r\n// ‚úÖ CORRECTION SECTION 8 : Gestion Offline Compl√®te\r\nimport { offlineManager } from './offline-manager.js';\r\n\r\nconsole.log('Initialisation de la page d accueil...');\r\n\r\n// Attendre que le DOM soit charg√©\r\ndocument.addEventListener('DOMContentLoaded', initIndexPage);\r\n\r\nfunction initIndexPage() {\r\n    console.log('üìÑ DOM charg√© - configuration du bouton de connexion...');\r\n    \r\n    // Bouton Google Sign-In\r\n    const googleBtn = document.getElementById('google-signin-btn');\r\n    if (googleBtn) {\r\n        googleBtn.addEventListener('click', handleGoogleSignIn);\r\n        console.log('‚úÖ Bouton Google configur√©');\r\n    } else {\r\n        console.warn('‚ö†Ô∏è Bouton Google non trouv√©');\r\n    }\r\n}\r\n\r\n/**\r\n * Handler pour le bouton Google Sign-In\r\n */\r\nasync function handleGoogleSignIn() {\r\n    console.log('üîê Clic sur connexion Google...');\r\n    \r\n    const loadingToast = showLoadingToast('Connexion en cours...');\r\n    \r\n    try {\r\n        const user = await signInWithGoogle();\r\n        \r\n    // Succ√®s\r\n    updateLoadingToast(loadingToast, `Bienvenue ${user.displayName} !`, 'success');\r\n        \r\n        // Recharger la page pour que le dashboard d√©tecte l'utilisateur connect√©\r\n        setTimeout(() => {\r\n            window.location.reload();\r\n        }, 800);\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur connexion Google:', error);\r\n        \r\n        // Messages d'erreur personnalis√©s\r\n        let errorMessage = 'Erreur lors de la connexion';\r\n        \r\n        if (error.code === 'auth/popup-closed-by-user') {\r\n            errorMessage = 'Connexion annul√©e';\r\n        } else if (error.code === 'auth/popup-blocked') {\r\n            errorMessage = 'Pop-up bloqu√©e. Autorisez les pop-ups.';\r\n        } else if (error.code === 'auth/unauthorized-domain') {\r\n            errorMessage = 'Domaine non autoris√© dans Firebase';\r\n        } else if (error.code === 'auth/network-request-failed') {\r\n            errorMessage = 'Erreur r√©seau. V√©rifiez votre connexion.';\r\n        }\r\n        \r\n    updateLoadingToast(loadingToast, errorMessage, 'error');\r\n    }\r\n}\r\n\r\n// Export pour tests\r\nexport { handleGoogleSignIn };\r\n","// Dashboard principal - Gestion de l'interface QuizPro\r\n\r\n// ‚úÖ CORRECTION FOND JAUNE: Forcer le background blanc IMM√âDIATEMENT (avant m√™me le chargement du DOM)\r\n(function() {\r\n    'use strict';\r\n    // Ex√©cuter imm√©diatement, m√™me si le DOM n'est pas encore charg√©\r\n    if (document.documentElement) {\r\n        document.documentElement.style.setProperty('background', '#F9FAFB', 'important');\r\n        document.documentElement.style.setProperty('background-color', '#F9FAFB', 'important');\r\n        document.documentElement.style.setProperty('background-image', 'none', 'important');\r\n    }\r\n    if (document.body) {\r\n        document.body.style.setProperty('background', '#F9FAFB', 'important');\r\n        document.body.style.setProperty('background-color', '#F9FAFB', 'important');\r\n        document.body.style.setProperty('background-image', 'none', 'important');\r\n    }\r\n    // Observer pour forcer le blanc d√®s que main-content existe\r\n    const observer = new MutationObserver(() => {\r\n        const mainContent = document.getElementById('main-content');\r\n        if (mainContent) {\r\n            mainContent.style.setProperty('background', '#F9FAFB', 'important');\r\n            mainContent.style.setProperty('background-color', '#F9FAFB', 'important');\r\n            mainContent.style.setProperty('background-image', 'none', 'important');\r\n        }\r\n    });\r\n    if (document.body) {\r\n        observer.observe(document.body, { childList: true, subtree: true });\r\n    }\r\n})();\r\n\r\nimport { onAuthChange, signInWithGoogle, signOutUser, getCurrentUserUnified, showAdminUIIfAdmin } from './auth.js';\r\nimport { startQuiz } from './quiz.js';\r\nimport { \r\n    getUserProfile, \r\n    getAnnualProgress, \r\n    getUserQuizResults,\r\n    updateStreak\r\n} from './firestore-service.js';\r\n// Import des utilitaires de mois (Section 2 - Correction logique mensuelle)\r\nimport { MONTH_NAMES, getCurrentMonthIndex, getCurrentYear, normalizeMonthFormat } from './month-utils.js';\r\n// ‚úÖ CORRECTION SECTION 4 : Protection XSS\r\nimport { escapeHtml } from './security.js';\r\n// ‚úÖ CORRECTION SECTION 5 : StateManager - Centralisation des variables globales\r\nimport { stateManager } from './state-manager.js';\r\n// ‚úÖ CORRECTION SECTION 9 : Analytics\r\nimport { trackPageView } from './analytics.js';\r\n\r\n// --- CONSTANTES GLOBALES ---\r\n// ‚úÖ CORRECTION SECTION 2 : Utilise la date r√©elle au lieu d'une valeur hardcod√©e\r\nconst currentMonthIndex = getCurrentMonthIndex(); // 0-11, change automatiquement chaque mois\r\nconst MONTH_NAMES_IMPORTED = MONTH_NAMES; // Alias pour compatibilit√©\r\n\r\n// ‚úÖ CORRECTION SECTION 5 : StateManager - Initialiser monthsData dans le StateManager\r\n// Donn√©es des mois (sera remplac√© par les donn√©es Firebase)\r\nstateManager.set('monthsData', MONTH_NAMES_IMPORTED.map(name => ({ name, score: null })));\r\nstateManager.set('currentMonthIndex', currentMonthIndex);\r\n\r\n// --- √âL√âMENTS DOM ---\r\nconst views = {\r\n    login: document.getElementById('login-view'),\r\n    dashboard: document.getElementById('dashboard-view'),\r\n    moduleSelection: document.getElementById('module-selection-view')\r\n};\r\n\r\nconst elements = {\r\n    modulesGrid: document.getElementById('modules-grid'),\r\n    annualProgressBar: document.getElementById('annual-progress-bar'),\r\n    annualProgressText: document.getElementById('annual-progress-text'),\r\n    moduleSelectionTitle: document.getElementById('module-selection-title'),\r\n    welcomeMessage: document.getElementById('welcome-message'),\r\n    userAvatar: document.getElementById('user-avatar'),\r\n    userName: document.getElementById('user-name'),\r\n    googleSigninBtn: document.getElementById('google-signin-btn'),\r\n    signoutLink: document.getElementById('signout-link')\r\n};\r\n\r\n// ‚úÖ CORRECTION SECTION 5 : StateManager - dashboardEventDelegationAttached migr√© vers StateManager\r\nstateManager.set('dashboardEventDelegationAttached', false);\r\n\r\n// --- FONCTIONS DE NAVIGATION ---\r\n\r\nfunction showView(viewId) {\r\n    Object.values(views).forEach(view => {\r\n        if (view) view.classList.add('view-hidden');\r\n    });\r\n    if (views[viewId]) {\r\n        views[viewId].classList.remove('view-hidden');\r\n        \r\n        // ‚úÖ CORRECTION FOND BEIGE/JAUNE: Forcer le background blanc sur main-content\r\n        forceWhiteBackground();\r\n    } else {\r\n        console.error('‚ùå Vue non trouv√©e:', viewId);\r\n    }\r\n}\r\n\r\n// ‚úÖ Fonction d√©di√©e pour forcer le background blanc (r√©utilisable)\r\nfunction forceWhiteBackground() {\r\n    // Utiliser la fonction globale si elle existe (d√©finie dans index.html)\r\n    if (window.forceWhiteBackground && window.forceWhiteBackground !== forceWhiteBackground) {\r\n        window.forceWhiteBackground();\r\n        return;\r\n    }\r\n    \r\n    const mainContent = document.getElementById('main-content');\r\n    if (mainContent) {\r\n        mainContent.style.setProperty('background', '#FFFFFF', 'important');\r\n        mainContent.style.setProperty('background-color', '#FFFFFF', 'important');\r\n        mainContent.style.setProperty('background-image', 'none', 'important');\r\n    }\r\n    \r\n    // ‚úÖ Forcer aussi sur body et html pour √™tre s√ªr\r\n    document.body.style.setProperty('background', '#FFFFFF', 'important');\r\n    document.body.style.setProperty('background-color', '#FFFFFF', 'important');\r\n    document.body.style.setProperty('background-image', 'none', 'important');\r\n    \r\n    document.documentElement.style.setProperty('background', '#FFFFFF', 'important');\r\n    document.documentElement.style.setProperty('background-color', '#FFFFFF', 'important');\r\n    document.documentElement.style.setProperty('background-image', 'none', 'important');\r\n    \r\n    // ‚úÖ Supprimer toutes les classes Tailwind qui pourraient ajouter un background\r\n    if (mainContent) {\r\n        mainContent.classList.remove('bg-slate-100', 'bg-gray-100', 'bg-yellow-50', 'bg-amber-50', 'bg-ap-red-50');\r\n    }\r\n    document.body.classList.remove('bg-slate-100', 'bg-gray-100', 'bg-yellow-50', 'bg-amber-50', 'bg-ap-red-50');\r\n    document.documentElement.classList.remove('bg-slate-100', 'bg-gray-100', 'bg-yellow-50', 'bg-amber-50', 'bg-ap-red-50');\r\n}\r\n\r\nfunction updateActiveNavLink(navId) {\r\n    document.querySelectorAll('.nav-link').forEach(link => {\r\n        link.classList.remove('bg-ap-accent', 'text-white');\r\n        link.classList.add('text-ap-silver');\r\n    });\r\n    const activeLink = document.getElementById(navId);\r\n    if (activeLink) {\r\n        activeLink.classList.add('bg-ap-accent', 'text-white');\r\n        activeLink.classList.remove('text-ap-silver');\r\n    }\r\n}\r\n\r\n// --- FONCTIONS DE G√âN√âRATION DE CARTES ---\r\n\r\nfunction createProgressRing(percentage) {\r\n    const r = 54;\r\n    const c = r * 2 * Math.PI;\r\n    const offset = c - (percentage / 100) * c;\r\n\r\n    let progressColorClass = 'text-green-600';\r\n    if (percentage < 80) progressColorClass = 'text-yellow-500';\r\n    if (percentage < 60) progressColorClass = 'text-red-600';\r\n    \r\n    return `\r\n        <svg class=\"w-32 h-32\" viewBox=\"0 0 120 120\">\r\n            <circle class=\"text-gray-200\" stroke-width=\"12\" stroke=\"currentColor\" fill=\"transparent\" r=\"${r}\" cx=\"60\" cy=\"60\" />\r\n            <circle\r\n                class=\"progress-circle ${progressColorClass} transition-all duration-500\"\r\n                stroke-width=\"12\"\r\n                stroke-dasharray=\"${c}\"\r\n                stroke-dashoffset=\"${offset}\"\r\n                stroke-linecap=\"round\"\r\n                stroke=\"currentColor\"\r\n                fill=\"transparent\"\r\n                r=\"${r}\"\r\n                cx=\"60\"\r\n                cy=\"60\"\r\n                transform=\"rotate(-90 60 60)\"\r\n                style=\"stroke-dashoffset: 283;\"\r\n            />\r\n            <text x=\"50%\" y=\"50%\" text-anchor=\"middle\" dy=\".3em\" class=\"text-3xl font-bold fill-current text-slate-800\">\r\n                ${percentage}%\r\n            </text>\r\n        </svg>\r\n    `;\r\n}\r\n\r\nfunction createCompletedCard(month, score) {\r\n    // ‚úÖ AVANTAGE PLUS: Cartes compl√©t√©es en dor√©/vert\r\n    const getScoreStyle = (score) => {\r\n        if (score >= 90) return { \r\n            badgeText: 'üèÜ Excellent'\r\n        };\r\n        if (score >= 75) return { \r\n            badgeText: '‚≠ê Tr√®s bien'\r\n        };\r\n        if (score >= 60) return { \r\n            badgeText: '‚úì Bien'\r\n        };\r\n        return { \r\n            badgeText: '‚úì Passable'\r\n        };\r\n    };\r\n    \r\n    const style = getScoreStyle(score);\r\n    // ‚úÖ CORRECTION SECTION 4 : Protection XSS - √âchapper les donn√©es utilisateur\r\n    const safeMonth = escapeHtml(month);\r\n    const safeScore = escapeHtml(score);\r\n    \r\n    return `\r\n        <div class=\"module-card module-card--completed\">\r\n            <div class=\"module-card-header\">\r\n                <div class=\"module-card-icon\">\r\n                    <svg fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                        <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\" />\r\n                    </svg>\r\n                </div>\r\n                <div class=\"module-card-badge\">${style.badgeText}</div>\r\n            </div>\r\n            <h3 class=\"module-card-title\">${safeMonth}</h3>\r\n            <p class=\"module-card-subtitle\">Quiz compl√©t√©</p>\r\n            <p class=\"module-card-progress-label\">Score obtenu</p>\r\n            <div class=\"module-card-progress-bar\">\r\n                <div class=\"module-card-progress-fill\" style=\"width: ${safeScore}%\"></div>\r\n            </div>\r\n            <span class=\"text-sm font-semibold text-ap-red-dark\">Score: ${safeScore}%</span>\r\n        </div>\r\n    `;\r\n}\r\n\r\nfunction createLockedCard(month) {\r\n    // ‚úÖ AVANTAGE PLUS: Cartes verrouill√©es en gris\r\n    const safeMonth = escapeHtml(month);\r\n    \r\n    return `\r\n        <div class=\"module-card module-card--locked\">\r\n            <div class=\"module-card-header\">\r\n                <div class=\"module-card-icon\">\r\n                    <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\r\n                    </svg>\r\n                </div>\r\n                <div class=\"module-card-badge\">VERROUILL√â</div>\r\n            </div>\r\n            <h3 class=\"module-card-title\">${safeMonth}</h3>\r\n            <p class=\"module-card-subtitle\">Disponible le 1er du mois</p>\r\n            <p class=\"module-card-progress-label\">Progression</p>\r\n            <div class=\"module-card-progress-bar\">\r\n                <div class=\"module-card-progress-fill\" style=\"width: 0%\"></div>\r\n            </div>\r\n            <span class=\"text-sm text-ap-gray-600\">Pas encore accessible</span>\r\n        </div>\r\n    `;\r\n}\r\n\r\nfunction createIncompleteCard(month) {\r\n    // ‚úÖ AVANTAGE PLUS: Cartes incompl√®tes en argent/anthracite\r\n    const safeMonth = escapeHtml(month);\r\n    \r\n    return `\r\n        <div class=\"module-card module-card--incomplete\">\r\n            <div class=\"module-card-header\">\r\n                <div class=\"module-card-icon\">\r\n                    <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                    </svg>\r\n                </div>\r\n                <div class=\"module-card-badge\">√Ä COMPL√âTER</div>\r\n            </div>\r\n            <h3 class=\"module-card-title\">${safeMonth}</h3>\r\n            <p class=\"module-card-subtitle\">Mois manqu√© - Rattrapez-le !</p>\r\n            <p class=\"module-card-progress-label\">Progression</p>\r\n            <div class=\"module-card-progress-bar\">\r\n                <div class=\"module-card-progress-fill\" style=\"width: 0%\"></div>\r\n            </div>\r\n            <span class=\"text-sm font-semibold text-ap-accent-medium\">0% compl√©t√©</span>\r\n        </div>\r\n    `;\r\n}\r\n\r\nfunction createActiveCard(month) {\r\n    // ‚úÖ AVANTAGE PLUS: Carte active en rouge/dor√©\r\n    const safeMonth = escapeHtml(month);\r\n    \r\n    return `\r\n        <div class=\"module-card module-card--active\">\r\n            <div class=\"module-card-header\">\r\n                <div class=\"module-card-icon\">\r\n                    <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n                    </svg>\r\n                </div>\r\n                <div class=\"module-card-badge\">EN COURS</div>\r\n            </div>\r\n            <h3 class=\"module-card-title\">${safeMonth}</h3>\r\n            <p class=\"module-card-subtitle\">Pr√™t √† √™tre compl√©t√© !</p>\r\n            <p class=\"module-card-progress-label\">Progression</p>\r\n            <div class=\"module-card-progress-bar\">\r\n                <div class=\"module-card-progress-fill\" style=\"width: 0%\"></div>\r\n            </div>\r\n            <button class=\"start-quiz-button btn-primary w-full mt-2 flex items-center justify-center gap-2\">\r\n                <span>D√©marrer</span>\r\n                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 7l5 5m0 0l-5 5m5-5H6\"></path>\r\n                </svg>\r\n            </button>\r\n        </div>\r\n    `;\r\n}\r\n\r\nfunction createHeroCard(month, completedCount) {\r\n    // ‚úÖ HERO CARD: Carte principale avec progression annuelle int√©gr√©e\r\n    const safeMonth = escapeHtml(month);\r\n    const annualProgressPercent = (completedCount / 12) * 100;\r\n    \r\n    return `\r\n        <div class=\"module-card module-card--active\" style=\"grid-column: 1 / -1;\">\r\n            <div class=\"module-card-header\">\r\n                <div class=\"module-card-icon\">\r\n                    <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n                    </svg>\r\n                </div>\r\n                <div class=\"module-card-badge\">QUIZ MENSUEL DISPONIBLE</div>\r\n            </div>\r\n            <div style=\"display: flex; flex-direction: row; gap: 24px; align-items: flex-start;\">\r\n                <div style=\"flex: 1;\">\r\n                    <h3 class=\"module-card-title\">Quiz de ${safeMonth}</h3>\r\n                    <p class=\"module-card-subtitle\">Votre module mensuel est pr√™t. Relevez le d√©fi et am√©liorez vos comp√©tences !</p>\r\n                    <button class=\"start-quiz-button btn-primary w-full mt-4 flex items-center justify-center gap-2\" style=\"max-width: 300px;\">\r\n                        <span>D√©marrer le quiz</span>\r\n                        <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M13 7l5 5m0 0l-5 5m5-5H6\"></path>\r\n                        </svg>\r\n                    </button>\r\n                </div>\r\n                <div style=\"min-width: 200px; text-align: center; background: rgba(255, 255, 255, 0.15); padding: 20px; border-radius: 16px;\">\r\n                    <p style=\"color: #F9FAFB; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 12px;\">\r\n                        Progression Annuelle\r\n                    </p>\r\n                    <div style=\"background: rgba(255, 255, 255, 0.2); border-radius: 9999px; height: 16px; margin-bottom: 12px; overflow: hidden;\">\r\n                        <div id=\"annual-progress-bar\" style=\"background: #FFFFFF; height: 100%; border-radius: 9999px; transition: width 0.5s; width: ${annualProgressPercent}%;\"></div>\r\n                    </div>\r\n                    <p id=\"annual-progress-text\" style=\"color: #FFFFFF; font-size: 2rem; font-weight: 900; line-height: 1; margin-bottom: 4px;\">${completedCount}/12</p>\r\n                    <p style=\"color: #F9FAFB; font-size: 0.75rem; margin: 0;\">modules compl√©t√©s</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n// --- INITIALISATION DU DASHBOARD ---\r\n\r\nfunction calculateStreak() {\r\n    // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour monthsData\r\n    const monthsData = stateManager.get('monthsData');\r\n    let streak = 0;\r\n    for (let i = currentMonthIndex - 1; i >= 0; i--) {\r\n        if (monthsData[i].score !== null && monthsData[i].score >= 60) {\r\n            streak++;\r\n        } else {\r\n            break;\r\n        }\r\n    }\r\n    return streak;\r\n}\r\n\r\n// Charger les donn√©es Firebase pour le dashboard\r\nasync function loadDashboardData() {\r\n    try {\r\n        const user = getCurrentUserUnified();\r\n        if (!user) {\r\n            console.log('‚ÑπÔ∏è Aucun utilisateur - pas de donn√©es √† charger');\r\n            return;\r\n        }\r\n        \r\n        console.log('üìä Chargement des donn√©es du dashboard...');\r\n        \r\n        // Charger le profil utilisateur\r\n        const userProfile = await getUserProfile(user.uid);\r\n        \r\n        // Afficher l'interface admin si l'utilisateur est admin\r\n        if (userProfile) {\r\n            await showAdminUIIfAdmin(userProfile);\r\n        }\r\n        \r\n        // Charger la progression annuelle\r\n        const progress = await getAnnualProgress(user.uid);\r\n        console.log('üìä Progression annuelle r√©cup√©r√©e:', progress);\r\n        \r\n        // Mettre √† jour monthsData avec les vraies donn√©es\r\n        // ‚úÖ CORRECTION SECTION 2 : Normaliser le format du mois pour garantir la correspondance\r\n        // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour monthsData\r\n        const currentYear = getCurrentYear();\r\n        let monthsData = stateManager.get('monthsData');\r\n        monthsData = monthsData.map((month, index) => {\r\n            // Normaliser le format du mois pour garantir la correspondance\r\n            const monthKey = normalizeMonthFormat(month.name, currentYear);\r\n            if (progress[monthKey]) {\r\n                console.log(`‚úÖ Mois ${month.name} (${monthKey}): score = ${progress[monthKey].score}`);\r\n                return {\r\n                    name: month.name,\r\n                    score: progress[monthKey].score\r\n                };\r\n            }\r\n            return month;\r\n        });\r\n        stateManager.set('monthsData', monthsData); // ‚úÖ Sauvegarder dans le StateManager\r\n        \r\n        // Mettre √† jour le streak\r\n        const streak = await updateStreak(user.uid);\r\n        const streakCountElement = document.getElementById('streak-count');\r\n        if (streakCountElement) {\r\n            streakCountElement.textContent = streak;\r\n        }\r\n        \r\n        console.log('‚úÖ Donn√©es du dashboard charg√©es');\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur chargement donn√©es:', error);\r\n    }\r\n}\r\n\r\n// ‚úÖ Exporter pour permettre le rechargement depuis d'autres modules\r\nexport async function initializeDashboard() {\r\n    if (!elements.modulesGrid) {\r\n        console.error(\"‚ùå L'√©l√©ment 'modules-grid' est introuvable.\");\r\n        return;\r\n    }\r\n    \r\n    // ‚úÖ CORRECTION FOND BEIGE/JAUNE: Forcer le background blanc au chargement\r\n    forceWhiteBackground();\r\n    \r\n        // Charger les donn√©es Firebase en premier\r\n        await loadDashboardData();\r\n        \r\n        elements.modulesGrid.innerHTML = '';\r\n        let completedCount = 0;\r\n\r\n        // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour monthsData\r\n        // ‚úÖ HERO CARD: Cr√©er la Hero Card pour le mois actif en premi√®re position\r\n        const { getMonthlyQuizStatus } = await import('./utils/quiz-scoring.js');\r\n        \r\n        const currentMonthsData = stateManager.get('monthsData');\r\n        let heroCardInserted = false;\r\n        let activeMonthName = '';\r\n        \r\n        // D'abord, compter les compl√©t√©s et identifier le mois actuel\r\n        currentMonthsData.forEach((month, index) => {\r\n            const status = getMonthlyQuizStatus(index, currentMonthIndex, month.score);\r\n            console.log(`üìÖ Mois ${month.name} (index=${index}): status=${status}, score=${month.score}`);\r\n            if (status === 'completed') {\r\n                completedCount++;\r\n            }\r\n            // ‚úÖ FIX: Toujours afficher la Hero Card pour le mois ACTUEL (index === currentMonthIndex)\r\n            if (index === currentMonthIndex && !heroCardInserted) {\r\n                activeMonthName = month.name;\r\n            }\r\n        });\r\n        \r\n        // ‚úÖ FIX: Ins√©rer la Hero Card pour le mois actuel (m√™me si compl√©t√©)\r\n        if (activeMonthName && !heroCardInserted) {\r\n            const heroCardHtml = createHeroCard(activeMonthName, completedCount);\r\n            elements.modulesGrid.innerHTML = heroCardHtml;\r\n            heroCardInserted = true;\r\n        } else {\r\n            elements.modulesGrid.innerHTML = '';\r\n        }\r\n        \r\n        // G√©n√©rer toutes les 12 cartes mensuelles (incluant le mois actuel)\r\n        currentMonthsData.forEach((month, index) => {\r\n            let cardHtml = '';\r\n            const status = getMonthlyQuizStatus(index, currentMonthIndex, month.score);\r\n            \r\n            // ‚úÖ Afficher TOUTES les cartes (12 mois) incluant le mois actuel\r\n            if (status === 'active') {\r\n                cardHtml = createActiveCard(month.name);\r\n            } else if (status === 'completed') {\r\n                cardHtml = createCompletedCard(month.name, month.score);\r\n            } else if (status === 'incomplete') {\r\n                cardHtml = createIncompleteCard(month.name);\r\n            } else if (status === 'locked') {\r\n                cardHtml = createLockedCard(month.name);\r\n            }\r\n            if (cardHtml) {\r\n                elements.modulesGrid.innerHTML += cardHtml;\r\n            }\r\n        });\r\n\r\n    // La barre de progression annuelle est maintenant dans la Hero Card\r\n    // Mise √† jour via l'ID dans la Hero Card\r\n\r\n    // Mettre √† jour le badge de s√©rie\r\n    const streak = calculateStreak();\r\n    const streakCountElement = document.getElementById('streak-count');\r\n    if (streakCountElement) {\r\n        streakCountElement.textContent = streak;\r\n    }\r\n    const streakBadge = document.getElementById('streak-badge');\r\n    if (streakBadge && streak === 0) {\r\n        streakBadge.style.display = 'none';\r\n    }\r\n\r\n    // Attacher les √©v√©nements via d√©l√©gation (une seule fois)\r\n    initializeDashboardEventDelegation();\r\n    \r\n    // Cr√©er les graphiques\r\n    setTimeout(() => {\r\n        createSkillsRadarChart();\r\n        createScoresTrendChart();\r\n        createActivityHeatmap();\r\n    }, 500);\r\n}\r\n\r\n// Cr√©er le graphique radar des comp√©tences\r\nfunction createSkillsRadarChart() {\r\n    const ctx = document.getElementById('skills-radar-chart');\r\n    if (!ctx) return;\r\n    \r\n    new Chart(ctx, {\r\n        type: 'radar',\r\n        data: {\r\n            labels: ['Proc√©dures', 'Garanties', 'Documentation', 'Inspection', 'Entretien', 'R√©glementation'],\r\n            datasets: [{\r\n                label: 'Vos Comp√©tences',\r\n                data: [92, 88, 85, 90, 87, 94],\r\n                backgroundColor: 'rgba(99, 102, 241, 0.2)',\r\n                borderColor: 'rgb(99, 102, 241)',\r\n                borderWidth: 2,\r\n                pointBackgroundColor: 'rgb(99, 102, 241)',\r\n                pointBorderColor: '#fff',\r\n                pointHoverBackgroundColor: '#fff',\r\n                pointHoverBorderColor: 'rgb(99, 102, 241)'\r\n            }]\r\n        },\r\n        options: {\r\n            responsive: true,\r\n            maintainAspectRatio: true,\r\n            scales: {\r\n                r: {\r\n                    beginAtZero: true,\r\n                    max: 100,\r\n                    ticks: {\r\n                        stepSize: 20\r\n                    }\r\n                }\r\n            },\r\n            plugins: {\r\n                legend: {\r\n                    display: false\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// Cr√©er le graphique de tendance des scores\r\nfunction createScoresTrendChart() {\r\n    const ctx = document.getElementById('scores-trend-chart');\r\n    if (!ctx) return;\r\n    \r\n    // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour monthsData\r\n    const monthsData = stateManager.get('monthsData');\r\n    const completedMonths = monthsData.filter((m, i) => i < currentMonthIndex);\r\n    \r\n    new Chart(ctx, {\r\n        type: 'line',\r\n        data: {\r\n            labels: completedMonths.map(m => m.name),\r\n            datasets: [{\r\n                label: 'Score (%)',\r\n                data: completedMonths.map(m => m.score),\r\n                backgroundColor: 'rgba(99, 102, 241, 0.1)',\r\n                borderColor: 'rgb(99, 102, 241)',\r\n                borderWidth: 3,\r\n                fill: true,\r\n                tension: 0.4,\r\n                pointRadius: 5,\r\n                pointHoverRadius: 7,\r\n                pointBackgroundColor: 'rgb(99, 102, 241)',\r\n                pointBorderColor: '#fff',\r\n                pointBorderWidth: 2\r\n            }]\r\n        },\r\n        options: {\r\n            responsive: true,\r\n            maintainAspectRatio: true,\r\n            scales: {\r\n                y: {\r\n                    beginAtZero: true,\r\n                    max: 100,\r\n                    ticks: {\r\n                        callback: function(value) {\r\n                            return value + '%';\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            plugins: {\r\n                legend: {\r\n                    display: false\r\n                },\r\n                tooltip: {\r\n                    callbacks: {\r\n                        label: function(context) {\r\n                            return 'Score: ' + context.parsed.y + '%';\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// Cr√©er la heatmap d'activit√© (style GitHub)\r\nfunction createActivityHeatmap() {\r\n    const container = document.getElementById('activity-heatmap');\r\n    if (!container) return;\r\n    \r\n    const weeksInYear = 52;\r\n    const daysInWeek = 7;\r\n    \r\n    let heatmapHTML = '<div class=\"flex gap-1\">';\r\n    \r\n    for (let week = 0; week < weeksInYear; week++) {\r\n        heatmapHTML += '<div class=\"flex flex-col gap-1\">';\r\n        for (let day = 0; day < daysInWeek; day++) {\r\n            const dayIndex = week * daysInWeek + day;\r\n            let intensity = 0;\r\n            \r\n            // Simuler des donn√©es d'activit√©\r\n            if (dayIndex % 30 < 28) {\r\n                intensity = Math.floor(Math.random() * 4) + 1;\r\n            }\r\n            \r\n            const colors = [\r\n                'bg-slate-100',\r\n                'bg-green-200',\r\n                'bg-green-400',\r\n                'bg-green-600',\r\n                'bg-green-800'\r\n            ];\r\n            \r\n            heatmapHTML += `<div class=\"w-3 h-3 rounded-sm ${colors[intensity]}\" title=\"Activit√©\"></div>`;\r\n        }\r\n        heatmapHTML += '</div>';\r\n    }\r\n    \r\n    heatmapHTML += '</div>';\r\n    // ‚úÖ CORRECTION SECTION 4 : Protection XSS - Le HTML g√©n√©r√© ici ne contient pas de donn√©es utilisateur, donc safe\r\n    container.innerHTML = heatmapHTML;\r\n}\r\n\r\n// Variable pour emp√™cher l'attachement multiple des listeners\r\nlet navigationListenersAttached = false;\r\n\r\nfunction attachNavigationListeners() {\r\n    // √âviter d'attacher les listeners plusieurs fois\r\n    if (navigationListenersAttached) {\r\n        return;\r\n    }\r\n    navigationListenersAttached = true;\r\n\r\n    console.log('üîß Attachement des listeners de navigation (une seule fois)...');\r\n\r\n    // Navigation - Dashboard\r\n    document.getElementById('nav-dashboard')?.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        showView('dashboard');\r\n        updateActiveNavLink('nav-dashboard');\r\n    });\r\n\r\n    // Navigation - Quiz (ouvre la s√©lection de modules)\r\n    document.getElementById('nav-quiz')?.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        // ‚úÖ CORRECTION SECTION 4 : Protection XSS - Utiliser textContent (√©chappement automatique)\r\n        // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour monthsData\r\n        const monthsData = stateManager.get('monthsData');\r\n        const activeMonth = monthsData[currentMonthIndex]?.name || 'ce mois';\r\n        elements.moduleSelectionTitle.textContent = `Quiz de ${activeMonth}`;\r\n        showView('moduleSelection');\r\n        updateActiveNavLink('nav-quiz');\r\n    });\r\n\r\n    // Navigation - Mes R√©sultats (demander confirmation si un quiz est en cours)\r\n    document.getElementById('nav-results')?.addEventListener('click', (e) => {\r\n        e.preventDefault(); // TOUJOURS emp√™cher la navigation par d√©faut\r\n        const target = e.currentTarget;\r\n        if (window.__QUIZ_ACTIVE) {\r\n            const ok = confirm('Un quiz est en cours. Voulez-vous vraiment quitter ?');\r\n            if (ok && target && target.href) {\r\n                window.location.href = target.href;\r\n            }\r\n        } else {\r\n            // Navigation normale vers la page des r√©sultats\r\n            if (target && target.href) {\r\n                window.location.href = target.href;\r\n            }\r\n        }\r\n    });\r\n\r\n    // Navigation - Ressources (demander confirmation si un quiz est en cours)\r\n    document.getElementById('nav-resources')?.addEventListener('click', (e) => {\r\n        e.preventDefault(); // TOUJOURS emp√™cher la navigation par d√©faut\r\n        const target = e.currentTarget;\r\n        if (window.__QUIZ_ACTIVE) {\r\n            const ok = confirm('Un quiz est en cours. Voulez-vous vraiment quitter ?');\r\n            if (ok && target && target.href) {\r\n                window.location.href = target.href;\r\n            }\r\n        } else {\r\n            // Navigation normale vers la page des ressources\r\n            if (target && target.href) {\r\n                window.location.href = target.href;\r\n            }\r\n        }\r\n    });\r\n    \r\n    console.log('‚úÖ Listeners de navigation attach√©s');\r\n}\r\n\r\nfunction initializeDashboardEventDelegation() {\r\n    // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour dashboardEventDelegationAttached\r\n    if (stateManager.get('dashboardEventDelegationAttached')) {\r\n        return;\r\n    }\r\n\r\n    document.addEventListener('click', (event) => {\r\n        const startButton = event.target.closest('.start-quiz-button');\r\n        if (startButton) {\r\n            event.preventDefault();\r\n            // ‚úÖ CORRECTION SECTION 4 : Protection XSS - Utiliser textContent (√©chappement automatique)\r\n            // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour monthsData\r\n            const monthsData = stateManager.get('monthsData');\r\n            const activeMonth = monthsData[currentMonthIndex]?.name || 'ce mois';\r\n            elements.moduleSelectionTitle.textContent = `Quiz de ${activeMonth}`;\r\n            showView('moduleSelection');\r\n            updateActiveNavLink('nav-quiz');\r\n            return;\r\n        }\r\n\r\n        const backButton = event.target.closest('.back-to-dashboard');\r\n        if (backButton) {\r\n            event.preventDefault();\r\n            showView('dashboard');\r\n            updateActiveNavLink('nav-dashboard');\r\n            return;\r\n        }\r\n\r\n        // ‚úÖ CORRECTION: Support des nouvelles cartes module-card-professional ET module-card\r\n        const moduleCard = event.target.closest('.module-card, .module-card-professional, [data-module]');\r\n        if (moduleCard) {\r\n            event.preventDefault();\r\n            const module = moduleCard.getAttribute('data-module');\r\n            if (module) {\r\n                console.log('üéØ Module s√©lectionn√©:', module);\r\n                startQuiz(module);\r\n            }\r\n        }\r\n    });\r\n\r\n    // ‚úÖ CORRECTION SECTION 5 : StateManager - Sauvegarder dans StateManager\r\n    stateManager.set('dashboardEventDelegationAttached', true);\r\n}\r\n\r\n// --- GESTION DE L'AUTHENTIFICATION ---\r\n\r\nfunction updateUserProfile(user) {\r\n    if (user) {\r\n        // ‚úÖ CORRECTION SECTION 4 : Protection XSS - Utiliser textContent (√©chappement automatique)\r\n        elements.userName.textContent = user.displayName || 'Utilisateur';\r\n        elements.userAvatar.src = user.photoURL || 'https://placehold.co/100x100/667eea/e0e7ff?text=' + (user.displayName?.[0] || 'U');\r\n        \r\n        // Message de bienvenue personnalis√© - textContent √©chappe automatiquement\r\n        // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour monthsData\r\n        const monthsData = stateManager.get('monthsData');\r\n        const firstName = user.displayName?.split(' ')[0] || 'Utilisateur';\r\n        const monthName = monthsData[currentMonthIndex]?.name || 'ce mois';\r\n        elements.welcomeMessage.textContent = `Bonjour ${firstName}, pr√™t √† relever votre d√©fi de ${monthName} ?`;\r\n    }\r\n}\r\n\r\n// --- INITIALISATION PRINCIPALE ---\r\n\r\n// Gestion du th√®me (dark/light mode)\r\nfunction initializeTheme() {\r\n    const savedTheme = localStorage.getItem('theme') || 'light';\r\n    document.documentElement.classList.toggle('dark', savedTheme === 'dark');\r\n    updateThemeButton(savedTheme);\r\n}\r\n\r\nfunction updateThemeButton(theme) {\r\n    const sunIcon = document.getElementById('theme-icon-sun');\r\n    const moonIcon = document.getElementById('theme-icon-moon');\r\n    const themeText = document.getElementById('theme-text');\r\n    \r\n    if (theme === 'dark') {\r\n        sunIcon?.classList.remove('hidden');\r\n        moonIcon?.classList.add('hidden');\r\n        if (themeText) themeText.textContent = 'Mode Clair';\r\n    } else {\r\n        sunIcon?.classList.add('hidden');\r\n        moonIcon?.classList.remove('hidden');\r\n        if (themeText) themeText.textContent = 'Mode Sombre';\r\n    }\r\n}\r\n\r\nfunction toggleTheme() {\r\n    const currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';\r\n    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\r\n    \r\n    document.documentElement.classList.toggle('dark');\r\n    localStorage.setItem('theme', newTheme);\r\n    updateThemeButton(newTheme);\r\n    \r\n    // ‚úÖ CORRECTION ACCESSIBILIT√â : Mettre √† jour aria-pressed\r\n    const themeBtn = document.getElementById('theme-toggle');\r\n    if (themeBtn) {\r\n        const isDark = newTheme === 'dark';\r\n        themeBtn.setAttribute('aria-pressed', isDark ? 'true' : 'false');\r\n        themeBtn.setAttribute('aria-label', isDark ? 'D√©sactiver le mode sombre' : 'Activer le mode sombre');\r\n    }\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    // ‚úÖ CORRECTION SECTION 9 : Tracker la page vue\r\n    trackPageView('Dashboard', '/index.html');\r\n    console.log('üöÄ Initialisation de QuizPro...');\r\n\r\n    // Initialiser le th√®me\r\n    initializeTheme();\r\n    \r\n    // Attacher les listeners de navigation UNE SEULE FOIS\r\n    attachNavigationListeners();\r\n    \r\n    // Bouton toggle th√®me\r\n    document.getElementById('theme-toggle')?.addEventListener('click', toggleTheme);\r\n\r\n    // Gestion de la connexion Google\r\n    elements.googleSigninBtn?.addEventListener('click', signInWithGoogle);\r\n    \r\n    elements.signoutLink?.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        if (confirm('Voulez-vous vraiment vous d√©connecter ?')) {\r\n            signOutUser();\r\n        }\r\n    });\r\n\r\n    // Mode normal - Afficher l'√©cran de connexion\r\n    showView('login');\r\n    \r\n    // √âcouter les changements d'authentification Firebase\r\n    onAuthChange((user) => {\r\n        if (user) {\r\n            console.log('‚úÖ Utilisateur connect√©:', user.displayName);\r\n            updateUserProfile(user);\r\n            showView('dashboard');\r\n            updateActiveNavLink('nav-dashboard');\r\n            initializeDashboard();\r\n        } else {\r\n            console.log('üë§ Aucun utilisateur connect√©');\r\n            showView('login');\r\n        }\r\n    });\r\n\r\n    // ‚úÖ CORRECTION FOND BEIGE/JAUNE: Forcer le background blanc quand l'utilisateur revient sur l'onglet\r\n    document.addEventListener('visibilitychange', () => {\r\n        if (!document.hidden) {\r\n            // L'utilisateur revient sur l'onglet\r\n            forceWhiteBackground();\r\n        }\r\n    });\r\n\r\n    // ‚úÖ CORRECTION FOND BEIGE/JAUNE: Forcer aussi au focus de la fen√™tre\r\n    window.addEventListener('focus', () => {\r\n        forceWhiteBackground();\r\n    });\r\n\r\n    // ‚úÖ CORRECTION FOND BEIGE/JAUNE: Forcer aussi au pageshow (retour navigateur)\r\n    window.addEventListener('pageshow', (event) => {\r\n        if (event.persisted) {\r\n            // Page charg√©e depuis le cache\r\n            forceWhiteBackground();\r\n        }\r\n    });\r\n\r\n    console.log('‚úÖ QuizPro initialis√© avec succ√®s');\r\n});\r\n"],"file":"main-CB1eOSY0.js"}