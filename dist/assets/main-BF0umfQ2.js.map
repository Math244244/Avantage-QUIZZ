{"version":3,"mappings":";+wBAYA,IAAIA,EAAY,KAKT,SAASC,GAAgB,CAC5B,GAAI,CAEA,OAAI,OAAO,OAAW,KAAe,kBAAmB,WACpDD,EAAYE,GAAaC,EAAG,EAC5B,QAAQ,IAAI,iCAAiC,EACtCH,IAEP,QAAQ,KAAK,6DAA6D,EACnE,KAEf,OAASI,EAAO,CACZ,eAAQ,MAAM,qCAAsCA,CAAK,EAClD,IACX,CACJ,CAOO,SAASC,EAAWC,EAAWC,EAAS,GAAI,CAC/C,GAAI,CAACP,EAAW,CAEZ,QAAQ,IAAI,eAAeM,CAAS,GAAIC,CAAM,EAC9C,MACJ,CAEA,GAAI,CACAC,EAASR,EAAWM,EAAW,CAC3B,GAAGC,EACH,UAAW,KAAK,IAAG,EACnB,KAAM,OAAO,SAAS,QAClC,CAAS,EACD,QAAQ,IAAI,qBAAqBD,CAAS,GAAIC,CAAM,CACxD,OAASH,EAAO,CACZ,QAAQ,MAAM,+BAAgCA,CAAK,CACvD,CACJ,CAOO,SAASK,GAAWL,EAAOM,EAAU,GAAI,CAC5C,GAAI,CAACV,EAAW,CACZ,QAAQ,MAAM,oBAAqBI,EAAOM,CAAO,EACjD,MACJ,CAEA,GAAI,CACAF,EAASR,EAAW,YAAa,CAC7B,YAAaI,EAAM,SAAW,gBAC9B,MAAO,GACP,WAAYA,EAAM,MAAQ,QAC1B,YAAaA,EAAM,OAAO,UAAU,EAAG,GAAG,GAAK,GAC/C,GAAGM,CACf,CAAS,EACD,QAAQ,MAAM,oBAAqBN,EAAM,OAAO,CACpD,OAASO,EAAe,CACpB,QAAQ,MAAM,4BAA6BA,CAAa,CAC5D,CACJ,CA+BO,SAASC,GAAiBC,EAAQ,CACrC,GAAKb,EAEL,GAAI,CACAc,GAAUd,EAAWa,CAAM,EAC3B,QAAQ,IAAI,wBAAyBA,CAAM,CAC/C,OAAST,EAAO,CACZ,QAAQ,MAAM,6CAA8CA,CAAK,CACrE,CACJ,CAMO,SAASW,GAA2BC,EAAY,CACnD,GAAKhB,EAEL,GAAI,CACAiB,GAAkBjB,EAAWgB,CAAU,EACvC,QAAQ,IAAI,mCAAoCA,CAAU,CAC9D,OAASZ,EAAO,CACZ,QAAQ,MAAM,8CAA+CA,CAAK,CACtE,CACJ,CAOO,SAASc,GAAcC,EAAUC,EAAW,OAAO,SAAS,SAAU,CACzE,GAAI,CAACpB,EAAW,CACZ,QAAQ,IAAI,wBAAwBmB,CAAQ,MAAMC,CAAQ,EAAE,EAC5D,MACJ,CAEA,GAAI,CACAZ,EAASR,EAAW,YAAa,CAC7B,WAAYmB,EACZ,cAAe,OAAO,SAAS,KAC/B,UAAWC,CACvB,CAAS,EACD,QAAQ,IAAI,yBAAyBD,CAAQ,EAAE,CACnD,OAASf,EAAO,CACZ,QAAQ,MAAM,+BAAgCA,CAAK,CACvD,CACJ,CAOO,SAASiB,GAAeC,EAAUC,EAAO,CAC5ClB,EAAW,aAAc,CACrB,UAAWiB,EACX,MAAOC,EACP,UAAW,KAAK,IAAG,CAC3B,CAAK,CACL,CASO,SAASC,GAAkBF,EAAUG,EAAOC,EAAaC,EAAgB,CAC5EtB,EAAW,gBAAiB,CACxB,UAAWiB,EACX,MAAOG,EACP,aAAcC,EACd,gBAAiBC,EACjB,OAAQF,GAAS,EACzB,CAAK,CACL,CA6BI,OAAO,OAAW,MAEd,SAAS,aAAe,UACxB,SAAS,iBAAiB,mBAAoB,IAAM,CAChDxB,EAAa,CACjB,CAAC,EAEDA,EAAa,EAIb2B,IACAA,GAAK,mBAAoBC,GAAS,CAC1BA,IACAjB,GAAiBiB,EAAK,GAAG,EACzBd,GAA2B,CACvB,MAAOc,EAAK,OAAS,GACrB,aAAcA,EAAK,aAAe,EACtD,CAAiB,EAET,CAAC,4PC7NIC,EAAa,CACtB,QAAS,UACT,UAAW,YACX,KAAM,OACN,WAAY,aACZ,QAAS,SACb,EAKA,MAAMC,EAAa,CACf,aAAc,CACV,KAAK,SAAW,GAChB,KAAK,WAAa,IAClB,KAAK,oBAAmB,CAC5B,CAKA,qBAAsB,CAElB,OAAO,iBAAiB,QAAUC,GAAU,CACxC,KAAK,YAAY,CACb,QAASA,EAAM,QACf,SAAUA,EAAM,SAChB,OAAQA,EAAM,OACd,MAAOA,EAAM,MACb,MAAOA,EAAM,MACb,KAAMF,EAAW,OACjC,EAAe,sBAAsB,CAC7B,CAAC,EAGD,OAAO,iBAAiB,qBAAuBE,GAAU,CACrD,KAAK,YAAY,CACb,QAASA,EAAM,QAAQ,SAAW,8BAClC,MAAOA,EAAM,OACb,KAAMF,EAAW,OACjC,EAAe,6BAA6B,CACpC,CAAC,CACL,CAQA,YAAY1B,EAAOM,EAAU,UAAWuB,EAAU,GAAI,CAClD,MAAMC,EAAY,KAAK,eAAe9B,EAAOM,EAASuB,CAAO,EAG7D,YAAK,SAASC,CAAS,EAGnBD,EAAQ,aAAe,IACvB,KAAK,gBAAgBC,EAAWD,CAAO,EAIvCA,EAAQ,UAAY,CAACE,KACrB,KAAK,gBAAgBD,CAAS,EAAE,MAAME,GAAO,CACzCC,EAAO,MAAM,6CAAgDD,CAAG,CACpE,CAAC,EAGEF,CACX,CASA,eAAe9B,EAAOM,EAASuB,EAAS,CACpC,MAAMC,EAAY,CACd,QAAS9B,GAAO,SAAW,OAAOA,CAAK,GAAK,kBAC5C,MAAOA,GAAO,MACd,QAASM,EACT,KAAM,KAAK,gBAAgBN,CAAK,EAChC,UAAW,IAAI,KAAI,EAAG,YAAW,EACjC,IAAK,OAAO,SAAS,KACrB,UAAW,UAAU,UACrB,GAAG6B,EAAQ,QACvB,EAGQ,OAAI7B,GAAO,OACP8B,EAAU,KAAO9B,EAAM,MAEvBA,GAAO,OACP8B,EAAU,KAAO9B,EAAM,MAGpB8B,CACX,CAOA,gBAAgB9B,EAAO,CACnB,GAAI,CAACA,EAAO,OAAO0B,EAAW,QAE9B,MAAMQ,GAAWlC,EAAM,SAAW,IAAI,YAAW,EAC3CmC,EAAOnC,EAAM,MAAQ,GAE3B,OAAImC,IAAS,eAAiBA,IAAS,qBAAuBD,EAAQ,SAAS,SAAS,GAAKA,EAAQ,SAAS,OAAO,EAC1GR,EAAW,QAElBS,IAAS,qBAAuBA,IAAS,mBAAqBD,EAAQ,SAAS,MAAM,EAC9ER,EAAW,KAElBS,IAAS,oBAAsBA,IAAS,uBAAyBD,EAAQ,SAAS,YAAY,EACvFR,EAAW,WAElBQ,EAAQ,SAAS,WAAW,GAAKC,EAAK,WAAW,WAAW,EACrDT,EAAW,UAGfA,EAAW,OACtB,CAMA,SAASI,EAAW,CAEhB,KAAK,SAAS,KAAKA,CAAS,EACxB,KAAK,SAAS,OAAS,KAAK,YAC5B,KAAK,SAAS,QAIlB,MAAMM,EAAa,IAAIN,EAAU,IAAI,KAAKA,EAAU,OAAO,KAAKA,EAAU,OAAO,GAE7EA,EAAU,OAASJ,EAAW,QAC9BO,EAAO,KAAKG,EAAYN,CAAS,EAEjCG,EAAO,MAAMG,EAAYN,CAAS,CAE1C,CAOA,gBAAgBA,EAAWD,EAAS,CAChC,IAAIK,EAAUL,EAAQ,YAEtB,GAAI,CAACK,EAED,OAAQJ,EAAU,KAAI,CAClB,KAAKJ,EAAW,QACZQ,EAAU,4DACV,MACJ,KAAKR,EAAW,KACZQ,EAAU,wDACV,MACJ,KAAKR,EAAW,WACZQ,EAAU,yDACV,MACJ,KAAKR,EAAW,UACZQ,EAAU,0DACV,MACJ,QACIA,EAAU,8CAC9B,CAIQ,MAAMG,EAAWR,EAAQ,WAAaC,EAAU,OAASJ,EAAW,QAAU,IAAO,KACrFY,EAAM,MAAMJ,EAASG,CAAQ,CACjC,CAOA,MAAM,gBAAgBP,EAAW,CAE7B,GAAI,CACA,KAAM,CAAE,WAAAzB,CAAU,EAAK,4CAAM,2BAAAkC,EAAA,EAAuB,kBAAAlC,CAAA,WACpDA,EAAW,IAAI,MAAMyB,EAAU,OAAO,EAAG,CACrC,WAAYA,EAAU,KACtB,aAAcA,EAAU,OACxB,QAASA,EAAU,QAAU,WAC7C,CAAa,CACL,MAAyB,CAErB,QAAQ,KAAK,+CAA+C,CAChE,CAEA,GAAI,CAEA,KAAM,CAAE,GAAAU,CAAE,EAAK,MAAKC,EAAA,mBAAAD,GAAA,KAAC,QAAO,oBAAsB,OAAAE,KAAA,aAAAF,CAAA,2BAC5C,CAAE,WAAAG,EAAY,OAAAC,EAAQ,UAAAC,GAAc,gEAAM,QAAO,iEAAiE,oBAAAF,EAAA,OAAAC,EAAA,UAAAC,CAAA,OAClH,CAAE,mBAAAC,CAAkB,EAAK,MAAKL,EAAA,mCAAAK,GAAA,KAAC,QAAO,iCAAwB,4BAAAA,CAAA,iCAIpE,GAAI,CADY,MAAMA,EAAkB,EAEpC,OAGJ,MAAMF,EAAOD,EAAWH,EAAI,WAAW,EAAG,CACtC,GAAGV,EACH,UAAWe,EAAU,IAAG,CACxC,CAAa,CACL,OAASb,EAAK,CAEV,QAAQ,MAAM,6CAAgDA,CAAG,CACrE,CACJ,CAOA,gBAAgBe,EAAQ,GAAI,CACxB,OAAO,KAAK,SAAS,MAAM,CAACA,CAAK,CACrC,CAKA,eAAgB,CACZ,KAAK,SAAW,EACpB,CACJ,CAGO,MAAMC,GAAe,IAAIrB,GCnP1BsB,GAAkB,CACpB,WAAY,EACZ,aAAc,IACd,SAAU,IACV,kBAAmB,EACnB,gBAAiB,CAAC,cAAe,oBAAqB,WAAY,SAAS,EAC3E,QAAS,IACb,EAQA,SAASC,GAAiBlD,EAAOmD,EAAiB,CAC9C,GAAI,CAACnD,EAAO,MAAO,GAEnB,MAAMmC,EAAOnC,EAAM,MAAQ,GACrBkC,GAAWlC,EAAM,SAAW,IAAI,YAAW,EAGjD,OAAImC,IAAS,eAAiBA,IAAS,qBACnCD,EAAQ,SAAS,SAAS,GAAKA,EAAQ,SAAS,cAAc,EACvD,GAIJiB,EAAgB,KAAKC,GACxBjB,IAASiB,GAAiBlB,EAAQ,SAASkB,EAAc,YAAW,CAAE,CAC9E,CACA,CAUA,SAASC,GAAeC,EAASC,EAAcC,EAAUC,EAAmB,CACxE,MAAMC,EAAQH,EAAe,KAAK,IAAIE,EAAmBH,CAAO,EAChE,OAAO,KAAK,IAAII,EAAOF,CAAQ,CACnC,CAOA,SAASG,GAAKC,EAAI,CACd,OAAO,IAAI,QAAQC,GAAW,WAAWA,EAASD,CAAE,CAAC,CACzD,CAQO,eAAeE,GAAUC,EAAIlC,EAAU,GAAI,CAC9C,MAAMmC,EAAO,CAAE,GAAGf,GAAiB,GAAGpB,CAAO,EAC7C,IAAIoC,EAGJ,GAAI,CACA,OAAO,MAAMF,EAAE,CACnB,OAAS/D,EAAO,CAIZ,GAHAiE,EAAYjE,EAGR,CAACkD,GAAiBlD,EAAOgE,EAAK,eAAe,EAC7C,MAAMhE,CAEd,CAGA,QAASsD,EAAU,EAAGA,EAAUU,EAAK,WAAYV,IAAW,CACxD,MAAMI,EAAQL,GACVC,EACAU,EAAK,aACLA,EAAK,SACLA,EAAK,iBACjB,EAGYA,EAAK,QACLA,EAAK,QAAQV,EAAU,EAAGI,EAAOO,CAAS,EAG1ChC,EAAO,KAAK,sBAAsBqB,EAAU,CAAC,IAAIU,EAAK,UAAU,SAASN,CAAK,OAAO,EAIzF,MAAMC,GAAKD,CAAK,EAEhB,GAAI,CACA,OAAO,MAAMK,EAAE,CACnB,OAAS/D,EAAO,CAIZ,GAHAiE,EAAYjE,EAGR,CAACkD,GAAiBlD,EAAOgE,EAAK,eAAe,EAC7C,MAAMhE,EAIV,GAAIsD,IAAYU,EAAK,WAAa,EAC9B,MAAAhB,GAAa,YAAYhD,EAAO,sCAAuC,CACnE,WAAY,GACZ,YAAa,eAAegE,EAAK,UAAU,4CAC/D,CAAiB,EACKhE,CAEd,CACJ,CAGA,MAAMiE,CACV,CAQO,eAAeC,GAAmBC,EAAoBtC,EAAU,GAAI,CACvE,OAAOiC,GAAUK,EAAoB,CACjC,GAAGtC,EACH,gBAAiB,CACb,cACA,oBACA,WACA,UACA,oBACZ,EACQ,QAASA,EAAQ,UAAY,CAACyB,EAASI,IAAU,CAC7CzB,EAAO,KAAK,mBAAmBqB,CAAO,IAAIzB,EAAQ,YAAc,CAAC,SAAS6B,CAAK,OAAO,CAC1F,EACR,CAAK,CACL,CCpJA,MAAMU,GAAU,sBACVC,GAAa,EACbC,EAAa,aAEnB,IAAI9B,EAAK,KAKT,eAAe+B,GAAS,CACpB,OAAI/B,GAEG,IAAI,QAAQ,CAACqB,EAASW,IAAW,CACpC,MAAMC,EAAU,UAAU,KAAKL,GAASC,EAAU,EAElDI,EAAQ,QAAU,IAAMD,EAAOC,EAAQ,KAAK,EAC5CA,EAAQ,UAAY,IAAM,CACtBjC,EAAKiC,EAAQ,OACbZ,EAAQrB,CAAE,CACd,EAEAiC,EAAQ,gBAAmB7C,GAAU,CACjC,MAAM8C,EAAW9C,EAAM,OAAO,OAC9B,GAAI,CAAC8C,EAAS,iBAAiB,SAASJ,CAAU,EAAG,CACjD,MAAMK,EAAQD,EAAS,kBAAkBJ,EAAY,CAAE,QAAS,KAAM,cAAe,GAAM,EAC3FK,EAAM,YAAY,YAAa,YAAa,CAAE,OAAQ,GAAO,EAC7DA,EAAM,YAAY,OAAQ,OAAQ,CAAE,OAAQ,GAAO,EACnDA,EAAM,YAAY,SAAU,SAAU,CAAE,OAAQ,GAAO,CAC3D,CACJ,CACJ,CAAC,CACL,CAKA,MAAMC,EAAU,CACZ,aAAc,CACV,KAAK,aAAe,GACpB,KAAK,UAAY,IAAI,GACzB,CASA,MAAM,IAAIC,EAAMC,EAAWC,EAAO,GAAI,CAClC,MAAMR,EAAM,EAEZ,MAAMS,EAAY,CACd,KAAAH,EACA,UAAW,KAAK,mBAAmBC,CAAS,EAC5C,KAAAC,EACA,UAAW,KAAK,IAAG,EACnB,OAAQ,UACR,QAAS,EACT,WAAY,CACxB,EAEQ,OAAO,IAAI,QAAQ,CAAClB,EAASW,IAAW,CAGpC,MAAMC,EAFcjC,EAAG,YAAY,CAAC8B,CAAU,EAAG,WAAW,EAClC,YAAYA,CAAU,EAC1B,IAAIU,CAAS,EAEnCP,EAAQ,UAAY,IAAM,CACtB,MAAMQ,EAAKR,EAAQ,OACnB,QAAQ,IAAI,6CAA6CI,CAAI,SAASI,CAAE,GAAG,EAC3E,KAAK,gBAAgB,QAAS,CAAE,GAAAA,EAAI,KAAAJ,CAAI,CAAE,EAC1ChB,EAAQoB,CAAE,CACd,EAEAR,EAAQ,QAAU,IAAMD,EAAOC,EAAQ,KAAK,CAChD,CAAC,CACL,CAOA,mBAAmBK,EAAW,CAG1B,MAAO,CACH,KAAMA,EAAU,MAAQ,WAEpC,CACI,CAKA,MAAM,QAAS,CACX,aAAMP,EAAM,EAEL,IAAI,QAAQ,CAACV,EAASW,IAAW,CAIpC,MAAMC,EAHcjC,EAAG,YAAY,CAAC8B,CAAU,EAAG,UAAU,EACjC,YAAYA,CAAU,EAC5B,MAAM,QAAQ,EACZ,OAAO,SAAS,EAEtCG,EAAQ,UAAY,IAAMZ,EAAQY,EAAQ,MAAM,EAChDA,EAAQ,QAAU,IAAMD,EAAOC,EAAQ,KAAK,CAChD,CAAC,CACL,CAKA,MAAM,cAAcQ,EAAI,CACpB,aAAMV,EAAM,EAEL,IAAI,QAAQ,CAACV,EAASW,IAAW,CAEpC,MAAMG,EADcnC,EAAG,YAAY,CAAC8B,CAAU,EAAG,WAAW,EAClC,YAAYA,CAAU,EAC1CY,EAAaP,EAAM,IAAIM,CAAE,EAE/BC,EAAW,UAAY,IAAM,CACzB,MAAMC,EAAOD,EAAW,OACxB,GAAIC,EAAM,CACNA,EAAK,OAAS,YACd,MAAMC,EAAgBT,EAAM,IAAIQ,CAAI,EACpCC,EAAc,UAAY,IAAM,CAC5B,QAAQ,IAAI,0BAA0BD,EAAK,IAAI,SAASF,CAAE,GAAG,EAC7D,KAAK,gBAAgB,YAAa,CAAE,GAAAA,EAAI,KAAME,EAAK,KAAM,EACzDtB,EAAO,CACX,EACAuB,EAAc,QAAU,IAAMZ,EAAOY,EAAc,KAAK,CAC5D,MACIvB,EAAO,CAEf,EAEAqB,EAAW,QAAU,IAAMV,EAAOU,EAAW,KAAK,CACtD,CAAC,CACL,CAKA,MAAM,WAAWD,EAAIjF,EAAO,CACxB,aAAMuE,EAAM,EAEL,IAAI,QAAQ,CAACV,EAASW,IAAW,CAEpC,MAAMG,EADcnC,EAAG,YAAY,CAAC8B,CAAU,EAAG,WAAW,EAClC,YAAYA,CAAU,EAC1CY,EAAaP,EAAM,IAAIM,CAAE,EAE/BC,EAAW,UAAY,IAAM,CACzB,MAAMC,EAAOD,EAAW,OACxB,GAAIC,EAAM,CACNA,EAAK,UACDA,EAAK,SAAWA,EAAK,YACrBA,EAAK,OAAS,SACdA,EAAK,MAAQnF,GAAO,SAAW,iBAE/BmF,EAAK,OAAS,UAElB,MAAMC,EAAgBT,EAAM,IAAIQ,CAAI,EACpCC,EAAc,UAAY,IAAM,CACxBD,EAAK,SAAW,UAChB,QAAQ,MAAM,uCAAuCA,EAAK,IAAI,SAASF,CAAE,GAAG,EAC5E,KAAK,gBAAgB,SAAU,CAAE,GAAAA,EAAI,KAAME,EAAK,KAAM,MAAAnF,EAAO,GAE7D,QAAQ,KAAK,iCAAiCmF,EAAK,OAAO,IAAIA,EAAK,UAAU,KAAKA,EAAK,IAAI,SAASF,CAAE,GAAG,EAE7GpB,EAAO,CACX,EACAuB,EAAc,QAAU,IAAMZ,EAAOY,EAAc,KAAK,CAC5D,MACIvB,EAAO,CAEf,EAEAqB,EAAW,QAAU,IAAMV,EAAOU,EAAW,KAAK,CACtD,CAAC,CACL,CAKA,MAAM,OAAOD,EAAI,CACb,aAAMV,EAAM,EAEL,IAAI,QAAQ,CAACV,EAASW,IAAW,CAGpC,MAAMC,EAFcjC,EAAG,YAAY,CAAC8B,CAAU,EAAG,WAAW,EAClC,YAAYA,CAAU,EAC1B,OAAOW,CAAE,EAE/BR,EAAQ,UAAY,IAAM,CACtB,QAAQ,IAAI,+BAA+BQ,CAAE,EAAE,EAC/CpB,EAAO,CACX,EAEAY,EAAQ,QAAU,IAAMD,EAAOC,EAAQ,KAAK,CAChD,CAAC,CACL,CAMA,MAAM,aAAaY,EAAoB,GAAI,CACvC,GAAI,KAAK,aAAc,CACnB,QAAQ,IAAI,+BAA+B,EAC3C,MACJ,CAEA,GAAI,CAAC,UAAU,OAAQ,CACnB,QAAQ,IAAI,yCAAyC,EACrD,MACJ,CAEA,KAAK,aAAe,GACpB,QAAQ,IAAI,gDAAiD,EAE7D,GAAI,CACA,MAAMC,EAAe,MAAM,KAAK,OAAM,EAEtC,GAAIA,EAAa,SAAW,EACxB,eAAQ,IAAI,+BAA+B,EAC3C,KAAK,aAAe,GACb,CAAE,QAAS,EAAG,OAAQ,CAAC,EAGlC,QAAQ,IAAI,MAAMA,EAAa,MAAM,0BAA0B,EAE/D,IAAIC,EAAe,EACfC,EAAc,EAElB,UAAWL,KAAQG,EACf,GAAI,CAEA,MAAMG,EAAUJ,EAAkBF,EAAK,IAAI,EAC3C,GAAI,CAACM,EAAS,CACV,QAAQ,KAAK,kCAAkCN,EAAK,IAAI,EAAE,EAC1D,MAAM,KAAK,WAAWA,EAAK,GAAI,IAAI,MAAM,wBAAwBA,EAAK,IAAI,EAAE,CAAC,EAC7EK,IACA,QACJ,CAGA,MAAMC,EAAQN,EAAK,IAAI,EAGvB,MAAM,KAAK,cAAcA,EAAK,EAAE,EAChC,MAAM,KAAK,OAAOA,EAAK,EAAE,EACzBI,GAEJ,OAASvF,EAAO,CACZ,QAAQ,MAAM,iCAAiCmF,EAAK,EAAE,IAAKnF,CAAK,EAChE,MAAM,KAAK,WAAWmF,EAAK,GAAInF,CAAK,EACpCwF,GACJ,CAGJ,eAAQ,IAAI,yBAAyBD,CAAY,cAAcC,CAAW,WAAW,EACrF,KAAK,gBAAgB,YAAa,CAAE,QAASD,EAAc,OAAQC,EAAa,EAEzE,CAAE,QAASD,EAAc,OAAQC,CAAW,CAEvD,OAASxF,EAAO,CACZ,cAAQ,MAAM,sCAAwCA,CAAK,EACrDA,CACV,QAAC,CACG,KAAK,aAAe,EACxB,CACJ,CAKA,MAAM,UAAW,CACb,aAAMuE,EAAM,EAEL,IAAI,QAAQ,CAACV,EAASW,IAAW,CAGpC,MAAMC,EAFcjC,EAAG,YAAY,CAAC8B,CAAU,EAAG,UAAU,EACjC,YAAYA,CAAU,EAC1B,OAAM,EAE5BG,EAAQ,UAAY,IAAM,CACtB,MAAMiB,EAAQjB,EAAQ,OAChBkB,EAAQ,CACV,MAAOD,EAAM,OACb,QAASA,EAAM,OAAOE,GAAKA,EAAE,SAAW,SAAS,EAAE,OACnD,UAAWF,EAAM,OAAOE,GAAKA,EAAE,SAAW,WAAW,EAAE,OACvD,OAAQF,EAAM,OAAOE,GAAKA,EAAE,SAAW,QAAQ,EAAE,MACrE,EACgB/B,EAAQ8B,CAAK,CACjB,EAEAlB,EAAQ,QAAU,IAAMD,EAAOC,EAAQ,KAAK,CAChD,CAAC,CACL,CAKA,MAAM,gBAAiB,CACnB,MAAMF,EAAM,EAEZ,MAAMsB,EAAe,KAAK,IAAG,EAAM,MAAc,GAAK,IAEtD,OAAO,IAAI,QAAQ,CAAChC,EAASW,IAAW,CAIpC,MAAMC,EAHcjC,EAAG,YAAY,CAAC8B,CAAU,EAAG,WAAW,EAClC,YAAYA,CAAU,EAC5B,MAAM,WAAW,EACf,WAAU,EAEhC,IAAIwB,EAAe,EAEnBrB,EAAQ,UAAa7C,GAAU,CAC3B,MAAMmE,EAASnE,EAAM,OAAO,OAC5B,GAAImE,EAAQ,CACR,MAAMZ,EAAOY,EAAO,MAChBZ,EAAK,SAAW,aAAeA,EAAK,UAAYU,IAChDE,EAAO,OAAM,EACbD,KAEJC,EAAO,SAAQ,CACnB,MACI,QAAQ,IAAI,MAAMD,CAAY,wCAAwC,EACtEjC,EAAQiC,CAAY,CAE5B,EAEArB,EAAQ,QAAU,IAAMD,EAAOC,EAAQ,KAAK,CAChD,CAAC,CACL,CAKA,UAAUuB,EAAU,CAChB,YAAK,UAAU,IAAIA,CAAQ,EACpB,IAAM,KAAK,UAAU,OAAOA,CAAQ,CAC/C,CAKA,gBAAgBpE,EAAOmD,EAAM,CACzB,KAAK,UAAU,QAAQiB,GAAY,CAC/B,GAAI,CACAA,EAASpE,EAAOmD,CAAI,CACxB,OAAS/E,EAAO,CACZ,QAAQ,MAAM,mBAAoBA,CAAK,CAC3C,CACJ,CAAC,CACL,CACJ,CAGO,MAAMiG,EAAY,IAAIrB,GAG7BL,EAAM,EAAG,MAAMvE,GAAS,CACpB,QAAQ,MAAM,qCAAsCA,CAAK,CAC7D,CAAC,kHCvWD,MAAMkG,EAAe,CACjB,aAAc,CACV,KAAK,SAAW,UAAU,OAC1B,KAAK,UAAY,IAAI,IACrB,KAAK,iBAAmB,KACxB,KAAK,oBAAmB,EACxB,KAAK,gBAAe,CACxB,CAKA,qBAAsB,CAClB,OAAO,iBAAiB,SAAU,IAAM,KAAK,aAAY,CAAE,EAC3D,OAAO,iBAAiB,UAAW,IAAM,KAAK,cAAa,CAAE,EAG7D,YAAY,IAAM,KAAK,gBAAe,EAAI,GAAK,CACnD,CAKA,MAAM,iBAAkB,CACpB,GAAI,CAEA,MAAMC,EAAW,MAAM,MAAM,mCAAoC,CAC7D,OAAQ,OACR,KAAM,UACN,MAAO,UACvB,CAAa,EAEI,KAAK,UACN,KAAK,aAAY,CAEzB,MAAgB,CACR,KAAK,UACL,KAAK,cAAa,CAE1B,CACJ,CAKA,MAAM,cAAe,CACjB,GAAI,MAAK,SAET,MAAK,SAAW,GAChB,QAAQ,IAAI,uBAAuB,EAEnC,KAAK,gBAAe,EACpB,KAAK,gBAAgB,QAAQ,EAG7B7D,EAAM,QAAQ,kDAAmD,GAAI,EAGrE,GAAI,CAEA,KAAM,CAAE,eAAA8D,CAAc,EAAK,MAAK3D,EAAA,+BAAA2D,GAAA,KAAC,QAAO,iCAAwB,wBAAAA,CAAA,iCAE1DT,EAAQ,MAAMM,EAAU,SAAQ,EACtC,GAAIN,EAAM,QAAU,EAAG,CACnB,QAAQ,IAAI,yBAAyBA,EAAM,OAAO,6BAA6B,EAG/E,MAAMN,EAAoB,CACtB,WAAY,MAAON,GAAS,CACxB,MAAMqB,EAAerB,CAAI,CAC7B,CAEpB,EAEsBsB,EAAS,MAAMJ,EAAU,aAAaZ,CAAiB,EAEzDgB,EAAO,QAAU,GACjB/D,EAAM,QAAQ,GAAG+D,EAAO,OAAO,4CAA6C,GAAI,EAEhFA,EAAO,OAAS,GAChB/D,EAAM,QAAQ,GAAG+D,EAAO,MAAM,gDAAiD,GAAI,CAE3F,CACJ,OAASrG,EAAO,CACZ,QAAQ,MAAM,4BAA6BA,CAAK,EAChDsC,EAAM,MAAM,oCAAqC,GAAI,CACzD,EACJ,CAKA,eAAgB,CACP,KAAK,WAEV,KAAK,SAAW,GAChB,QAAQ,IAAI,qBAAqB,EAEjC,KAAK,gBAAe,EACpB,KAAK,gBAAgB,SAAS,EAG9BA,EAAM,QAAQ,gEAAiE,GAAI,EACvF,CAKA,iBAAkB,CAEd,KAAK,iBAAmB,SAAS,cAAc,KAAK,EACpD,KAAK,iBAAiB,GAAK,oBAC3B,KAAK,iBAAiB,UAAY,iHAClC,KAAK,iBAAiB,MAAM,QAAU,OAGtC,SAAS,KAAK,YAAY,KAAK,gBAAgB,EAG/C,KAAK,gBAAe,CACxB,CAKA,iBAAkB,CACT,KAAK,mBAEN,KAAK,SACL,KAAK,iBAAiB,MAAM,QAAU,QAEtC,KAAK,iBAAiB,MAAM,QAAU,OACtC,KAAK,iBAAiB,UAAY,0IAClC,KAAK,iBAAiB,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,eAO1C,CAKA,WAAY,CACR,MAAO,CACH,SAAU,KAAK,SACf,UAAW,KAAK,IAAG,CAC/B,CACI,CAKA,UAAU0D,EAAU,CAChB,YAAK,UAAU,IAAIA,CAAQ,EACpB,IAAM,KAAK,UAAU,OAAOA,CAAQ,CAC/C,CAKA,gBAAgBpE,EAAO,CACnB,KAAK,UAAU,QAAQoE,GAAY,CAC/B,GAAI,CACAA,EAASpE,EAAO,KAAK,WAAW,CACpC,OAAS5B,EAAO,CACZ,QAAQ,MAAM,2BAA4BA,CAAK,CACnD,CACJ,CAAC,CACL,CACJ,CAG8B,IAAIkG,GCjLlC,QAAQ,IAAI,wCAAwC,EAGpD,SAAS,iBAAiB,mBAAoBI,EAAa,EAE3D,SAASA,IAAgB,CACrB,QAAQ,IAAI,yDAAyD,EAGrE,MAAMC,EAAY,SAAS,eAAe,mBAAmB,EACzDA,GACAA,EAAU,iBAAiB,QAASC,EAAkB,EACtD,QAAQ,IAAI,2BAA2B,GAEvC,QAAQ,KAAK,6BAA6B,CAElD,CAKA,eAAeA,IAAqB,CAChC,QAAQ,IAAI,iCAAiC,EAE7C,MAAMC,EAAeC,GAAiB,uBAAuB,EAE7D,GAAI,CACA,MAAMjF,EAAO,MAAMkF,GAAgB,EAGvCC,EAAmBH,EAAc,aAAahF,EAAK,WAAW,KAAM,SAAS,EAGzE,WAAW,IAAM,CACb,OAAO,SAAS,OAAM,CAC1B,EAAG,GAAG,CAEV,OAASzB,EAAO,CACZ,QAAQ,MAAM,6BAA8BA,CAAK,EAGjD,IAAI6G,EAAe,8BAEf7G,EAAM,OAAS,4BACf6G,EAAe,oBACR7G,EAAM,OAAS,qBACtB6G,EAAe,yCACR7G,EAAM,OAAS,2BACtB6G,EAAe,qCACR7G,EAAM,OAAS,gCACtB6G,EAAe,4CAGvBD,EAAmBH,EAAcI,EAAc,OAAO,CACtD,CACJ,CC/DO,SAASC,IAAiB,CAC7B,MAAMC,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,MAAM,SAAW,QACxBA,EAAO,MAAM,IAAM,IACnBA,EAAO,MAAM,KAAO,IACpBA,EAAO,MAAM,MAAQ,OACrBA,EAAO,MAAM,OAAS,OACtBA,EAAO,MAAM,cAAgB,OAC7BA,EAAO,MAAM,OAAS,OACtB,SAAS,KAAK,YAAYA,CAAM,EAEhC,MAAMC,EAAMD,EAAO,WAAW,IAAI,EAClCA,EAAO,MAAQ,OAAO,WACtBA,EAAO,OAAS,OAAO,YAEvB,MAAME,EAAY,GACZC,EAAS,CAAC,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,SAAS,EAGtG,QAAS,EAAI,EAAG,EAAI,IAAK,IACrBD,EAAU,KAAK,CACX,EAAG,KAAK,OAAM,EAAKF,EAAO,MAC1B,EAAGA,EAAO,OAAS,KAAK,OAAM,EAAK,IACnC,KAAM,KAAK,OAAM,EAAK,EAAI,EAC1B,OAAQ,EAAE,KAAK,OAAM,EAAK,EAAI,GAC9B,OAAQ,KAAK,OAAM,EAAK,EAAI,EAC5B,MAAOG,EAAO,KAAK,MAAM,KAAK,OAAM,EAAKA,EAAO,MAAM,CAAC,EACvD,SAAU,KAAK,OAAM,EAAK,IAC1B,cAAe,KAAK,OAAM,EAAK,GAAK,EACpC,QAAS,IACT,QAAS,CACrB,CAAS,EAGL,SAASC,GAAU,CACfH,EAAI,UAAU,EAAG,EAAGD,EAAO,MAAOA,EAAO,MAAM,EAE/C,IAAIK,EAAkB,EAEtBH,EAAU,QAAQ,CAACI,EAAGC,IAAU,CAC5BD,EAAE,QAAUA,EAAE,QACdA,EAAE,GAAKA,EAAE,OACTA,EAAE,GAAKA,EAAE,OACTA,EAAE,UAAYA,EAAE,cAGZA,EAAE,EAAIN,EAAO,OAAS,MACtBM,EAAE,SAAW,KAGbA,EAAE,QAAU,GAAKA,EAAE,EAAIN,EAAO,OAAS,KACvCK,IAEAJ,EAAI,KAAI,EACRA,EAAI,UAAUK,EAAE,EAAGA,EAAE,CAAC,EACtBL,EAAI,OAAQK,EAAE,SAAW,KAAK,GAAM,GAAG,EACvCL,EAAI,YAAcK,EAAE,QACpBL,EAAI,UAAYK,EAAE,MAGlBL,EAAI,SAAS,CAACK,EAAE,KAAO,EAAG,CAACA,EAAE,KAAO,EAAGA,EAAE,KAAMA,EAAE,IAAI,EAErDL,EAAI,QAAO,EAEnB,CAAC,EAEGI,EAAkB,EAClB,sBAAsBD,CAAO,EAE7BJ,EAAO,OAAM,CAErB,CAEAI,GACJ,CCxDA,MAAMI,EAAe,CACjB,KAAQ,CACJ,KAAM,cACN,MAAO,SACP,MAAO,MACf,EACI,OAAU,CACN,KAAM,uBACN,MAAO,OACP,MAAO,QACf,EACI,GAAM,CACF,KAAM,uBACN,MAAO,SACP,MAAO,IACf,EACI,SAAY,CACR,KAAM,sBACN,MAAO,QACP,MAAO,UACf,CACA,EAIMC,EAAiB,IAAMC,EAAa,IAAI,aAAa,EACrDC,GAAkBC,GAAUF,EAAa,IAAI,cAAeE,CAAK,EACjEC,EAA0B,IAAMH,EAAa,IAAI,sBAAsB,EACvEI,GAA2BF,GAAUF,EAAa,IAAI,uBAAwBE,CAAK,EACnFG,EAAiB,IAAML,EAAa,IAAI,aAAa,EACrDM,GAAkBJ,GAAUF,EAAa,IAAI,cAAeE,CAAK,EACjEK,EAAe,IAAMP,EAAa,IAAI,WAAW,EACjDQ,GAAgBN,GAAUF,EAAa,IAAI,YAAaE,CAAK,EAC7DO,GAAmB,IAAMT,EAAa,IAAI,eAAe,EACzDU,GAAoBR,GAAUF,EAAa,IAAI,gBAAiBE,CAAK,EACrES,GAAuB,IAAMX,EAAa,IAAI,mBAAmB,EACjEY,GAAwBV,GAAUF,EAAa,IAAI,oBAAqBE,CAAK,EAC7EW,GAAmB,IAAMb,EAAa,IAAI,eAAe,EACzDc,GAAoBZ,GAAUF,EAAa,IAAI,gBAAiBE,CAAK,EACrEa,EAAc,IAAMf,EAAa,IAAI,UAAU,EAC/CgB,EAAed,GAAUF,EAAa,IAAI,WAAYE,CAAK,EAC3De,EAAoB,IAAMjB,EAAa,IAAI,gBAAgB,EAC3DkB,EAAqBhB,GAAUF,EAAa,IAAI,iBAAkBE,CAAK,EACvEiB,EAAoB,IAAMnB,EAAa,IAAI,gBAAgB,EAC3DoB,EAAqBlB,GAAUF,EAAa,IAAI,iBAAkBE,CAAK,EACvEmB,EAAmB,IAAMrB,EAAa,IAAI,eAAe,EACzDsB,GAAoBpB,GAAUF,EAAa,IAAI,gBAAiBE,CAAK,EACrEqB,EAAkB,IAAMvB,EAAa,IAAI,cAAc,EACvDwB,GAAmBtB,GAAUF,EAAa,IAAI,eAAgBE,CAAK,EACnEuB,EAAiB,IAAMzB,EAAa,IAAI,aAAa,EACrD0B,GAAkBxB,GAAUF,EAAa,IAAI,cAAeE,CAAK,EACjEyB,GAAoC,IAAM3B,EAAa,IAAI,gCAAgC,EAC3F4B,EAAqC1B,GAAUF,EAAa,IAAI,iCAAkCE,CAAK,EACvG2B,GAAoC,IAAM7B,EAAa,IAAI,gCAAgC,EAC3F8B,GAAqC5B,GAAUF,EAAa,IAAI,iCAAkCE,CAAK,EAGvG6B,GAAe,CACjB,OAAU,CAAE,GAAI,gBAAiB,KAAM,kBAAmB,OAAQ,mBAAmB,EACrF,KAAQ,CAAE,GAAI,cAAe,KAAM,gBAAiB,OAAQ,iBAAiB,EAC7E,OAAU,CAAE,GAAI,gBAAiB,KAAM,kBAAmB,OAAQ,mBAAmB,EACrF,MAAS,CAAE,GAAI,eAAgB,KAAM,iBAAkB,OAAQ,kBAAkB,CACrF,EAGA,eAAeC,GAAsBvI,EAAUwI,EAAaC,EAAM,CAC9D,QAAQ,IAAI,uCAAuCzI,CAAQ,UAAUwI,CAAW,WAAWC,CAAI,EAAE,EAEjG,MAAMC,EAAqBC,GAAQ,CAC/B,MAAM9E,EAAO8E,EAAI,KAAI,EACrB,MAAO,CACH,GAAIA,EAAI,GACR,SAAU9E,EAAK,SACf,QAASA,EAAK,QAAQ,IAAI,CAAC+E,EAAKxC,KAAW,CACvC,GAAI,OAAO,aAAa,GAAKA,CAAK,EAClC,KAAMwC,EACN,QAASxC,IAAUvC,EAAK,aACxC,EAAc,EACF,YAAaA,EAAK,aAAe,+BACjC,UAAWA,EAAK,WAAa,GAC7B,KAAMA,EAAK,MAAQ,EAC/B,CACI,EAGA,GAAIhD,EAAU,EAAI,CACd,QAAQ,IAAI,kEAAkE,EAI9E,MAAMgI,EAAQ,aAAa,QADF,+BAC0B,EAEnD,IAAIC,EAAgB,GAEpB,GAAID,EACA,GAAI,CACA,MAAME,EAAS,KAAK,MAAMF,CAAK,EAC/B,QAAQ,IAAI,MAAME,EAAO,MAAM,yCAAyC,EAGxED,EAAgBC,EAAO,IAAIC,IAAM,CAC7B,GAAIA,EAAE,GACN,SAAUA,EAAE,SACZ,QAASA,EAAE,QAAQ,IAAI,CAACJ,EAAKxC,KAAW,CACpC,GAAI,OAAO,aAAa,GAAKA,CAAK,EAClC,KAAMwC,EACN,QAASxC,IAAU4C,EAAE,aAC7C,EAAsB,EACF,YAAaA,EAAE,aAAe,+BAC9B,UAAWA,EAAE,WAAa,GAC1B,KAAMA,EAAE,MAAQ,EACpC,EAAkB,EAGFF,EAAgBA,EAAc,OAAOE,GAAK,CACtC,MAAMC,EAAc,CAACjJ,GAAY+I,EAAO,KAAK5C,GAAKA,EAAE,KAAO6C,EAAE,EAAE,GAAG,SAAWhJ,EACvEkJ,EAAa,CAACV,GAAeO,EAAO,KAAK5C,GAAKA,EAAE,KAAO6C,EAAE,EAAE,GAAG,QAAUR,EAC9E,OAAOS,GAAeC,CAC1B,CAAC,CAEL,MAAY,CACR,QAAQ,KAAK,kEAAkE,CACnF,CAIJ,OAAIJ,EAAc,SAAW,IACzB,QAAQ,IAAI,8DAA8D,EAC1EA,EAAgB,CACZ,CACI,GAAI,SACJ,SAAU,yEACV,QAAS,CACL,CAAE,GAAI,IAAK,KAAM,WAAY,QAAS,EAAK,EAC3C,CAAE,GAAI,IAAK,KAAM,WAAY,QAAS,EAAK,EAC3C,CAAE,GAAI,IAAK,KAAM,WAAY,QAAS,EAAK,EAC3C,CAAE,GAAI,IAAK,KAAM,iCAAkC,QAAS,EAAI,CACxF,EACoB,YAAa,0FACb,UAAW,yCACX,KAAM,CAAC,UAAW,WAAW,CACjD,EACgB,CACI,GAAI,SACJ,SAAU,6GACV,QAAS,CACL,CAAE,GAAI,IAAK,KAAM,WAAY,QAAS,EAAK,EAC3C,CAAE,GAAI,IAAK,KAAM,WAAY,QAAS,EAAI,EAC1C,CAAE,GAAI,IAAK,KAAM,YAAa,QAAS,EAAK,EAC5C,CAAE,GAAI,IAAK,KAAM,YAAa,QAAS,EAAK,CACpE,EACoB,YAAa,qEACb,UAAW,kBACX,KAAM,CAAC,UAAW,UAAU,CAChD,EACgB,CACI,GAAI,SACJ,SAAU,kEACV,QAAS,CACL,CAAE,GAAI,IAAK,KAAM,OAAQ,QAAS,EAAK,EACvC,CAAE,GAAI,IAAK,KAAM,OAAQ,QAAS,EAAI,EACtC,CAAE,GAAI,IAAK,KAAM,OAAQ,QAAS,EAAK,EACvC,CAAE,GAAI,IAAK,KAAM,OAAQ,QAAS,EAAK,CAC/D,EACoB,YAAa,6DACb,UAAW,0BACX,KAAM,CAAC,SAAU,UAAU,CAC/C,EACgB,CACI,GAAI,SACJ,SAAU,2EACV,QAAS,CACL,CAAE,GAAI,IAAK,KAAM,WAAY,QAAS,EAAK,EAC3C,CAAE,GAAI,IAAK,KAAM,WAAY,QAAS,EAAI,EAC1C,CAAE,GAAI,IAAK,KAAM,WAAY,QAAS,EAAK,EAC3C,CAAE,GAAI,IAAK,KAAM,WAAY,QAAS,EAAK,CACnE,EACoB,YAAa,8CACb,UAAW,OACX,KAAM,CAAC,UAAW,QAAQ,CAC9C,EACgB,CACI,GAAI,SACJ,SAAU,mEACV,QAAS,CACL,CAAE,GAAI,IAAK,KAAM,YAAa,QAAS,EAAK,EAC5C,CAAE,GAAI,IAAK,KAAM,aAAc,QAAS,EAAI,EAC5C,CAAE,GAAI,IAAK,KAAM,aAAc,QAAS,EAAK,EAC7C,CAAE,GAAI,IAAK,KAAM,aAAc,QAAS,EAAK,CACrE,EACoB,YAAa,2CACb,UAAW,aACX,KAAM,CAAC,WAAY,UAAU,CACjD,CACA,GAGQ,QAAQ,IAAI,KAAKA,EAAc,MAAM,uCAAuC,EACrEA,CACX,CAEA,GAAI,CAEA,IAAIK,EAAKC,GACL3H,GAAWH,GAAI,WAAW,EAC1B+H,EAAM,SAAU,KAAMrJ,CAAQ,EAC9BqJ,EAAM,QAAS,KAAMb,CAAW,EAChCa,EAAM,OAAQ,KAAMZ,CAAI,CACpC,EACYa,EAAO,MAAMC,GAAQJ,CAAE,EAC3B,GAAI,CAACG,EAAK,MAAO,CACb,MAAME,EAAM,GACZ,OAAAF,EAAK,QAASG,GAAMD,EAAI,KAAKd,EAAkBe,CAAC,CAAC,CAAC,EAClD,QAAQ,IAAI,KAAKD,EAAI,MAAM,6BAA6B,EACjDA,CACX,CAIA,MAAME,EADa,CAAC,UAAW,UAAW,OAAQ,QAAS,MAAO,OAAQ,UAAW,OAAQ,YAAa,UAAW,WAAY,UAAU,EAC9GlB,EAAc,CAAC,EACtCmB,EAAkBD,EAAU,OAAO,CAAC,EAAE,YAAW,EAAKA,EAAU,MAAM,CAAC,EAAE,YAAW,EAE1F,IAAIE,EAAKR,GACL3H,GAAWH,GAAI,WAAW,EAC1B+H,EAAM,SAAU,KAAMrJ,CAAQ,EAC9BqJ,EAAM,QAAS,KAAMM,CAAe,EACpCN,EAAM,OAAQ,KAAMZ,CAAI,CACpC,EAEQ,GADAa,EAAO,MAAMC,GAAQK,CAAE,EACnB,CAACN,EAAK,MAAO,CACb,MAAME,EAAM,GACZ,OAAAF,EAAK,QAASG,GAAMD,EAAI,KAAKd,EAAkBe,CAAC,CAAC,CAAC,EAClD,QAAQ,IAAI,KAAKD,EAAI,MAAM,yBAAyB,EAC7CA,CACX,CAEA,eAAQ,KAAK,gEAAgE,EACtE,EACX,OAAS1K,EAAO,CACZ,cAAQ,MAAM,6CAA8CA,CAAK,EAC3DA,CACV,CACJ,CAGA,eAAe+K,GAAkB7J,EAAUwI,EAAaC,EAAM,CAC1D,GAAI,CACA,MAAMqB,EAAO,MAAM,MAAM,8BAA8B,EACvD,GAAI,CAACA,EAAK,GAAI,MAAO,GACrB,MAAMjG,EAAO,MAAMiG,EAAK,KAAI,EAEtBJ,EADa,CAAC,UAAW,UAAW,OAAQ,QAAS,MAAO,OAAQ,UAAW,OAAQ,YAAa,UAAW,WAAY,UAAU,EAC9GlB,EAAc,CAAC,EAG5C,OADiB3E,EAAK,OAAOmF,GAAKA,EAAE,SAAWhJ,GAAYgJ,EAAE,OAASP,IAASO,EAAE,QAAUU,GAAaV,EAAE,QAAUR,EAAY,EAChH,IAAI,CAACQ,EAAGe,KAAS,CAC7B,GAAI,QAAQ/J,CAAQ,IAAI+J,CAAG,GAC3B,SAAUf,EAAE,SACZ,QAASA,EAAE,QAAQ,IAAI,CAACJ,EAAKxC,KAAW,CACpC,GAAI,OAAO,aAAa,GAAKA,CAAK,EAClC,KAAMwC,EACN,QAASxC,IAAU4C,EAAE,aACrC,EAAc,EACF,YAAaA,EAAE,aAAe,+BAC9B,UAAWA,EAAE,WAAa,GAC1B,KAAMA,EAAE,MAAQ,EAC5B,EAAU,CACN,OAASgB,EAAG,CACR,eAAQ,KAAK,iCAAkCA,CAAC,EACzC,EACX,CACJ,CAGO,eAAeC,GAAUjK,EAAU,CACtC,MAAMkK,EAAS7D,EAAarG,CAAQ,EACpC,GAAI,CAACkK,EAAQ,CACT,QAAQ,MAAM,6BAA8BlK,CAAQ,EACpDoB,EAAM,MAAM,wCAAwC,EACpD,MACJ,CAGA,MAAMmE,EAAeC,GAAiB,sBAAsB0E,EAAO,KAAK,KAAK,EAC7EC,GAAkBD,EAAO,KAAK,EAE9B,GAAI,CAGA,KAAM,CAAE,sBAAAE,EAAuB,eAAApC,EAAgB,qBAAAqC,GAAyB,MAAK9I,EAAA,sCAAA6I,EAAA,eAAApC,EAAA,qBAAAqC,CAAA,OAAC,QAAO,4BAAkB,OAAA7I,KAAA,gCAAA4I,EAAA,eAAApC,EAAA,qBAAAqC,CAAA,6BACjG7B,EAAc4B,EAAqB,EACnC3B,EAAOT,EAAc,EAGrB2B,EAAkBU,EAAqB7B,EAAaC,CAAI,EAC9DV,GAAgB4B,CAAe,EAC/B1B,GAAeQ,CAAI,EACnBZ,GAAiB7H,CAAQ,EAG7B,GAAI,CAAE,OAAO,cAAgB,EAAM,MAAY,CAAC,CAG5C,IAAIsK,EAAY,MAAM/B,GAAsBvI,EAAUwI,EAAaC,CAAI,EAQvE,GALI6B,EAAU,SAAW,GAAKzJ,EAAU,IACpC,QAAQ,IAAI,wDAAwD,EACpEyJ,EAAY,MAAMT,GAAkB7J,EAAUwI,EAAaC,CAAI,GAG/D6B,EAAU,SAAW,EAAG,CAExB5E,EAAmBH,EAAc,6BAA8B,OAAO,EAEtE,MAAMgF,EAAezC,EAAe,EACpC1G,EAAM,MAAM,gCAAgC8I,EAAO,KAAK,OAAOK,CAAY;;AAAA,6BAAoC,GAAI,EACnH,MACJ,CAIA,MAAMA,EAAezC,EAAe,EACpCtB,GAAe,CAEX,KAAM,QAAQ0D,EAAO,KAAK,MAAMK,CAAY,GAC5C,OAAQL,EAAO,KACf,MAAOA,EAAO,MACd,UAAWI,CACvB,CAAS,EAGD3D,GAAwB,CAAC,EACzBE,GAAe,EAAE,EACjBE,GAAa,KAAK,KAAK,EACvBI,GAAqB,KAAK,KAAK,EAG/BpH,GAAeC,EAAU8H,GAAiB,EAC1CT,GAAiB,CAAC,EAClBE,EAAY,EAAK,EACjBE,EAAkB,CAAC,EACnBE,EAAkB,IAAI,EACtBQ,EAAkC,EAAK,EAI3CqC,GAAY,EACRC,GAAc,EACdC,GAAU,EACVC,GAAkB,EAGlBjF,EAAmBH,EAAc,GAAG+E,EAAU,MAAM,wBAAyB,SAAS,CAE1F,OAASxL,EAAO,CACZ8L,IAEA,QAAQ,MAAM,sCAAuC9L,CAAK,EAC1D4G,EAAmBH,EAAc,uBAAwB,OAAO,EAChEnE,EAAM,MAAM,yDAA0D,GAAI,CAC9E,CACJ,CAGA,SAAS+I,GAAkBU,EAAY,CACnC,MAAMC,EAAWC,GAAmB,EACpCD,EAAS,UAAY;AAAA;AAAA;AAAA;AAAA,gGAIuEE,EAAWH,CAAU,CAAC;AAAA;AAAA;AAAA;AAAA,MAKlHC,EAAS,UAAU,OAAO,aAAa,CAC3C,CAOA,SAASN,IAAe,CACpB,SAAS,eAAe,gBAAgB,GAAG,UAAU,IAAI,aAAa,EACtE,SAAS,eAAe,uBAAuB,GAAG,UAAU,IAAI,aAAa,EAC7E,SAAS,eAAe,YAAY,GAAG,UAAU,IAAI,aAAa,EAEjDO,GAAmB,EAC3B,UAAU,OAAO,aAAa,CAC3C,CAEA,SAASA,IAAsB,CAC3B,IAAID,EAAW,SAAS,eAAe,WAAW,EAClD,OAAKA,IACDA,EAAW,SAAS,cAAc,KAAK,EACvCA,EAAS,GAAK,YACd,SAAS,cAAc,MAAM,EAAE,YAAYA,CAAQ,GAEvDG,GAA8BH,CAAQ,EAC/BA,CACX,CAEA,SAASG,GAA8BH,EAAU,CAEzC1C,GAAiC,GAAM,CAAC0C,IAI5CA,EAAS,iBAAiB,QAAUpK,GAAU,CAC1C,MAAMwK,EAAexK,EAAM,OAAO,QAAQ,gBAAgB,EAC1D,GAAIwK,GAAgB,CAACA,EAAa,SAAU,CACxC,MAAMC,EAAWD,EAAa,QAAQ,SAClCC,GACAC,GAAaD,CAAQ,EAEzB,MACJ,CAGA,GADmBzK,EAAM,OAAO,QAAQ,oBAAoB,EAC5C,CACZA,EAAM,eAAc,EACpB2K,GAAY,EACZ,MACJ,CAGA,GADmB3K,EAAM,OAAO,QAAQ,gBAAgB,EACxC,CACZA,EAAM,eAAc,EAChB,QAAQ,uEAAuE,GAC/E4K,GAAiB,EAErB,MACJ,CAGA,GADoB5K,EAAM,OAAO,QAAQ,iBAAiB,EACzC,CACbA,EAAM,eAAc,EACpB6K,GAAe,EACf,MACJ,CAGA,GADoB7K,EAAM,OAAO,QAAQ,YAAY,EACpC,CACbA,EAAM,eAAc,EACpB8K,GAAW,EACX,MACJ,CACJ,CAAC,EAEDnD,GAAkC,EAAI,EAC1C,CAGA,SAASoC,IAAiB,CAEtB,MAAMgB,EAAcnF,EAAc,EAC5BoF,EAAuBhF,EAAuB,EAC9CiF,EAAWF,EAAY,UAAUC,CAAoB,EACrDZ,EAAW,SAAS,eAAe,WAAW,EAC9Cc,EAActD,GAAamD,EAAY,KAAK,EAClDtD,EAAkC,EAAK,EAEvC2C,EAAS,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uEAM8CE,EAAWS,EAAY,IAAI,CAAC;AAAA,qEAC9BC,EAAuB,CAAC,QAAQD,EAAY,UAAU,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCAoC/FG,EAAY,EAAE,iEAAkEF,EAAuB,GAAKD,EAAY,UAAU,OAAU,GAAG;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2DAYtHG,EAAY,IAAI,cAAcF,EAAuB,CAAC,QAAQD,EAAY,UAAU,MAAM;AAAA;AAAA;AAAA;AAAA,0BAI3HT,EAAWW,EAAS,QAAQ,CAAC;AAAA;AAAA;AAAA;AAAA,sBAIjCA,EAAS,MAAQA,EAAS,KAAK,OAAS,EAAI;AAAA;AAAA,8BAEpCA,EAAS,KAAK,IAAIE,GAAO;AAAA;AAAA,sCAEjBb,EAAWa,CAAG,CAAC;AAAA;AAAA,6BAExB,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,sBAEf,EAAE;AAAA;;AAAA;AAAA;AAAA;AAAA,0BAMAF,EAAS,QAAQ,IAAIG,GAAU;AAAA,sDACHd,EAAWc,EAAO,EAAE,CAAC;AAAA,uIAC4DL,EAAY,KAAK,iBAAiBA,EAAY,KAAK;AAAA;AAAA,qFAErGG,EAAY,EAAE;AAAA,yEAC1BA,EAAY,IAAI,KAAKZ,EAAWc,EAAO,EAAE,CAAC;AAAA;AAAA;AAAA,0CAGzEd,EAAWc,EAAO,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA,yBAIxC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,gEAa6BF,EAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAW1EjB,GAAkB,CACtB,CAGA,SAASS,GAAaD,EAAU,CAE5B,GAAIjD,GAAiC,EACjC,OAEJ,MAAMuD,EAAcnF,EAAc,EAC5BoF,EAAuBhF,EAAuB,EAC9CqF,EAAoB7E,GAAoB,EACxCyE,EAAWF,EAAY,UAAUC,CAAoB,EACrDM,EAAiBL,EAAS,QAAQ,KAAK/C,GAAOA,EAAI,KAAOuC,CAAQ,EACjEc,EAAY,KAAK,OAAO,KAAK,IAAG,EAAKF,GAAqB,GAAI,EACpE5D,EAAkC,EAAI,EAGtC,MAAM+D,EAActF,EAAc,EAClCsF,EAAY,KAAK,CACb,WAAYP,EAAS,GACrB,SAAUA,EAAS,SACnB,eAAgBR,EAChB,cAAeQ,EAAS,QAAQ,KAAK/C,GAAOA,EAAI,OAAO,EAAE,GACzD,UAAWoD,EAAe,QAC1B,UAAWC,CACnB,CAAK,EACDpF,GAAeqF,CAAW,EAG1B,IAAIC,EAAgB/E,GAAgB,EAChC4E,EAAe,QACfG,IAEAA,EAAgB,EAEpB9E,GAAiB8E,CAAa,EAG9B,SAAS,iBAAiB,gBAAgB,EAAE,QAAQC,GAAO,CACvDA,EAAI,SAAW,GACfA,EAAI,UAAU,OAAO,0BAA2B,oBAAoB,CACxE,CAAC,EAGDC,GAAmBlB,EAAUa,EAAe,QAASL,CAAQ,EAG7DhB,GAAkB,EAGlB,WAAW,IAAM,CACb,SAAS,eAAe,kBAAkB,GAAG,UAAU,OAAO,QAAQ,CAC1E,EAAG,GAAI,CACX,CAGA,SAAS0B,GAAmBC,EAAYC,EAAWZ,EAAU,CAEzD,MAAMF,EAAcnF,EAAc,EACdgC,GAAamD,EAAY,KAAK,EAClD,MAAMe,EAAgBb,EAAS,QAAQ,KAAK/C,GAAOA,EAAI,OAAO,EAG9D,SAAS,iBAAiB,gBAAgB,EAAE,QAAQwD,GAAO,CACvD,MAAMK,EAAQL,EAAI,QAAQ,SAEtBK,IAAUD,EAAc,IAExBJ,EAAI,UAAU,IAAI,mBAAoB,aAAa,EACnDA,EAAI,UAAU,OAAO,iBAAiB,GAC/BK,IAAUH,GAAc,CAACC,IAEhCH,EAAI,UAAU,IAAI,iBAAkB,WAAW,EAC/CA,EAAI,UAAU,OAAO,iBAAiB,EAE9C,CAAC,EAGD,MAAMM,EAAkB,SAAS,eAAe,kBAAkB,EAC9DA,IACAA,EAAgB,UAAY;AAAA;AAAA,kBAElBH,EACE,ySACA,0SACpB;AAAA;AAAA,mDAEmDA,EAAY,iBAAmB,cAAc;AAAA,0BACtEA,EAAY,oBAAsB,sBAAsB;AAAA;AAAA,oFAEEvB,EAAWW,EAAS,WAAW,CAAC;AAAA,sBAC9FA,EAAS,UAAY,kEAAkEX,EAAWW,EAAS,SAAS,CAAC,OAAS,EAAE;AAAA;AAAA;AAAA,UAI9Ie,EAAgB,UAAU,OAAO,QAAQ,EAEjD,CAGA,SAASrB,IAAe,CAEpBlE,GAAqB,KAAK,KAAK,EAC/B,MAAMuE,EAAuBhF,EAAuB,EACpDC,GAAwB+E,EAAuB,CAAC,EAEhD,MAAMD,EAAcnF,EAAc,EACjBI,EAAuB,EACzB+E,EAAY,UAAU,OACjChB,GAAc,EAEdkC,GAAW,CAEnB,CAGA,SAASA,IAAc,CAEnB/B,EAAS,EACT,GAAI,CAAE,OAAO,cAAgB,EAAO,MAAY,CAAC,CAEjD,MAAMsB,EAActF,EAAc,EAElC,GAAIsF,EAAY,SAAW,EAAG,CAC1B,QAAQ,MAAM,8CAA8C,EAC5D9K,EAAM,MAAM,gEAAgE,EAC5E,MACJ,CAEA,MAAMwL,EAAeV,EAAY,OAAOW,GAAKA,EAAE,SAAS,EAAE,OACpD1M,EAAQ,KAAK,MAAOyM,EAAeV,EAAY,OAAU,GAAG,EAGlE,GAAI,MAAM/L,CAAK,GAAKA,EAAQ,GAAKA,EAAQ,IAAK,CAC1C,QAAQ,MAAM,4BAA6BA,CAAK,EAChDiB,EAAM,MAAM,kDAAkD,EAC9D,MACJ,CACA,MAAM0L,EAAiBtF,EAAiB,EAClCuF,EAAWzF,EAAW,EACtB0F,EAAiBtF,EAAiB,EACxC,IAAIuF,EAAeH,EACfC,GAAYC,IACZC,GAAgB,KAAK,IAAG,EAAKD,GAEjC,MAAME,EAAYpG,EAAY,EACxBqG,EAAY,KAAK,IAAI,EAAG,KAAK,OAAO,KAAK,IAAG,EAAKD,EAAYD,GAAgB,GAAI,CAAC,EACxF1F,EAAY,EAAK,EACjBI,EAAkB,IAAI,EACtBF,EAAkB,CAAC,EACnB,MAAM2F,EAAU,KAAK,MAAMD,EAAY,EAAE,EACnCE,EAAUF,EAAY,GAG5BG,GAAoBnN,EAAOgN,CAAS,EAGpC,MAAM1B,EAAcnF,EAAc,EAClC,GAAI,CAACmF,EAAa,CACd,QAAQ,MAAM,2CAA2C,EACzDrK,EAAM,MAAM,kEAAmE,EAC/E,MACJ,CAEA,MAAMwK,EAActD,GAAamD,EAAY,KAAK,EAC5CX,EAAW,SAAS,eAAe,WAAW,EAEpDA,EAAS,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wDAM+BW,EAAY,KAAK,WAAWA,EAAY,KAAK;AAAA;AAAA,+DAEtCtL,CAAK;AAAA,wDACZ+L,EAAY,OAAOW,GAAKA,EAAE,SAAS,EAAE,MAAM,MAAMX,EAAY,MAAM;AAAA,2EAChDkB,CAAO,IAAIC,EAAQ,SAAQ,EAAG,SAAS,EAAG,GAAG,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,0BAK/FlN,GAAS,GACP,kLACJA,GAAS,GACL,oKACJA,GAAS,GACL,iLACA,6KAC5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAO8B+L,EAAY,IAAI,CAACqB,EAAQnH,KAAU;AAAA,+FAC8BmH,EAAO,UAAY,cAAgB,WAAW;AAAA;AAAA,uDAEtFA,EAAO,UAAY,iBAAmB,cAAc;AAAA,8CAC7DA,EAAO,UAAY,IAAM,GAAG;AAAA;AAAA;AAAA,6FAGmBnH,GAAQ,CAAC;AAAA,gFACtBmH,EAAO,QAAQ;AAAA,8CAChDA,EAAO,UAAyI,GAA7H,0DAA0DA,EAAO,cAAc,iBAAiBA,EAAO,aAAa,MAAW;AAAA;AAAA;AAAA,2EAGtHA,EAAO,SAAS;AAAA;AAAA,6BAE9D,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oEAM6B3B,EAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAa1EzL,GAAS,IACT,WAAW,IAAMyF,GAAc,EAAI,GAAG,EAK1C,MAAM4H,EAAgB,KAAK,OAAO,KAAK,IAAG,EAAK1G,EAAY,GAAM,GAAI,EACrE5G,GACI0H,EAAgB,EAChBzH,EACAqN,EACA/B,GAAa,WAAW,QAAU,CAC1C,EAGI,SAAS,eAAe,gBAAgB,GAAG,iBAAiB,QAAS,IAAM,CACvE,MAAMgC,EAAgB7F,EAAgB,EAClC6F,EACAxD,GAAUwD,CAAa,EAEvBrM,EAAM,MAAM,2CAA2C,CAE/D,CAAC,EAED,SAAS,eAAe,sBAAsB,GAAG,iBAAiB,QAASkK,EAAiB,CAChG,CAGA,eAAegC,GAAoBnN,EAAOgN,EAAW,CAEjD,GAAI,CAEA,GAAI,CADSO,GAAqB,EACvB,CACP,QAAQ,IAAI,6CAA6C,EACzD9C,IACA,MACJ,CAGA,GAAI/J,EAAU,EAAI,CACd,QAAQ,IAAI,oDAAoD,EAChEO,EAAM,KAAK,mDAAmD,EAC9DwJ,IACA,MACJ,CAGA,MAAM6C,EAAgB7F,EAAgB,EAChC2C,EAAezC,EAAe,EAC9B6F,EAAc3F,EAAc,EAC5ByD,EAAcnF,EAAc,EAC5B4F,EAActF,EAAc,EAC5BgH,EAAgBvH,EAAaoH,CAAa,GAAK,GAC/CI,EAAW,CACb,SAAUJ,EACV,WAAYG,EAAc,MAAQnC,EAAY,QAAUgC,EACxD,MAAAtN,EACA,eAAgB+L,EAAY,OAAOW,GAAKA,EAAE,SAAS,EAAE,OACrD,eAAgBpB,EAAY,UAAU,OACtC,YAAa0B,EACb,QAASjB,EACT,MAAO3B,EACP,KAAMoD,CAClB,EAGQ,MAAM3K,GACF,IAAMkC,GAAe2I,CAAQ,EAC7B,CACI,WAAY,EACZ,QAAS,CAACzL,EAASI,IAAU,CACzBpB,EAAM,KAAK,oCAAoCgB,CAAO,QAAS,GAAI,CACvE,CAChB,CACA,EAEQhB,EAAM,QAAQ,oCAAqC,GAAI,EACvD,QAAQ,IAAI,sCAAsC,CACtD,OAAStC,EAAO,CACZ,QAAQ,MAAM,kCAAmCA,CAAK,EACtD8L,IAGAxJ,EAAM,MAAM,iGAAkG,GAAI,EAGlH,GAAI,CAEA,MAAMqM,EAAgB7F,EAAgB,EAChC2C,EAAezC,EAAe,EAC9B6F,EAAc3F,EAAc,EAC5BkE,EAActF,EAAc,EAE5BkH,EAAa,CACf,SAAUL,EACV,WAAYpH,EAAaoH,CAAa,GAAG,MAAQA,EACjD,MAAOtN,EACP,eAAgB+L,EAAY,OAAOW,GAAKA,EAAE,SAAS,EAAE,OACrD,eAAgBX,EAAY,OAC5B,YAAaiB,EACb,QAASjB,EACT,MAAO3B,EACP,KAAMoD,CACtB,EAGkB,CAAE,UAAA5I,CAAS,EAAK,MAAKxD,EAAA,0BAAAwD,CAAA,QAAC,2BAAAgJ,EAAA,EAAwB,iBAAAhJ,CAAA,WACpD,MAAMA,EAAU,IAAI,aAAc,MAAOlB,GAAS,CAC9C,MAAMqB,GAAerB,CAAI,CAC7B,EAAGiK,CAAU,EAEb,QAAQ,IAAI,0DAA2D,CAC3E,OAASE,EAAY,CACjB,QAAQ,MAAM,sCAAwCA,CAAU,EAEhE,GAAI,CACA,MAAMC,EAAW,eAAe,KAAK,IAAG,CAAE,GAC1C,aAAa,QAAQA,EAAU,KAAK,UAAU,CAC1C,MAAA9N,EACA,UAAAgN,EACA,SAAUvF,EAAgB,EAC1B,MAAOE,EAAe,EACtB,KAAME,EAAc,EACpB,YAAapB,EAAc,EAC3B,UAAW,KAAK,IAAG,CACvC,CAAiB,CAAC,CACN,OAASsH,EAAY,CACjB,QAAQ,MAAM,yCAA0CA,CAAU,CACtE,CACJ,CACJ,CACJ,CAGA,SAASxD,IAAa,CAElBE,EAAS,EACT,MAAMuD,EAAW,YAAY,IAAM,CAC/B,MAAMjB,EAAYpG,EAAY,EAC9B,GAAIoG,IAAc,KACd,OAGJ,MAAMJ,EAAiBtF,EAAiB,EAClCuF,EAAWzF,EAAW,EACtB0F,EAAiBtF,EAAiB,EACxC,IAAIuF,EAAeH,EACfC,GAAYC,IACZC,GAAgB,KAAK,IAAG,EAAKD,GAGjC,MAAMoB,EAAY,KAAK,IAAG,EAAKlB,EAAYD,EACrCoB,EAAU,KAAK,IAAI,EAAG,KAAK,MAAMD,EAAY,GAAI,CAAC,EAClDhB,EAAU,KAAK,MAAMiB,EAAU,EAAE,EACjChB,EAAUgB,EAAU,GACpBC,EAAe,SAAS,eAAe,YAAY,EACrDA,IACAA,EAAa,YAAc,GAAGlB,CAAO,IAAIC,EAAQ,SAAQ,EAAG,SAAS,EAAG,GAAG,CAAC,GAEpF,EAAG,GAAI,EACPpG,GAAiBkH,CAAQ,CAC7B,CAEA,SAASvD,GAAY,CAEjB,MAAM2D,EAAgBvH,GAAgB,EAClCuH,IACA,cAAcA,CAAa,EAC3BtH,GAAiB,IAAI,GAEzBU,EAAkB,IAAI,CAC1B,CAIA,OAAO,iBAAiB,eAAgB,IAAM,CAC1CiD,EAAS,CACb,CAAC,EAGD,SAAS,iBAAiB,mBAAoB,IAAM,CAIpD,CAAC,EAGD,SAASD,IAAqB,CAE1B,MAAMuB,EAActF,EAAc,EAClC,GAAIsF,EAAY,SAAW,EAAG,OAE9B,MAAM/L,EAAQ,KAAK,MAAO+L,EAAY,OAAOW,GAAKA,EAAE,SAAS,EAAE,OAASX,EAAY,OAAU,GAAG,EAC3FsC,EAAe,SAAS,eAAe,YAAY,EACrDA,IACAA,EAAa,YAAc,UAAUrO,CAAK,IAElD,CAGA,SAASoL,IAAkB,CACvB,SAAS,KAAK,UAAU,OAAO,YAAY,CAC/C,CAGA,SAASC,IAAc,CAEnB,MAAMiD,EAAW,SAAS,eAAe,WAAW,EACpD,GAAI,CAACA,EACD,OAIJ,GAAI,CADanH,EAAW,EAExBC,EAAY,EAAI,EAChBI,EAAkB,KAAK,KAAK,EAC5B8G,EAAS,UAAY,oYACrBrN,EAAM,QAAQ,yDAA0D,GAAI,MACzE,CAEHmG,EAAY,EAAK,EACjB,MAAMyF,EAAiBtF,EAAiB,EACxC,GAAIsF,EAAgB,CAChB,MAAMF,EAAiBtF,EAAiB,EACxCC,EAAkBqF,GAAkB,KAAK,IAAG,EAAKE,EAAe,CACpE,CACArF,EAAkB,IAAI,EACtB8G,EAAS,UAAY,yNACrBrN,EAAM,QAAQ,gBAAiB,GAAI,CACvC,CACJ,CAGA,SAASkK,IAAoB,CAEzBV,EAAS,EACT,GAAI,CAAE,OAAO,cAAgB,EAAO,MAAY,CAAC,CACjDrD,EAAY,EAAK,EACjBE,EAAkB,CAAC,EACnBE,EAAkB,IAAI,EACtBQ,EAAkC,EAAK,EACvC,SAAS,eAAe,WAAW,GAAG,UAAU,IAAI,aAAa,EACjE,SAAS,eAAe,gBAAgB,GAAG,UAAU,OAAO,aAAa,EAGzE,SAAS,iBAAiB,WAAW,EAAE,QAAQuG,GAAQ,CACnDA,EAAK,UAAU,OAAO,gBAAiB,iBAAiB,EACxDA,EAAK,UAAU,IAAI,iBAAiB,CACxC,CAAC,EACD,SAAS,eAAe,eAAe,GAAG,UAAU,IAAI,gBAAiB,iBAAiB,EAG1FtN,EAAM,KAAK,4BAA6B,GAAI,EAG5C,WAAW,IAAM,OAAO,SAAS,OAAM,EAAI,GAAG,CAClD,CCriCA,MAAMuN,EAAoBC,GAAoB,EACxCC,GAAuBC,GAI7BvI,EAAa,IAAI,aAAcsI,GAAqB,IAAIE,IAAS,CAAE,KAAAA,EAAM,MAAO,IAAI,EAAG,CAAC,EACxFxI,EAAa,IAAI,oBAAqBoI,CAAiB,EAGvD,MAAMK,EAAQ,CACV,MAAO,SAAS,eAAe,YAAY,EAC3C,UAAW,SAAS,eAAe,gBAAgB,EACnD,gBAAiB,SAAS,eAAe,uBAAuB,CACpE,EAEMC,EAAW,CACb,YAAa,SAAS,eAAe,cAAc,EACnD,kBAAmB,SAAS,eAAe,qBAAqB,EAChE,mBAAoB,SAAS,eAAe,sBAAsB,EAClE,qBAAsB,SAAS,eAAe,wBAAwB,EACtE,eAAgB,SAAS,eAAe,iBAAiB,EACzD,WAAY,SAAS,eAAe,aAAa,EACjD,SAAU,SAAS,eAAe,WAAW,EAC7C,gBAAiB,SAAS,eAAe,mBAAmB,EAC5D,YAAa,SAAS,eAAe,cAAc,CACvD,EAGA1I,EAAa,IAAI,mCAAoC,EAAK,EAI1D,SAAS2I,EAASC,EAAQ,CACtB,OAAO,OAAOH,CAAK,EAAE,QAAQI,GAAQ,CAC7BA,GAAMA,EAAK,UAAU,IAAI,aAAa,CAC9C,CAAC,EACGJ,EAAMG,CAAM,EACZH,EAAMG,CAAM,EAAE,UAAU,OAAO,aAAa,EAE5C,QAAQ,MAAM,qBAAsBA,CAAM,CAElD,CAEA,SAASE,EAAoBC,EAAO,CAChC,SAAS,iBAAiB,WAAW,EAAE,QAAQZ,GAAQ,CACnDA,EAAK,UAAU,OAAO,gBAAiB,iBAAiB,EACxDA,EAAK,UAAU,IAAI,iBAAiB,CACxC,CAAC,EACD,MAAMa,EAAa,SAAS,eAAeD,CAAK,EAC5CC,IACAA,EAAW,UAAU,IAAI,gBAAiB,iBAAiB,EAC3DA,EAAW,UAAU,OAAO,iBAAiB,EAErD,CAIA,SAASC,GAAmBC,EAAY,CAEpC,MAAMC,EAAI,IAAQ,KAAK,GACjBC,EAASD,EAAKD,EAAa,IAAOC,EAExC,IAAIE,EAAqB,iBACzB,OAAIH,EAAa,KAAIG,EAAqB,mBACtCH,EAAa,KAAIG,EAAqB,gBAEnC;AAAA;AAAA;AAAA;AAAA,yCAI8BA,CAAkB;AAAA;AAAA,oCAEvBF,CAAC;AAAA,qCACAC,CAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAWzBF,CAAU;AAAA;AAAA;AAAA,KAI5B,CAEA,SAASI,GAAoB5P,EAAOE,EAAO,CAyBvC,MAAM2P,GAvBiB3P,GACfA,GAAS,GAAW,CACpB,GAAI,+CACJ,MAAO,iBACP,UAAW,WACvB,EACYA,GAAS,GAAW,CACpB,GAAI,+CACJ,MAAO,cACP,UAAW,WACvB,EACYA,GAAS,GAAW,CACpB,GAAI,+CACJ,MAAO,gBACP,UAAW,MACvB,EACe,CACH,GAAI,4CACJ,MAAO,eACP,UAAW,UACvB,GAGgCA,CAAK,EAE3B4P,EAAY/E,EAAW/K,CAAK,EAC5B+P,EAAYhF,EAAW7K,CAAK,EAElC,MAAO;AAAA,4DACiD2P,EAAM,EAAE;AAAA,iDACnBA,EAAM,KAAK;AAAA,kBAC1CA,EAAM,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2EAO0CC,CAAS;AAAA,cACtEP,GAAmBrP,CAAK,CAAC;AAAA,kIAC2F6P,CAAS;AAAA;AAAA;AAAA,KAI3I,CAEA,SAASC,GAAiBhQ,EAAO,CAI7B,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gEAFW+K,EAAW/K,CAAK,CAqBmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KASzE,CAEA,SAASiQ,GAAqBjQ,EAAO,CAIjC,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gEAFW+K,EAAW/K,CAAK,CAkBmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAezE,CAEA,SAASkQ,GAAiBlQ,EAAO,CAI7B,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4EAFW+K,EAAW/K,CAAK,CAqB+C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAcrF,CAIA,SAASmQ,IAAkB,CAEvB,MAAMC,EAAa9J,EAAa,IAAI,YAAY,EAChD,IAAI+J,EAAS,EACb,QAAS5L,EAAIiK,EAAoB,EAAGjK,GAAK,IACjC2L,EAAW3L,CAAC,EAAE,QAAU,MAAQ2L,EAAW3L,CAAC,EAAE,OAAS,IADnBA,IAEpC4L,IAKR,OAAOA,CACX,CAGA,eAAeC,IAAoB,CAC/B,GAAI,CACA,MAAMhQ,EAAOmN,GAAqB,EAClC,GAAI,CAACnN,EAAM,CACP,QAAQ,IAAI,iDAAiD,EAC7D,MACJ,CAEA,QAAQ,IAAI,2CAA2C,EAGvD,MAAMiQ,EAAc,MAAMC,GAAelQ,EAAK,GAAG,EAG7CiQ,GACA,MAAME,GAAmBF,CAAW,EAIxC,MAAMG,EAAW,MAAMC,GAAkBrQ,EAAK,GAAG,EAK3CoN,EAAc3F,GAAc,EAClC,IAAIqI,EAAa9J,EAAa,IAAI,YAAY,EAC9C8J,EAAaA,EAAW,IAAI,CAACpQ,EAAOmG,IAAU,CAE1C,MAAMyK,EAAWxG,GAAqBpK,EAAM,KAAM0N,CAAW,EAC7D,OAAIgD,EAASE,CAAQ,EACV,CACH,KAAM5Q,EAAM,KACZ,MAAO0Q,EAASE,CAAQ,EAAE,KAC9C,EAEmB5Q,CACX,CAAC,EAGD,MAAMqQ,EAAS,MAAMQ,GAAavQ,EAAK,GAAG,EACpCwQ,EAAqB,SAAS,eAAe,cAAc,EAC7DA,IACAA,EAAmB,YAAcT,GAGrC,QAAQ,IAAI,iCAAiC,CACjD,OAASxR,EAAO,CACZ,QAAQ,MAAM,+BAAgCA,CAAK,CACvD,CACJ,CAEA,eAAekS,IAAsB,CACjC,GAAI,CAAC/B,EAAS,YAAa,CACvB,QAAQ,MAAM,6CAA6C,EAC3D,MACJ,CAGI,MAAMsB,GAAiB,EAEvBtB,EAAS,YAAY,UAAY,GACjC,IAAIgC,EAAiB,EAGK1K,EAAa,IAAI,YAAY,EACrC,QAAQ,CAACtG,EAAOmG,IAAU,CAC5C,IAAI8K,EAAW,GACX9K,EAAQuI,EAEJ1O,EAAM,QAAU,MAChBiR,EAAWrB,GAAoB5P,EAAM,KAAMA,EAAM,KAAK,EACtDgR,KAGAC,EAAWhB,GAAqBjQ,EAAM,IAAI,EAEvCmG,IAAUuI,EACjBuC,EAAWf,GAAiBlQ,EAAM,IAAI,EAEtCiR,EAAWjB,GAAiBhQ,EAAM,IAAI,EAE1CgP,EAAS,YAAY,WAAaiC,CACtC,CAAC,EAGD,MAAMC,EAAyBF,EAAiB,GAAM,IACtDhC,EAAS,kBAAkB,MAAM,MAAQ,GAAGkC,CAAqB,IACjElC,EAAS,mBAAmB,YAAc,GAAGgC,CAAc,MAG3D,MAAMX,EAASF,GAAe,EACxBW,EAAqB,SAAS,eAAe,cAAc,EAC7DA,IACAA,EAAmB,YAAcT,GAErC,MAAMc,EAAc,SAAS,eAAe,cAAc,EACtDA,GAAed,IAAW,IAC1Bc,EAAY,MAAM,QAAU,QAIhCC,GAAkC,EAGlC,WAAW,IAAM,CACbC,GAAsB,EACtBC,GAAsB,EACtBC,GAAqB,CACzB,EAAG,GAAG,CACV,CAGA,SAASF,IAAyB,CAC9B,MAAMxL,EAAM,SAAS,eAAe,oBAAoB,EACnDA,GAEL,IAAI,MAAMA,EAAK,CACX,KAAM,QACN,KAAM,CACF,OAAQ,CAAC,aAAc,YAAa,gBAAiB,aAAc,YAAa,gBAAgB,EAChG,SAAU,CAAC,CACP,MAAO,kBACP,KAAM,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EAC7B,gBAAiB,0BACjB,YAAa,oBACb,YAAa,EACb,qBAAsB,oBACtB,iBAAkB,OAClB,0BAA2B,OAC3B,sBAAuB,mBACvC,CAAa,CACb,EACQ,QAAS,CACL,WAAY,GACZ,oBAAqB,GACrB,OAAQ,CACJ,EAAG,CACC,YAAa,GACb,IAAK,IACL,MAAO,CACH,SAAU,EAClC,CACA,CACA,EACY,QAAS,CACL,OAAQ,CACJ,QAAS,EAC7B,CACA,CACA,CACA,CAAK,CACL,CAGA,SAASyL,IAAyB,CAC9B,MAAMzL,EAAM,SAAS,eAAe,oBAAoB,EACxD,GAAI,CAACA,EAAK,OAIV,MAAM2L,EADalL,EAAa,IAAI,YAAY,EACb,OAAO,CAACmL,EAAGhN,IAAMA,EAAIiK,CAAiB,EAEzE,IAAI,MAAM7I,EAAK,CACX,KAAM,OACN,KAAM,CACF,OAAQ2L,EAAgB,IAAIC,GAAKA,EAAE,IAAI,EACvC,SAAU,CAAC,CACP,MAAO,YACP,KAAMD,EAAgB,IAAIC,GAAKA,EAAE,KAAK,EACtC,gBAAiB,0BACjB,YAAa,oBACb,YAAa,EACb,KAAM,GACN,QAAS,GACT,YAAa,EACb,iBAAkB,EAClB,qBAAsB,oBACtB,iBAAkB,OAClB,iBAAkB,CAClC,CAAa,CACb,EACQ,QAAS,CACL,WAAY,GACZ,oBAAqB,GACrB,OAAQ,CACJ,EAAG,CACC,YAAa,GACb,IAAK,IACL,MAAO,CACH,SAAU,SAASjL,EAAO,CACtB,OAAOA,EAAQ,GACnB,CACxB,CACA,CACA,EACY,QAAS,CACL,OAAQ,CACJ,QAAS,EAC7B,EACgB,QAAS,CACL,UAAW,CACP,MAAO,SAASrH,EAAS,CACrB,MAAO,UAAYA,EAAQ,OAAO,EAAI,GAC1C,CACxB,CACA,CACA,CACA,CACA,CAAK,CACL,CAGA,SAASoS,IAAwB,CAC7B,MAAMG,EAAY,SAAS,eAAe,kBAAkB,EAC5D,GAAI,CAACA,EAAW,OAEhB,MAAMC,EAAc,GACdC,EAAa,EAEnB,IAAIC,EAAc,2BAElB,QAASC,EAAO,EAAGA,EAAOH,EAAaG,IAAQ,CAC3CD,GAAe,oCACf,QAASE,EAAM,EAAGA,EAAMH,EAAYG,IAAO,CACvC,MAAMC,EAAWF,EAAOF,EAAaG,EACrC,IAAIE,EAAY,EAGZD,EAAW,GAAK,KAChBC,EAAY,KAAK,MAAM,KAAK,OAAM,EAAK,CAAC,EAAI,GAWhDJ,GAAe,kCARA,CACX,eACA,eACA,eACA,eACA,cAChB,EAEoEI,CAAS,CAAC,2BACtE,CACAJ,GAAe,QACnB,CAEAA,GAAe,SAEfH,EAAU,UAAYG,CAC1B,CAGA,IAAIK,GAA8B,GAElC,SAASC,IAA4B,CAE7BD,KAGJA,GAA8B,GAE9B,QAAQ,IAAI,gEAAgE,EAG5E,SAAS,eAAe,eAAe,GAAG,iBAAiB,QAAU,GAAM,CACvE,EAAE,eAAc,EAChBjD,EAAS,WAAW,EACpBG,EAAoB,eAAe,CACvC,CAAC,EAGD,SAAS,eAAe,UAAU,GAAG,iBAAiB,QAAU,GAAM,CAClE,EAAE,eAAc,EAIhB,MAAMgD,EADa9L,EAAa,IAAI,YAAY,EACjBoI,CAAiB,GAAG,MAAQ,UAC3DM,EAAS,qBAAqB,YAAc,WAAWoD,CAAW,GAClEnD,EAAS,iBAAiB,EAC1BG,EAAoB,UAAU,CAClC,CAAC,EAGD,SAAS,eAAe,aAAa,GAAG,iBAAiB,QAAU,GAAM,CACrE,EAAE,eAAc,EAChB,MAAMiD,EAAS,EAAE,cACb,OAAO,cACI,QAAQ,sDAAsD,GAC/DA,GAAUA,EAAO,OACvB,OAAO,SAAS,KAAOA,EAAO,MAI9BA,GAAUA,EAAO,OACjB,OAAO,SAAS,KAAOA,EAAO,KAG1C,CAAC,EAGD,SAAS,eAAe,eAAe,GAAG,iBAAiB,QAAU,GAAM,CACvE,EAAE,eAAc,EAChB,MAAMA,EAAS,EAAE,cACb,OAAO,cACI,QAAQ,sDAAsD,GAC/DA,GAAUA,EAAO,OACvB,OAAO,SAAS,KAAOA,EAAO,MAI9BA,GAAUA,EAAO,OACjB,OAAO,SAAS,KAAOA,EAAO,KAG1C,CAAC,EAED,QAAQ,IAAI,oCAAoC,EACpD,CAEA,SAASjB,IAAqC,CAEtC9K,EAAa,IAAI,kCAAkC,IAIvD,SAAS,iBAAiB,QAAU7F,GAAU,CAE1C,GADoBA,EAAM,OAAO,QAAQ,oBAAoB,EAC5C,CACbA,EAAM,eAAc,EAIpB,MAAM2R,EADa9L,EAAa,IAAI,YAAY,EACjBoI,CAAiB,GAAG,MAAQ,UAC3DM,EAAS,qBAAqB,YAAc,WAAWoD,CAAW,GAClEnD,EAAS,iBAAiB,EAC1BG,EAAoB,UAAU,EAC9B,MACJ,CAGA,GADmB3O,EAAM,OAAO,QAAQ,oBAAoB,EAC5C,CACZA,EAAM,eAAc,EACpBwO,EAAS,WAAW,EACpBG,EAAoB,eAAe,EACnC,MACJ,CAEA,MAAMkD,EAAa7R,EAAM,OAAO,QAAQ,cAAc,EACtD,GAAI6R,EAAY,CACZ7R,EAAM,eAAc,EACpB,MAAM8R,EAASD,EAAW,aAAa,aAAa,EAChDC,GACAvI,GAAUuI,CAAM,CAExB,CACJ,CAAC,EAGDjM,EAAa,IAAI,mCAAoC,EAAI,EAC7D,CAIA,SAASkM,GAAkBlS,EAAM,CAC7B,GAAIA,EAAM,CAEN0O,EAAS,SAAS,YAAc1O,EAAK,aAAe,cACpD0O,EAAS,WAAW,IAAM1O,EAAK,UAAY,oDAAsDA,EAAK,cAAc,CAAC,GAAK,KAI1H,MAAM8P,EAAa9J,EAAa,IAAI,YAAY,EAC1CmM,EAAYnS,EAAK,aAAa,MAAM,GAAG,EAAE,CAAC,GAAK,cAC/CoS,EAAYtC,EAAW1B,CAAiB,GAAG,MAAQ,UACzDM,EAAS,eAAe,YAAc,WAAWyD,CAAS,kCAAkCC,CAAS,IACzG,CACJ,CAKA,SAASC,IAAkB,CACvB,MAAMC,EAAa,aAAa,QAAQ,OAAO,GAAK,QACpD,SAAS,gBAAgB,UAAU,OAAO,OAAQA,IAAe,MAAM,EACvEC,GAAkBD,CAAU,CAChC,CAEA,SAASC,GAAkBC,EAAO,CAC9B,MAAMC,EAAU,SAAS,eAAe,gBAAgB,EAClDC,EAAW,SAAS,eAAe,iBAAiB,EACpDC,EAAY,SAAS,eAAe,YAAY,EAElDH,IAAU,QACVC,GAAS,UAAU,OAAO,QAAQ,EAClCC,GAAU,UAAU,IAAI,QAAQ,EAC5BC,IAAWA,EAAU,YAAc,gBAEvCF,GAAS,UAAU,IAAI,QAAQ,EAC/BC,GAAU,UAAU,OAAO,QAAQ,EAC/BC,IAAWA,EAAU,YAAc,eAE/C,CAEA,SAASC,IAAc,CAEnB,MAAMC,GADe,SAAS,gBAAgB,UAAU,SAAS,MAAM,EAAI,OAAS,WAClD,OAAS,QAAU,OAErD,SAAS,gBAAgB,UAAU,OAAO,MAAM,EAChD,aAAa,QAAQ,QAASA,CAAQ,EACtCN,GAAkBM,CAAQ,CAC9B,CAEA,SAAS,iBAAiB,mBAAoB,IAAM,CAEhDxT,GAAc,YAAa,aAAa,EACxC,QAAQ,IAAI,iCAAiC,EAG7CgT,GAAe,EAGfR,GAAyB,EAGzB,SAAS,eAAe,cAAc,GAAG,iBAAiB,QAASe,EAAW,EAG9ElE,EAAS,iBAAiB,iBAAiB,QAASxJ,EAAgB,EAEpEwJ,EAAS,aAAa,iBAAiB,QAAU,GAAM,CACnD,EAAE,eAAc,EACZ,QAAQ,yCAAyC,GACjDoE,GAAW,CAEnB,CAAC,EAGDnE,EAAS,OAAO,EAGhBoE,GAAc/S,GAAS,CACfA,GACA,QAAQ,IAAI,0BAA2BA,EAAK,WAAW,EACvDkS,GAAkBlS,CAAI,EACtB2O,EAAS,WAAW,EACpBG,EAAoB,eAAe,EACnC2B,GAAmB,IAEnB,QAAQ,IAAI,+BAA+B,EAC3C9B,EAAS,OAAO,EAExB,CAAC,EAED,QAAQ,IAAI,kCAAkC,CAClD,CAAC","names":["analytics","initAnalytics","getAnalytics","app","error","trackEvent","eventName","params","logEvent","trackError","context","trackingError","setAnalyticsUser","userId","setUserId","setAnalyticsUserProperties","properties","setUserProperties","trackPageView","pageName","pagePath","trackQuizStart","moduleId","month","trackQuizComplete","score","timeElapsed","totalQuestions","auth","user","ErrorTypes","ErrorHandler","event","options","errorData","isDemoMode","err","logger","message","code","logMessage","duration","toast","analytics$1","db","__vitePreload","n","collection","addDoc","Timestamp","isCurrentUserAdmin","limit","errorHandler","DEFAULT_OPTIONS","isRetryableError","retryableErrors","retryableCode","calculateDelay","attempt","initialDelay","maxDelay","backoffMultiplier","delay","wait","ms","resolve","withRetry","fn","opts","lastError","withFirestoreRetry","firestoreOperation","DB_NAME","DB_VERSION","STORE_NAME","initDB","reject","request","database","store","SyncQueue","type","operation","data","queueItem","id","getRequest","item","updateRequest","operationHandlers","pendingItems","successCount","failedCount","handler","items","stats","i","sevenDaysAgo","deletedCount","cursor","listener","syncQueue","OfflineManager","response","saveQuizResult","result","initIndexPage","googleBtn","handleGoogleSignIn","loadingToast","showLoadingToast","signInWithGoogle","updateLoadingToast","errorMessage","launchConfetti","canvas","ctx","particles","colors","animate","activeParticles","p","index","moduleConfig","getCurrentQuiz","stateManager","setCurrentQuiz","value","getCurrentQuestionIndex","setCurrentQuestionIndex","getUserAnswers","setUserAnswers","getStartTime","setStartTime","getTimerInterval","setTimerInterval","getQuestionStartTime","setQuestionStartTime","getCurrentStreak","setCurrentStreak","getIsPaused","setIsPaused","getPausedDuration","setPausedDuration","getPauseStartedAt","setPauseStartedAt","getCurrentModule","setCurrentModule","getCurrentMonth","setCurrentMonth","getCurrentYear","setCurrentYear","getHasCurrentQuestionBeenAnswered","setHasCurrentQuestionBeenAnswered","getQuizEventDelegationInitialized","setQuizEventDelegationInitialized","moduleColors","loadQuizFromFirestore","monthNumber","year","toQuestionObjects","doc","opt","saved","demoQuestions","parsed","q","matchModule","matchMonth","q1","query","where","snap","getDocs","res","d","monthText","normalizedMonth","q2","loadDemoQuestions","resp","idx","e","startQuiz","config","showLoadingScreen","getCurrentMonthNumber","normalizeMonthFormat","questions","currentMonth","showQuizView","renderQuestion","startTimer","updateScoreDisplay","stopTimer","moduleName","quizView","getOrCreateQuizView","escapeHtml","initializeQuizEventDelegation","optionButton","optionId","handleAnswer","nextQuestion","returnToDashboard","toggleFocusMode","togglePause","currentQuiz","currentQuestionIndex","question","colorScheme","tag","option","questionStartTime","selectedOption","timeSpent","userAnswers","currentStreak","btn","showAnswerFeedback","selectedId","isCorrect","correctOption","optId","explanationArea","showResults","correctCount","a","pausedDuration","isPaused","pauseStartedAt","pausedOffset","startTime","totalTime","minutes","seconds","saveQuizToFirestore","answer","quizTotalTime","currentModule","getCurrentUserUnified","currentYear","moduleDetails","quizData","resultData","syncQueue$1","queueError","queueKey","localError","interval","elapsedMs","elapsed","timerElement","timerInterval","scoreElement","pauseBtn","link","currentMonthIndex","getCurrentMonthIndex","MONTH_NAMES_IMPORTED","MONTH_NAMES","name","views","elements","showView","viewId","view","updateActiveNavLink","navId","activeLink","createProgressRing","percentage","c","offset","progressColorClass","createCompletedCard","style","safeMonth","safeScore","createLockedCard","createIncompleteCard","createActiveCard","calculateStreak","monthsData","streak","loadDashboardData","userProfile","getUserProfile","showAdminUIIfAdmin","progress","getAnnualProgress","monthKey","updateStreak","streakCountElement","initializeDashboard","completedCount","cardHtml","annualProgressPercent","streakBadge","initializeDashboardEventDelegation","createSkillsRadarChart","createScoresTrendChart","createActivityHeatmap","completedMonths","m","container","weeksInYear","daysInWeek","heatmapHTML","week","day","dayIndex","intensity","navigationListenersAttached","attachNavigationListeners","activeMonth","target","moduleCard","module","updateUserProfile","firstName","monthName","initializeTheme","savedTheme","updateThemeButton","theme","sunIcon","moonIcon","themeText","toggleTheme","newTheme","signOutUser","onAuthChange"],"ignoreList":[],"sources":["../../js/analytics.js","../../js/error-handler.js","../../js/retry-handler.js","../../js/sync-queue.js","../../js/offline-manager.js","../../js/index-init.js","../../js/confetti.js","../../js/quiz.js","../../js/dashboard.js"],"sourcesContent":["/**\n * Module Analytics et Monitoring\n * \n * ‚úÖ CORRECTION SECTION 9 : Monitoring et Analytics\n * \n * G√®re Firebase Analytics et le tracking d'erreurs\n */\n\nimport { getAnalytics, logEvent, setUserProperties, setUserId } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js';\nimport { app } from './firebase-config.js';\nimport { auth } from './firebase-config.js';\n\nlet analytics = null;\n\n/**\n * Initialiser Firebase Analytics\n */\nexport function initAnalytics() {\n    try {\n        // V√©rifier si on est dans un environnement support√© (navigateur)\n        if (typeof window !== 'undefined' && 'serviceWorker' in navigator) {\n            analytics = getAnalytics(app);\n            console.log('‚úÖ Firebase Analytics initialis√©');\n            return analytics;\n        } else {\n            console.warn('‚ö†Ô∏è Firebase Analytics non disponible dans cet environnement');\n            return null;\n        }\n    } catch (error) {\n        console.error('‚ùå Erreur initialisation Analytics:', error);\n        return null;\n    }\n}\n\n/**\n * Tracker un √©v√©nement\n * @param {string} eventName - Nom de l'√©v√©nement\n * @param {Object} params - Param√®tres de l'√©v√©nement\n */\nexport function trackEvent(eventName, params = {}) {\n    if (!analytics) {\n        // Mode silencieux si analytics non disponible\n        console.log(`[Analytics] ${eventName}`, params);\n        return;\n    }\n    \n    try {\n        logEvent(analytics, eventName, {\n            ...params,\n            timestamp: Date.now(),\n            page: window.location.pathname\n        });\n        console.log(`üìä Event tracked: ${eventName}`, params);\n    } catch (error) {\n        console.error('‚ùå Erreur tracking √©v√©nement:', error);\n    }\n}\n\n/**\n * Tracker une erreur\n * @param {Error} error - Erreur √† tracker\n * @param {Object} context - Contexte suppl√©mentaire\n */\nexport function trackError(error, context = {}) {\n    if (!analytics) {\n        console.error('[Analytics Error]', error, context);\n        return;\n    }\n    \n    try {\n        logEvent(analytics, 'exception', {\n            description: error.message || 'Unknown error',\n            fatal: false,\n            error_type: error.name || 'Error',\n            error_stack: error.stack?.substring(0, 500) || '', // Limiter la taille\n            ...context\n        });\n        console.error('üìä Error tracked:', error.message);\n    } catch (trackingError) {\n        console.error('‚ùå Erreur tracking erreur:', trackingError);\n    }\n}\n\n/**\n * Tracker une m√©trique de performance\n * @param {string} metricName - Nom de la m√©trique\n * @param {number} value - Valeur de la m√©trique\n * @param {string} unit - Unit√© (ms, bytes, etc.)\n */\nexport function trackPerformance(metricName, value, unit = 'ms') {\n    if (!analytics) {\n        console.log(`[Analytics Performance] ${metricName}: ${value}${unit}`);\n        return;\n    }\n    \n    try {\n        logEvent(analytics, 'performance', {\n            metric_name: metricName,\n            metric_value: value,\n            metric_unit: unit,\n            page: window.location.pathname\n        });\n        console.log(`üìä Performance tracked: ${metricName} = ${value}${unit}`);\n    } catch (error) {\n        console.error('‚ùå Erreur tracking performance:', error);\n    }\n}\n\n/**\n * D√©finir l'utilisateur pour Analytics\n * @param {string} userId - ID de l'utilisateur\n */\nexport function setAnalyticsUser(userId) {\n    if (!analytics) return;\n    \n    try {\n        setUserId(analytics, userId);\n        console.log('‚úÖ Analytics user set:', userId);\n    } catch (error) {\n        console.error('‚ùå Erreur d√©finition utilisateur Analytics:', error);\n    }\n}\n\n/**\n * D√©finir les propri√©t√©s utilisateur\n * @param {Object} properties - Propri√©t√©s utilisateur\n */\nexport function setAnalyticsUserProperties(properties) {\n    if (!analytics) return;\n    \n    try {\n        setUserProperties(analytics, properties);\n        console.log('‚úÖ Analytics user properties set:', properties);\n    } catch (error) {\n        console.error('‚ùå Erreur d√©finition propri√©t√©s utilisateur:', error);\n    }\n}\n\n/**\n * Tracker une page vue\n * @param {string} pageName - Nom de la page\n * @param {string} pagePath - Chemin de la page\n */\nexport function trackPageView(pageName, pagePath = window.location.pathname) {\n    if (!analytics) {\n        console.log(`[Analytics PageView] ${pageName} - ${pagePath}`);\n        return;\n    }\n    \n    try {\n        logEvent(analytics, 'page_view', {\n            page_title: pageName,\n            page_location: window.location.href,\n            page_path: pagePath\n        });\n        console.log(`üìä Page view tracked: ${pageName}`);\n    } catch (error) {\n        console.error('‚ùå Erreur tracking page view:', error);\n    }\n}\n\n/**\n * Tracker le d√©but d'un quiz\n * @param {string} moduleId - ID du module\n * @param {string} month - Mois du quiz\n */\nexport function trackQuizStart(moduleId, month) {\n    trackEvent('quiz_start', {\n        module_id: moduleId,\n        month: month,\n        timestamp: Date.now()\n    });\n}\n\n/**\n * Tracker la fin d'un quiz\n * @param {string} moduleId - ID du module\n * @param {number} score - Score obtenu\n * @param {number} timeElapsed - Temps √©coul√© en secondes\n * @param {number} totalQuestions - Nombre total de questions\n */\nexport function trackQuizComplete(moduleId, score, timeElapsed, totalQuestions) {\n    trackEvent('quiz_complete', {\n        module_id: moduleId,\n        score: score,\n        time_elapsed: timeElapsed,\n        total_questions: totalQuestions,\n        passed: score >= 60\n    });\n}\n\n/**\n * Tracker une action utilisateur\n * @param {string} action - Action effectu√©e\n * @param {string} category - Cat√©gorie de l'action\n * @param {Object} params - Param√®tres suppl√©mentaires\n */\nexport function trackUserAction(action, category = 'user_interaction', params = {}) {\n    trackEvent('user_action', {\n        action: action,\n        category: category,\n        ...params\n    });\n}\n\n/**\n * Tracker un √©v√©nement de conversion\n * @param {string} conversionType - Type de conversion\n * @param {Object} params - Param√®tres de conversion\n */\nexport function trackConversion(conversionType, params = {}) {\n    trackEvent('conversion', {\n        conversion_type: conversionType,\n        ...params\n    });\n}\n\n// Initialiser automatiquement si possible\nif (typeof window !== 'undefined') {\n    // Attendre que le DOM soit pr√™t\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', () => {\n            initAnalytics();\n        });\n    } else {\n        initAnalytics();\n    }\n    \n    // √âcouter les changements d'authentification pour d√©finir l'utilisateur\n    if (auth) {\n        auth.onAuthStateChanged((user) => {\n            if (user) {\n                setAnalyticsUser(user.uid);\n                setAnalyticsUserProperties({\n                    email: user.email || '',\n                    display_name: user.displayName || ''\n                });\n            }\n        });\n    }\n}\n\n","/**\n * Gestionnaire d'erreurs centralis√© pour l'application Avantage QUIZZ\n * \n * Ce module fournit une gestion d'erreurs centralis√©e pour :\n * - Capturer les erreurs non g√©r√©es\n * - Logger les erreurs de mani√®re coh√©rente\n * - Afficher des messages utilisateur appropri√©s\n * - Envoyer les erreurs critiques √† Firestore (si admin)\n */\n\nimport { logger } from './logger.js';\nimport { toast } from './toast.js';\nimport { isDemoMode } from './auth.js';\n\n/**\n * Types d'erreurs possibles\n */\nexport const ErrorTypes = {\n    NETWORK: 'NETWORK',\n    FIRESTORE: 'FIRESTORE',\n    AUTH: 'AUTH',\n    VALIDATION: 'VALIDATION',\n    UNKNOWN: 'UNKNOWN'\n};\n\n/**\n * Classe pour g√©rer les erreurs de mani√®re centralis√©e\n */\nclass ErrorHandler {\n    constructor() {\n        this.errorLog = [];\n        this.maxLogSize = 100; // Limiter la taille du log en m√©moire\n        this.setupGlobalHandlers();\n    }\n\n    /**\n     * Configure les gestionnaires d'erreurs globaux\n     */\n    setupGlobalHandlers() {\n        // Gestionnaire pour les erreurs JavaScript non captur√©es\n        window.addEventListener('error', (event) => {\n            this.handleError({\n                message: event.message,\n                filename: event.filename,\n                lineno: event.lineno,\n                colno: event.colno,\n                error: event.error,\n                type: ErrorTypes.UNKNOWN\n            }, 'Global error handler');\n        });\n\n        // Gestionnaire pour les promesses rejet√©es non g√©r√©es\n        window.addEventListener('unhandledrejection', (event) => {\n            this.handleError({\n                message: event.reason?.message || 'Unhandled promise rejection',\n                error: event.reason,\n                type: ErrorTypes.UNKNOWN\n            }, 'Unhandled promise rejection');\n        });\n    }\n\n    /**\n     * G√®re une erreur de mani√®re centralis√©e\n     * @param {Error|Object} error - L'erreur √† g√©rer\n     * @param {string} context - Contexte o√π l'erreur s'est produite\n     * @param {Object} options - Options suppl√©mentaires\n     */\n    handleError(error, context = 'Unknown', options = {}) {\n        const errorData = this.normalizeError(error, context, options);\n        \n        // Logger l'erreur\n        this.logError(errorData);\n        \n        // Afficher un message utilisateur si n√©cessaire\n        if (options.showToUser !== false) {\n            this.showUserMessage(errorData, options);\n        }\n        \n        // Envoyer √† Firestore si critique et en production\n        if (options.critical && !isDemoMode()) {\n            this.sendToFirestore(errorData).catch(err => {\n                logger.error('Impossible d\\'envoyer l\\'erreur √† Firestore:', err);\n            });\n        }\n        \n        return errorData;\n    }\n\n    /**\n     * Normalise une erreur en objet standardis√©\n     * @param {Error|Object} error - L'erreur √† normaliser\n     * @param {string} context - Contexte\n     * @param {Object} options - Options\n     * @returns {Object} Erreur normalis√©e\n     */\n    normalizeError(error, context, options) {\n        const errorData = {\n            message: error?.message || String(error) || 'Erreur inconnue',\n            stack: error?.stack,\n            context: context,\n            type: this.detectErrorType(error),\n            timestamp: new Date().toISOString(),\n            url: window.location.href,\n            userAgent: navigator.userAgent,\n            ...options.metadata\n        };\n\n        // Ajouter des informations sp√©cifiques selon le type d'erreur\n        if (error?.code) {\n            errorData.code = error.code;\n        }\n        if (error?.name) {\n            errorData.name = error.name;\n        }\n\n        return errorData;\n    }\n\n    /**\n     * D√©tecte le type d'erreur bas√© sur le message ou le code\n     * @param {Error|Object} error - L'erreur\n     * @returns {string} Type d'erreur\n     */\n    detectErrorType(error) {\n        if (!error) return ErrorTypes.UNKNOWN;\n\n        const message = (error.message || '').toLowerCase();\n        const code = error.code || '';\n\n        if (code === 'unavailable' || code === 'deadline-exceeded' || message.includes('network') || message.includes('fetch')) {\n            return ErrorTypes.NETWORK;\n        }\n        if (code === 'permission-denied' || code === 'unauthenticated' || message.includes('auth')) {\n            return ErrorTypes.AUTH;\n        }\n        if (code === 'invalid-argument' || code === 'failed-precondition' || message.includes('validation')) {\n            return ErrorTypes.VALIDATION;\n        }\n        if (message.includes('firestore') || code.startsWith('firestore')) {\n            return ErrorTypes.FIRESTORE;\n        }\n\n        return ErrorTypes.UNKNOWN;\n    }\n\n    /**\n     * Log l'erreur de mani√®re coh√©rente\n     * @param {Object} errorData - Donn√©es d'erreur normalis√©es\n     */\n    logError(errorData) {\n        // Ajouter au log en m√©moire\n        this.errorLog.push(errorData);\n        if (this.errorLog.length > this.maxLogSize) {\n            this.errorLog.shift(); // Garder seulement les N derni√®res erreurs\n        }\n\n        // Logger selon le type\n        const logMessage = `[${errorData.type}] ${errorData.context}: ${errorData.message}`;\n        \n        if (errorData.type === ErrorTypes.NETWORK) {\n            logger.warn(logMessage, errorData);\n        } else {\n            logger.error(logMessage, errorData);\n        }\n    }\n\n    /**\n     * Affiche un message utilisateur appropri√©\n     * @param {Object} errorData - Donn√©es d'erreur\n     * @param {Object} options - Options\n     */\n    showUserMessage(errorData, options) {\n        let message = options.userMessage;\n        \n        if (!message) {\n            // Messages par d√©faut selon le type\n            switch (errorData.type) {\n                case ErrorTypes.NETWORK:\n                    message = 'Probl√®me de connexion. V√©rifiez votre connexion internet.';\n                    break;\n                case ErrorTypes.AUTH:\n                    message = 'Erreur d\\'authentification. Veuillez vous reconnecter.';\n                    break;\n                case ErrorTypes.VALIDATION:\n                    message = 'Donn√©es invalides. Veuillez v√©rifier vos informations.';\n                    break;\n                case ErrorTypes.FIRESTORE:\n                    message = 'Erreur lors de l\\'acc√®s aux donn√©es. Veuillez r√©essayer.';\n                    break;\n                default:\n                    message = 'Une erreur est survenue. Veuillez r√©essayer.';\n            }\n        }\n\n        // Afficher le toast\n        const duration = options.duration || (errorData.type === ErrorTypes.NETWORK ? 8000 : 5000);\n        toast.error(message, duration);\n    }\n\n    /**\n     * Envoie l'erreur √† Firestore pour analyse (si admin)\n     * ‚úÖ CORRECTION SECTION 9 : Ajouter tracking Analytics\n     * @param {Object} errorData - Donn√©es d'erreur\n     */\n    async sendToFirestore(errorData) {\n        // ‚úÖ CORRECTION SECTION 9 : Tracker l'erreur avec Analytics\n        try {\n            const { trackError } = await import('./analytics.js');\n            trackError(new Error(errorData.message), {\n                error_type: errorData.type,\n                error_source: errorData.source,\n                user_id: errorData.userId || 'anonymous'\n            });\n        } catch (analyticsError) {\n            // Mode silencieux si analytics non disponible\n            console.warn('Analytics non disponible pour tracking erreur');\n        }\n        \n        try {\n            // Import dynamique pour √©viter les d√©pendances circulaires\n            const { db } = await import('./firebase-config.js');\n            const { collection, addDoc, Timestamp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');\n            const { isCurrentUserAdmin } = await import('./firestore-service.js');\n            \n            // Seulement si admin (pour √©viter les co√ªts)\n            const isAdmin = await isCurrentUserAdmin();\n            if (!isAdmin) {\n                return;\n            }\n\n            await addDoc(collection(db, 'errorLogs'), {\n                ...errorData,\n                timestamp: Timestamp.now()\n            });\n        } catch (err) {\n            // Ne pas logger pour √©viter les boucles infinies\n            console.error('Impossible d\\'envoyer l\\'erreur √† Firestore:', err);\n        }\n    }\n\n    /**\n     * R√©cup√®re les erreurs r√©centes\n     * @param {number} limit - Nombre d'erreurs √† retourner\n     * @returns {Array} Liste des erreurs\n     */\n    getRecentErrors(limit = 10) {\n        return this.errorLog.slice(-limit);\n    }\n\n    /**\n     * Efface le log d'erreurs\n     */\n    clearErrorLog() {\n        this.errorLog = [];\n    }\n}\n\n// Instance singleton\nexport const errorHandler = new ErrorHandler();\n\n/**\n * Fonction utilitaire pour wrapper les fonctions async avec gestion d'erreur\n * @param {Function} fn - Fonction async √† wrapper\n * @param {string} context - Contexte de l'erreur\n * @param {Object} options - Options\n * @returns {Function} Fonction wrapp√©e\n */\nexport function withErrorHandling(fn, context, options = {}) {\n    return async (...args) => {\n        try {\n            return await fn(...args);\n        } catch (error) {\n            errorHandler.handleError(error, context, options);\n            throw error; // Re-throw pour permettre la gestion en amont si n√©cessaire\n        }\n    };\n}\n\n/**\n * Fonction utilitaire pour cr√©er un gestionnaire d'erreur pour une fonction sp√©cifique\n * @param {Function} fn - Fonction √† prot√©ger\n * @param {string} context - Contexte\n * @param {Object} options - Options\n * @returns {Function} Fonction prot√©g√©e\n */\nexport function protectFunction(fn, context, options = {}) {\n    return withErrorHandling(fn, context, {\n        ...options,\n        showToUser: options.showToUser !== false\n    });\n}\n\nexport default errorHandler;\n\n\n","/**\n * Gestionnaire de retry automatique pour les op√©rations r√©seau/Firestore\n * \n * Ce module fournit un syst√®me de retry avec backoff exponentiel pour :\n * - Les requ√™tes Firestore qui √©chouent\n * - Les op√©rations r√©seau\n * - Les appels API\n */\n\nimport { logger } from './logger.js';\nimport { errorHandler, ErrorTypes } from './error-handler.js';\n\n/**\n * Options par d√©faut pour le retry\n */\nconst DEFAULT_OPTIONS = {\n    maxRetries: 3,\n    initialDelay: 1000, // 1 seconde\n    maxDelay: 30000, // 30 secondes max\n    backoffMultiplier: 2,\n    retryableErrors: ['unavailable', 'deadline-exceeded', 'internal', 'aborted'],\n    onRetry: null // Callback appel√© √† chaque retry\n};\n\n/**\n * V√©rifie si une erreur est retryable\n * @param {Error} error - L'erreur √† v√©rifier\n * @param {Array} retryableErrors - Liste des codes d'erreur retryables\n * @returns {boolean} True si l'erreur est retryable\n */\nfunction isRetryableError(error, retryableErrors) {\n    if (!error) return false;\n    \n    const code = error.code || '';\n    const message = (error.message || '').toLowerCase();\n    \n    // Erreurs r√©seau toujours retryables\n    if (code === 'unavailable' || code === 'deadline-exceeded' || \n        message.includes('network') || message.includes('fetch failed')) {\n        return true;\n    }\n    \n    // V√©rifier dans la liste des erreurs retryables\n    return retryableErrors.some(retryableCode => \n        code === retryableCode || message.includes(retryableCode.toLowerCase())\n    );\n}\n\n/**\n * Calcule le d√©lai avant le prochain retry (backoff exponentiel)\n * @param {number} attempt - Num√©ro de la tentative (0 = premi√®re retry)\n * @param {number} initialDelay - D√©lai initial\n * @param {number} maxDelay - D√©lai maximum\n * @param {number} backoffMultiplier - Multiplicateur\n * @returns {number} D√©lai en millisecondes\n */\nfunction calculateDelay(attempt, initialDelay, maxDelay, backoffMultiplier) {\n    const delay = initialDelay * Math.pow(backoffMultiplier, attempt);\n    return Math.min(delay, maxDelay);\n}\n\n/**\n * Attend un certain d√©lai\n * @param {number} ms - Millisecondes √† attendre\n * @returns {Promise} Promise qui se r√©sout apr√®s le d√©lai\n */\nfunction wait(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/**\n * Ex√©cute une fonction avec retry automatique\n * @param {Function} fn - Fonction async √† ex√©cuter\n * @param {Object} options - Options de retry\n * @returns {Promise} R√©sultat de la fonction\n */\nexport async function withRetry(fn, options = {}) {\n    const opts = { ...DEFAULT_OPTIONS, ...options };\n    let lastError;\n    \n    // Premi√®re tentative\n    try {\n        return await fn();\n    } catch (error) {\n        lastError = error;\n        \n        // Si l'erreur n'est pas retryable, on arr√™te imm√©diatement\n        if (!isRetryableError(error, opts.retryableErrors)) {\n            throw error;\n        }\n    }\n    \n    // Retries\n    for (let attempt = 0; attempt < opts.maxRetries; attempt++) {\n        const delay = calculateDelay(\n            attempt,\n            opts.initialDelay,\n            opts.maxDelay,\n            opts.backoffMultiplier\n        );\n        \n        // Callback onRetry si fourni\n        if (opts.onRetry) {\n            opts.onRetry(attempt + 1, delay, lastError);\n        } else {\n            // Message par d√©faut\n            logger.warn(`Nouvelle tentative ${attempt + 1}/${opts.maxRetries} dans ${delay}ms...`);\n        }\n        \n        // Attendre avant de retry\n        await wait(delay);\n        \n        try {\n            return await fn();\n        } catch (error) {\n            lastError = error;\n            \n            // Si l'erreur n'est plus retryable, arr√™ter\n            if (!isRetryableError(error, opts.retryableErrors)) {\n                throw error;\n            }\n            \n            // Si c'est la derni√®re tentative, logger et throw\n            if (attempt === opts.maxRetries - 1) {\n                errorHandler.handleError(error, 'Retry handler - Max retries reached', {\n                    showToUser: true,\n                    userMessage: `√âchec apr√®s ${opts.maxRetries} tentatives. Veuillez r√©essayer plus tard.`\n                });\n                throw error;\n            }\n        }\n    }\n    \n    // Ne devrait jamais arriver ici, mais au cas o√π\n    throw lastError;\n}\n\n/**\n * Wrapper sp√©cialis√© pour les op√©rations Firestore\n * @param {Function} firestoreOperation - Op√©ration Firestore async\n * @param {Object} options - Options de retry\n * @returns {Promise} R√©sultat de l'op√©ration\n */\nexport async function withFirestoreRetry(firestoreOperation, options = {}) {\n    return withRetry(firestoreOperation, {\n        ...options,\n        retryableErrors: [\n            'unavailable',\n            'deadline-exceeded',\n            'internal',\n            'aborted',\n            'resource-exhausted'\n        ],\n        onRetry: options.onRetry || ((attempt, delay) => {\n            logger.warn(`Retry Firestore ${attempt}/${options.maxRetries || 3} dans ${delay}ms...`);\n        })\n    });\n}\n\n/**\n * Wrapper sp√©cialis√© pour les op√©rations r√©seau (fetch)\n * @param {Function} networkOperation - Op√©ration r√©seau async\n * @param {Object} options - Options de retry\n * @returns {Promise} R√©sultat de l'op√©ration\n */\nexport async function withNetworkRetry(networkOperation, options = {}) {\n    return withRetry(networkOperation, {\n        ...options,\n        retryableErrors: ['network', 'timeout', 'fetch'],\n        onRetry: options.onRetry || ((attempt, delay) => {\n            logger.warn(`Retry r√©seau ${attempt}/${options.maxRetries || 3} dans ${delay}ms...`);\n        })\n    });\n}\n\nexport default {\n    withRetry,\n    withFirestoreRetry,\n    withNetworkRetry\n};\n\n\n","/**\n * File d'attente globale pour synchronisation offline\n * \n * ‚úÖ CORRECTION SECTION 8 : Gestion Offline Compl√®te\n * \n * G√®re toutes les op√©rations Firestore en file d'attente avec IndexedDB\n * pour la persistance et la synchronisation automatique √† la reconnexion.\n */\n\nconst DB_NAME = 'avantage-quizz-sync';\nconst DB_VERSION = 1;\nconst STORE_NAME = 'sync-queue';\n\nlet db = null;\n\n/**\n * Initialiser IndexedDB\n */\nasync function initDB() {\n    if (db) return db;\n    \n    return new Promise((resolve, reject) => {\n        const request = indexedDB.open(DB_NAME, DB_VERSION);\n        \n        request.onerror = () => reject(request.error);\n        request.onsuccess = () => {\n            db = request.result;\n            resolve(db);\n        };\n        \n        request.onupgradeneeded = (event) => {\n            const database = event.target.result;\n            if (!database.objectStoreNames.contains(STORE_NAME)) {\n                const store = database.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });\n                store.createIndex('timestamp', 'timestamp', { unique: false });\n                store.createIndex('type', 'type', { unique: false });\n                store.createIndex('status', 'status', { unique: false });\n            }\n        };\n    });\n}\n\n/**\n * Classe pour g√©rer la file d'attente de synchronisation\n */\nclass SyncQueue {\n    constructor() {\n        this.isProcessing = false;\n        this.listeners = new Set();\n    }\n    \n    /**\n     * Ajouter une op√©ration √† la file d'attente\n     * @param {string} type - Type d'op√©ration (quizResult, userUpdate, etc.)\n     * @param {Function} operation - Fonction async √† ex√©cuter\n     * @param {Object} data - Donn√©es √† sauvegarder\n     * @returns {Promise<string>} ID de l'op√©ration\n     */\n    async add(type, operation, data = {}) {\n        await initDB();\n        \n        const queueItem = {\n            type,\n            operation: this.serializeOperation(operation),\n            data,\n            timestamp: Date.now(),\n            status: 'pending',\n            retries: 0,\n            maxRetries: 3\n        };\n        \n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction([STORE_NAME], 'readwrite');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.add(queueItem);\n            \n            request.onsuccess = () => {\n                const id = request.result;\n                console.log(`üì• Op√©ration ajout√©e √† la file d'attente: ${type} (ID: ${id})`);\n                this.notifyListeners('added', { id, type });\n                resolve(id);\n            };\n            \n            request.onerror = () => reject(request.error);\n        });\n    }\n    \n    /**\n     * S√©rialiser une fonction pour le stockage (limitation : on stocke seulement les donn√©es)\n     * Note: Les fonctions ne peuvent pas √™tre s√©rialis√©es, donc on stocke les donn√©es\n     * et on reconstruit l'op√©ration lors du traitement\n     */\n    serializeOperation(operation) {\n        // On ne peut pas s√©rialiser une fonction, donc on stocke les m√©tadonn√©es\n        // L'op√©ration sera reconstruite lors du traitement bas√© sur le type\n        return {\n            name: operation.name || 'anonymous',\n            // On stocke les param√®tres n√©cessaires pour reconstruire l'op√©ration\n        };\n    }\n    \n    /**\n     * Obtenir toutes les op√©rations en attente\n     */\n    async getAll() {\n        await initDB();\n        \n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction([STORE_NAME], 'readonly');\n            const store = transaction.objectStore(STORE_NAME);\n            const index = store.index('status');\n            const request = index.getAll('pending');\n            \n            request.onsuccess = () => resolve(request.result);\n            request.onerror = () => reject(request.error);\n        });\n    }\n    \n    /**\n     * Marquer une op√©ration comme compl√©t√©e\n     */\n    async markCompleted(id) {\n        await initDB();\n        \n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction([STORE_NAME], 'readwrite');\n            const store = transaction.objectStore(STORE_NAME);\n            const getRequest = store.get(id);\n            \n            getRequest.onsuccess = () => {\n                const item = getRequest.result;\n                if (item) {\n                    item.status = 'completed';\n                    const updateRequest = store.put(item);\n                    updateRequest.onsuccess = () => {\n                        console.log(`‚úÖ Op√©ration compl√©t√©e: ${item.type} (ID: ${id})`);\n                        this.notifyListeners('completed', { id, type: item.type });\n                        resolve();\n                    };\n                    updateRequest.onerror = () => reject(updateRequest.error);\n                } else {\n                    resolve();\n                }\n            };\n            \n            getRequest.onerror = () => reject(getRequest.error);\n        });\n    }\n    \n    /**\n     * Marquer une op√©ration comme √©chou√©e\n     */\n    async markFailed(id, error) {\n        await initDB();\n        \n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction([STORE_NAME], 'readwrite');\n            const store = transaction.objectStore(STORE_NAME);\n            const getRequest = store.get(id);\n            \n            getRequest.onsuccess = () => {\n                const item = getRequest.result;\n                if (item) {\n                    item.retries++;\n                    if (item.retries >= item.maxRetries) {\n                        item.status = 'failed';\n                        item.error = error?.message || 'Unknown error';\n                    } else {\n                        item.status = 'pending'; // R√©essayer\n                    }\n                    const updateRequest = store.put(item);\n                    updateRequest.onsuccess = () => {\n                        if (item.status === 'failed') {\n                            console.error(`‚ùå Op√©ration √©chou√©e d√©finitivement: ${item.type} (ID: ${id})`);\n                            this.notifyListeners('failed', { id, type: item.type, error });\n                        } else {\n                            console.warn(`‚ö†Ô∏è Op√©ration √©chou√©e, r√©essai ${item.retries}/${item.maxRetries}: ${item.type} (ID: ${id})`);\n                        }\n                        resolve();\n                    };\n                    updateRequest.onerror = () => reject(updateRequest.error);\n                } else {\n                    resolve();\n                }\n            };\n            \n            getRequest.onerror = () => reject(getRequest.error);\n        });\n    }\n    \n    /**\n     * Supprimer une op√©ration de la file\n     */\n    async remove(id) {\n        await initDB();\n        \n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction([STORE_NAME], 'readwrite');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.delete(id);\n            \n            request.onsuccess = () => {\n                console.log(`üóëÔ∏è Op√©ration supprim√©e: ID ${id}`);\n                resolve();\n            };\n            \n            request.onerror = () => reject(request.error);\n        });\n    }\n    \n    /**\n     * Traiter toutes les op√©rations en attente\n     * @param {Object} operationHandlers - Map des handlers par type d'op√©ration\n     */\n    async processQueue(operationHandlers = {}) {\n        if (this.isProcessing) {\n            console.log('‚è≥ Traitement d√©j√† en cours...');\n            return;\n        }\n        \n        if (!navigator.onLine) {\n            console.log('üì¥ Hors ligne, synchronisation report√©e');\n            return;\n        }\n        \n        this.isProcessing = true;\n        console.log('üîÑ D√©but du traitement de la file d\\'attente...');\n        \n        try {\n            const pendingItems = await this.getAll();\n            \n            if (pendingItems.length === 0) {\n                console.log('‚úÖ Aucune op√©ration en attente');\n                this.isProcessing = false;\n                return { success: 0, failed: 0 };\n            }\n            \n            console.log(`üìã ${pendingItems.length} op√©ration(s) en attente`);\n            \n            let successCount = 0;\n            let failedCount = 0;\n            \n            for (const item of pendingItems) {\n                try {\n                    // Reconstruire l'op√©ration bas√©e sur le type\n                    const handler = operationHandlers[item.type];\n                    if (!handler) {\n                        console.warn(`‚ö†Ô∏è Aucun handler pour le type: ${item.type}`);\n                        await this.markFailed(item.id, new Error(`No handler for type: ${item.type}`));\n                        failedCount++;\n                        continue;\n                    }\n                    \n                    // Ex√©cuter l'op√©ration\n                    await handler(item.data);\n                    \n                    // Marquer comme compl√©t√©e et supprimer\n                    await this.markCompleted(item.id);\n                    await this.remove(item.id);\n                    successCount++;\n                    \n                } catch (error) {\n                    console.error(`‚ùå Erreur traitement op√©ration ${item.id}:`, error);\n                    await this.markFailed(item.id, error);\n                    failedCount++;\n                }\n            }\n            \n            console.log(`‚úÖ Traitement termin√©: ${successCount} r√©ussies, ${failedCount} √©chou√©es`);\n            this.notifyListeners('processed', { success: successCount, failed: failedCount });\n            \n            return { success: successCount, failed: failedCount };\n            \n        } catch (error) {\n            console.error('‚ùå Erreur traitement file d\\'attente:', error);\n            throw error;\n        } finally {\n            this.isProcessing = false;\n        }\n    }\n    \n    /**\n     * Obtenir les statistiques de la file\n     */\n    async getStats() {\n        await initDB();\n        \n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction([STORE_NAME], 'readonly');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.getAll();\n            \n            request.onsuccess = () => {\n                const items = request.result;\n                const stats = {\n                    total: items.length,\n                    pending: items.filter(i => i.status === 'pending').length,\n                    completed: items.filter(i => i.status === 'completed').length,\n                    failed: items.filter(i => i.status === 'failed').length\n                };\n                resolve(stats);\n            };\n            \n            request.onerror = () => reject(request.error);\n        });\n    }\n    \n    /**\n     * Nettoyer les op√©rations compl√©t√©es (plus de 7 jours)\n     */\n    async cleanCompleted() {\n        await initDB();\n        \n        const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);\n        \n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction([STORE_NAME], 'readwrite');\n            const store = transaction.objectStore(STORE_NAME);\n            const index = store.index('timestamp');\n            const request = index.openCursor();\n            \n            let deletedCount = 0;\n            \n            request.onsuccess = (event) => {\n                const cursor = event.target.result;\n                if (cursor) {\n                    const item = cursor.value;\n                    if (item.status === 'completed' && item.timestamp < sevenDaysAgo) {\n                        cursor.delete();\n                        deletedCount++;\n                    }\n                    cursor.continue();\n                } else {\n                    console.log(`üßπ ${deletedCount} op√©ration(s) compl√©t√©e(s) nettoy√©e(s)`);\n                    resolve(deletedCount);\n                }\n            };\n            \n            request.onerror = () => reject(request.error);\n        });\n    }\n    \n    /**\n     * S'abonner aux √©v√©nements de la file\n     */\n    subscribe(listener) {\n        this.listeners.add(listener);\n        return () => this.listeners.delete(listener);\n    }\n    \n    /**\n     * Notifier les listeners\n     */\n    notifyListeners(event, data) {\n        this.listeners.forEach(listener => {\n            try {\n                listener(event, data);\n            } catch (error) {\n                console.error('Erreur listener:', error);\n            }\n        });\n    }\n}\n\n// Instance singleton\nexport const syncQueue = new SyncQueue();\n\n// Initialiser au chargement\ninitDB().catch(error => {\n    console.error('‚ùå Erreur initialisation IndexedDB:', error);\n});\n\n","/**\n * Gestionnaire de d√©tection offline/online\n * \n * ‚úÖ CORRECTION SECTION 8 : Gestion Offline Compl√®te\n * \n * D√©tecte l'√©tat de connexion et affiche des notifications/indicateurs visuels\n */\n\nimport { toast } from './toast.js';\nimport { syncQueue } from './sync-queue.js';\n\nclass OfflineManager {\n    constructor() {\n        this.isOnline = navigator.onLine;\n        this.listeners = new Set();\n        this.indicatorElement = null;\n        this.setupEventListeners();\n        this.createIndicator();\n    }\n    \n    /**\n     * Configurer les event listeners pour online/offline\n     */\n    setupEventListeners() {\n        window.addEventListener('online', () => this.handleOnline());\n        window.addEventListener('offline', () => this.handleOffline());\n        \n        // V√©rifier p√©riodiquement (toutes les 30 secondes)\n        setInterval(() => this.checkConnection(), 30000);\n    }\n    \n    /**\n     * V√©rifier manuellement la connexion\n     */\n    async checkConnection() {\n        try {\n            // Tenter une requ√™te l√©g√®re vers Firebase\n            const response = await fetch('https://firestore.googleapis.com', { \n                method: 'HEAD',\n                mode: 'no-cors',\n                cache: 'no-cache'\n            });\n            \n            if (!this.isOnline) {\n                this.handleOnline();\n            }\n        } catch (error) {\n            if (this.isOnline) {\n                this.handleOffline();\n            }\n        }\n    }\n    \n    /**\n     * G√©rer le passage en ligne\n     */\n    async handleOnline() {\n        if (this.isOnline) return; // D√©j√† en ligne\n        \n        this.isOnline = true;\n        console.log('üåê Connexion r√©tablie');\n        \n        this.updateIndicator();\n        this.notifyListeners('online');\n        \n        // Afficher notification\n        toast.success('Connexion r√©tablie. Synchronisation en cours...', 3000);\n        \n        // Synchroniser la file d'attente\n        try {\n            // Import dynamique pour √©viter d√©pendance circulaire\n            const { saveQuizResult } = await import('./firestore-service.js');\n            \n            const stats = await syncQueue.getStats();\n            if (stats.pending > 0) {\n                console.log(`üì§ Synchronisation de ${stats.pending} op√©ration(s) en attente...`);\n                \n                // D√©finir les handlers pour chaque type d'op√©ration\n                const operationHandlers = {\n                    quizResult: async (data) => {\n                        await saveQuizResult(data);\n                    },\n                    // Ajouter d'autres types si n√©cessaire\n                };\n                \n                const result = await syncQueue.processQueue(operationHandlers);\n                \n                if (result.success > 0) {\n                    toast.success(`${result.success} op√©ration(s) synchronis√©e(s) avec succ√®s`, 3000);\n                }\n                if (result.failed > 0) {\n                    toast.warning(`${result.failed} op√©ration(s) n'ont pas pu √™tre synchronis√©es`, 3000);\n                }\n            }\n        } catch (error) {\n            console.error('‚ùå Erreur synchronisation:', error);\n            toast.error('Erreur lors de la synchronisation', 3000);\n        }\n    }\n    \n    /**\n     * G√©rer le passage hors ligne\n     */\n    handleOffline() {\n        if (!this.isOnline) return; // D√©j√† hors ligne\n        \n        this.isOnline = false;\n        console.log('üì¥ Connexion perdue');\n        \n        this.updateIndicator();\n        this.notifyListeners('offline');\n        \n        // Afficher notification\n        toast.warning('Connexion perdue. Les donn√©es seront sauvegard√©es localement.', 5000);\n    }\n    \n    /**\n     * Cr√©er l'indicateur visuel de connexion\n     */\n    createIndicator() {\n        // Cr√©er l'√©l√©ment indicateur\n        this.indicatorElement = document.createElement('div');\n        this.indicatorElement.id = 'offline-indicator';\n        this.indicatorElement.className = 'fixed bottom-4 right-4 z-50 flex items-center gap-2 px-4 py-2 rounded-lg shadow-lg transition-all duration-300';\n        this.indicatorElement.style.display = 'none';\n        \n        // Ajouter au body\n        document.body.appendChild(this.indicatorElement);\n        \n        // Mettre √† jour l'apparence initiale\n        this.updateIndicator();\n    }\n    \n    /**\n     * Mettre √† jour l'indicateur visuel\n     */\n    updateIndicator() {\n        if (!this.indicatorElement) return;\n        \n        if (this.isOnline) {\n            this.indicatorElement.style.display = 'none';\n        } else {\n            this.indicatorElement.style.display = 'flex';\n            this.indicatorElement.className = 'fixed bottom-4 right-4 z-50 flex items-center gap-2 px-4 py-2 rounded-lg shadow-lg bg-yellow-500 text-white transition-all duration-300';\n            this.indicatorElement.innerHTML = `\n                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414\"></path>\n                </svg>\n                <span class=\"text-sm font-medium\">Mode hors ligne</span>\n            `;\n        }\n    }\n    \n    /**\n     * Obtenir l'√©tat actuel\n     */\n    getStatus() {\n        return {\n            isOnline: this.isOnline,\n            timestamp: Date.now()\n        };\n    }\n    \n    /**\n     * S'abonner aux changements d'√©tat\n     */\n    subscribe(listener) {\n        this.listeners.add(listener);\n        return () => this.listeners.delete(listener);\n    }\n    \n    /**\n     * Notifier les listeners\n     */\n    notifyListeners(event) {\n        this.listeners.forEach(listener => {\n            try {\n                listener(event, this.getStatus());\n            } catch (error) {\n                console.error('Erreur listener offline:', error);\n            }\n        });\n    }\n}\n\n// Instance singleton\nexport const offlineManager = new OfflineManager();\n\n// Exporter une fonction utilitaire pour v√©rifier l'√©tat\nexport function isOnline() {\n    return offlineManager.isOnline;\n}\n\n// Exporter une fonction pour attendre la reconnexion\nexport function waitForOnline() {\n    return new Promise((resolve) => {\n        if (offlineManager.isOnline) {\n            resolve();\n            return;\n        }\n        \n        const unsubscribe = offlineManager.subscribe((event) => {\n            if (event === 'online') {\n                unsubscribe();\n                resolve();\n            }\n        });\n    });\n}\n\n","// Initialisation de la page d'accueil (index.html)\nimport { signInWithGoogle } from './auth.js';\nimport { showErrorToast, showSuccessToast, showLoadingToast, updateLoadingToast } from './toast.js';\n// Import des gestionnaires d'erreurs centralis√©s (Section 1 - Architecture)\nimport { errorHandler, withErrorHandling } from './error-handler.js';\nimport { withRetry, withFirestoreRetry } from './retry-handler.js';\n// ‚úÖ CORRECTION SECTION 8 : Gestion Offline Compl√®te\nimport { offlineManager } from './offline-manager.js';\n\nconsole.log('Initialisation de la page d accueil...');\n\n// Attendre que le DOM soit charg√©\ndocument.addEventListener('DOMContentLoaded', initIndexPage);\n\nfunction initIndexPage() {\n    console.log('üìÑ DOM charg√© - configuration du bouton de connexion...');\n    \n    // Bouton Google Sign-In\n    const googleBtn = document.getElementById('google-signin-btn');\n    if (googleBtn) {\n        googleBtn.addEventListener('click', handleGoogleSignIn);\n        console.log('‚úÖ Bouton Google configur√©');\n    } else {\n        console.warn('‚ö†Ô∏è Bouton Google non trouv√©');\n    }\n}\n\n/**\n * Handler pour le bouton Google Sign-In\n */\nasync function handleGoogleSignIn() {\n    console.log('üîê Clic sur connexion Google...');\n    \n    const loadingToast = showLoadingToast('Connexion en cours...');\n    \n    try {\n        const user = await signInWithGoogle();\n        \n    // Succ√®s\n    updateLoadingToast(loadingToast, `Bienvenue ${user.displayName} !`, 'success');\n        \n        // Recharger la page pour que le dashboard d√©tecte l'utilisateur connect√©\n        setTimeout(() => {\n            window.location.reload();\n        }, 800);\n        \n    } catch (error) {\n        console.error('‚ùå Erreur connexion Google:', error);\n        \n        // Messages d'erreur personnalis√©s\n        let errorMessage = 'Erreur lors de la connexion';\n        \n        if (error.code === 'auth/popup-closed-by-user') {\n            errorMessage = 'Connexion annul√©e';\n        } else if (error.code === 'auth/popup-blocked') {\n            errorMessage = 'Pop-up bloqu√©e. Autorisez les pop-ups.';\n        } else if (error.code === 'auth/unauthorized-domain') {\n            errorMessage = 'Domaine non autoris√© dans Firebase';\n        } else if (error.code === 'auth/network-request-failed') {\n            errorMessage = 'Erreur r√©seau. V√©rifiez votre connexion.';\n        }\n        \n    updateLoadingToast(loadingToast, errorMessage, 'error');\n    }\n}\n\n// Export pour tests\nexport { handleGoogleSignIn };\n","// Simple confetti animation using canvas\r\nexport function launchConfetti() {\r\n    const canvas = document.createElement('canvas');\r\n    canvas.style.position = 'fixed';\r\n    canvas.style.top = '0';\r\n    canvas.style.left = '0';\r\n    canvas.style.width = '100%';\r\n    canvas.style.height = '100%';\r\n    canvas.style.pointerEvents = 'none';\r\n    canvas.style.zIndex = '9999';\r\n    document.body.appendChild(canvas);\r\n\r\n    const ctx = canvas.getContext('2d');\r\n    canvas.width = window.innerWidth;\r\n    canvas.height = window.innerHeight;\r\n\r\n    const particles = [];\r\n    const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2'];\r\n    \r\n    // Create particles\r\n    for (let i = 0; i < 150; i++) {\r\n        particles.push({\r\n            x: Math.random() * canvas.width,\r\n            y: canvas.height + Math.random() * 100,\r\n            size: Math.random() * 8 + 4,\r\n            speedY: -(Math.random() * 3 + 3),\r\n            speedX: Math.random() * 6 - 3,\r\n            color: colors[Math.floor(Math.random() * colors.length)],\r\n            rotation: Math.random() * 360,\r\n            rotationSpeed: Math.random() * 10 - 5,\r\n            gravity: 0.15,\r\n            opacity: 1\r\n        });\r\n    }\r\n\r\n    function animate() {\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        \r\n        let activeParticles = 0;\r\n        \r\n        particles.forEach((p, index) => {\r\n            p.speedY += p.gravity;\r\n            p.y += p.speedY;\r\n            p.x += p.speedX;\r\n            p.rotation += p.rotationSpeed;\r\n            \r\n            // Fade out near the bottom\r\n            if (p.y > canvas.height - 100) {\r\n                p.opacity -= 0.02;\r\n            }\r\n            \r\n            if (p.opacity > 0 && p.y < canvas.height + 50) {\r\n                activeParticles++;\r\n                \r\n                ctx.save();\r\n                ctx.translate(p.x, p.y);\r\n                ctx.rotate((p.rotation * Math.PI) / 180);\r\n                ctx.globalAlpha = p.opacity;\r\n                ctx.fillStyle = p.color;\r\n                \r\n                // Draw rectangle confetti\r\n                ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);\r\n                \r\n                ctx.restore();\r\n            }\r\n        });\r\n        \r\n        if (activeParticles > 0) {\r\n            requestAnimationFrame(animate);\r\n        } else {\r\n            canvas.remove();\r\n        }\r\n    }\r\n    \r\n    animate();\r\n}\r\n","// Module Quiz - Interface de questions style professionnel (VERSION 2.0 - Firestore)\nimport { db } from './firebase-config.js';\nimport { collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';\nimport { getCurrentUserUnified, isDemoMode } from './auth.js';\nimport { launchConfetti } from './confetti.js';\nimport { saveQuizResult } from './firestore-service.js';\nimport { toast, showLoadingToast, updateLoadingToast } from './toast.js';\n// ‚úÖ CORRECTION SECTION 9 : Analytics\nimport { trackQuizStart, trackQuizComplete } from './analytics.js';\n// Import du gestionnaire de retry (Section 1 - Architecture)\nimport { withFirestoreRetry } from './retry-handler.js';\n// Import des fonctions de s√©curit√© (Section 4 - S√©curit√©)\nimport { escapeHtml } from './security.js';\n// Import du rate limiter (Section 4 - S√©curit√©)\nimport { safeFirestoreRead } from './rate-limiter.js';\n// ‚úÖ CORRECTION SECTION 5 : Import du gestionnaire d'√©tat centralis√©\nimport { stateManager } from './state-manager.js';\n\n// Configuration des modules (m√©tadonn√©es uniquement - pas de questions hardcod√©es)\nconst moduleConfig = {\n    'auto': {\n        name: 'AT-AVE-AVEX',\n        color: 'indigo',\n        label: 'Auto'\n    },\n    'loisir': {\n        name: 'VTT, Motoneige, etc.',\n        color: 'cyan',\n        label: 'Loisir'\n    },\n    'vr': {\n        name: 'V√©hicules R√©cr√©atifs',\n        color: 'orange',\n        label: 'VR'\n    },\n    'tracteur': {\n        name: '√âquipement Agricole',\n        color: 'green',\n        label: 'Tracteur'\n    }\n};\n\n// ‚úÖ CORRECTION SECTION 5 : √âtat du quiz g√©r√© par StateManager\n// Helper functions pour faciliter la migration (utilisent StateManager en arri√®re-plan)\nconst getCurrentQuiz = () => stateManager.get('currentQuiz');\nconst setCurrentQuiz = (value) => stateManager.set('currentQuiz', value);\nconst getCurrentQuestionIndex = () => stateManager.get('currentQuestionIndex');\nconst setCurrentQuestionIndex = (value) => stateManager.set('currentQuestionIndex', value);\nconst getUserAnswers = () => stateManager.get('userAnswers');\nconst setUserAnswers = (value) => stateManager.set('userAnswers', value);\nconst getStartTime = () => stateManager.get('startTime');\nconst setStartTime = (value) => stateManager.set('startTime', value);\nconst getTimerInterval = () => stateManager.get('timerInterval');\nconst setTimerInterval = (value) => stateManager.set('timerInterval', value);\nconst getQuestionStartTime = () => stateManager.get('questionStartTime');\nconst setQuestionStartTime = (value) => stateManager.set('questionStartTime', value);\nconst getCurrentStreak = () => stateManager.get('currentStreak');\nconst setCurrentStreak = (value) => stateManager.set('currentStreak', value);\nconst getIsPaused = () => stateManager.get('isPaused');\nconst setIsPaused = (value) => stateManager.set('isPaused', value);\nconst getPausedDuration = () => stateManager.get('pausedDuration');\nconst setPausedDuration = (value) => stateManager.set('pausedDuration', value);\nconst getPauseStartedAt = () => stateManager.get('pauseStartedAt');\nconst setPauseStartedAt = (value) => stateManager.set('pauseStartedAt', value);\nconst getCurrentModule = () => stateManager.get('currentModule');\nconst setCurrentModule = (value) => stateManager.set('currentModule', value);\nconst getCurrentMonth = () => stateManager.get('currentMonth');\nconst setCurrentMonth = (value) => stateManager.set('currentMonth', value);\nconst getCurrentYear = () => stateManager.get('currentYear');\nconst setCurrentYear = (value) => stateManager.set('currentYear', value);\nconst getHasCurrentQuestionBeenAnswered = () => stateManager.get('hasCurrentQuestionBeenAnswered');\nconst setHasCurrentQuestionBeenAnswered = (value) => stateManager.set('hasCurrentQuestionBeenAnswered', value);\nconst getQuizEventDelegationInitialized = () => stateManager.get('quizEventDelegationInitialized');\nconst setQuizEventDelegationInitialized = (value) => stateManager.set('quizEventDelegationInitialized', value);\n\n// Couleurs par module\nconst moduleColors = {\n    'indigo': { bg: 'bg-indigo-600', text: 'text-indigo-600', border: 'border-indigo-600' },\n    'cyan': { bg: 'bg-cyan-600', text: 'text-cyan-600', border: 'border-cyan-600' },\n    'orange': { bg: 'bg-orange-600', text: 'text-orange-600', border: 'border-orange-600' },\n    'green': { bg: 'bg-green-600', text: 'text-green-600', border: 'border-green-600' }\n};\n\n// Charger les questions depuis Firestore, compatible mois num√©rique ou texte (r√©tro-compatibilit√©)\nasync function loadQuizFromFirestore(moduleId, monthNumber, year) {\n    console.log(`üì• Chargement des questions: module=${moduleId}, mois=${monthNumber}, ann√©e=${year}`);\n\n    const toQuestionObjects = (doc) => {\n        const data = doc.data();\n        return {\n            id: doc.id,\n            question: data.question,\n            options: data.options.map((opt, index) => ({\n                id: String.fromCharCode(65 + index), // A, B, C, D\n                text: opt,\n                correct: index === data.correctAnswer\n            })),\n            explanation: data.explanation || 'Pas d\\'explication disponible',\n            reference: data.reference || '',\n            tags: data.tags || []\n        };\n    };\n\n    // ‚úÖ MODE D√âMO : Utiliser les questions mock√©es de localStorage OU d√©fauts\n    if (isDemoMode()) {\n        console.log('üìù Mode d√©mo : Chargement des questions simul√©es pour le quiz...');\n        \n        // üíæ Charger depuis localStorage (synchronis√© avec admin)\n        const DEMO_STORAGE_KEY = 'avantage-quizz-demo-questions';\n        const saved = localStorage.getItem(DEMO_STORAGE_KEY);\n        \n        let demoQuestions = [];\n        \n        if (saved) {\n            try {\n                const parsed = JSON.parse(saved);\n                console.log(`üíæ ${parsed.length} questions charg√©es depuis localStorage`);\n                \n                // Convertir au format attendu par le quiz\n                demoQuestions = parsed.map(q => ({\n                    id: q.id,\n                    question: q.question,\n                    options: q.options.map((opt, index) => ({\n                        id: String.fromCharCode(65 + index), // A, B, C, D\n                        text: opt,\n                        correct: index === q.correctAnswer\n                    })),\n                    explanation: q.explanation || 'Pas d\\'explication disponible',\n                    reference: q.reference || '',\n                    tags: q.tags || []\n                }));\n                \n                // Filtrer par module et mois si n√©cessaire\n                demoQuestions = demoQuestions.filter(q => {\n                    const matchModule = !moduleId || parsed.find(p => p.id === q.id)?.module === moduleId;\n                    const matchMonth = !monthNumber || parsed.find(p => p.id === q.id)?.month === monthNumber;\n                    return matchModule && matchMonth;\n                });\n                \n            } catch (e) {\n                console.warn('‚ö†Ô∏è Erreur lecture localStorage, utilisation questions par d√©faut');\n            }\n        }\n        \n        // Si pas de questions en localStorage, utiliser les 5 par d√©faut\n        if (demoQuestions.length === 0) {\n            console.log('üì¶ Utilisation questions par d√©faut (aucune en localStorage)');\n            demoQuestions = [\n                {\n                    id: 'demo-1',\n                    question: 'Quelle est la vitesse maximale autoris√©e sur une autoroute au Qu√©bec ?',\n                    options: [\n                        { id: 'A', text: '100 km/h', correct: false },\n                        { id: 'B', text: '110 km/h', correct: false },\n                        { id: 'C', text: '120 km/h', correct: false },\n                        { id: 'D', text: '100 km/h (conditions normales)', correct: true }\n                    ],\n                    explanation: 'La vitesse maximale sur autoroute au Qu√©bec est de 100 km/h, sauf indication contraire.',\n                    reference: 'Code de la s√©curit√© routi√®re du Qu√©bec',\n                    tags: ['vitesse', 'autoroute']\n                },\n                {\n                    id: 'demo-2',\n                    question: '√Ä quelle distance minimale devez-vous vous arr√™ter derri√®re un autobus scolaire dont les feux clignotent ?',\n                    options: [\n                        { id: 'A', text: '3 m√®tres', correct: false },\n                        { id: 'B', text: '5 m√®tres', correct: true },\n                        { id: 'C', text: '10 m√®tres', correct: false },\n                        { id: 'D', text: '15 m√®tres', correct: false }\n                    ],\n                    explanation: 'Vous devez vous arr√™ter √† au moins 5 m√®tres d\\'un autobus scolaire.',\n                    reference: 'Article 460 CSR',\n                    tags: ['autobus', 's√©curit√©']\n                },\n                {\n                    id: 'demo-3',\n                    question: 'Quel est le taux d\\'alcool√©mie maximal pour conduire au Qu√©bec ?',\n                    options: [\n                        { id: 'A', text: '0.05', correct: false },\n                        { id: 'B', text: '0.08', correct: true },\n                        { id: 'C', text: '0.10', correct: false },\n                        { id: 'D', text: '0.00', correct: false }\n                    ],\n                    explanation: 'Le taux maximal est de 0.08 pour conducteurs exp√©riment√©s.',\n                    reference: 'Code criminel du Canada',\n                    tags: ['alcool', 's√©curit√©']\n                },\n                {\n                    id: 'demo-4',\n                    question: 'Combien de points d\\'inaptitude entra√Æne un exc√®s de vitesse de 30 km/h ?',\n                    options: [\n                        { id: 'A', text: '2 points', correct: false },\n                        { id: 'B', text: '3 points', correct: true },\n                        { id: 'C', text: '4 points', correct: false },\n                        { id: 'D', text: '5 points', correct: false }\n                    ],\n                    explanation: 'Un exc√®s de 21 √† 30 km/h entra√Æne 3 points.',\n                    reference: 'SAAQ',\n                    tags: ['vitesse', 'points']\n                },\n                {\n                    id: 'demo-5',\n                    question: 'Quelle est la distance de s√©curit√© recommand√©e entre v√©hicules ?',\n                    options: [\n                        { id: 'A', text: '1 seconde', correct: false },\n                        { id: 'B', text: '2 secondes', correct: true },\n                        { id: 'C', text: '3 secondes', correct: false },\n                        { id: 'D', text: '5 secondes', correct: false }\n                    ],\n                    explanation: 'La r√®gle des 2 secondes est recommand√©e.',\n                    reference: 'Guide SAAQ',\n                    tags: ['distance', 's√©curit√©']\n                }\n            ];\n        }\n        \n        console.log(`‚úÖ ${demoQuestions.length} questions d√©mo charg√©es pour le quiz`);\n        return demoQuestions;\n    }\n\n    try {\n        // 1) Essayer avec mois num√©rique (sch√©ma actuel de l'admin)\n        let q1 = query(\n            collection(db, 'questions'),\n            where('module', '==', moduleId),\n            where('month', '==', monthNumber),\n            where('year', '==', year)\n        );\n        let snap = await getDocs(q1);\n        if (!snap.empty) {\n            const res = [];\n            snap.forEach((d) => res.push(toQuestionObjects(d)));\n            console.log(`‚úÖ ${res.length} questions (mois num√©rique)`);\n            return res;\n        }\n\n        // 2) R√©tro-compatibilit√©: essayer avec mois texte (ex: \"Novembre\")\n        const monthNames = ['janvier', 'f√©vrier', 'mars', 'avril', 'mai', 'juin', 'juillet', 'ao√ªt', 'septembre', 'octobre', 'novembre', 'd√©cembre'];\n        const monthText = monthNames[monthNumber - 1];\n        const normalizedMonth = monthText.charAt(0).toUpperCase() + monthText.slice(1).toLowerCase();\n\n        let q2 = query(\n            collection(db, 'questions'),\n            where('module', '==', moduleId),\n            where('month', '==', normalizedMonth),\n            where('year', '==', year)\n        );\n        snap = await getDocs(q2);\n        if (!snap.empty) {\n            const res = [];\n            snap.forEach((d) => res.push(toQuestionObjects(d)));\n            console.log(`‚úÖ ${res.length} questions (mois texte)`);\n            return res;\n        }\n\n        console.warn('‚ö†Ô∏è Aucune question trouv√©e pour ces crit√®res (num√©rique/texte)');\n        return [];\n    } catch (error) {\n        console.error('‚ùå Erreur lors du chargement des questions:', error);\n        throw error;\n    }\n}\n\n// Fallback Demo: charger depuis un JSON local lorsque le Mode D√©mo est actif\nasync function loadDemoQuestions(moduleId, monthNumber, year) {\n    try {\n        const resp = await fetch('/test-questions-valides.json');\n        if (!resp.ok) return [];\n        const data = await resp.json();\n        const monthNames = ['janvier', 'f√©vrier', 'mars', 'avril', 'mai', 'juin', 'juillet', 'ao√ªt', 'septembre', 'octobre', 'novembre', 'd√©cembre'];\n        const monthText = monthNames[monthNumber - 1];\n\n        const filtered = data.filter(q => q.module === moduleId && q.year === year && (q.month === monthText || q.month === monthNumber));\n        return filtered.map((q, idx) => ({\n            id: `demo-${moduleId}-${idx}`,\n            question: q.question,\n            options: q.options.map((opt, index) => ({\n                id: String.fromCharCode(65 + index),\n                text: opt,\n                correct: index === q.correctAnswer\n            })),\n            explanation: q.explanation || 'Pas d\\'explication disponible',\n            reference: q.reference || '',\n            tags: q.tags || []\n        }));\n    } catch (e) {\n        console.warn('Demo questions fallback error:', e);\n        return [];\n    }\n}\n\n// **FONCTION MODIFI√âE** : Initialiser le quiz avec chargement Firestore\nexport async function startQuiz(moduleId) {\n    const config = moduleConfig[moduleId];\n    if (!config) {\n        console.error('Module de quiz non trouv√©:', moduleId);\n        toast.error('Module non trouv√©. Veuillez r√©essayer.');\n        return;\n    }\n    \n    // Afficher un √©cran de chargement avec toast\n    const loadingToast = showLoadingToast(`Chargement du quiz ${config.label}...`);\n    showLoadingScreen(config.label);\n    \n    try {\n        // D√©terminer le mois (num√©rique) et l'ann√©e actuels\n        // ‚úÖ CORRECTION SECTION 2 : Utiliser les utilitaires de mois pour normalisation\n        const { getCurrentMonthNumber, getCurrentYear, normalizeMonthFormat } = await import('./month-utils.js');\n        const monthNumber = getCurrentMonthNumber();\n        const year = getCurrentYear();\n        // Normaliser le format du mois pour garantir la coh√©rence avec le dashboard\n        // ‚úÖ CORRECTION SECTION 5 : Utiliser StateManager\n        const normalizedMonth = normalizeMonthFormat(monthNumber, year);\n        setCurrentMonth(normalizedMonth);\n        setCurrentYear(year);\n        setCurrentModule(moduleId);\n        \n    // Indiquer qu'un quiz est en cours (utilis√© pour confirmations de navigation)\n    try { window.__QUIZ_ACTIVE = true; } catch (e) {}\n\n    // Charger les questions depuis Firestore (num√©rique/texte)\n        let questions = await loadQuizFromFirestore(moduleId, monthNumber, year);\n\n        // En mode D√©mo, si aucune question en base, charger depuis JSON local\n        if (questions.length === 0 && isDemoMode()) {\n            console.log('‚ÑπÔ∏è Mode D√©mo: chargement des questions locales de test');\n            questions = await loadDemoQuestions(moduleId, monthNumber, year);\n        }\n        \n        if (questions.length === 0) {\n            hideLoadingScreen();\n            updateLoadingToast(loadingToast, 'Aucune question disponible', 'error');\n            // ‚úÖ CORRECTION SECTION 2 : currentMonth est d√©j√† normalis√© (format \"Novembre 2025\")\n            const currentMonth = getCurrentMonth();\n            toast.error(`Aucune question trouv√©e pour ${config.label} en ${currentMonth}.\\n\\nContactez l'administrateur.`, 5000);\n            return;\n        }\n        \n        // Cr√©er l'objet quiz\n        // ‚úÖ CORRECTION SECTION 5 : Utiliser StateManager\n        const currentMonth = getCurrentMonth();\n        setCurrentQuiz({\n            // ‚úÖ CORRECTION SECTION 2 : currentMonth est d√©j√† normalis√© (format \"Novembre 2025\")\n            name: `Quiz ${config.label} - ${currentMonth}`,\n            module: config.name,\n            color: config.color,\n            questions: questions\n        });\n        \n        // R√©initialiser l'√©tat\n        setCurrentQuestionIndex(0);\n        setUserAnswers([]);\n        setStartTime(Date.now());\n        setQuestionStartTime(Date.now());\n        \n        // ‚úÖ CORRECTION SECTION 9 : Tracker le d√©but du quiz\n        trackQuizStart(moduleId, getCurrentMonth());\n        setCurrentStreak(0);\n        setIsPaused(false);\n        setPausedDuration(0);\n        setPauseStartedAt(null);\n        setHasCurrentQuestionBeenAnswered(false);\n        \n        // Cacher l'√©cran de chargement et d√©marrer\n    hideLoadingScreen();\n    showQuizView();\n        renderQuestion();\n        startTimer();\n        updateScoreDisplay();\n        \n        // Toast de succ√®s\n        updateLoadingToast(loadingToast, `${questions.length} questions charg√©es !`, 'success');\n        \n    } catch (error) {\n        stopTimer(); // ‚úÖ CORRECTION SECTION 3 : Nettoyer le timer en cas d'erreur\n        hideLoadingScreen();\n        console.error('‚ùå Erreur lors du d√©marrage du quiz:', error);\n        updateLoadingToast(loadingToast, 'Erreur de chargement', 'error');\n        toast.error('Erreur lors du chargement du quiz. Veuillez r√©essayer.', 4000);\n    }\n}\n\n// √âcran de chargement\nfunction showLoadingScreen(moduleName) {\n    const quizView = getOrCreateQuizView();\n    quizView.innerHTML = `\n        <div class=\"min-h-screen flex items-center justify-center\">\n            <div class=\"text-center\">\n                <div class=\"animate-spin rounded-full h-16 w-16 border-b-4 border-indigo-600 mx-auto mb-6\"></div>\n                        <h2 class=\"text-2xl font-bold text-slate-900 mb-2\">Chargement du quiz ${escapeHtml(moduleName)}</h2>\n                <p class=\"text-slate-600\">R√©cup√©ration des questions...</p>\n            </div>\n        </div>\n    `;\n    quizView.classList.remove('view-hidden');\n}\n\nfunction hideLoadingScreen() {\n    // L'√©cran sera remplac√© par le contenu du quiz\n}\n\n// Afficher la vue du quiz\nfunction showQuizView() {\n    document.getElementById('dashboard-view')?.classList.add('view-hidden');\n    document.getElementById('module-selection-view')?.classList.add('view-hidden');\n    document.getElementById('login-view')?.classList.add('view-hidden');\n    \n    const quizView = getOrCreateQuizView();\n    quizView.classList.remove('view-hidden');\n}\n\nfunction getOrCreateQuizView() {\n    let quizView = document.getElementById('quiz-view');\n    if (!quizView) {\n        quizView = document.createElement('div');\n        quizView.id = 'quiz-view';\n        document.querySelector('main').appendChild(quizView);\n    }\n    initializeQuizEventDelegation(quizView);\n    return quizView;\n}\n\nfunction initializeQuizEventDelegation(quizView) {\n    // ‚úÖ CORRECTION SECTION 5 : Utiliser StateManager\n    if (getQuizEventDelegationInitialized() || !quizView) {\n        return;\n    }\n\n    quizView.addEventListener('click', (event) => {\n        const optionButton = event.target.closest('.option-button');\n        if (optionButton && !optionButton.disabled) {\n            const optionId = optionButton.dataset.optionId;\n            if (optionId) {\n                handleAnswer(optionId);\n            }\n            return;\n        }\n\n        const nextButton = event.target.closest('#next-question-btn');\n        if (nextButton) {\n            event.preventDefault();\n            nextQuestion();\n            return;\n        }\n\n        const quitButton = event.target.closest('#quit-quiz-btn');\n        if (quitButton) {\n            event.preventDefault();\n            if (confirm('Voulez-vous vraiment quitter le quiz ? Votre progression sera perdue.')) {\n                returnToDashboard();\n            }\n            return;\n        }\n\n        const focusButton = event.target.closest('#focus-mode-btn');\n        if (focusButton) {\n            event.preventDefault();\n            toggleFocusMode();\n            return;\n        }\n\n        const pauseButton = event.target.closest('#pause-btn');\n        if (pauseButton) {\n            event.preventDefault();\n            togglePause();\n            return;\n        }\n    });\n\n    setQuizEventDelegationInitialized(true);\n}\n\n// Rendre la question actuelle\nfunction renderQuestion() {\n    // ‚úÖ CORRECTION SECTION 5 : Utiliser StateManager\n    const currentQuiz = getCurrentQuiz();\n    const currentQuestionIndex = getCurrentQuestionIndex();\n    const question = currentQuiz.questions[currentQuestionIndex];\n    const quizView = document.getElementById('quiz-view');\n    const colorScheme = moduleColors[currentQuiz.color];\n    setHasCurrentQuestionBeenAnswered(false);\n    \n    quizView.innerHTML = `\n        <!-- En-t√™te du quiz -->\n        <div class=\"bg-white border-b border-gray-200 shadow-sm\">\n            <div class=\"max-w-5xl mx-auto px-6 py-4\">\n                <div class=\"flex items-center justify-between\">\n                    <div>\n                        <h1 class=\"text-xl font-bold text-slate-900\">${escapeHtml(currentQuiz.name)}</h1>\n                        <p class=\"text-sm text-slate-500\">Question ${currentQuestionIndex + 1} sur ${currentQuiz.questions.length}</p>\n                    </div>\n                    <div class=\"flex items-center gap-6\">\n                        <button id=\"focus-mode-btn\" class=\"text-sm font-medium text-slate-600 hover:text-slate-900 flex items-center gap-1\">\n                            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"></path>\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"></path>\n                            </svg>\n                            Focus\n                        </button>\n                        <button id=\"pause-btn\" class=\"text-sm font-medium text-slate-600 hover:text-slate-900 flex items-center gap-1\">\n                            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n                            </svg>\n                            Pause\n                        </button>\n                        <div class=\"flex items-center gap-2\">\n                            <svg class=\"w-5 h-5 text-indigo-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n                            </svg>\n                            <span id=\"quiz-score\" class=\"text-sm font-bold text-indigo-600\">Score: 0%</span>\n                        </div>\n                        <div class=\"flex items-center gap-2\">\n                            <svg class=\"w-5 h-5 text-slate-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n                            </svg>\n                            <span id=\"quiz-timer\" class=\"text-sm font-medium text-slate-600\">0:00</span>\n                        </div>\n                        <button id=\"quit-quiz-btn\" class=\"text-sm font-medium text-slate-600 hover:text-slate-900\">\n                            Quitter\n                        </button>\n                    </div>\n                </div>\n                \n                <!-- Barre de progression -->\n                <div class=\"mt-4 w-full bg-gray-200 rounded-full h-2\">\n                    <div class=\"${colorScheme.bg} h-2 rounded-full transition-all duration-300\" style=\"width: ${((currentQuestionIndex + 1) / currentQuiz.questions.length) * 100}%\"></div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Contenu de la question -->\n        <div class=\"max-w-5xl mx-auto px-6 py-8\">\n            <div class=\"bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden\">\n                \n                <!-- En-t√™te de question -->\n                <div class=\"px-8 py-6 bg-gradient-to-r from-slate-50 to-white border-b border-gray-100\">\n                    <div class=\"mb-4\">\n                        <span class=\"text-sm font-medium ${colorScheme.text}\">Question ${currentQuestionIndex + 1} sur ${currentQuiz.questions.length}</span>\n                    </div>\n                    \n                    <h2 class=\"text-2xl font-bold text-slate-900 leading-relaxed\">\n                        ${escapeHtml(question.question)}\n                    </h2>\n                    \n                    <!-- Tags -->\n                    ${question.tags && question.tags.length > 0 ? `\n                        <div class=\"flex flex-wrap gap-2 mt-4\">\n                            ${question.tags.map(tag => `\n                                <span class=\"px-3 py-1 bg-slate-100 text-slate-600 text-xs font-medium rounded-full\">\n                                    ${escapeHtml(tag)}\n                                </span>\n                            `).join('')}\n                        </div>\n                    ` : ''}\n                </div>\n\n                <!-- Options de r√©ponse -->\n                <div class=\"p-8\">\n                    <div class=\"space-y-3\">\n                        ${question.options.map(option => `\n                            <button data-option-id=\"${escapeHtml(option.id)}\" \n                                    class=\"option-button w-full text-left px-6 py-5 rounded-xl border-2 border-gray-200 hover:border-${currentQuiz.color}-400 hover:bg-${currentQuiz.color}-50 transition-all duration-200 group\">\n                                <div class=\"flex items-center gap-4\">\n                                    <div class=\"flex-shrink-0 w-10 h-10 rounded-lg ${colorScheme.bg} bg-opacity-10 flex items-center justify-center group-hover:bg-opacity-20 transition-colors\">\n                                        <span class=\"text-lg font-bold ${colorScheme.text}\">${escapeHtml(option.id)}</span>\n                                    </div>\n                                    <span class=\"text-lg text-slate-700 group-hover:text-slate-900 font-medium\">\n                                        ${escapeHtml(option.text)}\n                                    </span>\n                                </div>\n                            </button>\n                        `).join('')}\n                    </div>\n                </div>\n\n                <!-- Zone d'explication (cach√©e initialement) -->\n                <div id=\"explanation-area\" class=\"hidden px-8 py-6 bg-slate-50 border-t border-gray-200\">\n                    <!-- Sera rempli apr√®s la r√©ponse -->\n                </div>\n\n                <!-- Bouton suivant (cach√© initialement) -->\n                <div id=\"next-button-area\" class=\"hidden px-8 py-6 border-t border-gray-200\">\n                    <div class=\"flex justify-between items-center\">\n                        <p class=\"text-sm text-slate-500\">Question suivante dans quelques secondes...</p>\n                        <button id=\"next-question-btn\" class=\"${colorScheme.bg} text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-all flex items-center gap-2\">\n                            Question suivante\n                            <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 7l5 5m0 0l-5 5m5-5H6\"></path>\n                            </svg>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n    updateScoreDisplay();\n}\n\n// G√©rer la r√©ponse de l'utilisateur\nfunction handleAnswer(optionId) {\n    // ‚úÖ CORRECTION SECTION 5 : Utiliser StateManager\n    if (getHasCurrentQuestionBeenAnswered()) {\n        return;\n    }\n    const currentQuiz = getCurrentQuiz();\n    const currentQuestionIndex = getCurrentQuestionIndex();\n    const questionStartTime = getQuestionStartTime();\n    const question = currentQuiz.questions[currentQuestionIndex];\n    const selectedOption = question.options.find(opt => opt.id === optionId);\n    const timeSpent = Math.floor((Date.now() - questionStartTime) / 1000);\n    setHasCurrentQuestionBeenAnswered(true);\n    \n    // Enregistrer la r√©ponse\n    const userAnswers = getUserAnswers();\n    userAnswers.push({\n        questionId: question.id,\n        question: question.question,\n        selectedAnswer: optionId,\n        correctAnswer: question.options.find(opt => opt.correct).id,\n        isCorrect: selectedOption.correct,\n        timeSpent: timeSpent\n    });\n    setUserAnswers(userAnswers);\n    \n    // Mettre √† jour le streak\n    let currentStreak = getCurrentStreak();\n    if (selectedOption.correct) {\n        currentStreak++;\n    } else {\n        currentStreak = 0;\n    }\n    setCurrentStreak(currentStreak);\n    \n    // D√©sactiver tous les boutons\n    document.querySelectorAll('.option-button').forEach(btn => {\n        btn.disabled = true;\n        btn.classList.remove('hover:border-indigo-400', 'hover:bg-indigo-50');\n    });\n    \n    // Afficher le r√©sultat\n    showAnswerFeedback(optionId, selectedOption.correct, question);\n    \n    // Mettre √† jour le score\n    updateScoreDisplay();\n    \n    // Passer √† la question suivante apr√®s un d√©lai\n    setTimeout(() => {\n        document.getElementById('next-button-area')?.classList.remove('hidden');\n    }, 1000);\n}\n\n// Afficher le feedback de la r√©ponse\nfunction showAnswerFeedback(selectedId, isCorrect, question) {\n    // ‚úÖ CORRECTION : Utiliser StateManager pour currentQuiz\n    const currentQuiz = getCurrentQuiz();\n    const colorScheme = moduleColors[currentQuiz.color];\n    const correctOption = question.options.find(opt => opt.correct);\n    \n    // Colorier les options\n    document.querySelectorAll('.option-button').forEach(btn => {\n        const optId = btn.dataset.optionId;\n        \n        if (optId === correctOption.id) {\n            // Bonne r√©ponse en vert\n            btn.classList.add('border-green-500', 'bg-green-50');\n            btn.classList.remove('border-gray-200');\n        } else if (optId === selectedId && !isCorrect) {\n            // Mauvaise r√©ponse en rouge\n            btn.classList.add('border-red-500', 'bg-red-50');\n            btn.classList.remove('border-gray-200');\n        }\n    });\n    \n    // Afficher l'explication\n    const explanationArea = document.getElementById('explanation-area');\n    if (explanationArea) {\n        explanationArea.innerHTML = `\n            <div class=\"flex items-start gap-4\">\n                ${isCorrect ? \n                    '<div class=\"flex-shrink-0 w-12 h-12 rounded-full bg-green-100 flex items-center justify-center\"><svg class=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path></svg></div>' :\n                    '<div class=\"flex-shrink-0 w-12 h-12 rounded-full bg-red-100 flex items-center justify-center\"><svg class=\"w-6 h-6 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path></svg></div>'\n                }\n                <div class=\"flex-1\">\n                    <h3 class=\"text-lg font-bold ${isCorrect ? 'text-green-700' : 'text-red-700'} mb-2\">\n                        ${isCorrect ? '‚úÖ Bonne r√©ponse !' : '‚ùå R√©ponse incorrecte'}\n                    </h3>\n                    <p class=\"text-slate-700 mb-2\"><strong>Explication :</strong> ${escapeHtml(question.explanation)}</p>\n                    ${question.reference ? `<p class=\"text-sm text-slate-500\"><strong>R√©f√©rence :</strong> ${escapeHtml(question.reference)}</p>` : ''}\n                </div>\n            </div>\n        `;\n        explanationArea.classList.remove('hidden');\n    }\n}\n\n// Passer √† la question suivante\nfunction nextQuestion() {\n    // ‚úÖ CORRECTION SECTION 5 : Utiliser StateManager\n    setQuestionStartTime(Date.now());\n    const currentQuestionIndex = getCurrentQuestionIndex();\n    setCurrentQuestionIndex(currentQuestionIndex + 1);\n    \n    const currentQuiz = getCurrentQuiz();\n    const newIndex = getCurrentQuestionIndex();\n    if (newIndex < currentQuiz.questions.length) {\n        renderQuestion();\n    } else {\n        showResults();\n    }\n}\n\n// Afficher les r√©sultats finaux\nfunction showResults() {\n    // ‚úÖ CORRECTION SECTION 5 : Utiliser StateManager\n    stopTimer();\n    try { window.__QUIZ_ACTIVE = false; } catch (e) {}\n    \n    const userAnswers = getUserAnswers();\n    // ‚úÖ CORRECTION SECTION 2 : Validation avant calcul du score pour √©viter division par z√©ro\n    if (userAnswers.length === 0) {\n        console.error('‚ùå Aucune r√©ponse enregistr√©e - quiz invalide');\n        toast.error('Aucune r√©ponse enregistr√©e. Le quiz ne peut pas √™tre compl√©t√©.');\n        return;\n    }\n    \n    const correctCount = userAnswers.filter(a => a.isCorrect).length;\n    const score = Math.round((correctCount / userAnswers.length) * 100);\n    \n    // ‚úÖ CORRECTION SECTION 2 : Validation du score calcul√©\n    if (isNaN(score) || score < 0 || score > 100) {\n        console.error('‚ùå Score invalide calcul√©:', score);\n        toast.error('Erreur de calcul du score. Contactez le support.');\n        return;\n    }\n    const pausedDuration = getPausedDuration();\n    const isPaused = getIsPaused();\n    const pauseStartedAt = getPauseStartedAt();\n    let pausedOffset = pausedDuration;\n    if (isPaused && pauseStartedAt) {\n        pausedOffset += Date.now() - pauseStartedAt;\n    }\n    const startTime = getStartTime();\n    const totalTime = Math.max(0, Math.floor((Date.now() - startTime - pausedOffset) / 1000));\n    setIsPaused(false);\n    setPauseStartedAt(null);\n    setPausedDuration(0);\n    const minutes = Math.floor(totalTime / 60);\n    const seconds = totalTime % 60;\n    \n    // Sauvegarder dans Firestore\n    saveQuizToFirestore(score, totalTime);\n    \n    // ‚úÖ CORRECTION : Utiliser StateManager pour currentQuiz\n    const currentQuiz = getCurrentQuiz();\n    if (!currentQuiz) {\n        console.error('‚ùå currentQuiz non d√©fini dans showResults');\n        toast.error('Erreur: Impossible d\\'afficher les r√©sultats. Veuillez r√©essayer.');\n        return;\n    }\n    \n    const colorScheme = moduleColors[currentQuiz.color];\n    const quizView = document.getElementById('quiz-view');\n    \n    quizView.innerHTML = `\n        <div class=\"min-h-screen bg-gradient-to-br from-slate-50 to-indigo-50 py-12 px-4\">\n            <div class=\"max-w-4xl mx-auto\">\n                <!-- Carte de r√©sultat principale -->\n                <div class=\"bg-white rounded-3xl shadow-2xl overflow-hidden mb-8\">\n                    <!-- Header avec score -->\n                    <div class=\"bg-gradient-to-r from-${currentQuiz.color}-500 to-${currentQuiz.color}-700 px-8 py-12 text-center text-white\">\n                        <h1 class=\"text-4xl font-bold mb-4\">Quiz Termin√© ! üéâ</h1>\n                        <div class=\"text-8xl font-bold mb-4\">${score}%</div>\n                        <p class=\"text-xl opacity-90\">${userAnswers.filter(a => a.isCorrect).length} / ${userAnswers.length} bonnes r√©ponses</p>\n                        <p class=\"text-lg opacity-75 mt-2\">Temps total : ${minutes}:${seconds.toString().padStart(2, '0')}</p>\n                    </div>\n                    \n                    <!-- Message de feedback -->\n                    <div class=\"px-8 py-8 text-center border-b border-gray-200\">\n                        ${score >= 90 ? \n                            '<h2 class=\"text-3xl font-bold text-green-600 mb-2\">üèÜ Excellent !</h2><p class=\"text-slate-600 text-lg\">Performance exceptionnelle ! Vous ma√Ætrisez parfaitement ce module.</p>' :\n                        score >= 75 ?\n                            '<h2 class=\"text-3xl font-bold text-blue-600 mb-2\">üëè Tr√®s bien !</h2><p class=\"text-slate-600 text-lg\">Bon travail ! Quelques r√©visions et vous serez au top.</p>' :\n                        score >= 60 ?\n                            '<h2 class=\"text-3xl font-bold text-yellow-600 mb-2\">üìö Pas mal !</h2><p class=\"text-slate-600 text-lg\">C\\'est un bon d√©but. Continuez √† r√©viser pour am√©liorer votre score.</p>' :\n                            '<h2 class=\"text-3xl font-bold text-red-600 mb-2\">üí™ Continuez !</h2><p class=\"text-slate-600 text-lg\">Ne vous d√©couragez pas. R√©visez les points faibles et r√©essayez !</p>'\n                        }\n                    </div>\n                    \n                    <!-- D√©tails des r√©ponses -->\n                    <div class=\"px-8 py-6\">\n                        <h3 class=\"text-xl font-bold text-slate-900 mb-4\">D√©tails de vos r√©ponses :</h3>\n                        <div class=\"space-y-3 max-h-96 overflow-y-auto\">\n                            ${userAnswers.map((answer, index) => `\n                                <div class=\"flex items-center justify-between p-4 rounded-lg ${answer.isCorrect ? 'bg-green-50' : 'bg-red-50'}\">\n                                    <div class=\"flex items-center gap-3 flex-1\">\n                                        <span class=\"${answer.isCorrect ? 'text-green-600' : 'text-red-600'} text-2xl\">\n                                            ${answer.isCorrect ? '‚úÖ' : '‚ùå'}\n                                        </span>\n                                        <div class=\"flex-1\">\n                                            <p class=\"font-medium text-slate-900\">Question ${index + 1}</p>\n                                            <p class=\"text-sm text-slate-600\">${answer.question}</p>\n                                            ${!answer.isCorrect ? `<p class=\"text-xs text-slate-500 mt-1\">Votre r√©ponse : ${answer.selectedAnswer} | Correcte : ${answer.correctAnswer}</p>` : ''}\n                                        </div>\n                                    </div>\n                                    <span class=\"text-sm text-slate-500\">${answer.timeSpent}s</span>\n                                </div>\n                            `).join('')}\n                        </div>\n                    </div>\n                    \n                    <!-- Boutons d'action -->\n                    <div class=\"px-8 py-6 flex gap-4\">\n                        <button id=\"retry-quiz-btn\" class=\"flex-1 ${colorScheme.bg} text-white px-6 py-3 rounded-xl font-semibold hover:opacity-90 transition-all\">\n                            Refaire le quiz\n                        </button>\n                        <button id=\"return-dashboard-btn\" class=\"flex-1 border-2 border-gray-300 text-slate-700 px-6 py-3 rounded-xl font-semibold hover:bg-slate-50 transition-all\">\n                            Retour au tableau de bord\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n    \n    // Confettis si bon score\n    if (score >= 80) {\n        setTimeout(() => launchConfetti(), 500);\n    }\n    \n    // ‚úÖ CORRECTION SECTION 9 : Tracker la fin du quiz\n    // currentQuiz est d√©j√† d√©fini plus haut dans la fonction\n    const quizTotalTime = Math.floor((Date.now() - getStartTime()) / 1000);\n    trackQuizComplete(\n        getCurrentModule(),\n        score,\n        quizTotalTime,\n        currentQuiz?.questions?.length || 0\n    );\n    \n    // √âv√©nements\n    document.getElementById('retry-quiz-btn')?.addEventListener('click', () => {\n        const currentModule = getCurrentModule();\n        if (currentModule) {\n            startQuiz(currentModule);\n        } else {\n            toast.error('Erreur: Impossible de red√©marrer le quiz.');\n        }\n    });\n    \n    document.getElementById('return-dashboard-btn')?.addEventListener('click', returnToDashboard);\n}\n\n// Sauvegarder le r√©sultat dans Firestore\nasync function saveQuizToFirestore(score, totalTime) {\n    // ‚úÖ CORRECTION SECTION 3 : Nettoyer le timer en cas d'erreur\n    try {\n        const user = getCurrentUserUnified();\n        if (!user) {\n            console.log('Aucun utilisateur - r√©sultat non sauvegard√©');\n            stopTimer(); // Nettoyer le timer\n            return;\n        }\n        \n        // En mode d√©mo, ne pas sauvegarder dans Firestore\n        if (isDemoMode()) {\n            console.log('Mode d√©mo - r√©sultat non sauvegard√© dans Firestore');\n            toast.info('Mode D√©mo : les r√©sultats ne sont pas sauvegard√©s');\n            stopTimer(); // Nettoyer le timer\n            return;\n        }\n        \n        // ‚úÖ CORRECTION SECTION 5 : Utiliser StateManager\n        const currentModule = getCurrentModule();\n        const currentMonth = getCurrentMonth();\n        const currentYear = getCurrentYear();\n        const currentQuiz = getCurrentQuiz();\n        const userAnswers = getUserAnswers();\n        const moduleDetails = moduleConfig[currentModule] || {};\n        const quizData = {\n            moduleId: currentModule,\n            moduleName: moduleDetails.name || currentQuiz.module || currentModule,\n            score,\n            correctAnswers: userAnswers.filter(a => a.isCorrect).length,\n            totalQuestions: currentQuiz.questions.length,\n            timeElapsed: totalTime,\n            answers: userAnswers,\n            month: currentMonth,\n            year: currentYear\n        };\n        \n        // ‚úÖ CORRECTION SECTION 3 : Utiliser retry automatique avec notification utilisateur\n        await withFirestoreRetry(\n            () => saveQuizResult(quizData),\n            {\n                maxRetries: 3,\n                onRetry: (attempt, delay) => {\n                    toast.info(`Nouvelle tentative de sauvegarde ${attempt}/3...`, 3000);\n                }\n            }\n        );\n        \n        toast.success('R√©sultat sauvegard√© avec succ√®s !', 3000);\n        console.log('‚úÖ R√©sultat sauvegard√© dans Firestore');\n    } catch (error) {\n        console.error('‚ùå Erreur lors de la sauvegarde:', error);\n        stopTimer(); // ‚úÖ CORRECTION SECTION 3 : Nettoyer le timer en cas d'erreur\n        \n        // ‚úÖ CORRECTION SECTION 3 : Informer l'utilisateur de l'erreur\n        toast.error('Erreur lors de la sauvegarde. Le r√©sultat sera sauvegard√© localement et synchronis√© plus tard.', 8000);\n        \n        // ‚úÖ CORRECTION SECTION 8 : Utiliser la file d'attente globale\n        try {\n            // ‚úÖ CORRECTION SECTION 5 : Utiliser StateManager\n            const currentModule = getCurrentModule();\n            const currentMonth = getCurrentMonth();\n            const currentYear = getCurrentYear();\n            const userAnswers = getUserAnswers();\n            \n            const resultData = {\n                moduleId: currentModule,\n                moduleName: moduleConfig[currentModule]?.name || currentModule,\n                score: score,\n                correctAnswers: userAnswers.filter(a => a.isCorrect).length,\n                totalQuestions: userAnswers.length,\n                timeElapsed: totalTime,\n                answers: userAnswers,\n                month: currentMonth,\n                year: currentYear\n            };\n            \n            // ‚úÖ CORRECTION SECTION 8 : Ajouter √† la file d'attente globale\n            const { syncQueue } = await import('./sync-queue.js');\n            await syncQueue.add('quizResult', async (data) => {\n                await saveQuizResult(data);\n            }, resultData);\n            \n            console.log('‚úÖ R√©sultat ajout√© √† la file d\\'attente de synchronisation');\n        } catch (queueError) {\n            console.error('‚ùå Erreur ajout √† la file d\\'attente:', queueError);\n            // Fallback sur localStorage si IndexedDB n'est pas disponible\n            try {\n                const queueKey = `quiz_result_${Date.now()}`;\n                localStorage.setItem(queueKey, JSON.stringify({\n                    score,\n                    totalTime,\n                    moduleId: getCurrentModule(),\n                    month: getCurrentMonth(),\n                    year: getCurrentYear(),\n                    userAnswers: getUserAnswers(),\n                    timestamp: Date.now()\n                }));\n            } catch (localError) {\n                console.error('‚ùå Erreur sauvegarde locale de secours:', localError);\n            }\n        }\n    }\n}\n\n// Timer du quiz\nfunction startTimer() {\n    // ‚úÖ CORRECTION SECTION 5 : Utiliser StateManager\n    stopTimer();\n    const interval = setInterval(() => {\n        const startTime = getStartTime();\n        if (startTime === null) {\n            return;\n        }\n\n        const pausedDuration = getPausedDuration();\n        const isPaused = getIsPaused();\n        const pauseStartedAt = getPauseStartedAt();\n        let pausedOffset = pausedDuration;\n        if (isPaused && pauseStartedAt) {\n            pausedOffset += Date.now() - pauseStartedAt;\n        }\n\n        const elapsedMs = Date.now() - startTime - pausedOffset;\n        const elapsed = Math.max(0, Math.floor(elapsedMs / 1000));\n        const minutes = Math.floor(elapsed / 60);\n        const seconds = elapsed % 60;\n        const timerElement = document.getElementById('quiz-timer');\n        if (timerElement) {\n            timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;\n        }\n    }, 1000);\n    setTimerInterval(interval);\n}\n\nfunction stopTimer() {\n    // ‚úÖ CORRECTION SECTION 5 : Utiliser StateManager\n    const timerInterval = getTimerInterval();\n    if (timerInterval) {\n        clearInterval(timerInterval);\n        setTimerInterval(null);\n    }\n    setPauseStartedAt(null);\n}\n\n// ‚úÖ CORRECTION SECTION 3 : Nettoyer le timer sur toutes les sorties (beforeunload, erreurs)\n// Nettoyer le timer quand l'utilisateur quitte la page\nwindow.addEventListener('beforeunload', () => {\n    stopTimer();\n});\n\n// Nettoyer le timer quand la page est cach√©e (onglet inactif)\ndocument.addEventListener('visibilitychange', () => {\n    if (document.hidden) {\n        // Optionnel : on peut aussi nettoyer ici si n√©cessaire\n    }\n});\n\n// Mettre √† jour l'affichage du score\nfunction updateScoreDisplay() {\n    // ‚úÖ CORRECTION SECTION 5 : Utiliser StateManager\n    const userAnswers = getUserAnswers();\n    if (userAnswers.length === 0) return;\n    \n    const score = Math.round((userAnswers.filter(a => a.isCorrect).length / userAnswers.length) * 100);\n    const scoreElement = document.getElementById('quiz-score');\n    if (scoreElement) {\n        scoreElement.textContent = `Score: ${score}%`;\n    }\n}\n\n// Mode focus\nfunction toggleFocusMode() {\n    document.body.classList.toggle('focus-mode');\n}\n\n// Pause\nfunction togglePause() {\n    // ‚úÖ CORRECTION SECTION 5 : Utiliser StateManager\n    const pauseBtn = document.getElementById('pause-btn');\n    if (!pauseBtn) {\n        return;\n    }\n\n    const isPaused = getIsPaused();\n    if (!isPaused) {\n        setIsPaused(true);\n        setPauseStartedAt(Date.now());\n        pauseBtn.innerHTML = '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z\"></path><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg> Reprendre';\n        toast.warning('Quiz en pause. Cliquez sur \"Reprendre\" pour continuer.', 3000);\n    } else {\n        // ‚úÖ CORRECTION SECTION 5 : Utiliser StateManager\n        setIsPaused(false);\n        const pauseStartedAt = getPauseStartedAt();\n        if (pauseStartedAt) {\n            const pausedDuration = getPausedDuration();\n            setPausedDuration(pausedDuration + (Date.now() - pauseStartedAt));\n        }\n        setPauseStartedAt(null);\n        pauseBtn.innerHTML = '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg> Pause';\n        toast.success('Quiz repris !', 2000);\n    }\n}\n\n// Retour au dashboard\nfunction returnToDashboard() {\n    // ‚úÖ CORRECTION SECTION 5 : Utiliser StateManager\n    stopTimer();\n    try { window.__QUIZ_ACTIVE = false; } catch (e) {}\n    setIsPaused(false);\n    setPausedDuration(0);\n    setPauseStartedAt(null);\n    setHasCurrentQuestionBeenAnswered(false);\n    document.getElementById('quiz-view')?.classList.add('view-hidden');\n    document.getElementById('dashboard-view')?.classList.remove('view-hidden');\n    \n    // Mettre √† jour la navigation\n    document.querySelectorAll('.nav-link').forEach(link => {\n        link.classList.remove('bg-indigo-800', 'text-indigo-100');\n        link.classList.add('text-indigo-300');\n    });\n    document.getElementById('nav-dashboard')?.classList.add('bg-indigo-800', 'text-indigo-100');\n    \n    // Toast de confirmation\n    toast.info('Retour au tableau de bord', 2000);\n    \n    // Recharger le dashboard pour mettre √† jour les stats\n    setTimeout(() => window.location.reload(), 500);\n}\n","// Dashboard principal - Gestion de l'interface QuizPro\nimport { onAuthChange, signInWithGoogle, signOutUser, getCurrentUserUnified, showAdminUIIfAdmin } from './auth.js';\nimport { startQuiz } from './quiz.js';\nimport { \n    getUserProfile, \n    getAnnualProgress, \n    getUserQuizResults,\n    updateStreak\n} from './firestore-service.js';\n// Import des utilitaires de mois (Section 2 - Correction logique mensuelle)\nimport { MONTH_NAMES, getCurrentMonthIndex, getCurrentYear, normalizeMonthFormat } from './month-utils.js';\n// ‚úÖ CORRECTION SECTION 4 : Protection XSS\nimport { escapeHtml } from './security.js';\n// ‚úÖ CORRECTION SECTION 5 : StateManager - Centralisation des variables globales\nimport { stateManager } from './state-manager.js';\n// ‚úÖ CORRECTION SECTION 9 : Analytics\nimport { trackPageView } from './analytics.js';\n\n// --- CONSTANTES GLOBALES ---\n// ‚úÖ CORRECTION SECTION 2 : Utilise la date r√©elle au lieu d'une valeur hardcod√©e\nconst currentMonthIndex = getCurrentMonthIndex(); // 0-11, change automatiquement chaque mois\nconst MONTH_NAMES_IMPORTED = MONTH_NAMES; // Alias pour compatibilit√©\n\n// ‚úÖ CORRECTION SECTION 5 : StateManager - Initialiser monthsData dans le StateManager\n// Donn√©es des mois (sera remplac√© par les donn√©es Firebase)\nstateManager.set('monthsData', MONTH_NAMES_IMPORTED.map(name => ({ name, score: null })));\nstateManager.set('currentMonthIndex', currentMonthIndex);\n\n// --- √âL√âMENTS DOM ---\nconst views = {\n    login: document.getElementById('login-view'),\n    dashboard: document.getElementById('dashboard-view'),\n    moduleSelection: document.getElementById('module-selection-view')\n};\n\nconst elements = {\n    modulesGrid: document.getElementById('modules-grid'),\n    annualProgressBar: document.getElementById('annual-progress-bar'),\n    annualProgressText: document.getElementById('annual-progress-text'),\n    moduleSelectionTitle: document.getElementById('module-selection-title'),\n    welcomeMessage: document.getElementById('welcome-message'),\n    userAvatar: document.getElementById('user-avatar'),\n    userName: document.getElementById('user-name'),\n    googleSigninBtn: document.getElementById('google-signin-btn'),\n    signoutLink: document.getElementById('signout-link')\n};\n\n// ‚úÖ CORRECTION SECTION 5 : StateManager - dashboardEventDelegationAttached migr√© vers StateManager\nstateManager.set('dashboardEventDelegationAttached', false);\n\n// --- FONCTIONS DE NAVIGATION ---\n\nfunction showView(viewId) {\n    Object.values(views).forEach(view => {\n        if (view) view.classList.add('view-hidden');\n    });\n    if (views[viewId]) {\n        views[viewId].classList.remove('view-hidden');\n    } else {\n        console.error('‚ùå Vue non trouv√©e:', viewId);\n    }\n}\n\nfunction updateActiveNavLink(navId) {\n    document.querySelectorAll('.nav-link').forEach(link => {\n        link.classList.remove('bg-indigo-800', 'text-indigo-100');\n        link.classList.add('text-indigo-300');\n    });\n    const activeLink = document.getElementById(navId);\n    if (activeLink) {\n        activeLink.classList.add('bg-indigo-800', 'text-indigo-100');\n        activeLink.classList.remove('text-indigo-300');\n    }\n}\n\n// --- FONCTIONS DE G√âN√âRATION DE CARTES ---\n\nfunction createProgressRing(percentage) {\n    const r = 54;\n    const c = r * 2 * Math.PI;\n    const offset = c - (percentage / 100) * c;\n\n    let progressColorClass = 'text-green-600';\n    if (percentage < 80) progressColorClass = 'text-yellow-500';\n    if (percentage < 60) progressColorClass = 'text-red-600';\n    \n    return `\n        <svg class=\"w-32 h-32\" viewBox=\"0 0 120 120\">\n            <circle class=\"text-gray-200\" stroke-width=\"12\" stroke=\"currentColor\" fill=\"transparent\" r=\"${r}\" cx=\"60\" cy=\"60\" />\n            <circle\n                class=\"progress-circle ${progressColorClass} transition-all duration-500\"\n                stroke-width=\"12\"\n                stroke-dasharray=\"${c}\"\n                stroke-dashoffset=\"${offset}\"\n                stroke-linecap=\"round\"\n                stroke=\"currentColor\"\n                fill=\"transparent\"\n                r=\"${r}\"\n                cx=\"60\"\n                cy=\"60\"\n                transform=\"rotate(-90 60 60)\"\n                style=\"stroke-dashoffset: 283;\"\n            />\n            <text x=\"50%\" y=\"50%\" text-anchor=\"middle\" dy=\".3em\" class=\"text-3xl font-bold fill-current text-slate-800\">\n                ${percentage}%\n            </text>\n        </svg>\n    `;\n}\n\nfunction createCompletedCard(month, score) {\n    // Intensit√© du d√©grad√© indigo bas√©e sur le score\n    const getScoreStyle = (score) => {\n        if (score >= 90) return { \n            bg: 'from-indigo-600 via-indigo-700 to-indigo-800', \n            badge: 'bg-emerald-500',\n            badgeText: 'Excellent'\n        };\n        if (score >= 75) return { \n            bg: 'from-indigo-500 via-indigo-600 to-indigo-700', \n            badge: 'bg-blue-500',\n            badgeText: 'Tr√®s bien'\n        };\n        if (score >= 60) return { \n            bg: 'from-indigo-400 via-indigo-500 to-indigo-600', \n            badge: 'bg-indigo-400',\n            badgeText: 'Bien'\n        };\n        return { \n            bg: 'from-slate-400 via-slate-500 to-slate-600', \n            badge: 'bg-slate-400',\n            badgeText: 'Passable'\n        };\n    };\n    \n    const style = getScoreStyle(score);\n    // ‚úÖ CORRECTION SECTION 4 : Protection XSS - √âchapper les donn√©es utilisateur\n    const safeMonth = escapeHtml(month);\n    const safeScore = escapeHtml(score);\n    \n    return `\n        <div class=\"card-hover relative bg-gradient-to-br ${style.bg} p-6 rounded-2xl shadow-lg hover:shadow-xl border border-white/20 flex flex-col items-center cursor-pointer transform transition-all duration-300 hover:scale-[1.02] group\">\n            <div class=\"absolute top-3 right-3 ${style.badge} text-white text-xs font-semibold px-2.5 py-1 rounded-full shadow-md\">\n                ${style.badgeText}\n            </div>\n            <div class=\"absolute top-3 left-3 bg-white/90 backdrop-blur-sm p-1.5 rounded-full\">\n                <svg class=\"h-4 w-4 text-emerald-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                    <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\" />\n                </svg>\n            </div>\n            <h3 class=\"text-xl font-bold text-white mb-4 drop-shadow-md\">${safeMonth}</h3>\n            ${createProgressRing(score)}\n            <span class=\"mt-4 text-sm font-semibold text-white/95 bg-white/15 px-3 py-1.5 rounded-full backdrop-blur-sm\">Score: ${safeScore}%</span>\n            <a href=\"#\" class=\"mt-3 text-sm font-medium text-white/90 hover:text-white underline decoration-2 underline-offset-2 opacity-0 group-hover:opacity-100 transition-opacity\">Voir d√©tails ‚Üí</a>\n        </div>\n    `;\n}\n\nfunction createLockedCard(month) {\n    // ‚úÖ CORRECTION SECTION 4 : Protection XSS - √âchapper les donn√©es utilisateur\n    const safeMonth = escapeHtml(month);\n    \n    return `\n        <div class=\"relative bg-gradient-to-br from-slate-50 via-slate-100 to-slate-200 p-6 rounded-2xl border border-slate-300 flex flex-col items-center justify-center min-h-[260px] shadow-sm overflow-hidden\">\n            <!-- Motif subtil -->\n            <div class=\"absolute inset-0 opacity-[0.03]\" style=\"background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,.1) 10px, rgba(0,0,0,.1) 20px);\"></div>\n            \n            <!-- Badge verrouill√© discret -->\n            <div class=\"absolute top-3 right-3 bg-red-500 text-white px-2 py-1 rounded-md text-xs font-semibold shadow-sm\">\n                üîí Verrouill√©\n            </div>\n            \n            <!-- Cadenas minimaliste -->\n            <div class=\"relative mb-4\">\n                <div class=\"relative bg-white p-3.5 rounded-xl shadow-md border-2 border-red-100\">\n                    <svg class=\"h-8 w-8 text-red-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\n                    </svg>\n                </div>\n            </div>\n            \n            <h3 class=\"text-xl font-bold text-slate-700 mb-2\">${safeMonth}</h3>\n            <div class=\"flex items-center gap-2 text-sm text-slate-500 bg-white px-3 py-1.5 rounded-lg\">\n                <svg class=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                </svg>\n                <span class=\"font-medium\">Disponible le 1er du mois</span>\n            </div>\n        </div>\n    `;\n}\n\nfunction createIncompleteCard(month) {\n    // ‚úÖ CORRECTION SECTION 4 : Protection XSS - √âchapper les donn√©es utilisateur\n    const safeMonth = escapeHtml(month);\n    \n    return `\n        <div class=\"card-hover relative bg-gradient-to-br from-amber-50 to-orange-50 p-6 rounded-2xl shadow-sm hover:shadow-md border border-amber-200 flex flex-col items-center justify-center min-h-[260px] cursor-pointer transform transition-all duration-300 hover:scale-[1.02] group overflow-hidden\">\n            <!-- Badge √† compl√©ter -->\n            <div class=\"absolute top-3 right-3 bg-amber-500 text-white px-2 py-1 rounded-md text-xs font-semibold shadow-sm\">\n                √Ä compl√©ter\n            </div>\n            \n            <!-- Ic√¥ne horloge -->\n            <div class=\"relative mb-4\">\n                <div class=\"relative bg-white p-3.5 rounded-xl shadow-md border-2 border-amber-100\">\n                    <svg class=\"h-8 w-8 text-amber-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                    </svg>\n                </div>\n            </div>\n            \n            <h3 class=\"text-xl font-bold text-slate-700 mb-2\">${safeMonth}</h3>\n            <span class=\"text-sm text-amber-600 text-center font-medium mb-3\">Mois manqu√© - Rattrapez-le !</span>\n            \n            <!-- Barre de progression -->\n            <div class=\"mt-3 w-full bg-amber-100 rounded-full h-2.5 overflow-hidden\">\n                <div class=\"bg-gradient-to-r from-amber-400 to-amber-500 h-2.5 rounded-full\" style=\"width: 0%\"></div>\n            </div>\n            <span class=\"mt-2 text-xs text-amber-600 font-medium\">0% compl√©t√©</span>\n            \n            <!-- Bouton au hover -->\n            <button class=\"mt-4 opacity-0 group-hover:opacity-100 transition-all bg-amber-500 hover:bg-amber-600 text-white font-semibold px-4 py-2 rounded-lg shadow-sm hover:shadow-md transform hover:-translate-y-0.5\">\n                Compl√©ter maintenant\n            </button>\n        </div>\n    `;\n}\n\nfunction createActiveCard(month) {\n    // ‚úÖ CORRECTION SECTION 4 : Protection XSS - √âchapper les donn√©es utilisateur\n    const safeMonth = escapeHtml(month);\n    \n    return `\n        <div class=\"card-hover relative bg-gradient-to-br from-indigo-500 via-indigo-600 to-indigo-700 p-6 rounded-2xl shadow-xl hover:shadow-2xl border border-indigo-400/30 flex flex-col items-center justify-center min-h-[260px] ring-2 ring-indigo-400/20 cursor-pointer transform transition-all duration-300 hover:scale-[1.02] group overflow-hidden\">\n            <!-- Effet de brillance subtil -->\n            <div class=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000\"></div>\n            \n            <!-- Badge ACTIF -->\n            <span class=\"absolute top-3 right-3 bg-emerald-500 text-white text-xs font-semibold px-3 py-1.5 rounded-md shadow-md\">\n                ‚ö° Actif\n            </span>\n            \n            <!-- Ic√¥ne stylo -->\n            <div class=\"relative mb-4\">\n                <div class=\"relative bg-white/15 backdrop-blur-sm p-4 rounded-xl shadow-lg border border-white/20\">\n                    <svg class=\"h-10 w-10 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\n                    </svg>\n                </div>\n            </div>\n            \n            <h3 class=\"text-2xl font-bold text-white mb-2 drop-shadow-md\">${safeMonth}</h3>\n            <p class=\"text-white/90 text-sm font-medium mb-4 bg-white/10 px-3 py-1 rounded-lg backdrop-blur-sm\">üéØ Pr√™t √† √™tre compl√©t√©</p>\n            \n            <!-- Bouton CTA -->\n            <button class=\"start-quiz-button w-full bg-white text-indigo-600 font-semibold px-6 py-3 rounded-lg shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5 group/btn\">\n                <span class=\"flex items-center justify-center gap-2\">\n                    D√©marrer le quiz\n                    <svg class=\"h-5 w-5 transform group-hover/btn:translate-x-1 transition-transform\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 7l5 5m0 0l-5 5m5-5H6\" />\n                    </svg>\n                </span>\n            </button>\n        </div>\n    `;\n}\n\n// --- INITIALISATION DU DASHBOARD ---\n\nfunction calculateStreak() {\n    // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour monthsData\n    const monthsData = stateManager.get('monthsData');\n    let streak = 0;\n    for (let i = currentMonthIndex - 1; i >= 0; i--) {\n        if (monthsData[i].score !== null && monthsData[i].score >= 60) {\n            streak++;\n        } else {\n            break;\n        }\n    }\n    return streak;\n}\n\n// Charger les donn√©es Firebase pour le dashboard\nasync function loadDashboardData() {\n    try {\n        const user = getCurrentUserUnified();\n        if (!user) {\n            console.log('‚ÑπÔ∏è Aucun utilisateur - pas de donn√©es √† charger');\n            return;\n        }\n        \n        console.log('üìä Chargement des donn√©es du dashboard...');\n        \n        // Charger le profil utilisateur\n        const userProfile = await getUserProfile(user.uid);\n        \n        // Afficher l'interface admin si l'utilisateur est admin\n        if (userProfile) {\n            await showAdminUIIfAdmin(userProfile);\n        }\n        \n        // Charger la progression annuelle\n        const progress = await getAnnualProgress(user.uid);\n        \n        // Mettre √† jour monthsData avec les vraies donn√©es\n        // ‚úÖ CORRECTION SECTION 2 : Normaliser le format du mois pour garantir la correspondance\n        // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour monthsData\n        const currentYear = getCurrentYear();\n        let monthsData = stateManager.get('monthsData');\n        monthsData = monthsData.map((month, index) => {\n            // Normaliser le format du mois pour garantir la correspondance\n            const monthKey = normalizeMonthFormat(month.name, currentYear);\n            if (progress[monthKey]) {\n                return {\n                    name: month.name,\n                    score: progress[monthKey].score\n                };\n            }\n            return month;\n        });\n        \n        // Mettre √† jour le streak\n        const streak = await updateStreak(user.uid);\n        const streakCountElement = document.getElementById('streak-count');\n        if (streakCountElement) {\n            streakCountElement.textContent = streak;\n        }\n        \n        console.log('‚úÖ Donn√©es du dashboard charg√©es');\n    } catch (error) {\n        console.error('‚ùå Erreur chargement donn√©es:', error);\n    }\n}\n\nasync function initializeDashboard() {\n    if (!elements.modulesGrid) {\n        console.error(\"‚ùå L'√©l√©ment 'modules-grid' est introuvable.\");\n        return;\n    }\n    \n        // Charger les donn√©es Firebase en premier\n        await loadDashboardData();\n        \n        elements.modulesGrid.innerHTML = '';\n        let completedCount = 0;\n\n        // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour monthsData\n        const currentMonthsData = stateManager.get('monthsData');\n        currentMonthsData.forEach((month, index) => {\n        let cardHtml = '';\n        if (index < currentMonthIndex) {\n            // Mois pass√©s : v√©rifier s'ils sont compl√©t√©s ou non\n            if (month.score !== null) {\n                cardHtml = createCompletedCard(month.name, month.score);\n                completedCount++;\n            } else {\n                // Mois pass√© mais non compl√©t√© - afficher comme \"√† compl√©ter\"\n                cardHtml = createIncompleteCard(month.name);\n            }\n        } else if (index === currentMonthIndex) {\n            cardHtml = createActiveCard(month.name);\n        } else {\n            cardHtml = createLockedCard(month.name);\n        }\n        elements.modulesGrid.innerHTML += cardHtml;\n    });\n\n    // Mettre √† jour la barre de progression annuelle\n    const annualProgressPercent = (completedCount / 12) * 100;\n    elements.annualProgressBar.style.width = `${annualProgressPercent}%`;\n    elements.annualProgressText.textContent = `${completedCount}/12`;\n\n    // Mettre √† jour le badge de s√©rie\n    const streak = calculateStreak();\n    const streakCountElement = document.getElementById('streak-count');\n    if (streakCountElement) {\n        streakCountElement.textContent = streak;\n    }\n    const streakBadge = document.getElementById('streak-badge');\n    if (streakBadge && streak === 0) {\n        streakBadge.style.display = 'none';\n    }\n\n    // Attacher les √©v√©nements via d√©l√©gation (une seule fois)\n    initializeDashboardEventDelegation();\n    \n    // Cr√©er les graphiques\n    setTimeout(() => {\n        createSkillsRadarChart();\n        createScoresTrendChart();\n        createActivityHeatmap();\n    }, 500);\n}\n\n// Cr√©er le graphique radar des comp√©tences\nfunction createSkillsRadarChart() {\n    const ctx = document.getElementById('skills-radar-chart');\n    if (!ctx) return;\n    \n    new Chart(ctx, {\n        type: 'radar',\n        data: {\n            labels: ['Proc√©dures', 'Garanties', 'Documentation', 'Inspection', 'Entretien', 'R√©glementation'],\n            datasets: [{\n                label: 'Vos Comp√©tences',\n                data: [92, 88, 85, 90, 87, 94],\n                backgroundColor: 'rgba(99, 102, 241, 0.2)',\n                borderColor: 'rgb(99, 102, 241)',\n                borderWidth: 2,\n                pointBackgroundColor: 'rgb(99, 102, 241)',\n                pointBorderColor: '#fff',\n                pointHoverBackgroundColor: '#fff',\n                pointHoverBorderColor: 'rgb(99, 102, 241)'\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: true,\n            scales: {\n                r: {\n                    beginAtZero: true,\n                    max: 100,\n                    ticks: {\n                        stepSize: 20\n                    }\n                }\n            },\n            plugins: {\n                legend: {\n                    display: false\n                }\n            }\n        }\n    });\n}\n\n// Cr√©er le graphique de tendance des scores\nfunction createScoresTrendChart() {\n    const ctx = document.getElementById('scores-trend-chart');\n    if (!ctx) return;\n    \n    // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour monthsData\n    const monthsData = stateManager.get('monthsData');\n    const completedMonths = monthsData.filter((m, i) => i < currentMonthIndex);\n    \n    new Chart(ctx, {\n        type: 'line',\n        data: {\n            labels: completedMonths.map(m => m.name),\n            datasets: [{\n                label: 'Score (%)',\n                data: completedMonths.map(m => m.score),\n                backgroundColor: 'rgba(99, 102, 241, 0.1)',\n                borderColor: 'rgb(99, 102, 241)',\n                borderWidth: 3,\n                fill: true,\n                tension: 0.4,\n                pointRadius: 5,\n                pointHoverRadius: 7,\n                pointBackgroundColor: 'rgb(99, 102, 241)',\n                pointBorderColor: '#fff',\n                pointBorderWidth: 2\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: true,\n            scales: {\n                y: {\n                    beginAtZero: true,\n                    max: 100,\n                    ticks: {\n                        callback: function(value) {\n                            return value + '%';\n                        }\n                    }\n                }\n            },\n            plugins: {\n                legend: {\n                    display: false\n                },\n                tooltip: {\n                    callbacks: {\n                        label: function(context) {\n                            return 'Score: ' + context.parsed.y + '%';\n                        }\n                    }\n                }\n            }\n        }\n    });\n}\n\n// Cr√©er la heatmap d'activit√© (style GitHub)\nfunction createActivityHeatmap() {\n    const container = document.getElementById('activity-heatmap');\n    if (!container) return;\n    \n    const weeksInYear = 52;\n    const daysInWeek = 7;\n    \n    let heatmapHTML = '<div class=\"flex gap-1\">';\n    \n    for (let week = 0; week < weeksInYear; week++) {\n        heatmapHTML += '<div class=\"flex flex-col gap-1\">';\n        for (let day = 0; day < daysInWeek; day++) {\n            const dayIndex = week * daysInWeek + day;\n            let intensity = 0;\n            \n            // Simuler des donn√©es d'activit√©\n            if (dayIndex % 30 < 28) {\n                intensity = Math.floor(Math.random() * 4) + 1;\n            }\n            \n            const colors = [\n                'bg-slate-100',\n                'bg-green-200',\n                'bg-green-400',\n                'bg-green-600',\n                'bg-green-800'\n            ];\n            \n            heatmapHTML += `<div class=\"w-3 h-3 rounded-sm ${colors[intensity]}\" title=\"Activit√©\"></div>`;\n        }\n        heatmapHTML += '</div>';\n    }\n    \n    heatmapHTML += '</div>';\n    // ‚úÖ CORRECTION SECTION 4 : Protection XSS - Le HTML g√©n√©r√© ici ne contient pas de donn√©es utilisateur, donc safe\n    container.innerHTML = heatmapHTML;\n}\n\n// Variable pour emp√™cher l'attachement multiple des listeners\nlet navigationListenersAttached = false;\n\nfunction attachNavigationListeners() {\n    // √âviter d'attacher les listeners plusieurs fois\n    if (navigationListenersAttached) {\n        return;\n    }\n    navigationListenersAttached = true;\n\n    console.log('üîß Attachement des listeners de navigation (une seule fois)...');\n\n    // Navigation - Dashboard\n    document.getElementById('nav-dashboard')?.addEventListener('click', (e) => {\n        e.preventDefault();\n        showView('dashboard');\n        updateActiveNavLink('nav-dashboard');\n    });\n\n    // Navigation - Quiz (ouvre la s√©lection de modules)\n    document.getElementById('nav-quiz')?.addEventListener('click', (e) => {\n        e.preventDefault();\n        // ‚úÖ CORRECTION SECTION 4 : Protection XSS - Utiliser textContent (√©chappement automatique)\n        // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour monthsData\n        const monthsData = stateManager.get('monthsData');\n        const activeMonth = monthsData[currentMonthIndex]?.name || 'ce mois';\n        elements.moduleSelectionTitle.textContent = `Quiz de ${activeMonth}`;\n        showView('moduleSelection');\n        updateActiveNavLink('nav-quiz');\n    });\n\n    // Navigation - Mes R√©sultats (demander confirmation si un quiz est en cours)\n    document.getElementById('nav-results')?.addEventListener('click', (e) => {\n        e.preventDefault(); // TOUJOURS emp√™cher la navigation par d√©faut\n        const target = e.currentTarget;\n        if (window.__QUIZ_ACTIVE) {\n            const ok = confirm('Un quiz est en cours. Voulez-vous vraiment quitter ?');\n            if (ok && target && target.href) {\n                window.location.href = target.href;\n            }\n        } else {\n            // Navigation normale vers la page des r√©sultats\n            if (target && target.href) {\n                window.location.href = target.href;\n            }\n        }\n    });\n\n    // Navigation - Ressources (demander confirmation si un quiz est en cours)\n    document.getElementById('nav-resources')?.addEventListener('click', (e) => {\n        e.preventDefault(); // TOUJOURS emp√™cher la navigation par d√©faut\n        const target = e.currentTarget;\n        if (window.__QUIZ_ACTIVE) {\n            const ok = confirm('Un quiz est en cours. Voulez-vous vraiment quitter ?');\n            if (ok && target && target.href) {\n                window.location.href = target.href;\n            }\n        } else {\n            // Navigation normale vers la page des ressources\n            if (target && target.href) {\n                window.location.href = target.href;\n            }\n        }\n    });\n    \n    console.log('‚úÖ Listeners de navigation attach√©s');\n}\n\nfunction initializeDashboardEventDelegation() {\n    // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour dashboardEventDelegationAttached\n    if (stateManager.get('dashboardEventDelegationAttached')) {\n        return;\n    }\n\n    document.addEventListener('click', (event) => {\n        const startButton = event.target.closest('.start-quiz-button');\n        if (startButton) {\n            event.preventDefault();\n            // ‚úÖ CORRECTION SECTION 4 : Protection XSS - Utiliser textContent (√©chappement automatique)\n            // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour monthsData\n            const monthsData = stateManager.get('monthsData');\n            const activeMonth = monthsData[currentMonthIndex]?.name || 'ce mois';\n            elements.moduleSelectionTitle.textContent = `Quiz de ${activeMonth}`;\n            showView('moduleSelection');\n            updateActiveNavLink('nav-quiz');\n            return;\n        }\n\n        const backButton = event.target.closest('.back-to-dashboard');\n        if (backButton) {\n            event.preventDefault();\n            showView('dashboard');\n            updateActiveNavLink('nav-dashboard');\n            return;\n        }\n\n        const moduleCard = event.target.closest('.module-card');\n        if (moduleCard) {\n            event.preventDefault();\n            const module = moduleCard.getAttribute('data-module');\n            if (module) {\n                startQuiz(module);\n            }\n        }\n    });\n\n    // ‚úÖ CORRECTION SECTION 5 : StateManager - Sauvegarder dans StateManager\n    stateManager.set('dashboardEventDelegationAttached', true);\n}\n\n// --- GESTION DE L'AUTHENTIFICATION ---\n\nfunction updateUserProfile(user) {\n    if (user) {\n        // ‚úÖ CORRECTION SECTION 4 : Protection XSS - Utiliser textContent (√©chappement automatique)\n        elements.userName.textContent = user.displayName || 'Utilisateur';\n        elements.userAvatar.src = user.photoURL || 'https://placehold.co/100x100/667eea/e0e7ff?text=' + (user.displayName?.[0] || 'U');\n        \n        // Message de bienvenue personnalis√© - textContent √©chappe automatiquement\n        // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour monthsData\n        const monthsData = stateManager.get('monthsData');\n        const firstName = user.displayName?.split(' ')[0] || 'Utilisateur';\n        const monthName = monthsData[currentMonthIndex]?.name || 'ce mois';\n        elements.welcomeMessage.textContent = `Bonjour ${firstName}, pr√™t √† relever votre d√©fi de ${monthName} ?`;\n    }\n}\n\n// --- INITIALISATION PRINCIPALE ---\n\n// Gestion du th√®me (dark/light mode)\nfunction initializeTheme() {\n    const savedTheme = localStorage.getItem('theme') || 'light';\n    document.documentElement.classList.toggle('dark', savedTheme === 'dark');\n    updateThemeButton(savedTheme);\n}\n\nfunction updateThemeButton(theme) {\n    const sunIcon = document.getElementById('theme-icon-sun');\n    const moonIcon = document.getElementById('theme-icon-moon');\n    const themeText = document.getElementById('theme-text');\n    \n    if (theme === 'dark') {\n        sunIcon?.classList.remove('hidden');\n        moonIcon?.classList.add('hidden');\n        if (themeText) themeText.textContent = 'Mode Clair';\n    } else {\n        sunIcon?.classList.add('hidden');\n        moonIcon?.classList.remove('hidden');\n        if (themeText) themeText.textContent = 'Mode Sombre';\n    }\n}\n\nfunction toggleTheme() {\n    const currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';\n    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n    \n    document.documentElement.classList.toggle('dark');\n    localStorage.setItem('theme', newTheme);\n    updateThemeButton(newTheme);\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    // ‚úÖ CORRECTION SECTION 9 : Tracker la page vue\n    trackPageView('Dashboard', '/index.html');\n    console.log('üöÄ Initialisation de QuizPro...');\n\n    // Initialiser le th√®me\n    initializeTheme();\n    \n    // Attacher les listeners de navigation UNE SEULE FOIS\n    attachNavigationListeners();\n    \n    // Bouton toggle th√®me\n    document.getElementById('theme-toggle')?.addEventListener('click', toggleTheme);\n\n    // Gestion de la connexion Google\n    elements.googleSigninBtn?.addEventListener('click', signInWithGoogle);\n    \n    elements.signoutLink?.addEventListener('click', (e) => {\n        e.preventDefault();\n        if (confirm('Voulez-vous vraiment vous d√©connecter ?')) {\n            signOutUser();\n        }\n    });\n\n    // Mode normal - Afficher l'√©cran de connexion\n    showView('login');\n    \n    // √âcouter les changements d'authentification Firebase\n    onAuthChange((user) => {\n        if (user) {\n            console.log('‚úÖ Utilisateur connect√©:', user.displayName);\n            updateUserProfile(user);\n            showView('dashboard');\n            updateActiveNavLink('nav-dashboard');\n            initializeDashboard();\n        } else {\n            console.log('üë§ Aucun utilisateur connect√©');\n            showView('login');\n        }\n    });\n\n    console.log('‚úÖ QuizPro initialis√© avec succ√®s');\n});\n"],"file":"main-BF0umfQ2.js"}