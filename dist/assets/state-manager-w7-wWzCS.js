class u{constructor(){this.state={currentQuiz:null,currentQuestionIndex:0,userAnswers:[],startTime:null,timerInterval:null,questionStartTime:null,pausedDuration:0,isPaused:!1,currentModule:null,currentMonth:null,currentYear:null,currentStreak:0,monthsData:[],currentMonthIndex:null,annualProgress:{},userProfile:null,globalStats:null,topUsers:[],recentActivity:[],allUsers:[],questionsStats:null,usersStats:null,currentUser:null,isDemoMode:!1,clientId:null,isLoading:!1,error:null,notifications:[]},this.listeners=new Map,this.history=[],this.maxHistorySize=50}get(t){if(t.includes(".")){const s=t.split(".");let e=this.state;for(const r of s){if(e==null)return;e=e[r]}return e}return this.state[t]}set(t,s,e=!1){const r=this.get(t);if(t.includes(".")){const i=t.split("."),n=i.pop();let l=this.state;for(const o of i)(!l[o]||typeof l[o]!="object")&&(l[o]={}),l=l[o];l[n]=s}else this.state[t]=s;this.addToHistory(t,s,r),e||this.notify(t,s,r)}update(t){Object.keys(t).forEach(s=>{this.set(s,t[s],!0)}),Object.keys(t).forEach(s=>{this.notify(s,t[s],this.get(s))})}subscribe(t,s){return this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(s),()=>{const e=this.listeners.get(t);if(e){const r=e.indexOf(s);r>-1&&e.splice(r,1)}}}notify(t,s,e){(this.listeners.get(t)||[]).forEach(i=>{try{i(s,e,t)}catch(n){console.error(`âŒ Erreur dans listener pour ${t}:`,n)}})}resetQuiz(){this.update({currentQuiz:null,currentQuestionIndex:0,userAnswers:[],startTime:null,timerInterval:null,questionStartTime:null,pausedDuration:0,isPaused:!1,currentModule:null,currentMonth:null,currentYear:null})}resetDashboard(){this.update({monthsData:[],currentMonthIndex:null,annualProgress:{}})}resetAdmin(){this.update({globalStats:null,topUsers:[],recentActivity:[],allUsers:[],questionsStats:null,usersStats:null})}reset(){this.resetQuiz(),this.resetDashboard(),this.resetAdmin(),this.set("error",null),this.set("isLoading",!1)}addToHistory(t,s,e){this.history.push({key:t,newValue:s,oldValue:e,timestamp:Date.now()}),this.history.length>this.maxHistorySize&&this.history.shift()}getHistory(t=null){return t?this.history.filter(s=>s.key===t):[...this.history]}getSnapshot(){return JSON.parse(JSON.stringify(this.state))}restoreSnapshot(t){this.state=JSON.parse(JSON.stringify(t)),Object.keys(t).forEach(s=>{this.notify(s,t[s],this.get(s))})}has(t){if(t.includes(".")){const s=t.split(".");let e=this.state;for(const r of s){if(e==null||!(r in e))return!1;e=e[r]}return!0}return t in this.state}delete(t){const s=this.get(t);if(t.includes(".")){const e=t.split("."),r=e.pop();let i=this.state;for(const n of e){if(!i[n]||typeof i[n]!="object")return;i=i[n]}delete i[r]}else delete this.state[t];this.addToHistory(t,void 0,s),this.notify(t,void 0,s)}}const h=new u;export{h as s};
//# sourceMappingURL=state-manager-w7-wWzCS.js.map
