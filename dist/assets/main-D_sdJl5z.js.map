{"version":3,"file":"main-D_sdJl5z.js","sources":["../../js/index-init.js","../../js/confetti.js","../../js/quiz.js","../../js/dashboard.js"],"sourcesContent":["// Initialisation de la page d'accueil (index.html)\r\nimport { signInWithGoogle, activateDemoMode } from './auth.js';\r\nimport { showErrorToast, showSuccessToast, showLoadingToast, updateLoadingToast } from './toast.js';\r\n\r\nconsole.log('Initialisation de la page d accueil...');\r\n\r\n// Attendre que le DOM soit charg√©\r\ndocument.addEventListener('DOMContentLoaded', initIndexPage);\r\n\r\nfunction initIndexPage() {\r\n    console.log('üìÑ DOM charg√© - configuration des boutons...');\r\n    \r\n    // Bouton Google Sign-In\r\n    const googleBtn = document.getElementById('google-signin-btn');\r\n    if (googleBtn) {\r\n        googleBtn.addEventListener('click', handleGoogleSignIn);\r\n        console.log('‚úÖ Bouton Google configur√©');\r\n    } else {\r\n        console.warn('‚ö†Ô∏è Bouton Google non trouv√©');\r\n    }\r\n    \r\n    // Bouton Mode D√©mo\r\n    const demoBtn = document.getElementById('demo-mode-btn');\r\n    if (demoBtn) {\r\n        demoBtn.addEventListener('click', handleDemoMode);\r\n        console.log('‚úÖ Bouton Mode D√©mo configur√©');\r\n    } else {\r\n        console.warn('‚ö†Ô∏è Bouton Mode D√©mo non trouv√©');\r\n    }\r\n}\r\n\r\n/**\r\n * Handler pour le bouton Google Sign-In\r\n */\r\nasync function handleGoogleSignIn() {\r\n    console.log('üîê Clic sur connexion Google...');\r\n    \r\n    const loadingToast = showLoadingToast('Connexion en cours...');\r\n    \r\n    try {\r\n        const user = await signInWithGoogle();\r\n        \r\n    // Succ√®s\r\n    updateLoadingToast(loadingToast, `Bienvenue ${user.displayName} !`, 'success');\r\n        \r\n        // Recharger la page pour que le dashboard d√©tecte l'utilisateur connect√©\r\n        setTimeout(() => {\r\n            window.location.reload();\r\n        }, 800);\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur connexion Google:', error);\r\n        \r\n        // Messages d'erreur personnalis√©s\r\n        let errorMessage = 'Erreur lors de la connexion';\r\n        \r\n        if (error.code === 'auth/popup-closed-by-user') {\r\n            errorMessage = 'Connexion annul√©e';\r\n        } else if (error.code === 'auth/popup-blocked') {\r\n            errorMessage = 'Pop-up bloqu√©e. Autorisez les pop-ups.';\r\n        } else if (error.code === 'auth/unauthorized-domain') {\r\n            errorMessage = 'Domaine non autoris√© dans Firebase';\r\n        } else if (error.code === 'auth/network-request-failed') {\r\n            errorMessage = 'Erreur r√©seau. V√©rifiez votre connexion.';\r\n        }\r\n        \r\n    updateLoadingToast(loadingToast, errorMessage, 'error');\r\n    }\r\n}\r\n\r\n/**\r\n * Handler pour le bouton Mode D√©mo\r\n */\r\nasync function handleDemoMode() {\r\n    console.log('üé≠ Clic sur Mode D√©mo...');\r\n    \r\n    const loadingToast = showLoadingToast('Activation du mode d√©mo...');\r\n    \r\n    try {\r\n        const demoUser = await activateDemoMode();\r\n        \r\n        console.log('‚úÖ Mode d√©mo activ√©:', demoUser);\r\n        \r\n    // Succ√®s\r\n    updateLoadingToast(loadingToast, 'Mode d√©mo activ√© ! Rechargement...', 'success');\r\n        \r\n        // Recharger la page pour que le dashboard d√©tecte le mode d√©mo\r\n        setTimeout(() => {\r\n            window.location.reload();\r\n        }, 500);\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur activation mode d√©mo:', error);\r\n        updateLoadingToast(loadingToast, 'error', 'Impossible d\\'activer le mode d√©mo');\r\n    }\r\n}\r\n\r\n// Export pour tests\r\nexport { handleGoogleSignIn, handleDemoMode };\r\n","// Simple confetti animation using canvas\r\nexport function launchConfetti() {\r\n    const canvas = document.createElement('canvas');\r\n    canvas.style.position = 'fixed';\r\n    canvas.style.top = '0';\r\n    canvas.style.left = '0';\r\n    canvas.style.width = '100%';\r\n    canvas.style.height = '100%';\r\n    canvas.style.pointerEvents = 'none';\r\n    canvas.style.zIndex = '9999';\r\n    document.body.appendChild(canvas);\r\n\r\n    const ctx = canvas.getContext('2d');\r\n    canvas.width = window.innerWidth;\r\n    canvas.height = window.innerHeight;\r\n\r\n    const particles = [];\r\n    const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2'];\r\n    \r\n    // Create particles\r\n    for (let i = 0; i < 150; i++) {\r\n        particles.push({\r\n            x: Math.random() * canvas.width,\r\n            y: canvas.height + Math.random() * 100,\r\n            size: Math.random() * 8 + 4,\r\n            speedY: -(Math.random() * 3 + 3),\r\n            speedX: Math.random() * 6 - 3,\r\n            color: colors[Math.floor(Math.random() * colors.length)],\r\n            rotation: Math.random() * 360,\r\n            rotationSpeed: Math.random() * 10 - 5,\r\n            gravity: 0.15,\r\n            opacity: 1\r\n        });\r\n    }\r\n\r\n    function animate() {\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        \r\n        let activeParticles = 0;\r\n        \r\n        particles.forEach((p, index) => {\r\n            p.speedY += p.gravity;\r\n            p.y += p.speedY;\r\n            p.x += p.speedX;\r\n            p.rotation += p.rotationSpeed;\r\n            \r\n            // Fade out near the bottom\r\n            if (p.y > canvas.height - 100) {\r\n                p.opacity -= 0.02;\r\n            }\r\n            \r\n            if (p.opacity > 0 && p.y < canvas.height + 50) {\r\n                activeParticles++;\r\n                \r\n                ctx.save();\r\n                ctx.translate(p.x, p.y);\r\n                ctx.rotate((p.rotation * Math.PI) / 180);\r\n                ctx.globalAlpha = p.opacity;\r\n                ctx.fillStyle = p.color;\r\n                \r\n                // Draw rectangle confetti\r\n                ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);\r\n                \r\n                ctx.restore();\r\n            }\r\n        });\r\n        \r\n        if (activeParticles > 0) {\r\n            requestAnimationFrame(animate);\r\n        } else {\r\n            canvas.remove();\r\n        }\r\n    }\r\n    \r\n    animate();\r\n}\r\n","// Module Quiz - Interface de questions style professionnel (VERSION 2.0 - Firestore)\r\nimport { db } from './firebase-config.js';\r\nimport { collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';\r\nimport { getCurrentUserUnified, isDemoMode } from './auth.js';\r\nimport { launchConfetti } from './confetti.js';\r\nimport { saveQuizResult } from './firestore-service.js';\r\nimport { toast, showLoadingToast, updateLoadingToast } from './toast.js';\r\n\r\n// Configuration des modules (m√©tadonn√©es uniquement - pas de questions hardcod√©es)\r\nconst moduleConfig = {\r\n    'auto': {\r\n        name: 'AT-AVE-AVEX',\r\n        color: 'indigo',\r\n        label: 'Auto'\r\n    },\r\n    'loisir': {\r\n        name: 'VTT, Motoneige, etc.',\r\n        color: 'cyan',\r\n        label: 'Loisir'\r\n    },\r\n    'vr': {\r\n        name: 'V√©hicules R√©cr√©atifs',\r\n        color: 'orange',\r\n        label: 'VR'\r\n    },\r\n    'tracteur': {\r\n        name: '√âquipement Agricole',\r\n        color: 'green',\r\n        label: 'Tracteur'\r\n    }\r\n};\r\n\r\n// √âtat du quiz\r\nlet currentQuiz = null;\r\nlet currentQuestionIndex = 0;\r\nlet userAnswers = [];\r\nlet startTime = null;\r\nlet timerInterval = null;\r\nlet questionStartTime = null;\r\nlet currentStreak = 0;\r\nlet isPaused = false;\r\nlet pausedTime = 0;\r\nlet currentModule = null;\r\nlet currentMonth = null;\r\nlet currentYear = null;\r\n\r\n// Couleurs par module\r\nconst moduleColors = {\r\n    'indigo': { bg: 'bg-indigo-600', text: 'text-indigo-600', border: 'border-indigo-600' },\r\n    'cyan': { bg: 'bg-cyan-600', text: 'text-cyan-600', border: 'border-cyan-600' },\r\n    'orange': { bg: 'bg-orange-600', text: 'text-orange-600', border: 'border-orange-600' },\r\n    'green': { bg: 'bg-green-600', text: 'text-green-600', border: 'border-green-600' }\r\n};\r\n\r\n// Charger les questions depuis Firestore, compatible mois num√©rique ou texte (r√©tro-compatibilit√©)\r\nasync function loadQuizFromFirestore(moduleId, monthNumber, year) {\r\n    console.log(`üì• Chargement des questions: module=${moduleId}, mois=${monthNumber}, ann√©e=${year}`);\r\n\r\n    const toQuestionObjects = (doc) => {\r\n        const data = doc.data();\r\n        return {\r\n            id: doc.id,\r\n            question: data.question,\r\n            options: data.options.map((opt, index) => ({\r\n                id: String.fromCharCode(65 + index), // A, B, C, D\r\n                text: opt,\r\n                correct: index === data.correctAnswer\r\n            })),\r\n            explanation: data.explanation || 'Pas d\\'explication disponible',\r\n            reference: data.reference || '',\r\n            tags: data.tags || []\r\n        };\r\n    };\r\n\r\n    // ‚úÖ MODE D√âMO : Utiliser les questions mock√©es de localStorage OU d√©fauts\r\n    if (isDemoMode()) {\r\n        console.log('üìù Mode d√©mo : Chargement des questions simul√©es pour le quiz...');\r\n        \r\n        // üíæ Charger depuis localStorage (synchronis√© avec admin)\r\n        const DEMO_STORAGE_KEY = 'avantage-quizz-demo-questions';\r\n        const saved = localStorage.getItem(DEMO_STORAGE_KEY);\r\n        \r\n        let demoQuestions = [];\r\n        \r\n        if (saved) {\r\n            try {\r\n                const parsed = JSON.parse(saved);\r\n                console.log(`üíæ ${parsed.length} questions charg√©es depuis localStorage`);\r\n                \r\n                // Convertir au format attendu par le quiz\r\n                demoQuestions = parsed.map(q => ({\r\n                    id: q.id,\r\n                    question: q.question,\r\n                    options: q.options.map((opt, index) => ({\r\n                        id: String.fromCharCode(65 + index), // A, B, C, D\r\n                        text: opt,\r\n                        correct: index === q.correctAnswer\r\n                    })),\r\n                    explanation: q.explanation || 'Pas d\\'explication disponible',\r\n                    reference: q.reference || '',\r\n                    tags: q.tags || []\r\n                }));\r\n                \r\n                // Filtrer par module et mois si n√©cessaire\r\n                demoQuestions = demoQuestions.filter(q => {\r\n                    const matchModule = !moduleId || parsed.find(p => p.id === q.id)?.module === moduleId;\r\n                    const matchMonth = !monthNumber || parsed.find(p => p.id === q.id)?.month === monthNumber;\r\n                    return matchModule && matchMonth;\r\n                });\r\n                \r\n            } catch (e) {\r\n                console.warn('‚ö†Ô∏è Erreur lecture localStorage, utilisation questions par d√©faut');\r\n            }\r\n        }\r\n        \r\n        // Si pas de questions en localStorage, utiliser les 5 par d√©faut\r\n        if (demoQuestions.length === 0) {\r\n            console.log('üì¶ Utilisation questions par d√©faut (aucune en localStorage)');\r\n            demoQuestions = [\r\n                {\r\n                    id: 'demo-1',\r\n                    question: 'Quelle est la vitesse maximale autoris√©e sur une autoroute au Qu√©bec ?',\r\n                    options: [\r\n                        { id: 'A', text: '100 km/h', correct: false },\r\n                        { id: 'B', text: '110 km/h', correct: false },\r\n                        { id: 'C', text: '120 km/h', correct: false },\r\n                        { id: 'D', text: '100 km/h (conditions normales)', correct: true }\r\n                    ],\r\n                    explanation: 'La vitesse maximale sur autoroute au Qu√©bec est de 100 km/h, sauf indication contraire.',\r\n                    reference: 'Code de la s√©curit√© routi√®re du Qu√©bec',\r\n                    tags: ['vitesse', 'autoroute']\r\n                },\r\n                {\r\n                    id: 'demo-2',\r\n                    question: '√Ä quelle distance minimale devez-vous vous arr√™ter derri√®re un autobus scolaire dont les feux clignotent ?',\r\n                    options: [\r\n                        { id: 'A', text: '3 m√®tres', correct: false },\r\n                        { id: 'B', text: '5 m√®tres', correct: true },\r\n                        { id: 'C', text: '10 m√®tres', correct: false },\r\n                        { id: 'D', text: '15 m√®tres', correct: false }\r\n                    ],\r\n                    explanation: 'Vous devez vous arr√™ter √† au moins 5 m√®tres d\\'un autobus scolaire.',\r\n                    reference: 'Article 460 CSR',\r\n                    tags: ['autobus', 's√©curit√©']\r\n                },\r\n                {\r\n                    id: 'demo-3',\r\n                    question: 'Quel est le taux d\\'alcool√©mie maximal pour conduire au Qu√©bec ?',\r\n                    options: [\r\n                        { id: 'A', text: '0.05', correct: false },\r\n                        { id: 'B', text: '0.08', correct: true },\r\n                        { id: 'C', text: '0.10', correct: false },\r\n                        { id: 'D', text: '0.00', correct: false }\r\n                    ],\r\n                    explanation: 'Le taux maximal est de 0.08 pour conducteurs exp√©riment√©s.',\r\n                    reference: 'Code criminel du Canada',\r\n                    tags: ['alcool', 's√©curit√©']\r\n                },\r\n                {\r\n                    id: 'demo-4',\r\n                    question: 'Combien de points d\\'inaptitude entra√Æne un exc√®s de vitesse de 30 km/h ?',\r\n                    options: [\r\n                        { id: 'A', text: '2 points', correct: false },\r\n                        { id: 'B', text: '3 points', correct: true },\r\n                        { id: 'C', text: '4 points', correct: false },\r\n                        { id: 'D', text: '5 points', correct: false }\r\n                    ],\r\n                    explanation: 'Un exc√®s de 21 √† 30 km/h entra√Æne 3 points.',\r\n                    reference: 'SAAQ',\r\n                    tags: ['vitesse', 'points']\r\n                },\r\n                {\r\n                    id: 'demo-5',\r\n                    question: 'Quelle est la distance de s√©curit√© recommand√©e entre v√©hicules ?',\r\n                    options: [\r\n                        { id: 'A', text: '1 seconde', correct: false },\r\n                        { id: 'B', text: '2 secondes', correct: true },\r\n                        { id: 'C', text: '3 secondes', correct: false },\r\n                        { id: 'D', text: '5 secondes', correct: false }\r\n                    ],\r\n                    explanation: 'La r√®gle des 2 secondes est recommand√©e.',\r\n                    reference: 'Guide SAAQ',\r\n                    tags: ['distance', 's√©curit√©']\r\n                }\r\n            ];\r\n        }\r\n        \r\n        console.log(`‚úÖ ${demoQuestions.length} questions d√©mo charg√©es pour le quiz`);\r\n        return demoQuestions;\r\n    }\r\n\r\n    try {\r\n        // 1) Essayer avec mois num√©rique (sch√©ma actuel de l'admin)\r\n        let q1 = query(\r\n            collection(db, 'questions'),\r\n            where('module', '==', moduleId),\r\n            where('month', '==', monthNumber),\r\n            where('year', '==', year)\r\n        );\r\n        let snap = await getDocs(q1);\r\n        if (!snap.empty) {\r\n            const res = [];\r\n            snap.forEach((d) => res.push(toQuestionObjects(d)));\r\n            console.log(`‚úÖ ${res.length} questions (mois num√©rique)`);\r\n            return res;\r\n        }\r\n\r\n        // 2) R√©tro-compatibilit√©: essayer avec mois texte (ex: \"Novembre\")\r\n        const monthNames = ['janvier', 'f√©vrier', 'mars', 'avril', 'mai', 'juin', 'juillet', 'ao√ªt', 'septembre', 'octobre', 'novembre', 'd√©cembre'];\r\n        const monthText = monthNames[monthNumber - 1];\r\n        const normalizedMonth = monthText.charAt(0).toUpperCase() + monthText.slice(1).toLowerCase();\r\n\r\n        let q2 = query(\r\n            collection(db, 'questions'),\r\n            where('module', '==', moduleId),\r\n            where('month', '==', normalizedMonth),\r\n            where('year', '==', year)\r\n        );\r\n        snap = await getDocs(q2);\r\n        if (!snap.empty) {\r\n            const res = [];\r\n            snap.forEach((d) => res.push(toQuestionObjects(d)));\r\n            console.log(`‚úÖ ${res.length} questions (mois texte)`);\r\n            return res;\r\n        }\r\n\r\n        console.warn('‚ö†Ô∏è Aucune question trouv√©e pour ces crit√®res (num√©rique/texte)');\r\n        return [];\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur lors du chargement des questions:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// Fallback Demo: charger depuis un JSON local lorsque le Mode D√©mo est actif\r\nasync function loadDemoQuestions(moduleId, monthNumber, year) {\r\n    try {\r\n        const resp = await fetch('/test-questions-valides.json');\r\n        if (!resp.ok) return [];\r\n        const data = await resp.json();\r\n        const monthNames = ['janvier', 'f√©vrier', 'mars', 'avril', 'mai', 'juin', 'juillet', 'ao√ªt', 'septembre', 'octobre', 'novembre', 'd√©cembre'];\r\n        const monthText = monthNames[monthNumber - 1];\r\n\r\n        const filtered = data.filter(q => q.module === moduleId && q.year === year && (q.month === monthText || q.month === monthNumber));\r\n        return filtered.map((q, idx) => ({\r\n            id: `demo-${moduleId}-${idx}`,\r\n            question: q.question,\r\n            options: q.options.map((opt, index) => ({\r\n                id: String.fromCharCode(65 + index),\r\n                text: opt,\r\n                correct: index === q.correctAnswer\r\n            })),\r\n            explanation: q.explanation || 'Pas d\\'explication disponible',\r\n            reference: q.reference || '',\r\n            tags: q.tags || []\r\n        }));\r\n    } catch (e) {\r\n        console.warn('Demo questions fallback error:', e);\r\n        return [];\r\n    }\r\n}\r\n\r\n// **FONCTION MODIFI√âE** : Initialiser le quiz avec chargement Firestore\r\nexport async function startQuiz(moduleId) {\r\n    const config = moduleConfig[moduleId];\r\n    if (!config) {\r\n        console.error('Module de quiz non trouv√©:', moduleId);\r\n        toast.error('Module non trouv√©. Veuillez r√©essayer.');\r\n        return;\r\n    }\r\n    \r\n    // Afficher un √©cran de chargement avec toast\r\n    const loadingToast = showLoadingToast(`Chargement du quiz ${config.label}...`);\r\n    showLoadingScreen(config.label);\r\n    \r\n    try {\r\n        // D√©terminer le mois (num√©rique) et l'ann√©e actuels\r\n        const now = new Date();\r\n        const monthNames = ['janvier', 'f√©vrier', 'mars', 'avril', 'mai', 'juin', 'juillet', 'ao√ªt', 'septembre', 'octobre', 'novembre', 'd√©cembre'];\r\n        const monthNumber = now.getMonth() + 1;\r\n        currentMonth = monthNames[monthNumber - 1];\r\n        currentYear = now.getFullYear();\r\n        currentModule = moduleId;\r\n        \r\n    // Indiquer qu'un quiz est en cours (utilis√© pour confirmations de navigation)\r\n    try { window.__QUIZ_ACTIVE = true; } catch (e) {}\r\n\r\n    // Charger les questions depuis Firestore (num√©rique/texte)\r\n        let questions = await loadQuizFromFirestore(moduleId, monthNumber, currentYear);\r\n\r\n        // En mode D√©mo, si aucune question en base, charger depuis JSON local\r\n        if (questions.length === 0 && isDemoMode()) {\r\n            console.log('‚ÑπÔ∏è Mode D√©mo: chargement des questions locales de test');\r\n            questions = await loadDemoQuestions(moduleId, monthNumber, currentYear);\r\n        }\r\n        \r\n        if (questions.length === 0) {\r\n            hideLoadingScreen();\r\n            updateLoadingToast(loadingToast, 'Aucune question disponible', 'error');\r\n            toast.error(`Aucune question trouv√©e pour ${config.label} en ${currentMonth} ${currentYear}.\\n\\nContactez l'administrateur.`, 5000);\r\n            return;\r\n        }\r\n        \r\n        // Cr√©er l'objet quiz\r\n        currentQuiz = {\r\n            name: `Quiz ${config.label} - ${currentMonth.charAt(0).toUpperCase() + currentMonth.slice(1)}`,\r\n            module: config.name,\r\n            color: config.color,\r\n            questions: questions\r\n        };\r\n        \r\n        // R√©initialiser l'√©tat\r\n        currentQuestionIndex = 0;\r\n        userAnswers = [];\r\n        startTime = Date.now();\r\n        questionStartTime = Date.now();\r\n        currentStreak = 0;\r\n        \r\n        // Cacher l'√©cran de chargement et d√©marrer\r\n        hideLoadingScreen();\r\n        showQuizView();\r\n        renderQuestion();\r\n        startTimer();\r\n        updateScoreDisplay();\r\n        \r\n        // Toast de succ√®s\r\n        updateLoadingToast(loadingToast, `${questions.length} questions charg√©es !`, 'success');\r\n        \r\n    } catch (error) {\r\n        hideLoadingScreen();\r\n        console.error('‚ùå Erreur lors du d√©marrage du quiz:', error);\r\n        updateLoadingToast(loadingToast, 'Erreur de chargement', 'error');\r\n        toast.error('Erreur lors du chargement du quiz. Veuillez r√©essayer.', 4000);\r\n    }\r\n}\r\n\r\n// √âcran de chargement\r\nfunction showLoadingScreen(moduleName) {\r\n    const quizView = getOrCreateQuizView();\r\n    quizView.innerHTML = `\r\n        <div class=\"min-h-screen flex items-center justify-center\">\r\n            <div class=\"text-center\">\r\n                <div class=\"animate-spin rounded-full h-16 w-16 border-b-4 border-indigo-600 mx-auto mb-6\"></div>\r\n                <h2 class=\"text-2xl font-bold text-slate-900 mb-2\">Chargement du quiz ${moduleName}</h2>\r\n                <p class=\"text-slate-600\">R√©cup√©ration des questions...</p>\r\n            </div>\r\n        </div>\r\n    `;\r\n    quizView.classList.remove('view-hidden');\r\n}\r\n\r\nfunction hideLoadingScreen() {\r\n    // L'√©cran sera remplac√© par le contenu du quiz\r\n}\r\n\r\n// Afficher la vue du quiz\r\nfunction showQuizView() {\r\n    document.getElementById('dashboard-view')?.classList.add('view-hidden');\r\n    document.getElementById('module-selection-view')?.classList.add('view-hidden');\r\n    document.getElementById('login-view')?.classList.add('view-hidden');\r\n    \r\n    const quizView = getOrCreateQuizView();\r\n    quizView.classList.remove('view-hidden');\r\n}\r\n\r\nfunction getOrCreateQuizView() {\r\n    let quizView = document.getElementById('quiz-view');\r\n    if (!quizView) {\r\n        quizView = document.createElement('div');\r\n        quizView.id = 'quiz-view';\r\n        document.querySelector('main').appendChild(quizView);\r\n    }\r\n    return quizView;\r\n}\r\n\r\n// Rendre la question actuelle\r\nfunction renderQuestion() {\r\n    const question = currentQuiz.questions[currentQuestionIndex];\r\n    const quizView = document.getElementById('quiz-view');\r\n    const colorScheme = moduleColors[currentQuiz.color];\r\n    \r\n    quizView.innerHTML = `\r\n        <!-- En-t√™te du quiz -->\r\n        <div class=\"bg-white border-b border-gray-200 shadow-sm\">\r\n            <div class=\"max-w-5xl mx-auto px-6 py-4\">\r\n                <div class=\"flex items-center justify-between\">\r\n                    <div>\r\n                        <h1 class=\"text-xl font-bold text-slate-900\">${currentQuiz.name}</h1>\r\n                        <p class=\"text-sm text-slate-500\">Question ${currentQuestionIndex + 1} sur ${currentQuiz.questions.length}</p>\r\n                    </div>\r\n                    <div class=\"flex items-center gap-6\">\r\n                        <button id=\"focus-mode-btn\" class=\"text-sm font-medium text-slate-600 hover:text-slate-900 flex items-center gap-1\">\r\n                            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"></path>\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"></path>\r\n                            </svg>\r\n                            Focus\r\n                        </button>\r\n                        <button id=\"pause-btn\" class=\"text-sm font-medium text-slate-600 hover:text-slate-900 flex items-center gap-1\">\r\n                            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                            </svg>\r\n                            Pause\r\n                        </button>\r\n                        <div class=\"flex items-center gap-2\">\r\n                            <svg class=\"w-5 h-5 text-indigo-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                            </svg>\r\n                            <span id=\"quiz-score\" class=\"text-sm font-bold text-indigo-600\">Score: 0%</span>\r\n                        </div>\r\n                        <div class=\"flex items-center gap-2\">\r\n                            <svg class=\"w-5 h-5 text-slate-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                            </svg>\r\n                            <span id=\"quiz-timer\" class=\"text-sm font-medium text-slate-600\">0:00</span>\r\n                        </div>\r\n                        <button id=\"quit-quiz-btn\" class=\"text-sm font-medium text-slate-600 hover:text-slate-900\">\r\n                            Quitter\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n                \r\n                <!-- Barre de progression -->\r\n                <div class=\"mt-4 w-full bg-gray-200 rounded-full h-2\">\r\n                    <div class=\"${colorScheme.bg} h-2 rounded-full transition-all duration-300\" style=\"width: ${((currentQuestionIndex + 1) / currentQuiz.questions.length) * 100}%\"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Contenu de la question -->\r\n        <div class=\"max-w-5xl mx-auto px-6 py-8\">\r\n            <div class=\"bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden\">\r\n                \r\n                <!-- En-t√™te de question -->\r\n                <div class=\"px-8 py-6 bg-gradient-to-r from-slate-50 to-white border-b border-gray-100\">\r\n                    <div class=\"mb-4\">\r\n                        <span class=\"text-sm font-medium ${colorScheme.text}\">Question ${currentQuestionIndex + 1} sur ${currentQuiz.questions.length}</span>\r\n                    </div>\r\n                    \r\n                    <h2 class=\"text-2xl font-bold text-slate-900 leading-relaxed\">\r\n                        ${question.question}\r\n                    </h2>\r\n                    \r\n                    <!-- Tags -->\r\n                    ${question.tags && question.tags.length > 0 ? `\r\n                        <div class=\"flex flex-wrap gap-2 mt-4\">\r\n                            ${question.tags.map(tag => `\r\n                                <span class=\"px-3 py-1 bg-slate-100 text-slate-600 text-xs font-medium rounded-full\">\r\n                                    ${tag}\r\n                                </span>\r\n                            `).join('')}\r\n                        </div>\r\n                    ` : ''}\r\n                </div>\r\n\r\n                <!-- Options de r√©ponse -->\r\n                <div class=\"p-8\">\r\n                    <div class=\"space-y-3\">\r\n                        ${question.options.map(option => `\r\n                            <button data-option-id=\"${option.id}\" \r\n                                    class=\"option-button w-full text-left px-6 py-5 rounded-xl border-2 border-gray-200 hover:border-${currentQuiz.color}-400 hover:bg-${currentQuiz.color}-50 transition-all duration-200 group\">\r\n                                <div class=\"flex items-center gap-4\">\r\n                                    <div class=\"flex-shrink-0 w-10 h-10 rounded-lg ${colorScheme.bg} bg-opacity-10 flex items-center justify-center group-hover:bg-opacity-20 transition-colors\">\r\n                                        <span class=\"text-lg font-bold ${colorScheme.text}\">${option.id}</span>\r\n                                    </div>\r\n                                    <span class=\"text-lg text-slate-700 group-hover:text-slate-900 font-medium\">\r\n                                        ${option.text}\r\n                                    </span>\r\n                                </div>\r\n                            </button>\r\n                        `).join('')}\r\n                    </div>\r\n                </div>\r\n\r\n                <!-- Zone d'explication (cach√©e initialement) -->\r\n                <div id=\"explanation-area\" class=\"hidden px-8 py-6 bg-slate-50 border-t border-gray-200\">\r\n                    <!-- Sera rempli apr√®s la r√©ponse -->\r\n                </div>\r\n\r\n                <!-- Bouton suivant (cach√© initialement) -->\r\n                <div id=\"next-button-area\" class=\"hidden px-8 py-6 border-t border-gray-200\">\r\n                    <div class=\"flex justify-between items-center\">\r\n                        <p class=\"text-sm text-slate-500\">Question suivante dans quelques secondes...</p>\r\n                        <button id=\"next-question-btn\" class=\"${colorScheme.bg} text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-all flex items-center gap-2\">\r\n                            Question suivante\r\n                            <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 7l5 5m0 0l-5 5m5-5H6\"></path>\r\n                            </svg>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n\r\n    // Attacher les √©v√©nements\r\n    attachQuestionEvents();\r\n    updateScoreDisplay();\r\n}\r\n\r\n// Attacher les √©v√©nements aux boutons\r\nfunction attachQuestionEvents() {\r\n    // Options de r√©ponse\r\n    document.querySelectorAll('.option-button').forEach(button => {\r\n        button.addEventListener('click', () => handleAnswer(button.dataset.optionId));\r\n    });\r\n    \r\n    // Bouton suivant\r\n    document.getElementById('next-question-btn')?.addEventListener('click', nextQuestion);\r\n    \r\n    // Bouton quitter\r\n    document.getElementById('quit-quiz-btn')?.addEventListener('click', () => {\r\n        if (confirm('Voulez-vous vraiment quitter le quiz ? Votre progression sera perdue.')) {\r\n            returnToDashboard();\r\n        }\r\n    });\r\n    \r\n    // Bouton focus\r\n    document.getElementById('focus-mode-btn')?.addEventListener('click', toggleFocusMode);\r\n    \r\n    // Bouton pause\r\n    document.getElementById('pause-btn')?.addEventListener('click', togglePause);\r\n}\r\n\r\n// G√©rer la r√©ponse de l'utilisateur\r\nfunction handleAnswer(optionId) {\r\n    const question = currentQuiz.questions[currentQuestionIndex];\r\n    const selectedOption = question.options.find(opt => opt.id === optionId);\r\n    const timeSpent = Math.floor((Date.now() - questionStartTime) / 1000);\r\n    \r\n    // Enregistrer la r√©ponse\r\n    userAnswers.push({\r\n        questionId: question.id,\r\n        question: question.question,\r\n        selectedAnswer: optionId,\r\n        correctAnswer: question.options.find(opt => opt.correct).id,\r\n        isCorrect: selectedOption.correct,\r\n        timeSpent: timeSpent\r\n    });\r\n    \r\n    // Mettre √† jour le streak\r\n    if (selectedOption.correct) {\r\n        currentStreak++;\r\n    } else {\r\n        currentStreak = 0;\r\n    }\r\n    \r\n    // D√©sactiver tous les boutons\r\n    document.querySelectorAll('.option-button').forEach(btn => {\r\n        btn.disabled = true;\r\n        btn.classList.remove('hover:border-indigo-400', 'hover:bg-indigo-50');\r\n    });\r\n    \r\n    // Afficher le r√©sultat\r\n    showAnswerFeedback(optionId, selectedOption.correct, question);\r\n    \r\n    // Mettre √† jour le score\r\n    updateScoreDisplay();\r\n    \r\n    // Passer √† la question suivante apr√®s un d√©lai\r\n    setTimeout(() => {\r\n        document.getElementById('next-button-area')?.classList.remove('hidden');\r\n    }, 1000);\r\n}\r\n\r\n// Afficher le feedback de la r√©ponse\r\nfunction showAnswerFeedback(selectedId, isCorrect, question) {\r\n    const colorScheme = moduleColors[currentQuiz.color];\r\n    const correctOption = question.options.find(opt => opt.correct);\r\n    \r\n    // Colorier les options\r\n    document.querySelectorAll('.option-button').forEach(btn => {\r\n        const optId = btn.dataset.optionId;\r\n        \r\n        if (optId === correctOption.id) {\r\n            // Bonne r√©ponse en vert\r\n            btn.classList.add('border-green-500', 'bg-green-50');\r\n            btn.classList.remove('border-gray-200');\r\n        } else if (optId === selectedId && !isCorrect) {\r\n            // Mauvaise r√©ponse en rouge\r\n            btn.classList.add('border-red-500', 'bg-red-50');\r\n            btn.classList.remove('border-gray-200');\r\n        }\r\n    });\r\n    \r\n    // Afficher l'explication\r\n    const explanationArea = document.getElementById('explanation-area');\r\n    if (explanationArea) {\r\n        explanationArea.innerHTML = `\r\n            <div class=\"flex items-start gap-4\">\r\n                ${isCorrect ? \r\n                    '<div class=\"flex-shrink-0 w-12 h-12 rounded-full bg-green-100 flex items-center justify-center\"><svg class=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path></svg></div>' :\r\n                    '<div class=\"flex-shrink-0 w-12 h-12 rounded-full bg-red-100 flex items-center justify-center\"><svg class=\"w-6 h-6 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path></svg></div>'\r\n                }\r\n                <div class=\"flex-1\">\r\n                    <h3 class=\"text-lg font-bold ${isCorrect ? 'text-green-700' : 'text-red-700'} mb-2\">\r\n                        ${isCorrect ? '‚úÖ Bonne r√©ponse !' : '‚ùå R√©ponse incorrecte'}\r\n                    </h3>\r\n                    <p class=\"text-slate-700 mb-2\"><strong>Explication :</strong> ${question.explanation}</p>\r\n                    ${question.reference ? `<p class=\"text-sm text-slate-500\"><strong>R√©f√©rence :</strong> ${question.reference}</p>` : ''}\r\n                </div>\r\n            </div>\r\n        `;\r\n        explanationArea.classList.remove('hidden');\r\n    }\r\n}\r\n\r\n// Passer √† la question suivante\r\nfunction nextQuestion() {\r\n    questionStartTime = Date.now();\r\n    currentQuestionIndex++;\r\n    \r\n    if (currentQuestionIndex < currentQuiz.questions.length) {\r\n        renderQuestion();\r\n    } else {\r\n        showResults();\r\n    }\r\n}\r\n\r\n// Afficher les r√©sultats finaux\r\nfunction showResults() {\r\n    stopTimer();\r\n    try { window.__QUIZ_ACTIVE = false; } catch (e) {}\r\n    \r\n    const score = Math.round((userAnswers.filter(a => a.isCorrect).length / userAnswers.length) * 100);\r\n    const totalTime = Math.floor((Date.now() - startTime) / 1000);\r\n    const minutes = Math.floor(totalTime / 60);\r\n    const seconds = totalTime % 60;\r\n    \r\n    // Sauvegarder dans Firestore\r\n    saveQuizToFirestore(score, totalTime);\r\n    \r\n    const colorScheme = moduleColors[currentQuiz.color];\r\n    const quizView = document.getElementById('quiz-view');\r\n    \r\n    quizView.innerHTML = `\r\n        <div class=\"min-h-screen bg-gradient-to-br from-slate-50 to-indigo-50 py-12 px-4\">\r\n            <div class=\"max-w-4xl mx-auto\">\r\n                <!-- Carte de r√©sultat principale -->\r\n                <div class=\"bg-white rounded-3xl shadow-2xl overflow-hidden mb-8\">\r\n                    <!-- Header avec score -->\r\n                    <div class=\"bg-gradient-to-r from-${currentQuiz.color}-500 to-${currentQuiz.color}-700 px-8 py-12 text-center text-white\">\r\n                        <h1 class=\"text-4xl font-bold mb-4\">Quiz Termin√© ! üéâ</h1>\r\n                        <div class=\"text-8xl font-bold mb-4\">${score}%</div>\r\n                        <p class=\"text-xl opacity-90\">${userAnswers.filter(a => a.isCorrect).length} / ${userAnswers.length} bonnes r√©ponses</p>\r\n                        <p class=\"text-lg opacity-75 mt-2\">Temps total : ${minutes}:${seconds.toString().padStart(2, '0')}</p>\r\n                    </div>\r\n                    \r\n                    <!-- Message de feedback -->\r\n                    <div class=\"px-8 py-8 text-center border-b border-gray-200\">\r\n                        ${score >= 90 ? \r\n                            '<h2 class=\"text-3xl font-bold text-green-600 mb-2\">üèÜ Excellent !</h2><p class=\"text-slate-600 text-lg\">Performance exceptionnelle ! Vous ma√Ætrisez parfaitement ce module.</p>' :\r\n                        score >= 75 ?\r\n                            '<h2 class=\"text-3xl font-bold text-blue-600 mb-2\">üëè Tr√®s bien !</h2><p class=\"text-slate-600 text-lg\">Bon travail ! Quelques r√©visions et vous serez au top.</p>' :\r\n                        score >= 60 ?\r\n                            '<h2 class=\"text-3xl font-bold text-yellow-600 mb-2\">üìö Pas mal !</h2><p class=\"text-slate-600 text-lg\">C\\'est un bon d√©but. Continuez √† r√©viser pour am√©liorer votre score.</p>' :\r\n                            '<h2 class=\"text-3xl font-bold text-red-600 mb-2\">üí™ Continuez !</h2><p class=\"text-slate-600 text-lg\">Ne vous d√©couragez pas. R√©visez les points faibles et r√©essayez !</p>'\r\n                        }\r\n                    </div>\r\n                    \r\n                    <!-- D√©tails des r√©ponses -->\r\n                    <div class=\"px-8 py-6\">\r\n                        <h3 class=\"text-xl font-bold text-slate-900 mb-4\">D√©tails de vos r√©ponses :</h3>\r\n                        <div class=\"space-y-3 max-h-96 overflow-y-auto\">\r\n                            ${userAnswers.map((answer, index) => `\r\n                                <div class=\"flex items-center justify-between p-4 rounded-lg ${answer.isCorrect ? 'bg-green-50' : 'bg-red-50'}\">\r\n                                    <div class=\"flex items-center gap-3 flex-1\">\r\n                                        <span class=\"${answer.isCorrect ? 'text-green-600' : 'text-red-600'} text-2xl\">\r\n                                            ${answer.isCorrect ? '‚úÖ' : '‚ùå'}\r\n                                        </span>\r\n                                        <div class=\"flex-1\">\r\n                                            <p class=\"font-medium text-slate-900\">Question ${index + 1}</p>\r\n                                            <p class=\"text-sm text-slate-600\">${answer.question}</p>\r\n                                            ${!answer.isCorrect ? `<p class=\"text-xs text-slate-500 mt-1\">Votre r√©ponse : ${answer.selectedAnswer} | Correcte : ${answer.correctAnswer}</p>` : ''}\r\n                                        </div>\r\n                                    </div>\r\n                                    <span class=\"text-sm text-slate-500\">${answer.timeSpent}s</span>\r\n                                </div>\r\n                            `).join('')}\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    <!-- Boutons d'action -->\r\n                    <div class=\"px-8 py-6 flex gap-4\">\r\n                        <button id=\"retry-quiz-btn\" class=\"flex-1 ${colorScheme.bg} text-white px-6 py-3 rounded-xl font-semibold hover:opacity-90 transition-all\">\r\n                            Refaire le quiz\r\n                        </button>\r\n                        <button id=\"return-dashboard-btn\" class=\"flex-1 border-2 border-gray-300 text-slate-700 px-6 py-3 rounded-xl font-semibold hover:bg-slate-50 transition-all\">\r\n                            Retour au tableau de bord\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n    \r\n    // Confettis si bon score\r\n    if (score >= 80) {\r\n        setTimeout(() => launchConfetti(), 500);\r\n    }\r\n    \r\n    // √âv√©nements\r\n    document.getElementById('retry-quiz-btn')?.addEventListener('click', () => {\r\n        startQuiz(currentModule);\r\n    });\r\n    \r\n    document.getElementById('return-dashboard-btn')?.addEventListener('click', returnToDashboard);\r\n}\r\n\r\n// Sauvegarder le r√©sultat dans Firestore\r\nasync function saveQuizToFirestore(score, totalTime) {\r\n    try {\r\n        const user = getCurrentUserUnified();\r\n        if (!user) {\r\n            console.log('Aucun utilisateur - r√©sultat non sauvegard√©');\r\n            return;\r\n        }\r\n        \r\n        // En mode d√©mo, ne pas sauvegarder dans Firestore\r\n        if (isDemoMode()) {\r\n            console.log('Mode d√©mo - r√©sultat non sauvegard√© dans Firestore');\r\n            toast.info('Mode D√©mo : les r√©sultats ne sont pas sauvegard√©s');\r\n            return;\r\n        }\r\n        \r\n        await saveQuizResult(user.uid, {\r\n            module: currentModule,\r\n            month: currentMonth,\r\n            year: currentYear,\r\n            score: score,\r\n            totalQuestions: currentQuiz.questions.length,\r\n            correctAnswers: userAnswers.filter(a => a.isCorrect).length,\r\n            timeSpent: totalTime,\r\n            answers: userAnswers,\r\n            completedAt: new Date()\r\n        });\r\n        \r\n        console.log('‚úÖ R√©sultat sauvegard√© dans Firestore');\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur lors de la sauvegarde:', error);\r\n    }\r\n}\r\n\r\n// Timer du quiz\r\nfunction startTimer() {\r\n    timerInterval = setInterval(() => {\r\n        if (!isPaused) {\r\n            const elapsed = Math.floor((Date.now() - startTime - pausedTime) / 1000);\r\n            const minutes = Math.floor(elapsed / 60);\r\n            const seconds = elapsed % 60;\r\n            const timerElement = document.getElementById('quiz-timer');\r\n            if (timerElement) {\r\n                timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;\r\n            }\r\n        }\r\n    }, 1000);\r\n}\r\n\r\nfunction stopTimer() {\r\n    if (timerInterval) {\r\n        clearInterval(timerInterval);\r\n        timerInterval = null;\r\n    }\r\n}\r\n\r\n// Mettre √† jour l'affichage du score\r\nfunction updateScoreDisplay() {\r\n    if (userAnswers.length === 0) return;\r\n    \r\n    const score = Math.round((userAnswers.filter(a => a.isCorrect).length / userAnswers.length) * 100);\r\n    const scoreElement = document.getElementById('quiz-score');\r\n    if (scoreElement) {\r\n        scoreElement.textContent = `Score: ${score}%`;\r\n    }\r\n}\r\n\r\n// Mode focus\r\nfunction toggleFocusMode() {\r\n    document.body.classList.toggle('focus-mode');\r\n}\r\n\r\n// Pause\r\nfunction togglePause() {\r\n    isPaused = !isPaused;\r\n    const pauseBtn = document.getElementById('pause-btn');\r\n    if (isPaused) {\r\n        pausedTime += Date.now();\r\n        pauseBtn.innerHTML = '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z\"></path><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg> Reprendre';\r\n        toast.warning('Quiz en pause. Cliquez sur \"Reprendre\" pour continuer.', 3000);\r\n    } else {\r\n        pausedTime = Date.now() - pausedTime;\r\n        pauseBtn.innerHTML = '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg> Pause';\r\n        toast.success('Quiz repris !', 2000);\r\n    }\r\n}\r\n\r\n// Retour au dashboard\r\nfunction returnToDashboard() {\r\n    stopTimer();\r\n    try { window.__QUIZ_ACTIVE = false; } catch (e) {}\r\n    document.getElementById('quiz-view')?.classList.add('view-hidden');\r\n    document.getElementById('dashboard-view')?.classList.remove('view-hidden');\r\n    \r\n    // Mettre √† jour la navigation\r\n    document.querySelectorAll('.nav-link').forEach(link => {\r\n        link.classList.remove('bg-indigo-800', 'text-indigo-100');\r\n        link.classList.add('text-indigo-300');\r\n    });\r\n    document.getElementById('nav-dashboard')?.classList.add('bg-indigo-800', 'text-indigo-100');\r\n    \r\n    // Toast de confirmation\r\n    toast.info('Retour au tableau de bord', 2000);\r\n    \r\n    // Recharger le dashboard pour mettre √† jour les stats\r\n    setTimeout(() => window.location.reload(), 500);\r\n}\r\n","// Dashboard principal - Gestion de l'interface QuizPro\r\nimport { onAuthChange, signInWithGoogle, signOutUser, getCurrentUserUnified, showAdminUIIfAdmin, isDemoMode, deactivateDemoMode } from './auth.js';\r\nimport { startQuiz } from './quiz.js';\r\nimport { \r\n    getUserProfile, \r\n    getAnnualProgress, \r\n    getUserQuizResults,\r\n    updateStreak\r\n} from './firestore-service.js';\r\n\r\n// --- CONSTANTES GLOBALES ---\r\nconst currentMonthIndex = 10; // 0 = Jan, 10 = Nov (Novembre 2025)\r\nconst MONTH_NAMES = [\r\n    'Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin',\r\n    'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'\r\n];\r\n\r\n// Donn√©es des mois (sera remplac√© par les donn√©es Firebase)\r\nlet monthsData = MONTH_NAMES.map(name => ({ name, score: null }));\r\n\r\n// --- √âL√âMENTS DOM ---\r\nconst views = {\r\n    login: document.getElementById('login-view'),\r\n    dashboard: document.getElementById('dashboard-view'),\r\n    moduleSelection: document.getElementById('module-selection-view')\r\n};\r\n\r\nconst elements = {\r\n    modulesGrid: document.getElementById('modules-grid'),\r\n    annualProgressBar: document.getElementById('annual-progress-bar'),\r\n    annualProgressText: document.getElementById('annual-progress-text'),\r\n    moduleSelectionTitle: document.getElementById('module-selection-title'),\r\n    welcomeMessage: document.getElementById('welcome-message'),\r\n    userAvatar: document.getElementById('user-avatar'),\r\n    userName: document.getElementById('user-name'),\r\n    googleSigninBtn: document.getElementById('google-signin-btn'),\r\n    signoutLink: document.getElementById('signout-link')\r\n};\r\n\r\n// --- FONCTIONS DE NAVIGATION ---\r\n\r\nfunction showView(viewId) {\r\n    Object.values(views).forEach(view => {\r\n        if (view) view.classList.add('view-hidden');\r\n    });\r\n    if (views[viewId]) {\r\n        views[viewId].classList.remove('view-hidden');\r\n    } else {\r\n        console.error('‚ùå Vue non trouv√©e:', viewId);\r\n    }\r\n}\r\n\r\nfunction updateActiveNavLink(navId) {\r\n    document.querySelectorAll('.nav-link').forEach(link => {\r\n        link.classList.remove('bg-indigo-800', 'text-indigo-100');\r\n        link.classList.add('text-indigo-300');\r\n    });\r\n    const activeLink = document.getElementById(navId);\r\n    if (activeLink) {\r\n        activeLink.classList.add('bg-indigo-800', 'text-indigo-100');\r\n        activeLink.classList.remove('text-indigo-300');\r\n    }\r\n}\r\n\r\n// --- FONCTIONS DE G√âN√âRATION DE CARTES ---\r\n\r\nfunction createProgressRing(percentage) {\r\n    const r = 54;\r\n    const c = r * 2 * Math.PI;\r\n    const offset = c - (percentage / 100) * c;\r\n\r\n    let progressColorClass = 'text-green-600';\r\n    if (percentage < 80) progressColorClass = 'text-yellow-500';\r\n    if (percentage < 60) progressColorClass = 'text-red-600';\r\n    \r\n    return `\r\n        <svg class=\"w-32 h-32\" viewBox=\"0 0 120 120\">\r\n            <circle class=\"text-gray-200\" stroke-width=\"12\" stroke=\"currentColor\" fill=\"transparent\" r=\"${r}\" cx=\"60\" cy=\"60\" />\r\n            <circle\r\n                class=\"progress-circle ${progressColorClass} transition-all duration-500\"\r\n                stroke-width=\"12\"\r\n                stroke-dasharray=\"${c}\"\r\n                stroke-dashoffset=\"${offset}\"\r\n                stroke-linecap=\"round\"\r\n                stroke=\"currentColor\"\r\n                fill=\"transparent\"\r\n                r=\"${r}\"\r\n                cx=\"60\"\r\n                cy=\"60\"\r\n                transform=\"rotate(-90 60 60)\"\r\n                style=\"stroke-dashoffset: 283;\"\r\n            />\r\n            <text x=\"50%\" y=\"50%\" text-anchor=\"middle\" dy=\".3em\" class=\"text-3xl font-bold fill-current text-slate-800\">\r\n                ${percentage}%\r\n            </text>\r\n        </svg>\r\n    `;\r\n}\r\n\r\nfunction createCompletedCard(month, score) {\r\n    // Intensit√© du d√©grad√© indigo bas√©e sur le score\r\n    const getScoreStyle = (score) => {\r\n        if (score >= 90) return { \r\n            bg: 'from-indigo-600 via-indigo-700 to-indigo-800', \r\n            badge: 'bg-emerald-500',\r\n            badgeText: 'Excellent'\r\n        };\r\n        if (score >= 75) return { \r\n            bg: 'from-indigo-500 via-indigo-600 to-indigo-700', \r\n            badge: 'bg-blue-500',\r\n            badgeText: 'Tr√®s bien'\r\n        };\r\n        if (score >= 60) return { \r\n            bg: 'from-indigo-400 via-indigo-500 to-indigo-600', \r\n            badge: 'bg-indigo-400',\r\n            badgeText: 'Bien'\r\n        };\r\n        return { \r\n            bg: 'from-slate-400 via-slate-500 to-slate-600', \r\n            badge: 'bg-slate-400',\r\n            badgeText: 'Passable'\r\n        };\r\n    };\r\n    \r\n    const style = getScoreStyle(score);\r\n    \r\n    return `\r\n        <div class=\"card-hover relative bg-gradient-to-br ${style.bg} p-6 rounded-2xl shadow-lg hover:shadow-xl border border-white/20 flex flex-col items-center cursor-pointer transform transition-all duration-300 hover:scale-[1.02] group\">\r\n            <div class=\"absolute top-3 right-3 ${style.badge} text-white text-xs font-semibold px-2.5 py-1 rounded-full shadow-md\">\r\n                ${style.badgeText}\r\n            </div>\r\n            <div class=\"absolute top-3 left-3 bg-white/90 backdrop-blur-sm p-1.5 rounded-full\">\r\n                <svg class=\"h-4 w-4 text-emerald-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                    <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\" />\r\n                </svg>\r\n            </div>\r\n            <h3 class=\"text-xl font-bold text-white mb-4 drop-shadow-md\">${month}</h3>\r\n            ${createProgressRing(score)}\r\n            <span class=\"mt-4 text-sm font-semibold text-white/95 bg-white/15 px-3 py-1.5 rounded-full backdrop-blur-sm\">Score: ${score}%</span>\r\n            <a href=\"#\" class=\"mt-3 text-sm font-medium text-white/90 hover:text-white underline decoration-2 underline-offset-2 opacity-0 group-hover:opacity-100 transition-opacity\">Voir d√©tails ‚Üí</a>\r\n        </div>\r\n    `;\r\n}\r\n\r\nfunction createLockedCard(month) {\r\n    return `\r\n        <div class=\"relative bg-gradient-to-br from-slate-50 via-slate-100 to-slate-200 p-6 rounded-2xl border border-slate-300 flex flex-col items-center justify-center min-h-[260px] shadow-sm overflow-hidden\">\r\n            <!-- Motif subtil -->\r\n            <div class=\"absolute inset-0 opacity-[0.03]\" style=\"background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,.1) 10px, rgba(0,0,0,.1) 20px);\"></div>\r\n            \r\n            <!-- Badge verrouill√© discret -->\r\n            <div class=\"absolute top-3 right-3 bg-red-500 text-white px-2 py-1 rounded-md text-xs font-semibold shadow-sm\">\r\n                üîí Verrouill√©\r\n            </div>\r\n            \r\n            <!-- Cadenas minimaliste -->\r\n            <div class=\"relative mb-4\">\r\n                <div class=\"relative bg-white p-3.5 rounded-xl shadow-md border-2 border-red-100\">\r\n                    <svg class=\"h-8 w-8 text-red-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\r\n                    </svg>\r\n                </div>\r\n            </div>\r\n            \r\n            <h3 class=\"text-xl font-bold text-slate-700 mb-2\">${month}</h3>\r\n            <div class=\"flex items-center gap-2 text-sm text-slate-500 bg-white px-3 py-1.5 rounded-lg\">\r\n                <svg class=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                </svg>\r\n                <span class=\"font-medium\">Disponible le 1er du mois</span>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\nfunction createIncompleteCard(month) {\r\n    return `\r\n        <div class=\"card-hover relative bg-gradient-to-br from-amber-50 to-orange-50 p-6 rounded-2xl shadow-sm hover:shadow-md border border-amber-200 flex flex-col items-center justify-center min-h-[260px] cursor-pointer transform transition-all duration-300 hover:scale-[1.02] group overflow-hidden\">\r\n            <!-- Badge √† compl√©ter -->\r\n            <div class=\"absolute top-3 right-3 bg-amber-500 text-white px-2 py-1 rounded-md text-xs font-semibold shadow-sm\">\r\n                √Ä compl√©ter\r\n            </div>\r\n            \r\n            <!-- Ic√¥ne horloge -->\r\n            <div class=\"relative mb-4\">\r\n                <div class=\"relative bg-white p-3.5 rounded-xl shadow-md border-2 border-amber-100\">\r\n                    <svg class=\"h-8 w-8 text-amber-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                    </svg>\r\n                </div>\r\n            </div>\r\n            \r\n            <h3 class=\"text-xl font-bold text-slate-700 mb-2\">${month}</h3>\r\n            <span class=\"text-sm text-amber-600 text-center font-medium mb-3\">Mois manqu√© - Rattrapez-le !</span>\r\n            \r\n            <!-- Barre de progression -->\r\n            <div class=\"mt-3 w-full bg-amber-100 rounded-full h-2.5 overflow-hidden\">\r\n                <div class=\"bg-gradient-to-r from-amber-400 to-amber-500 h-2.5 rounded-full\" style=\"width: 0%\"></div>\r\n            </div>\r\n            <span class=\"mt-2 text-xs text-amber-600 font-medium\">0% compl√©t√©</span>\r\n            \r\n            <!-- Bouton au hover -->\r\n            <button class=\"mt-4 opacity-0 group-hover:opacity-100 transition-all bg-amber-500 hover:bg-amber-600 text-white font-semibold px-4 py-2 rounded-lg shadow-sm hover:shadow-md transform hover:-translate-y-0.5\">\r\n                Compl√©ter maintenant\r\n            </button>\r\n        </div>\r\n    `;\r\n}\r\n\r\nfunction createActiveCard(month) {\r\n    return `\r\n        <div class=\"card-hover relative bg-gradient-to-br from-indigo-500 via-indigo-600 to-indigo-700 p-6 rounded-2xl shadow-xl hover:shadow-2xl border border-indigo-400/30 flex flex-col items-center justify-center min-h-[260px] ring-2 ring-indigo-400/20 cursor-pointer transform transition-all duration-300 hover:scale-[1.02] group overflow-hidden\">\r\n            <!-- Effet de brillance subtil -->\r\n            <div class=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000\"></div>\r\n            \r\n            <!-- Badge ACTIF -->\r\n            <span class=\"absolute top-3 right-3 bg-emerald-500 text-white text-xs font-semibold px-3 py-1.5 rounded-md shadow-md\">\r\n                ‚ö° Actif\r\n            </span>\r\n            \r\n            <!-- Ic√¥ne stylo -->\r\n            <div class=\"relative mb-4\">\r\n                <div class=\"relative bg-white/15 backdrop-blur-sm p-4 rounded-xl shadow-lg border border-white/20\">\r\n                    <svg class=\"h-10 w-10 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n                    </svg>\r\n                </div>\r\n            </div>\r\n            \r\n            <h3 class=\"text-2xl font-bold text-white mb-2 drop-shadow-md\">${month}</h3>\r\n            <p class=\"text-white/90 text-sm font-medium mb-4 bg-white/10 px-3 py-1 rounded-lg backdrop-blur-sm\">üéØ Pr√™t √† √™tre compl√©t√©</p>\r\n            \r\n            <!-- Bouton CTA -->\r\n            <button class=\"start-quiz-button w-full bg-white text-indigo-600 font-semibold px-6 py-3 rounded-lg shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5 group/btn\">\r\n                <span class=\"flex items-center justify-center gap-2\">\r\n                    D√©marrer le quiz\r\n                    <svg class=\"h-5 w-5 transform group-hover/btn:translate-x-1 transition-transform\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 7l5 5m0 0l-5 5m5-5H6\" />\r\n                    </svg>\r\n                </span>\r\n            </button>\r\n        </div>\r\n    `;\r\n}\r\n\r\n// --- INITIALISATION DU DASHBOARD ---\r\n\r\nfunction calculateStreak() {\r\n    let streak = 0;\r\n    for (let i = currentMonthIndex - 1; i >= 0; i--) {\r\n        if (monthsData[i].score !== null && monthsData[i].score >= 60) {\r\n            streak++;\r\n        } else {\r\n            break;\r\n        }\r\n    }\r\n    return streak;\r\n}\r\n\r\n// Charger les donn√©es Firebase pour le dashboard\r\nasync function loadDashboardData() {\r\n    try {\r\n        const user = getCurrentUserUnified();\r\n        if (!user) {\r\n            console.log('‚ÑπÔ∏è Aucun utilisateur - pas de donn√©es √† charger');\r\n            return;\r\n        }\r\n        \r\n        // En mode d√©mo, ne pas charger depuis Firestore\r\n        if (isDemoMode()) {\r\n            console.log('‚ÑπÔ∏è Mode d√©mo - affichage des donn√©es simul√©es');\r\n            return;\r\n        }\r\n        \r\n        console.log('üìä Chargement des donn√©es du dashboard...');\r\n        \r\n        // Charger le profil utilisateur\r\n        const userProfile = await getUserProfile(user.uid);\r\n        \r\n        // Afficher l'interface admin si l'utilisateur est admin\r\n        if (userProfile) {\r\n            await showAdminUIIfAdmin(userProfile);\r\n        }\r\n        \r\n        // Charger la progression annuelle\r\n        const progress = await getAnnualProgress(user.uid);\r\n        \r\n        // Mettre √† jour monthsData avec les vraies donn√©es\r\n        monthsData = monthsData.map((month, index) => {\r\n            const monthKey = `${month.name} ${new Date().getFullYear()}`;\r\n            if (progress[monthKey]) {\r\n                return {\r\n                    name: month.name,\r\n                    score: progress[monthKey].score\r\n                };\r\n            }\r\n            return month;\r\n        });\r\n        \r\n        // Mettre √† jour le streak\r\n        const streak = await updateStreak(user.uid);\r\n        const streakCountElement = document.getElementById('streak-count');\r\n        if (streakCountElement) {\r\n            streakCountElement.textContent = streak;\r\n        }\r\n        \r\n        console.log('‚úÖ Donn√©es du dashboard charg√©es');\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur chargement donn√©es:', error);\r\n    }\r\n}\r\n\r\nasync function initializeDashboard() {\r\n    if (!elements.modulesGrid) {\r\n        console.error(\"‚ùå L'√©l√©ment 'modules-grid' est introuvable.\");\r\n        return;\r\n    }\r\n    \r\n    // Charger les donn√©es Firebase en premier\r\n    await loadDashboardData();\r\n    \r\n    elements.modulesGrid.innerHTML = '';\r\n    let completedCount = 0;\r\n\r\n    monthsData.forEach((month, index) => {\r\n        let cardHtml = '';\r\n        if (index < currentMonthIndex) {\r\n            // Mois pass√©s : v√©rifier s'ils sont compl√©t√©s ou non\r\n            if (month.score !== null) {\r\n                cardHtml = createCompletedCard(month.name, month.score);\r\n                completedCount++;\r\n            } else {\r\n                // Mois pass√© mais non compl√©t√© - afficher comme \"√† compl√©ter\"\r\n                cardHtml = createIncompleteCard(month.name);\r\n            }\r\n        } else if (index === currentMonthIndex) {\r\n            cardHtml = createActiveCard(month.name);\r\n        } else {\r\n            cardHtml = createLockedCard(month.name);\r\n        }\r\n        elements.modulesGrid.innerHTML += cardHtml;\r\n    });\r\n\r\n    // Mettre √† jour la barre de progression annuelle\r\n    const annualProgressPercent = (completedCount / 12) * 100;\r\n    elements.annualProgressBar.style.width = `${annualProgressPercent}%`;\r\n    elements.annualProgressText.textContent = `${completedCount}/12`;\r\n\r\n    // Mettre √† jour le badge de s√©rie\r\n    const streak = calculateStreak();\r\n    const streakCountElement = document.getElementById('streak-count');\r\n    if (streakCountElement) {\r\n        streakCountElement.textContent = streak;\r\n    }\r\n    const streakBadge = document.getElementById('streak-badge');\r\n    if (streakBadge && streak === 0) {\r\n        streakBadge.style.display = 'none';\r\n    }\r\n\r\n    // Attacher les √©v√©nements\r\n    attachDashboardEvents();\r\n    \r\n    // Cr√©er les graphiques\r\n    setTimeout(() => {\r\n        createSkillsRadarChart();\r\n        createScoresTrendChart();\r\n        createActivityHeatmap();\r\n    }, 500);\r\n}\r\n\r\n// Cr√©er le graphique radar des comp√©tences\r\nfunction createSkillsRadarChart() {\r\n    const ctx = document.getElementById('skills-radar-chart');\r\n    if (!ctx) return;\r\n    \r\n    new Chart(ctx, {\r\n        type: 'radar',\r\n        data: {\r\n            labels: ['Proc√©dures', 'Garanties', 'Documentation', 'Inspection', 'Entretien', 'R√©glementation'],\r\n            datasets: [{\r\n                label: 'Vos Comp√©tences',\r\n                data: [92, 88, 85, 90, 87, 94],\r\n                backgroundColor: 'rgba(99, 102, 241, 0.2)',\r\n                borderColor: 'rgb(99, 102, 241)',\r\n                borderWidth: 2,\r\n                pointBackgroundColor: 'rgb(99, 102, 241)',\r\n                pointBorderColor: '#fff',\r\n                pointHoverBackgroundColor: '#fff',\r\n                pointHoverBorderColor: 'rgb(99, 102, 241)'\r\n            }]\r\n        },\r\n        options: {\r\n            responsive: true,\r\n            maintainAspectRatio: true,\r\n            scales: {\r\n                r: {\r\n                    beginAtZero: true,\r\n                    max: 100,\r\n                    ticks: {\r\n                        stepSize: 20\r\n                    }\r\n                }\r\n            },\r\n            plugins: {\r\n                legend: {\r\n                    display: false\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// Cr√©er le graphique de tendance des scores\r\nfunction createScoresTrendChart() {\r\n    const ctx = document.getElementById('scores-trend-chart');\r\n    if (!ctx) return;\r\n    \r\n    const completedMonths = monthsData.filter((m, i) => i < currentMonthIndex);\r\n    \r\n    new Chart(ctx, {\r\n        type: 'line',\r\n        data: {\r\n            labels: completedMonths.map(m => m.name),\r\n            datasets: [{\r\n                label: 'Score (%)',\r\n                data: completedMonths.map(m => m.score),\r\n                backgroundColor: 'rgba(99, 102, 241, 0.1)',\r\n                borderColor: 'rgb(99, 102, 241)',\r\n                borderWidth: 3,\r\n                fill: true,\r\n                tension: 0.4,\r\n                pointRadius: 5,\r\n                pointHoverRadius: 7,\r\n                pointBackgroundColor: 'rgb(99, 102, 241)',\r\n                pointBorderColor: '#fff',\r\n                pointBorderWidth: 2\r\n            }]\r\n        },\r\n        options: {\r\n            responsive: true,\r\n            maintainAspectRatio: true,\r\n            scales: {\r\n                y: {\r\n                    beginAtZero: true,\r\n                    max: 100,\r\n                    ticks: {\r\n                        callback: function(value) {\r\n                            return value + '%';\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            plugins: {\r\n                legend: {\r\n                    display: false\r\n                },\r\n                tooltip: {\r\n                    callbacks: {\r\n                        label: function(context) {\r\n                            return 'Score: ' + context.parsed.y + '%';\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// Cr√©er la heatmap d'activit√© (style GitHub)\r\nfunction createActivityHeatmap() {\r\n    const container = document.getElementById('activity-heatmap');\r\n    if (!container) return;\r\n    \r\n    const weeksInYear = 52;\r\n    const daysInWeek = 7;\r\n    \r\n    let heatmapHTML = '<div class=\"flex gap-1\">';\r\n    \r\n    for (let week = 0; week < weeksInYear; week++) {\r\n        heatmapHTML += '<div class=\"flex flex-col gap-1\">';\r\n        for (let day = 0; day < daysInWeek; day++) {\r\n            const dayIndex = week * daysInWeek + day;\r\n            let intensity = 0;\r\n            \r\n            // Simuler des donn√©es d'activit√©\r\n            if (dayIndex % 30 < 28) {\r\n                intensity = Math.floor(Math.random() * 4) + 1;\r\n            }\r\n            \r\n            const colors = [\r\n                'bg-slate-100',\r\n                'bg-green-200',\r\n                'bg-green-400',\r\n                'bg-green-600',\r\n                'bg-green-800'\r\n            ];\r\n            \r\n            heatmapHTML += `<div class=\"w-3 h-3 rounded-sm ${colors[intensity]}\" title=\"Activit√©\"></div>`;\r\n        }\r\n        heatmapHTML += '</div>';\r\n    }\r\n    \r\n    heatmapHTML += '</div>';\r\n    container.innerHTML = heatmapHTML;\r\n}\r\n\r\n// Variable pour emp√™cher l'attachement multiple des listeners\r\nlet navigationListenersAttached = false;\r\n\r\nfunction attachNavigationListeners() {\r\n    // √âviter d'attacher les listeners plusieurs fois\r\n    if (navigationListenersAttached) {\r\n        return;\r\n    }\r\n    navigationListenersAttached = true;\r\n\r\n    console.log('üîß Attachement des listeners de navigation (une seule fois)...');\r\n\r\n    // Navigation - Dashboard\r\n    document.getElementById('nav-dashboard')?.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        showView('dashboard');\r\n        updateActiveNavLink('nav-dashboard');\r\n    });\r\n\r\n    // Navigation - Quiz (ouvre la s√©lection de modules)\r\n    document.getElementById('nav-quiz')?.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        const activeMonth = monthsData[currentMonthIndex].name;\r\n        elements.moduleSelectionTitle.textContent = `Quiz de ${activeMonth}`;\r\n        showView('moduleSelection');\r\n        updateActiveNavLink('nav-quiz');\r\n    });\r\n\r\n    // Navigation - Mes R√©sultats (demander confirmation si un quiz est en cours)\r\n    document.getElementById('nav-results')?.addEventListener('click', (e) => {\r\n        e.preventDefault(); // TOUJOURS emp√™cher la navigation par d√©faut\r\n        const target = e.currentTarget;\r\n        if (window.__QUIZ_ACTIVE) {\r\n            const ok = confirm('Un quiz est en cours. Voulez-vous vraiment quitter ?');\r\n            if (ok && target && target.href) {\r\n                window.location.href = target.href;\r\n            }\r\n        } else {\r\n            // Navigation normale vers la page des r√©sultats\r\n            if (target && target.href) {\r\n                window.location.href = target.href;\r\n            }\r\n        }\r\n    });\r\n\r\n    // Navigation - Ressources (demander confirmation si un quiz est en cours)\r\n    document.getElementById('nav-resources')?.addEventListener('click', (e) => {\r\n        e.preventDefault(); // TOUJOURS emp√™cher la navigation par d√©faut\r\n        const target = e.currentTarget;\r\n        if (window.__QUIZ_ACTIVE) {\r\n            const ok = confirm('Un quiz est en cours. Voulez-vous vraiment quitter ?');\r\n            if (ok && target && target.href) {\r\n                window.location.href = target.href;\r\n            }\r\n        } else {\r\n            // Navigation normale vers la page des ressources\r\n            if (target && target.href) {\r\n                window.location.href = target.href;\r\n            }\r\n        }\r\n    });\r\n    \r\n    console.log('‚úÖ Listeners de navigation attach√©s');\r\n}\r\n\r\nfunction attachDashboardEvents() {\r\n    // Supprimer tous les anciens listeners en clonant les √©l√©ments\r\n    // (alternative: utiliser des event listeners nomm√©s qu'on peut remove)\r\n    \r\n    // Boutons \"D√©marrer le quiz\" - D√©l√©gation d'√©v√©nements\r\n    const oldStartButtons = document.querySelectorAll('.start-quiz-button');\r\n    oldStartButtons.forEach(btn => {\r\n        const newBtn = btn.cloneNode(true);\r\n        btn.parentNode?.replaceChild(newBtn, btn);\r\n    });\r\n    \r\n    document.querySelectorAll('.start-quiz-button').forEach(button => {\r\n        button.addEventListener('click', (e) => {\r\n            e.preventDefault();\r\n            const activeMonth = monthsData[currentMonthIndex].name;\r\n            elements.moduleSelectionTitle.textContent = `Quiz de ${activeMonth}`;\r\n            showView('moduleSelection');\r\n            updateActiveNavLink('nav-quiz');\r\n        });\r\n    });\r\n\r\n    // Boutons \"Retour au dashboard\"\r\n    const oldBackButtons = document.querySelectorAll('.back-to-dashboard');\r\n    oldBackButtons.forEach(btn => {\r\n        const newBtn = btn.cloneNode(true);\r\n        btn.parentNode?.replaceChild(newBtn, btn);\r\n    });\r\n    \r\n    document.querySelectorAll('.back-to-dashboard').forEach(button => {\r\n        button.addEventListener('click', (e) => {\r\n            e.preventDefault();\r\n            showView('dashboard');\r\n            updateActiveNavLink('nav-dashboard');\r\n        });\r\n    });\r\n\r\n    // Cartes de s√©lection de module\r\n    const oldModuleCards = document.querySelectorAll('.module-card');\r\n    oldModuleCards.forEach(card => {\r\n        const newCard = card.cloneNode(true);\r\n        card.parentNode?.replaceChild(newCard, card);\r\n    });\r\n    \r\n    document.querySelectorAll('.module-card').forEach(card => {\r\n        card.addEventListener('click', (e) => {\r\n            e.preventDefault();\r\n            const module = card.getAttribute('data-module');\r\n            console.log('üéØ Module s√©lectionn√©:', module);\r\n            // Lancer l'interface du quiz\r\n            startQuiz(module);\r\n        });\r\n    });\r\n}\r\n\r\n// --- GESTION DE L'AUTHENTIFICATION ---\r\n\r\nfunction updateUserProfile(user) {\r\n    if (user) {\r\n        elements.userName.textContent = user.displayName || 'Utilisateur';\r\n        elements.userAvatar.src = user.photoURL || 'https://placehold.co/100x100/667eea/e0e7ff?text=' + (user.displayName?.[0] || 'U');\r\n        \r\n        // Message de bienvenue personnalis√©\r\n        const firstName = user.displayName?.split(' ')[0] || 'Utilisateur';\r\n        elements.welcomeMessage.textContent = `Bonjour ${firstName}, pr√™t √† relever votre d√©fi de ${monthsData[currentMonthIndex].name} ?`;\r\n    }\r\n}\r\n\r\n// --- INITIALISATION PRINCIPALE ---\r\n\r\n// Gestion du th√®me (dark/light mode)\r\nfunction initializeTheme() {\r\n    const savedTheme = localStorage.getItem('theme') || 'light';\r\n    document.documentElement.classList.toggle('dark', savedTheme === 'dark');\r\n    updateThemeButton(savedTheme);\r\n}\r\n\r\nfunction updateThemeButton(theme) {\r\n    const sunIcon = document.getElementById('theme-icon-sun');\r\n    const moonIcon = document.getElementById('theme-icon-moon');\r\n    const themeText = document.getElementById('theme-text');\r\n    \r\n    if (theme === 'dark') {\r\n        sunIcon?.classList.remove('hidden');\r\n        moonIcon?.classList.add('hidden');\r\n        if (themeText) themeText.textContent = 'Mode Clair';\r\n    } else {\r\n        sunIcon?.classList.add('hidden');\r\n        moonIcon?.classList.remove('hidden');\r\n        if (themeText) themeText.textContent = 'Mode Sombre';\r\n    }\r\n}\r\n\r\nfunction toggleTheme() {\r\n    const currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';\r\n    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\r\n    \r\n    document.documentElement.classList.toggle('dark');\r\n    localStorage.setItem('theme', newTheme);\r\n    updateThemeButton(newTheme);\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    console.log('üöÄ Initialisation de QuizPro...');\r\n\r\n    // Initialiser le th√®me\r\n    initializeTheme();\r\n    \r\n    // Attacher les listeners de navigation UNE SEULE FOIS\r\n    attachNavigationListeners();\r\n    \r\n    // Bouton toggle th√®me\r\n    document.getElementById('theme-toggle')?.addEventListener('click', toggleTheme);\r\n\r\n    // Gestion de la connexion Google\r\n    elements.googleSigninBtn?.addEventListener('click', signInWithGoogle);\r\n    \r\n    elements.signoutLink?.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        if (confirm('Voulez-vous vraiment vous d√©connecter ?')) {\r\n            // D√©sactiver le mode d√©mo si actif\r\n            if (isDemoMode()) {\r\n                deactivateDemoMode();\r\n                // Rester dans le SPA et afficher l'√©cran de connexion imm√©diatement\r\n                showView('login');\r\n                updateActiveNavLink('nav-dashboard');\r\n            } else {\r\n                signOutUser();\r\n            }\r\n        }\r\n    });\r\n\r\n    // V√©rifier si le mode d√©mo est actif\r\n    const demoModeActive = isDemoMode();\r\n    \r\n    if (demoModeActive) {\r\n        console.log('üé® MODE D√âMO ACTIF - Chargement du dashboard...');\r\n        const demoUser = getCurrentUserUnified();\r\n        if (demoUser) {\r\n            updateUserProfile(demoUser);\r\n            // Afficher l'UI admin en mode d√©mo (le user poss√®de role: 'admin')\r\n            try { showAdminUIIfAdmin(demoUser); } catch (e) { /* no-op */ }\r\n            showView('dashboard');\r\n            updateActiveNavLink('nav-dashboard');\r\n            initializeDashboard();\r\n        } else {\r\n            console.error('‚ùå Mode d√©mo actif mais pas d\\'utilisateur trouv√©');\r\n            showView('login');\r\n        }\r\n    } else {\r\n        // Mode normal - Afficher l'√©cran de connexion\r\n        showView('login');\r\n        \r\n        // √âcouter les changements d'authentification Firebase\r\n        onAuthChange((user) => {\r\n            if (user) {\r\n                console.log('‚úÖ Utilisateur connect√©:', user.displayName);\r\n                updateUserProfile(user);\r\n                showView('dashboard');\r\n                updateActiveNavLink('nav-dashboard');\r\n                initializeDashboard();\r\n            } else {\r\n                console.log('üë§ Aucun utilisateur connect√©');\r\n                showView('login');\r\n            }\r\n        });\r\n    }\r\n\r\n    console.log('‚úÖ QuizPro initialis√© avec succ√®s');\r\n});\r\n"],"names":["initIndexPage","googleBtn","handleGoogleSignIn","demoBtn","handleDemoMode","loadingToast","showLoadingToast","user","signInWithGoogle","updateLoadingToast","error","errorMessage","demoUser","activateDemoMode","launchConfetti","canvas","ctx","particles","colors","animate","activeParticles","p","index","moduleConfig","currentQuiz","currentQuestionIndex","userAnswers","startTime","timerInterval","questionStartTime","currentStreak","isPaused","pausedTime","currentModule","currentMonth","currentYear","moduleColors","loadQuizFromFirestore","moduleId","monthNumber","year","toQuestionObjects","doc","data","opt","isDemoMode","saved","demoQuestions","parsed","q","matchModule","matchMonth","q1","query","collection","db","where","snap","getDocs","res","d","monthText","normalizedMonth","q2","loadDemoQuestions","resp","idx","e","startQuiz","config","toast","showLoadingScreen","now","monthNames","questions","showQuizView","renderQuestion","startTimer","updateScoreDisplay","moduleName","quizView","getOrCreateQuizView","question","colorScheme","tag","option","attachQuestionEvents","button","handleAnswer","nextQuestion","returnToDashboard","toggleFocusMode","togglePause","optionId","selectedOption","timeSpent","btn","showAnswerFeedback","selectedId","isCorrect","correctOption","optId","explanationArea","showResults","stopTimer","score","a","totalTime","minutes","seconds","saveQuizToFirestore","answer","getCurrentUserUnified","saveQuizResult","elapsed","timerElement","scoreElement","pauseBtn","link","currentMonthIndex","MONTH_NAMES","monthsData","name","views","elements","showView","viewId","view","updateActiveNavLink","navId","activeLink","createProgressRing","percentage","c","offset","progressColorClass","createCompletedCard","month","style","createLockedCard","createIncompleteCard","createActiveCard","calculateStreak","streak","i","loadDashboardData","userProfile","getUserProfile","showAdminUIIfAdmin","progress","getAnnualProgress","monthKey","updateStreak","streakCountElement","initializeDashboard","completedCount","cardHtml","annualProgressPercent","streakBadge","attachDashboardEvents","createSkillsRadarChart","createScoresTrendChart","createActivityHeatmap","completedMonths","m","value","context","container","weeksInYear","daysInWeek","heatmapHTML","week","day","dayIndex","intensity","navigationListenersAttached","attachNavigationListeners","activeMonth","target","newBtn","card","newCard","module","updateUserProfile","firstName","initializeTheme","savedTheme","updateThemeButton","theme","sunIcon","moonIcon","themeText","toggleTheme","newTheme","deactivateDemoMode","signOutUser","onAuthChange"],"mappings":"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"}