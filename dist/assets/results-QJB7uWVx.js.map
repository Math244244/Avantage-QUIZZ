{"version":3,"file":"results-QJB7uWVx.js","sources":["../../js/results.js"],"sourcesContent":["// Page Mes R√©sultats - Gestion compl√®te des r√©sultats et statistiques\r\nimport { db } from './firebase-config.js';\r\nimport { collection, query, where, orderBy, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';\r\nimport { onAuthChange, signOutUser } from './auth.js';\r\nimport { getUserProfile } from './firestore-service.js';\r\nimport { toast } from './toast.js';\r\nimport { logger } from './logger.js';\r\n// ‚úÖ CORRECTION SECTION 4 : Protection XSS - Utiliser escapeHtml centralis√©\r\nimport { escapeHtml } from './security.js';\r\nimport {\r\n    createResultSkeleton,\r\n    createStatsSkeleton,\r\n    createChartSkeleton,\r\n    showSkeleton,\r\n    hideSkeleton\r\n} from './skeleton.js';\r\nimport { showEmptyState } from './empty-states.js';\r\n\r\n// √âtat\r\nlet allResults = [];\r\nlet filteredResults = [];\r\nlet currentPage = 1;\r\nconst resultsPerPage = 10;\r\nlet progressChart = null;\r\nlet moduleChart = null;\r\n\r\n// Configuration des modules\r\nconst moduleNames = {\r\n    'auto': 'AT-AVE-AVEX',\r\n    'loisir': 'VTT, Motoneige, etc.',\r\n    'vr': 'V√©hicules R√©cr√©atifs',\r\n    'tracteur': '√âquipement Agricole'\r\n};\r\n\r\nconst moduleColors = {\r\n    'auto': '#C41E3A',       // Rouge Avantage Plus\r\n    'loisir': '#D4AF37',     // Dor√© Avantage Plus\r\n    'vr': '#FF9F43',         // Orange p√™che\r\n    'tracteur': '#28A745'    // Vert succ√®s\r\n};\r\n\r\nconst MONTH_LABELS = ['Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'];\r\n\r\n// Initialisation\r\ndocument.addEventListener('DOMContentLoaded', async () => {\r\n    // V√©rifier l'authentification Firebase\r\n    onAuthChange(async (user) => {\r\n        if (!user) {\r\n            window.location.href = '/index.html';\r\n            return;\r\n        }\r\n        \r\n        updateUserInfo(user);\r\n        \r\n        // V√©rifier si l'utilisateur est admin\r\n        const userProfile = await getUserProfile(user.uid);\r\n        if (userProfile && userProfile.role === 'admin') {\r\n            document.getElementById('nav-admin-item')?.classList.remove('hidden');\r\n            document.getElementById('admin-badge-nav')?.classList.remove('hidden');\r\n        }\r\n        \r\n        await loadResults(user.uid);\r\n    });\r\n    \r\n    // √âv√©nements\r\n    document.getElementById('logout-btn')?.addEventListener('click', handleLogout);\r\n    document.getElementById('signout-link')?.addEventListener('click', handleLogout);\r\n    document.getElementById('filter-module')?.addEventListener('change', applyFilters);\r\n    document.getElementById('filter-period')?.addEventListener('change', applyFilters);\r\n    document.getElementById('filter-sort')?.addEventListener('change', applyFilters);\r\n    document.getElementById('reset-filters-btn')?.addEventListener('click', resetFilters);\r\n    document.getElementById('prev-page-btn')?.addEventListener('click', () => changePage(-1));\r\n    document.getElementById('next-page-btn')?.addEventListener('click', () => changePage(1));\r\n    document.getElementById('export-results-btn')?.addEventListener('click', exportToCSV);\r\n\r\n    const resultsList = document.getElementById('results-list');\r\n    if (resultsList && !resultsList.dataset.eventsBound) {\r\n        resultsList.addEventListener('click', handleResultsListClick);\r\n        resultsList.dataset.eventsBound = 'true';\r\n    }\r\n});\r\n\r\n// Mettre √† jour les infos utilisateur\r\nfunction updateUserInfo(user) {\r\n    // Anciens IDs (top nav - supprimer si pr√©sents)\r\n    if (document.getElementById('user-name')) {\r\n        document.getElementById('user-name').textContent = user.displayName || user.email;\r\n    }\r\n    if (document.getElementById('user-photo')) {\r\n        document.getElementById('user-photo').src = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || user.email)}`;\r\n    }\r\n    \r\n    // Nouveaux IDs (sidebar)\r\n    if (document.getElementById('user-display-name')) {\r\n        document.getElementById('user-display-name').textContent = user.displayName || user.email;\r\n    }\r\n    if (document.getElementById('user-avatar')) {\r\n        document.getElementById('user-avatar').src = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || user.email)}`;\r\n    }\r\n}\r\n\r\n// Charger les r√©sultats depuis Firestore\r\nasync function loadResults(userId) {\r\n    logger.info('üì• Chargement des r√©sultats pour:', userId);\r\n    \r\n    try {\r\n        // Afficher les skeletons pendant le chargement\r\n        const statsContainer = document.getElementById('global-stats');\r\n        const resultsListContainer = document.getElementById('results-list');\r\n        const progressChartContainer = document.getElementById('progress-chart-container');\r\n        \r\n        if (statsContainer) {\r\n            showSkeleton('global-stats', createStatsSkeleton(4));\r\n        }\r\n        if (resultsListContainer) {\r\n            showSkeleton('results-list', createResultSkeleton(5));\r\n        }\r\n        if (progressChartContainer) {\r\n            progressChartContainer.innerHTML = createChartSkeleton();\r\n        }\r\n        \r\n        // 1) Requ√™te principale sur le champ normalis√© 'completedAt'\r\n        let q = query(\r\n            collection(db, 'quizResults'),\r\n            where('userId', '==', userId),\r\n            orderBy('completedAt', 'desc')\r\n        );\r\n        \r\n        let querySnapshot = await getDocs(q);\r\n        \r\n        // 2) Fallback r√©tro-compatibilit√©: certains anciens documents n'ont que 'date'\r\n        if (querySnapshot.empty) {\r\n            q = query(\r\n                collection(db, 'quizResults'),\r\n                where('userId', '==', userId),\r\n                orderBy('date', 'desc')\r\n            );\r\n            querySnapshot = await getDocs(q);\r\n        }\r\n        \r\n        allResults = [];\r\n        querySnapshot.forEach((doc) => {\r\n            const data = doc.data();\r\n            let completedAt = null;\r\n            // Nouveau format (Timestamp Firestore)\r\n            if (data.completedAt && typeof data.completedAt.toDate === 'function') {\r\n                completedAt = data.completedAt.toDate();\r\n            } else if (data.date && typeof data.date.toDate === 'function') {\r\n                // Ancien champ 'date'\r\n                completedAt = data.date.toDate();\r\n            } else if (data.date && typeof data.date === 'string') {\r\n                // Si 'date' est une string (s√©curit√©)\r\n                const parsed = new Date(data.date);\r\n                if (!isNaN(parsed.getTime())) completedAt = parsed;\r\n            }\r\n\r\n            allResults.push({\r\n                id: doc.id,\r\n                ...data,\r\n                completedAt\r\n            });\r\n        });\r\n        \r\n        logger.info(`‚úÖ ${allResults.length} r√©sultats charg√©s`);\r\n        \r\n        if (allResults.length === 0) {\r\n            showNoResults();\r\n        } else {\r\n            filteredResults = [...allResults];\r\n            updateUI();\r\n        }\r\n        \r\n    } catch (error) {\r\n        logger.error('‚ùå Erreur lors du chargement des r√©sultats:', error);\r\n\r\n        if (error.code === 'permission-denied') {\r\n            toast.error('Permissions insuffisantes pour consulter vos r√©sultats. Contactez un administrateur.');\r\n        } else {\r\n            toast.error('Erreur lors du chargement des r√©sultats');\r\n        }\r\n        showNoResults();\r\n    }\r\n}\r\n\r\n// Restaurer la structure HTML si elle a √©t√© remplac√©e par un √©tat vide\r\nfunction restoreResultsContainerStructure() {\r\n    const container = document.getElementById('results-container');\r\n    if (!container) return;\r\n    \r\n    // V√©rifier si la structure existe d√©j√†\r\n    if (document.getElementById('results-list')) return;\r\n    \r\n    // Restaurer la structure HTML\r\n    container.innerHTML = `\r\n        <div id=\"results-list\" class=\"history-list-enhanced\">\r\n            <!-- Sera rempli dynamiquement avec classes result-card-enhanced -->\r\n        </div>\r\n        \r\n        <!-- Pagination ENHANCED -->\r\n        <div id=\"pagination\" class=\"pagination-enhanced\">\r\n            <button id=\"prev-page-btn\" class=\"px-4 py-2 border border-gray-300 rounded-lg text-slate-700 hover:bg-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed\">\r\n                Pr√©c√©dent\r\n            </button>\r\n            <span id=\"page-info\" class=\"text-sm text-slate-600\">Page 1 sur 1</span>\r\n            <button id=\"next-page-btn\" class=\"px-4 py-2 border border-gray-300 rounded-lg text-slate-700 hover:bg-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed\">\r\n                Suivant\r\n            </button>\r\n        </div>\r\n    `;\r\n    \r\n    // R√©attacher les event listeners de pagination (les anciens sont supprim√©s avec innerHTML)\r\n    const prevBtn = document.getElementById('prev-page-btn');\r\n    const nextBtn = document.getElementById('next-page-btn');\r\n    if (prevBtn && !prevBtn.dataset.eventsBound) {\r\n        prevBtn.addEventListener('click', () => changePage(-1));\r\n        prevBtn.dataset.eventsBound = 'true';\r\n    }\r\n    if (nextBtn && !nextBtn.dataset.eventsBound) {\r\n        nextBtn.addEventListener('click', () => changePage(1));\r\n        nextBtn.dataset.eventsBound = 'true';\r\n    }\r\n    \r\n    // R√©attacher l'event listener pour results-list\r\n    const resultsList = document.getElementById('results-list');\r\n    if (resultsList && !resultsList.dataset.eventsBound) {\r\n        resultsList.addEventListener('click', handleResultsListClick);\r\n        resultsList.dataset.eventsBound = 'true';\r\n    }\r\n}\r\n\r\n// Mettre √† jour l'interface compl√®te\r\nfunction updateUI() {\r\n    if (filteredResults.length === 0) {\r\n        showNoResults();\r\n        return;\r\n    }\r\n\r\n    document.getElementById('no-results')?.classList.add('hidden');\r\n    \r\n    // Restaurer la structure HTML si n√©cessaire\r\n    restoreResultsContainerStructure();\r\n    \r\n    updateGlobalStats();\r\n    updateCharts();\r\n    renderResults();\r\n    document.getElementById('results-loading')?.classList.add('hidden');\r\n    document.getElementById('results-container')?.classList.remove('hidden');\r\n}\r\n\r\n// Calculer et afficher les statistiques globales\r\nfunction updateGlobalStats() {\r\n    const statsContainer = document.getElementById('global-stats');\r\n    \r\n    const totalQuizzes = filteredResults.length;\r\n    const avgScore = totalQuizzes > 0 \r\n        ? Math.round(filteredResults.reduce((sum, r) => sum + r.score, 0) / totalQuizzes) \r\n        : 0;\r\n    const totalQuestions = filteredResults.reduce((sum, r) => sum + r.totalQuestions, 0);\r\n    const totalCorrect = filteredResults.reduce((sum, r) => sum + r.correctAnswers, 0);\r\n    const totalTime = filteredResults.reduce((sum, r) => sum + (r.timeSpent || 0), 0);\r\n    const avgTime = totalQuizzes > 0 \r\n        ? Math.round(totalTime / totalQuizzes) \r\n        : 0;\r\n    \r\n    // ‚úÖ CORRECTION SECTION 4 : Protection XSS - Les valeurs num√©riques sont safe, mais formatTime() peut retourner du texte\r\n    const safeAvgTime = escapeHtml(formatTime(avgTime));\r\n    \r\n    statsContainer.innerHTML = `\r\n        <div class=\"stat-card-enhanced animate-fade-in-up\" data-stat-type=\"completed\" style=\"animation-delay: 0.1s;\">\r\n            <div class=\"flex items-center gap-4\">\r\n                <div class=\"stat-icon\">\r\n                    <svg class=\"w-7 h-7\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                    </svg>\r\n                </div>\r\n                <div>\r\n                    <p class=\"text-sm text-slate-600 font-semibold mb-1\">Quiz compl√©t√©s</p>\r\n                    <p class=\"text-4xl font-extrabold text-ap-red-primary\">${totalQuizzes}</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \r\n        <div class=\"stat-card-enhanced animate-fade-in-up\" data-stat-type=\"average\" style=\"animation-delay: 0.2s;\">\r\n            <div class=\"flex items-center gap-4\">\r\n                <div class=\"stat-icon\">\r\n                    <svg class=\"w-7 h-7\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6\"></path>\r\n                    </svg>\r\n                </div>\r\n                <div>\r\n                    <p class=\"text-sm text-slate-600 font-semibold mb-1\">Score moyen</p>\r\n                    <p class=\"text-4xl font-extrabold text-ap-success\">${avgScore}%</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \r\n        <div class=\"stat-card-enhanced animate-fade-in-up\" data-stat-type=\"answered\" style=\"animation-delay: 0.3s;\">\r\n            <div class=\"flex items-center gap-4\">\r\n                <div class=\"stat-icon\">\r\n                    <svg class=\"w-7 h-7\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\"></path>\r\n                    </svg>\r\n                </div>\r\n                <div>\r\n                    <p class=\"text-sm text-slate-600 font-semibold mb-1\">Questions r√©pondues</p>\r\n                    <p class=\"text-4xl font-extrabold text-ap-gold-dark\">${totalCorrect}/${totalQuestions}</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \r\n        <div class=\"stat-card-enhanced animate-fade-in-up\" data-stat-type=\"time\" style=\"animation-delay: 0.4s;\">\r\n            <div class=\"flex items-center gap-4\">\r\n                <div class=\"stat-icon\">\r\n                    <svg class=\"w-7 h-7\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                    </svg>\r\n                </div>\r\n                <div>\r\n                    <p class=\"text-sm text-slate-600 font-semibold mb-1\">Temps moyen</p>\r\n                    <p class=\"text-4xl font-extrabold text-ap-warning-dark\">${safeAvgTime}</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n// Mettre √† jour les graphiques\r\nfunction updateCharts() {\r\n    updateProgressChart();\r\n    updateModuleChart();\r\n}\r\n\r\n// Graphique d'√©volution des scores\r\nfunction updateProgressChart() {\r\n    console.log('üéØ updateProgressChart() appel√©e');\r\n    \r\n    const ctx = document.getElementById('progress-chart');\r\n    console.log('üìä Canvas ctx:', ctx);\r\n    console.log('üìä Chart.js disponible?', typeof Chart !== 'undefined');\r\n    \r\n    if (!ctx) {\r\n        console.error('‚ùå Canvas #progress-chart introuvable!');\r\n        return;\r\n    }\r\n    \r\n    // Prendre les 10 derniers r√©sultats\r\n    const recentResults = [...filteredResults].reverse().slice(-10);\r\n    console.log('üìä recentResults:', recentResults);\r\n    \r\n    // Fallback si pas de donn√©es - VERSION AM√âLIOR√âE\r\n    if (recentResults.length === 0) {\r\n        console.warn('‚ö†Ô∏è Aucune donn√©e pour le graphique de progression');\r\n        console.log('üìä allResults.length:', allResults.length);\r\n        console.log('üìä filteredResults.length:', filteredResults.length);\r\n        \r\n        // Remplacer tout le conteneur parent par un message clair\r\n        const chartCard = ctx.closest('.bg-white');\r\n        if (chartCard) {\r\n            chartCard.innerHTML = `\r\n                <div class=\"p-8 flex flex-col items-center justify-center\" style=\"min-height: 350px;\">\r\n                    <div class=\"w-24 h-24 bg-ap-red-50 rounded-full flex items-center justify-center mb-6\">\r\n                        <svg class=\"w-12 h-12 text-ap-red-primary\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\"></path>\r\n                        </svg>\r\n                    </div>\r\n                    <h3 class=\"text-2xl font-bold text-slate-800 mb-3\">üìà √âvolution des scores</h3>\r\n                    <p class=\"text-xl font-semibold text-ap-red-primary mb-2\">Aucune donn√©e √† afficher</p>\r\n                    <p class=\"text-slate-600 text-center max-w-md mb-4\">\r\n                        ${allResults.length === 0 \r\n                            ? 'Compl√©tez votre premier quiz pour voir votre progression ici!' \r\n                            : 'Aucun r√©sultat ne correspond aux filtres s√©lectionn√©s. Essayez de r√©initialiser les filtres.'}\r\n                    </p>\r\n                    ${allResults.length === 0 \r\n                        ? `<a href=\"/\" class=\"mt-4 px-6 py-3 bg-ap-red-primary text-white rounded-lg hover:bg-ap-red-dark transition-all font-semibold shadow-md hover:shadow-lg transform hover:-translate-y-1\">\r\n                            Commencer un quiz\r\n                        </a>`\r\n                        : `<button onclick=\"document.getElementById('reset-filters-btn').click()\" class=\"mt-4 px-6 py-3 bg-ap-red-primary text-white rounded-lg hover:bg-ap-red-dark transition-all font-semibold shadow-md hover:shadow-lg transform hover:-translate-y-1\">\r\n                            R√©initialiser les filtres\r\n                        </button>`}\r\n                </div>\r\n            `;\r\n        }\r\n        return;\r\n    }\r\n    \r\n    const labels = recentResults.map((r, i) => {\r\n        const date = r.completedAt;\r\n        return date ? `${date.getDate()}/${date.getMonth() + 1}` : `Quiz ${i + 1}`;\r\n    });\r\n    \r\n    const scores = recentResults.map(r => r.score);\r\n    console.log('üìä labels:', labels);\r\n    console.log('üìä scores:', scores);\r\n    \r\n    if (progressChart) {\r\n        progressChart.destroy();\r\n    }\r\n    \r\n    progressChart = new Chart(ctx, {\r\n        type: 'line',\r\n        data: {\r\n            labels: labels,\r\n            datasets: [{\r\n                label: 'Score (%)',\r\n                data: scores,\r\n                borderColor: '#C41E3A',               // Rouge Avantage Plus\r\n                backgroundColor: 'rgba(196, 30, 58, 0.1)',  // Rouge AP transparent\r\n                tension: 0.4,\r\n                fill: true,\r\n                pointRadius: 5,\r\n                pointHoverRadius: 7,\r\n                pointBackgroundColor: '#C41E3A',\r\n                pointBorderColor: '#fff',\r\n                pointBorderWidth: 2\r\n            }]\r\n        },\r\n        options: {\r\n            responsive: true,\r\n            maintainAspectRatio: true, // ‚úÖ CORRECTION: √âviter les colonnes infinies\r\n            aspectRatio: 1.5, // Ratio largeur/hauteur fixe\r\n            plugins: {\r\n                legend: {\r\n                    display: false\r\n                }\r\n            },\r\n            scales: {\r\n                y: {\r\n                    beginAtZero: true,\r\n                    max: 100,\r\n                    ticks: {\r\n                        callback: (value) => value + '%'\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n    \r\n    console.log('‚úÖ Chart progression cr√©√©:', progressChart);\r\n}\r\n\r\n// Graphique de r√©partition par module\r\nfunction updateModuleChart() {\r\n    console.log('üéØ updateModuleChart() appel√©e');\r\n    \r\n    const ctx = document.getElementById('module-chart');\r\n    console.log('üìä Canvas module ctx:', ctx);\r\n    \r\n    if (!ctx) {\r\n        console.error('‚ùå Canvas #module-chart introuvable!');\r\n        return;\r\n    }\r\n    \r\n    // Compter les quiz par module\r\n    const moduleCounts = {};\r\n    filteredResults.forEach(r => {\r\n        // ‚úÖ CORRECTION: Utiliser moduleId (champ Firestore) au lieu de module\r\n        const moduleId = r.moduleId || r.module || 'auto'; // Fallback pour r√©tro-compatibilit√©\r\n        moduleCounts[moduleId] = (moduleCounts[moduleId] || 0) + 1;\r\n    });\r\n    \r\n    console.log('üìä moduleCounts:', moduleCounts);\r\n    \r\n    // Fallback am√©lior√© si pas de donn√©es\r\n    if (Object.keys(moduleCounts).length === 0) {\r\n        console.warn('‚ö†Ô∏è Aucune donn√©e pour le graphique de modules');\r\n        console.log('üìä allResults.length:', allResults.length);\r\n        console.log('üìä filteredResults.length:', filteredResults.length);\r\n        \r\n        const chartCard = ctx.closest('.bg-white');\r\n        if (chartCard) {\r\n            chartCard.innerHTML = `\r\n                <div class=\"p-8 flex flex-col items-center justify-center\" style=\"min-height: 350px;\">\r\n                    <div class=\"w-24 h-24 bg-ap-gold-light rounded-full flex items-center justify-center mb-6\">\r\n                        <svg class=\"w-12 h-12 text-ap-gold-dark\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z\"></path>\r\n                        </svg>\r\n                    </div>\r\n                    <h3 class=\"text-2xl font-bold text-slate-800 mb-3\">üìä R√©partition par module</h3>\r\n                    <p class=\"text-xl font-semibold text-ap-gold-dark mb-2\">Aucune donn√©e √† afficher</p>\r\n                    <p class=\"text-slate-600 text-center max-w-md mb-4\">\r\n                        ${allResults.length === 0 \r\n                            ? 'Compl√©tez des quiz dans diff√©rents modules pour voir la r√©partition!' \r\n                            : 'Aucun r√©sultat ne correspond aux filtres. Essayez de modifier vos crit√®res.'}\r\n                    </p>\r\n                    ${allResults.length === 0 \r\n                        ? `<a href=\"/\" class=\"mt-4 px-6 py-3 bg-ap-gradient-gold text-ap-red-dark rounded-lg hover:shadow-lg transition-all font-bold shadow-md transform hover:-translate-y-1\">\r\n                            D√©couvrir les modules\r\n                        </a>`\r\n                        : `<button onclick=\"document.getElementById('reset-filters-btn').click()\" class=\"mt-4 px-6 py-3 bg-ap-gradient-gold text-ap-red-dark rounded-lg hover:shadow-lg transition-all font-bold shadow-md transform hover:-translate-y-1\">\r\n                            R√©initialiser les filtres\r\n                        </button>`}\r\n                </div>\r\n            `;\r\n        }\r\n        return;\r\n    }\r\n    \r\n    const labels = Object.keys(moduleCounts).map(m => moduleNames[m] || m);\r\n    const data = Object.values(moduleCounts);\r\n    const colors = Object.keys(moduleCounts).map(m => moduleColors[m] || '#C41E3A');\r\n    \r\n    console.log('üìä labels:', labels);\r\n    console.log('üìä data:', data);\r\n    console.log('üìä colors:', colors);\r\n    \r\n    if (moduleChart) {\r\n        moduleChart.destroy();\r\n    }\r\n    \r\n    moduleChart = new Chart(ctx, {\r\n        type: 'doughnut',\r\n        data: {\r\n            labels: labels,\r\n            datasets: [{\r\n                data: data,\r\n                backgroundColor: colors,\r\n                borderWidth: 2,\r\n                borderColor: '#ffffff'\r\n            }]\r\n        },\r\n        options: {\r\n            responsive: true,\r\n            maintainAspectRatio: true, // ‚úÖ CORRECTION: √âviter les colonnes infinies\r\n            aspectRatio: 1, // Ratio 1:1 pour graphique circulaire\r\n            plugins: {\r\n                legend: {\r\n                    position: 'bottom',\r\n                    labels: {\r\n                        padding: 15,\r\n                        font: {\r\n                            size: 12\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n    \r\n    console.log('‚úÖ Chart module cr√©√©:', moduleChart);\r\n}\r\n\r\n// Afficher les r√©sultats avec pagination\r\nfunction renderResults() {\r\n    console.log('üéØ renderResults() appel√©e');\r\n    \r\n    const container = document.getElementById('results-list');\r\n    console.log('üìã Container results-list:', container);\r\n    \r\n    if (!container) {\r\n        console.error('‚ùå Container #results-list introuvable!');\r\n        return;\r\n    }\r\n\r\n    const start = (currentPage - 1) * resultsPerPage;\r\n    const end = start + resultsPerPage;\r\n    const pageResults = filteredResults.slice(start, end);\r\n    \r\n    console.log('üìã Page:', currentPage, 'Start:', start, 'End:', end);\r\n    console.log('üìã pageResults:', pageResults);\r\n    \r\n    if (pageResults.length === 0) {\r\n        console.warn('‚ö†Ô∏è Aucun r√©sultat √† afficher pour cette page');\r\n        container.replaceChildren();\r\n        return;\r\n    }\r\n\r\n    const fragment = document.createDocumentFragment();\r\n    pageResults.forEach(result => {\r\n        fragment.appendChild(createResultCardElement(result));\r\n    });\r\n    \r\n    container.replaceChildren(fragment);\r\n    console.log('‚úÖ R√©sultats rendus:', pageResults.length, 'cartes affich√©es');\r\n    \r\n    updatePagination();\r\n}\r\n\r\nfunction createResultCardElement(result) {\r\n    const card = document.createElement('article');\r\n    card.className = 'result-card-enhanced';\r\n    card.dataset.resultId = result.id;\r\n\r\n    const date = result.completedAt instanceof Date ? result.completedAt : null;\r\n    const dateStr = date\r\n        ? `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()} √† ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`\r\n        : 'Date inconnue';\r\n\r\n    const scoreColor = result.score >= 80 ? 'text-green-600' : result.score >= 60 ? 'text-yellow-600' : 'text-red-600';\r\n    // ‚úÖ CORRECTION SECTION 4 : Protection XSS - √âchapper toutes les donn√©es utilisateur\r\n    // ‚úÖ CORRECTION: Utiliser moduleId au lieu de module\r\n    const moduleId = result.moduleId || result.module || 'auto';\r\n    const moduleLabel = escapeHtml(moduleNames[moduleId] || moduleId || 'Module');\r\n    const monthLabelRaw = result.month ? String(result.month).trim() : '';\r\n    const yearLabelRaw = result.year ? String(result.year).trim() : '';\r\n    const periodLabel = escapeHtml([monthLabelRaw, yearLabelRaw].filter(Boolean).join(' ').trim());\r\n    const scoreValue = Number.isFinite(result.score) ? result.score : 0;\r\n    const correctAnswersValue = Number.isFinite(result.correctAnswers) ? result.correctAnswers : 0;\r\n    const totalQuestionsValue = Number.isFinite(result.totalQuestions) ? result.totalQuestions : 0;\r\n    const scoreDisplay = escapeHtml(`${scoreValue}%`);\r\n    const answersDisplay = escapeHtml(`${correctAnswersValue}/${totalQuestionsValue}`);\r\n    const timeDisplay = escapeHtml(formatTime(result.timeSpent || 0));\r\n    const dateDisplay = escapeHtml(dateStr);\r\n\r\n    card.innerHTML = `\r\n        <div class=\"flex items-center justify-between\">\r\n            <div class=\"flex-1\">\r\n                <div class=\"flex items-center gap-3 mb-2\">\r\n                    <h3 class=\"text-lg font-bold text-slate-900\">${moduleLabel}</h3>\r\n                    <span class=\"px-3 py-1 text-xs font-medium bg-slate-100 text-slate-600 rounded-full\">\r\n                        ${periodLabel}\r\n                    </span>\r\n                </div>\r\n                <p class=\"text-sm text-slate-500\">${dateDisplay}</p>\r\n            </div>\r\n            <div class=\"flex items-center gap-6\">\r\n                <div class=\"text-center\">\r\n                    <p class=\"text-sm text-slate-500 mb-1\">Score</p>\r\n                    <p class=\"${scoreColor} text-3xl font-bold\">${scoreDisplay}</p>\r\n                </div>\r\n                <div class=\"text-center\">\r\n                    <p class=\"text-sm text-slate-500 mb-1\">R√©ponses</p>\r\n                    <p class=\"text-slate-700 font-semibold\">${answersDisplay}</p>\r\n                </div>\r\n                <div class=\"text-center\">\r\n                    <p class=\"text-sm text-slate-500 mb-1\">Temps</p>\r\n                    <p class=\"text-slate-700 font-semibold\">${timeDisplay}</p>\r\n                </div>\r\n                <button class=\"result-details-btn px-4 py-2 bg-ap-red-primary text-white rounded-lg hover:bg-ap-red-dark transition-all transform hover:-translate-y-0.5 font-medium shadow-sm hover:shadow-md\" data-result-id=\"${result.id}\" aria-label=\"Voir les d√©tails du quiz ${moduleLabel} - ${periodLabel}\">\r\n                    D√©tails\r\n                </button>\r\n            </div>\r\n        </div>\r\n    `;\r\n\r\n    return card;\r\n}\r\n\r\nfunction handleResultsListClick(event) {\r\n    const button = event.target.closest('.result-details-btn');\r\n    if (!button) {\r\n        return;\r\n    }\r\n\r\n    const { resultId } = button.dataset;\r\n    if (!resultId) {\r\n        return;\r\n    }\r\n\r\n    openResultDetails(resultId);\r\n}\r\n\r\n// Mettre √† jour la pagination\r\nfunction updatePagination() {\r\n    const totalPages = Math.ceil(filteredResults.length / resultsPerPage);\r\n    const pageInfo = document.getElementById('page-info');\r\n    if (pageInfo) {\r\n        pageInfo.textContent = `Page ${currentPage} sur ${totalPages || 1}`;\r\n    }\r\n\r\n    const prevBtn = document.getElementById('prev-page-btn');\r\n    const nextBtn = document.getElementById('next-page-btn');\r\n    if (prevBtn) {\r\n        prevBtn.disabled = currentPage === 1;\r\n    }\r\n    if (nextBtn) {\r\n        nextBtn.disabled = currentPage === totalPages || totalPages === 0;\r\n    }\r\n}\r\n\r\n// Changer de page\r\nfunction changePage(direction) {\r\n    currentPage += direction;\r\n    renderResults();\r\n    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n}\r\n\r\n// Appliquer les filtres\r\nfunction applyFilters() {\r\n    const moduleFilter = document.getElementById('filter-module').value;\r\n    const periodFilter = document.getElementById('filter-period').value;\r\n    const sortFilter = document.getElementById('filter-sort').value;\r\n    \r\n    // Filtrer par module\r\n    filteredResults = moduleFilter \r\n        ? allResults.filter(r => r.module === moduleFilter)\r\n        : [...allResults];\r\n    \r\n    // Filtrer par p√©riode\r\n    if (periodFilter !== 'all') {\r\n        const now = new Date();\r\n        const filterDate = new Date();\r\n        \r\n        if (periodFilter === 'week') {\r\n            filterDate.setDate(now.getDate() - 7);\r\n        } else if (periodFilter === 'month') {\r\n            filterDate.setDate(now.getDate() - 30);\r\n        } else if (periodFilter === 'year') {\r\n            filterDate.setFullYear(now.getFullYear());\r\n            filterDate.setMonth(0);\r\n            filterDate.setDate(1);\r\n        }\r\n        \r\n        filteredResults = filteredResults.filter(r => r.completedAt >= filterDate);\r\n    }\r\n    \r\n    // Trier\r\n    filteredResults.sort((a, b) => {\r\n        if (sortFilter === 'date-desc') {\r\n            return b.completedAt - a.completedAt;\r\n        } else if (sortFilter === 'date-asc') {\r\n            return a.completedAt - b.completedAt;\r\n        } else if (sortFilter === 'score-desc') {\r\n            return b.score - a.score;\r\n        } else if (sortFilter === 'score-asc') {\r\n            return a.score - b.score;\r\n        }\r\n        return 0;\r\n    });\r\n    \r\n    currentPage = 1;\r\n    updateUI();\r\n}\r\n\r\n// R√©initialiser les filtres\r\nfunction resetFilters() {\r\n    document.getElementById('filter-module').value = '';\r\n    document.getElementById('filter-period').value = 'all';\r\n    document.getElementById('filter-sort').value = 'date-desc';\r\n    applyFilters();\r\n}\r\n\r\n// Exporter en CSV\r\nfunction exportToCSV() {\r\n    if (filteredResults.length === 0) {\r\n        toast.warning('Aucun r√©sultat √† exporter');\r\n        return;\r\n    }\r\n    \r\n    const loadingToast = toast.showLoadingToast('G√©n√©ration du fichier CSV...');\r\n    \r\n    try {\r\n        const headers = ['Date', 'Module', 'Mois', 'Ann√©e', 'Score (%)', 'Bonnes r√©ponses', 'Total questions', 'Temps (s)'];\r\n        const rows = filteredResults.map(r => {\r\n            const date = r.completedAt ? r.completedAt.toLocaleString('fr-FR') : 'N/A';\r\n            return [\r\n                date,\r\n                moduleNames[r.module] || r.module,\r\n                r.month,\r\n                r.year,\r\n                r.score,\r\n                r.correctAnswers,\r\n                r.totalQuestions,\r\n                r.timeSpent || 0\r\n            ];\r\n        });\r\n        \r\n        const csv = [headers, ...rows].map(row => row.join(',')).join('\\n');\r\n        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n        const link = document.createElement('a');\r\n        link.href = URL.createObjectURL(blob);\r\n        link.download = `mes-resultats-${new Date().toISOString().split('T')[0]}.csv`;\r\n        link.click();\r\n        \r\n        toast.updateLoadingToast(loadingToast, 'Export CSV r√©ussi !', 'success');\r\n        logger.info('‚úÖ Export CSV r√©ussi');\r\n    } catch (error) {\r\n        toast.updateLoadingToast(loadingToast, 'Erreur d\\'export', 'error');\r\n        toast.error('Erreur lors de l\\'export CSV', 4000);\r\n        logger.error('‚ùå Erreur export CSV:', error);\r\n    }\r\n}\r\n\r\n// Afficher les d√©tails d'un r√©sultat (modal)\r\nfunction openResultDetails(resultId) {\r\n    const result = allResults.find(r => r.id === resultId);\r\n    if (!result) {\r\n        return;\r\n    }\r\n\r\n    // ‚úÖ CORRECTION SECTION 4 : Protection XSS - √âchapper toutes les donn√©es utilisateur\r\n    const moduleLabel = escapeHtml(moduleNames[result.module] || result.module || 'Module');\r\n    const periodLabel = escapeHtml([result.month, result.year].filter(Boolean).join(' '));\r\n    const scoreValue = Number.isFinite(result.score) ? result.score : 0;\r\n    const correctAnswersValue = Number.isFinite(result.correctAnswers) ? result.correctAnswers : 0;\r\n    const totalQuestionsValue = Number.isFinite(result.totalQuestions) ? result.totalQuestions : 0;\r\n    const timeDisplay = escapeHtml(formatTime(result.timeSpent || 0));\r\n    const answers = Array.isArray(result.answers) ? result.answers : [];\r\n\r\n    const modal = document.createElement('div');\r\n    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';\r\n\r\n    const dialog = document.createElement('div');\r\n    dialog.className = 'bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto flex flex-col';\r\n    // ‚úÖ CORRECTION ACCESSIBILIT√â : Attributs ARIA pour modal\r\n    dialog.setAttribute('role', 'dialog');\r\n    dialog.setAttribute('aria-modal', 'true');\r\n    dialog.setAttribute('aria-labelledby', 'modal-title-' + resultId);\r\n    modal.appendChild(dialog);\r\n\r\n    const header = document.createElement('div');\r\n    header.className = 'px-8 py-6 text-white';\r\n    header.style.background = 'var(--ap-gradient-primary)';\r\n    const title = document.createElement('h2');\r\n    title.id = 'modal-title-' + resultId;\r\n    title.className = 'text-2xl font-bold';\r\n    title.textContent = 'D√©tails du quiz';\r\n    const subtitle = document.createElement('p');\r\n    subtitle.className = 'text-white opacity-90 mt-1';\r\n    // ‚úÖ CORRECTION SECTION 4 : Protection XSS - textContent √©chappe automatiquement\r\n    subtitle.textContent = periodLabel ? `${moduleLabel} - ${periodLabel}` : moduleLabel;\r\n    header.append(title, subtitle);\r\n    dialog.appendChild(header);\r\n\r\n    const body = document.createElement('div');\r\n    body.className = 'p-8';\r\n    dialog.appendChild(body);\r\n\r\n    const metricsGrid = document.createElement('div');\r\n    metricsGrid.className = 'grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8';\r\n    body.appendChild(metricsGrid);\r\n\r\n    const createMetricCard = (label, value, valueClass = '') => {\r\n        const card = document.createElement('div');\r\n        card.className = 'text-center p-4 bg-slate-50 rounded-lg';\r\n        const labelEl = document.createElement('p');\r\n        labelEl.className = 'text-sm text-slate-500 mb-1';\r\n        labelEl.textContent = label;\r\n        const valueEl = document.createElement('p');\r\n        valueEl.className = `text-3xl font-bold ${valueClass}`.trim();\r\n        valueEl.textContent = value;\r\n        card.append(labelEl, valueEl);\r\n        return card;\r\n    };\r\n\r\n    metricsGrid.append(\r\n        createMetricCard('Score', `${scoreValue}%`, 'text-ap-red-primary'),\r\n        createMetricCard('Bonnes r√©ponses', `${correctAnswersValue}/${totalQuestionsValue}`, 'text-slate-900'),\r\n        createMetricCard('Temps total', timeDisplay, 'text-slate-900')\r\n    );\r\n\r\n    if (answers.length > 0) {\r\n        const detailTitle = document.createElement('h3');\r\n        detailTitle.className = 'text-xl font-bold text-slate-900 mb-4';\r\n        detailTitle.textContent = 'R√©ponses d√©taill√©es';\r\n        body.appendChild(detailTitle);\r\n\r\n        const answersContainer = document.createElement('div');\r\n        answersContainer.className = 'space-y-3 max-h-96 overflow-y-auto';\r\n        body.appendChild(answersContainer);\r\n\r\n        answers.forEach((answer, index) => {\r\n            const wrapper = document.createElement('div');\r\n            wrapper.className = `p-4 rounded-lg border ${answer.isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`;\r\n\r\n            const row = document.createElement('div');\r\n            row.className = 'flex items-start gap-3';\r\n            wrapper.appendChild(row);\r\n\r\n            const icon = document.createElement('span');\r\n            icon.className = 'text-2xl';\r\n            icon.textContent = answer.isCorrect ? '‚úÖ' : '‚ùå';\r\n            row.appendChild(icon);\r\n\r\n            const content = document.createElement('div');\r\n            content.className = 'flex-1';\r\n            row.appendChild(content);\r\n\r\n            const questionTitle = document.createElement('p');\r\n            questionTitle.className = 'font-semibold text-slate-900 mb-1';\r\n            questionTitle.textContent = `Question ${index + 1}`;\r\n            content.appendChild(questionTitle);\r\n\r\n            const questionText = document.createElement('p');\r\n            questionText.className = 'text-sm text-slate-700 mb-2';\r\n            // ‚úÖ CORRECTION SECTION 4 : Protection XSS - textContent √©chappe automatiquement\r\n            questionText.textContent = answer.question || 'Question indisponible';\r\n            content.appendChild(questionText);\r\n\r\n            if (!answer.isCorrect) {\r\n                const diff = document.createElement('div');\r\n                diff.className = 'text-xs text-slate-600 space-y-1';\r\n\r\n                const userAnswer = document.createElement('p');\r\n                const userLabel = document.createElement('strong');\r\n                userLabel.textContent = 'Votre r√©ponse :';\r\n                // ‚úÖ CORRECTION SECTION 4 : Protection XSS - textContent √©chappe automatiquement\r\n                userAnswer.append(userLabel, document.createTextNode(` ${answer.selectedAnswer || 'N/A'}`));\r\n\r\n                const correctAnswer = document.createElement('p');\r\n                const correctLabel = document.createElement('strong');\r\n                correctLabel.textContent = 'Bonne r√©ponse :';\r\n                // ‚úÖ CORRECTION SECTION 4 : Protection XSS - textContent √©chappe automatiquement\r\n                correctAnswer.append(correctLabel, document.createTextNode(` ${answer.correctAnswer || 'N/A'}`));\r\n\r\n                diff.append(userAnswer, correctAnswer);\r\n                content.appendChild(diff);\r\n            }\r\n\r\n            const duration = document.createElement('span');\r\n            duration.className = 'text-sm text-slate-500';\r\n            duration.textContent = `${Number.isFinite(answer.timeSpent) ? answer.timeSpent : 0}s`;\r\n            row.appendChild(duration);\r\n\r\n            answersContainer.appendChild(wrapper);\r\n        });\r\n    } else {\r\n        const emptyState = document.createElement('p');\r\n        emptyState.className = 'text-slate-500 text-center py-8';\r\n        emptyState.textContent = 'D√©tails des r√©ponses non disponibles';\r\n        body.appendChild(emptyState);\r\n    }\r\n\r\n    const footer = document.createElement('div');\r\n    footer.className = 'px-8 py-6 bg-slate-50 border-t border-gray-200 flex justify-end';\r\n    const closeBtn = document.createElement('button');\r\n    closeBtn.id = 'close-modal-btn';\r\n    closeBtn.className = 'px-6 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors font-medium';\r\n    closeBtn.textContent = 'Fermer';\r\n    footer.appendChild(closeBtn);\r\n    dialog.appendChild(footer);\r\n\r\n    document.body.appendChild(modal);\r\n\r\n    const removeModal = () => {\r\n        if (modal.parentNode) {\r\n            modal.parentNode.removeChild(modal);\r\n        }\r\n    };\r\n\r\n    closeBtn.addEventListener('click', removeModal);\r\n    modal.addEventListener('click', (event) => {\r\n        if (event.target === modal) {\r\n            removeModal();\r\n        }\r\n    });\r\n}\r\n\r\n// Afficher message si aucun r√©sultat\r\nfunction showNoResults() {\r\n    document.getElementById('results-loading')?.classList.add('hidden');\r\n    document.getElementById('no-results')?.classList.add('hidden');\r\n    \r\n    // Utiliser le composant empty-states pour un rendu professionnel\r\n    const container = document.getElementById('results-container');\r\n    if (container) {\r\n        container.classList.remove('hidden');\r\n        showEmptyState('results-container', 'noResults', {\r\n            action: {\r\n                text: 'üéØ Commencer un quiz',\r\n                show: true,\r\n                href: '/'\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n// Afficher erreur\r\nfunction showError(message) {\r\n    alert(message);\r\n    document.getElementById('results-loading')?.classList.add('hidden');\r\n}\r\n\r\n// Formater le temps\r\nfunction formatTime(seconds) {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n}\r\n\r\n// ‚úÖ CORRECTION SECTION 4 : Fonction escapeHtml() supprim√©e - Utiliser celle de security.js\r\n\r\n// D√©connexion\r\nasync function handleLogout() {\r\n    try {\r\n        await signOutUser();\r\n        window.location.href = '/';\r\n    } catch (error) {\r\n        logger.error('Erreur lors de la d√©connexion:', error);\r\n    }\r\n}\r\n"],"names":["allResults","filteredResults","currentPage","resultsPerPage","progressChart","moduleChart","moduleNames","moduleColors","onAuthChange","user","updateUserInfo","userProfile","getUserProfile","loadResults","handleLogout","applyFilters","resetFilters","changePage","exportToCSV","resultsList","handleResultsListClick","userId","logger","statsContainer","resultsListContainer","progressChartContainer","showSkeleton","createStatsSkeleton","createResultSkeleton","createChartSkeleton","q","query","collection","db","where","orderBy","querySnapshot","getDocs","doc","data","completedAt","parsed","showNoResults","updateUI","error","toast","restoreResultsContainerStructure","container","prevBtn","nextBtn","updateGlobalStats","updateCharts","renderResults","totalQuizzes","avgScore","sum","totalQuestions","totalCorrect","totalTime","avgTime","safeAvgTime","escapeHtml","formatTime","updateProgressChart","updateModuleChart","ctx","recentResults","chartCard","labels","r","i","date","scores","value","moduleCounts","moduleId","m","colors","start","end","pageResults","fragment","result","createResultCardElement","updatePagination","card","dateStr","scoreColor","moduleLabel","monthLabelRaw","yearLabelRaw","periodLabel","scoreValue","correctAnswersValue","totalQuestionsValue","scoreDisplay","answersDisplay","timeDisplay","dateDisplay","event","button","resultId","openResultDetails","totalPages","pageInfo","direction","moduleFilter","periodFilter","sortFilter","now","filterDate","a","b","loadingToast","headers","rows","csv","row","blob","link","answers","modal","dialog","header","title","subtitle","body","metricsGrid","createMetricCard","label","valueClass","labelEl","valueEl","detailTitle","answersContainer","answer","index","wrapper","icon","content","questionTitle","questionText","diff","userAnswer","userLabel","correctAnswer","correctLabel","duration","emptyState","footer","closeBtn","removeModal","showEmptyState","seconds","mins","secs","signOutUser"],"mappings":"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"}