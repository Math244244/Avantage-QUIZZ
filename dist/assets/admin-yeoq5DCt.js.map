{"version":3,"file":"admin-yeoq5DCt.js","sources":["../../js/tooltip.js","../../js/admin-auth-guard.js","../../js/admin-questions.js","../../js/admin-users.js","../../js/admin-dashboard.js","../../admin.html?html-proxy&index=3.js"],"sourcesContent":["// Syst√®me de Tooltips - Position-aware tooltips pour l'interface\r\n/**\r\n * Tooltip.js - Syst√®me complet de tooltips intelligents\r\n * \r\n * Features:\r\n * - Auto-positionnement (d√©tection de d√©bordement)\r\n * - Animations fluides (fade-in/fade-out)\r\n * - D√©lai configurable (hover delay)\r\n * - Support keyboard (focus)\r\n * - Personnalisation (th√®mes, tailles)\r\n * - Mobile-friendly (d√©sactiv√© sur touch)\r\n * - Accessibilit√© (ARIA attributes)\r\n */\r\n\r\nclass TooltipManager {\r\n    constructor() {\r\n        this.activeTooltip = null;\r\n        this.hoverDelay = 300; // ms avant affichage\r\n        this.hideDelay = 100; // ms avant masquage\r\n        this.hoverTimer = null;\r\n        this.hideTimer = null;\r\n        this.isTouchDevice = ('ontouchstart' in window);\r\n        \r\n        this.init();\r\n    }\r\n    \r\n    /**\r\n     * Initialiser le syst√®me de tooltips\r\n     */\r\n    init() {\r\n        console.log('üéØ Initialisation du syst√®me de tooltips');\r\n        \r\n        // Cr√©er le container global pour les tooltips\r\n        this.createTooltipContainer();\r\n        \r\n        // Scanner et initialiser tous les √©l√©ments avec data-tooltip\r\n        this.initializeTooltips();\r\n        \r\n        // Observer les nouveaux √©l√©ments ajout√©s au DOM\r\n        this.observeDOM();\r\n        \r\n        console.log('‚úÖ Syst√®me de tooltips initialis√©');\r\n    }\r\n    \r\n    /**\r\n     * Cr√©er le container pour les tooltips\r\n     */\r\n    createTooltipContainer() {\r\n        let container = document.getElementById('tooltip-container');\r\n        if (!container) {\r\n            container = document.createElement('div');\r\n            container.id = 'tooltip-container';\r\n            container.className = 'fixed pointer-events-none z-[9999]';\r\n            document.body.appendChild(container);\r\n        }\r\n        this.container = container;\r\n    }\r\n    \r\n    /**\r\n     * Initialiser tous les tooltips existants\r\n     */\r\n    initializeTooltips() {\r\n        const elements = document.querySelectorAll('[data-tooltip]');\r\n        elements.forEach(el => this.attachTooltip(el));\r\n        console.log(`üìå ${elements.length} tooltips initialis√©s`);\r\n    }\r\n    \r\n    /**\r\n     * Observer les mutations du DOM\r\n     */\r\n    observeDOM() {\r\n        const observer = new MutationObserver((mutations) => {\r\n            mutations.forEach((mutation) => {\r\n                mutation.addedNodes.forEach((node) => {\r\n                    if (node.nodeType === 1) { // Element node\r\n                        if (node.hasAttribute && node.hasAttribute('data-tooltip')) {\r\n                            this.attachTooltip(node);\r\n                        }\r\n                        // Chercher dans les enfants\r\n                        if (node.querySelectorAll) {\r\n                            node.querySelectorAll('[data-tooltip]').forEach(el => {\r\n                                this.attachTooltip(el);\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n        });\r\n        \r\n        observer.observe(document.body, {\r\n            childList: true,\r\n            subtree: true\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Attacher un tooltip √† un √©l√©ment\r\n     */\r\n    attachTooltip(element) {\r\n        // √âviter les doublons\r\n        if (element.dataset.tooltipAttached) return;\r\n        element.dataset.tooltipAttached = 'true';\r\n        \r\n        // D√©sactiver sur mobile touch\r\n        if (this.isTouchDevice) return;\r\n        \r\n        // Events\r\n        element.addEventListener('mouseenter', (e) => this.handleMouseEnter(e, element));\r\n        element.addEventListener('mouseleave', (e) => this.handleMouseLeave(e));\r\n        element.addEventListener('focus', (e) => this.handleFocus(e, element));\r\n        element.addEventListener('blur', (e) => this.handleBlur(e));\r\n        \r\n        // ARIA attributes pour accessibilit√©\r\n        element.setAttribute('aria-describedby', `tooltip-${this.generateId()}`);\r\n    }\r\n    \r\n    /**\r\n     * G√©n√©rer un ID unique\r\n     */\r\n    generateId() {\r\n        return Math.random().toString(36).substring(2, 11);\r\n    }\r\n    \r\n    /**\r\n     * G√©rer mouseenter\r\n     */\r\n    handleMouseEnter(event, element) {\r\n        clearTimeout(this.hideTimer);\r\n        \r\n        this.hoverTimer = setTimeout(() => {\r\n            this.showTooltip(element);\r\n        }, this.hoverDelay);\r\n    }\r\n    \r\n    /**\r\n     * G√©rer mouseleave\r\n     */\r\n    handleMouseLeave(event) {\r\n        clearTimeout(this.hoverTimer);\r\n        \r\n        this.hideTimer = setTimeout(() => {\r\n            this.hideTooltip();\r\n        }, this.hideDelay);\r\n    }\r\n    \r\n    /**\r\n     * G√©rer focus (keyboard)\r\n     */\r\n    handleFocus(event, element) {\r\n        this.showTooltip(element);\r\n    }\r\n    \r\n    /**\r\n     * G√©rer blur (keyboard)\r\n     */\r\n    handleBlur(event) {\r\n        this.hideTooltip();\r\n    }\r\n    \r\n    /**\r\n     * Afficher le tooltip\r\n     */\r\n    showTooltip(element) {\r\n        const text = element.dataset.tooltip;\r\n        const position = element.dataset.tooltipPosition || 'top';\r\n        const theme = element.dataset.tooltipTheme || 'dark';\r\n        const size = element.dataset.tooltipSize || 'medium';\r\n        \r\n        if (!text) return;\r\n        \r\n        // Cacher l'ancien tooltip\r\n        this.hideTooltip();\r\n        \r\n        // Cr√©er le nouveau tooltip\r\n        const tooltip = this.createTooltipElement(text, theme, size);\r\n        this.container.appendChild(tooltip);\r\n        this.activeTooltip = tooltip;\r\n        \r\n        // Positionner le tooltip\r\n        this.positionTooltip(tooltip, element, position);\r\n        \r\n        // Animation d'apparition\r\n        setTimeout(() => {\r\n            tooltip.classList.remove('opacity-0', 'scale-95');\r\n            tooltip.classList.add('opacity-100', 'scale-100');\r\n        }, 10);\r\n    }\r\n    \r\n    /**\r\n     * Cr√©er l'√©l√©ment tooltip\r\n     */\r\n    createTooltipElement(text, theme, size) {\r\n        const tooltip = document.createElement('div');\r\n        tooltip.className = `tooltip absolute opacity-0 scale-95 transform transition-all duration-200 ease-out ${this.getThemeClasses(theme)} ${this.getSizeClasses(size)}`;\r\n        \r\n        // Contenu\r\n        tooltip.innerHTML = `\r\n            <div class=\"tooltip-content relative\">\r\n                ${text}\r\n                <div class=\"tooltip-arrow absolute w-2 h-2 transform rotate-45 ${this.getArrowClasses(theme)}\"></div>\r\n            </div>\r\n        `;\r\n        \r\n        return tooltip;\r\n    }\r\n    \r\n    /**\r\n     * Obtenir les classes de th√®me\r\n     */\r\n    getThemeClasses(theme) {\r\n        const themes = {\r\n            'dark': 'bg-slate-900 text-white shadow-lg',\r\n            'light': 'bg-white text-slate-900 shadow-lg border border-slate-200',\r\n            'success': 'bg-green-600 text-white shadow-lg',\r\n            'error': 'bg-red-600 text-white shadow-lg',\r\n            'warning': 'bg-orange-600 text-white shadow-lg',\r\n            'info': 'bg-blue-600 text-white shadow-lg'\r\n        };\r\n        return themes[theme] || themes.dark;\r\n    }\r\n    \r\n    /**\r\n     * Obtenir les classes de taille\r\n     */\r\n    getSizeClasses(size) {\r\n        const sizes = {\r\n            'small': 'text-xs px-2 py-1 rounded',\r\n            'medium': 'text-sm px-3 py-2 rounded-md',\r\n            'large': 'text-base px-4 py-3 rounded-lg'\r\n        };\r\n        return sizes[size] || sizes.medium;\r\n    }\r\n    \r\n    /**\r\n     * Obtenir les classes de fl√®che\r\n     */\r\n    getArrowClasses(theme) {\r\n        const arrows = {\r\n            'dark': 'bg-slate-900',\r\n            'light': 'bg-white border-l border-b border-slate-200',\r\n            'success': 'bg-green-600',\r\n            'error': 'bg-red-600',\r\n            'warning': 'bg-orange-600',\r\n            'info': 'bg-blue-600'\r\n        };\r\n        return arrows[theme] || arrows.dark;\r\n    }\r\n    \r\n    /**\r\n     * Positionner le tooltip intelligemment\r\n     */\r\n    positionTooltip(tooltip, element, preferredPosition) {\r\n        const rect = element.getBoundingClientRect();\r\n        const tooltipRect = tooltip.getBoundingClientRect();\r\n        const arrow = tooltip.querySelector('.tooltip-arrow');\r\n        \r\n        const spacing = 8; // Espace entre √©l√©ment et tooltip\r\n        const arrowSize = 8;\r\n        \r\n        // Calculer toutes les positions possibles\r\n        const positions = {\r\n            top: {\r\n                top: rect.top - tooltipRect.height - spacing,\r\n                left: rect.left + (rect.width / 2) - (tooltipRect.width / 2),\r\n                arrowTop: tooltipRect.height - arrowSize / 2,\r\n                arrowLeft: tooltipRect.width / 2 - arrowSize / 2,\r\n                arrowRotate: 'rotate(45deg)'\r\n            },\r\n            bottom: {\r\n                top: rect.bottom + spacing,\r\n                left: rect.left + (rect.width / 2) - (tooltipRect.width / 2),\r\n                arrowTop: -arrowSize / 2,\r\n                arrowLeft: tooltipRect.width / 2 - arrowSize / 2,\r\n                arrowRotate: 'rotate(225deg)'\r\n            },\r\n            left: {\r\n                top: rect.top + (rect.height / 2) - (tooltipRect.height / 2),\r\n                left: rect.left - tooltipRect.width - spacing,\r\n                arrowTop: tooltipRect.height / 2 - arrowSize / 2,\r\n                arrowLeft: tooltipRect.width - arrowSize / 2,\r\n                arrowRotate: 'rotate(135deg)'\r\n            },\r\n            right: {\r\n                top: rect.top + (rect.height / 2) - (tooltipRect.height / 2),\r\n                left: rect.right + spacing,\r\n                arrowTop: tooltipRect.height / 2 - arrowSize / 2,\r\n                arrowLeft: -arrowSize / 2,\r\n                arrowRotate: 'rotate(315deg)'\r\n            }\r\n        };\r\n        \r\n        // D√©terminer la meilleure position\r\n        let position = preferredPosition;\r\n        \r\n        // V√©rifier si la position pr√©f√©r√©e d√©borde\r\n        const testPosition = positions[preferredPosition];\r\n        if (testPosition) {\r\n            const wouldOverflow = \r\n                testPosition.top < 0 || \r\n                testPosition.top + tooltipRect.height > window.innerHeight ||\r\n                testPosition.left < 0 || \r\n                testPosition.left + tooltipRect.width > window.innerWidth;\r\n            \r\n            // Trouver une position alternative\r\n            if (wouldOverflow) {\r\n                const alternatives = ['top', 'bottom', 'left', 'right'];\r\n                for (const alt of alternatives) {\r\n                    const altPos = positions[alt];\r\n                    const altOverflow = \r\n                        altPos.top < 0 || \r\n                        altPos.top + tooltipRect.height > window.innerHeight ||\r\n                        altPos.left < 0 || \r\n                        altPos.left + tooltipRect.width > window.innerWidth;\r\n                    \r\n                    if (!altOverflow) {\r\n                        position = alt;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Appliquer la position\r\n        const finalPosition = positions[position] || positions.top;\r\n        tooltip.style.top = `${finalPosition.top}px`;\r\n        tooltip.style.left = `${finalPosition.left}px`;\r\n        \r\n        // Positionner la fl√®che\r\n        if (arrow) {\r\n            arrow.style.top = `${finalPosition.arrowTop}px`;\r\n            arrow.style.left = `${finalPosition.arrowLeft}px`;\r\n            arrow.style.transform = finalPosition.arrowRotate;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Cacher le tooltip\r\n     */\r\n    hideTooltip() {\r\n        if (!this.activeTooltip) return;\r\n        \r\n        // Animation de disparition\r\n        this.activeTooltip.classList.remove('opacity-100', 'scale-100');\r\n        this.activeTooltip.classList.add('opacity-0', 'scale-95');\r\n        \r\n        // Supprimer apr√®s l'animation\r\n        setTimeout(() => {\r\n            if (this.activeTooltip && this.activeTooltip.parentNode) {\r\n                this.activeTooltip.parentNode.removeChild(this.activeTooltip);\r\n            }\r\n            this.activeTooltip = null;\r\n        }, 200);\r\n    }\r\n    \r\n    /**\r\n     * Ajouter un tooltip programmatiquement\r\n     */\r\n    add(element, text, options = {}) {\r\n        element.dataset.tooltip = text;\r\n        element.dataset.tooltipPosition = options.position || 'top';\r\n        element.dataset.tooltipTheme = options.theme || 'dark';\r\n        element.dataset.tooltipSize = options.size || 'medium';\r\n        \r\n        this.attachTooltip(element);\r\n    }\r\n    \r\n    /**\r\n     * Retirer un tooltip\r\n     */\r\n    remove(element) {\r\n        element.removeAttribute('data-tooltip');\r\n        element.removeAttribute('data-tooltip-position');\r\n        element.removeAttribute('data-tooltip-theme');\r\n        element.removeAttribute('data-tooltip-size');\r\n        element.removeAttribute('data-tooltip-attached');\r\n        element.removeAttribute('aria-describedby');\r\n    }\r\n    \r\n    /**\r\n     * Mettre √† jour un tooltip\r\n     */\r\n    update(element, text, options = {}) {\r\n        this.remove(element);\r\n        this.add(element, text, options);\r\n    }\r\n    \r\n    /**\r\n     * D√©truire le syst√®me de tooltips\r\n     */\r\n    destroy() {\r\n        if (this.container && this.container.parentNode) {\r\n            this.container.parentNode.removeChild(this.container);\r\n        }\r\n        \r\n        clearTimeout(this.hoverTimer);\r\n        clearTimeout(this.hideTimer);\r\n        \r\n        console.log('üóëÔ∏è Syst√®me de tooltips d√©truit');\r\n    }\r\n}\r\n\r\n// Cr√©er l'instance globale\r\nconst tooltip = new TooltipManager();\r\n\r\n// Export pour utilisation dans d'autres modules\r\nexport { tooltip, TooltipManager };\r\n\r\n// Rendre accessible globalement\r\nwindow.tooltip = tooltip;\r\n","// Admin Auth Guard - Protection des routes administrateur\r\nimport { auth } from './firebase-config.js';\r\nimport { getUserProfile } from './firestore-service.js';\r\nimport { isDemoMode, getDemoUser } from './auth.js';\r\n\r\n/**\r\n * V√©rifie si l'utilisateur actuel est admin\r\n * Redirige vers index.html si non autoris√©\r\n * Support du mode d√©mo et Firebase\r\n */\r\nexport async function requireAdmin() {\r\n    return new Promise((resolve, reject) => {\r\n        // ‚úÖ V√©rifier d'abord le mode d√©mo\r\n        if (isDemoMode()) {\r\n            const demoUser = getDemoUser();\r\n            if (demoUser && demoUser.role === 'admin') {\r\n                console.log('‚úÖ Admin autoris√© (mode d√©mo):', demoUser.email);\r\n                resolve(demoUser);\r\n                return;\r\n            } else {\r\n                console.warn('‚ùå Acc√®s refus√©: utilisateur d√©mo non admin');\r\n                alert('Acc√®s refus√©. Cette page est r√©serv√©e aux administrateurs.');\r\n                window.location.href = '/index.html';\r\n                reject(new Error('Non autoris√©'));\r\n                return;\r\n            }\r\n        }\r\n        \r\n        // ‚úÖ Mode Firebase normal\r\n        const unsubscribe = auth.onAuthStateChanged(async (user) => {\r\n            unsubscribe(); // Se d√©sabonner imm√©diatement\r\n            \r\n            if (!user) {\r\n                console.warn('‚ùå Acc√®s refus√©: Utilisateur non connect√©');\r\n                window.location.href = '/index.html';\r\n                reject(new Error('Non authentifi√©'));\r\n                return;\r\n            }\r\n            \r\n            try {\r\n                // V√©rifier le r√¥le\r\n                const userProfile = await getUserProfile(user.uid);\r\n                \r\n                if (!userProfile || userProfile.role !== 'admin') {\r\n                    console.warn('‚ùå Acc√®s refus√©: Utilisateur non administrateur');\r\n                    alert('Acc√®s refus√©. Cette page est r√©serv√©e aux administrateurs.');\r\n                    window.location.href = '/index.html';\r\n                    reject(new Error('Non autoris√©'));\r\n                    return;\r\n                }\r\n                \r\n                console.log('‚úÖ Admin autoris√©:', user.email);\r\n                resolve(user);\r\n            } catch (error) {\r\n                console.error('‚ùå Erreur v√©rification admin:', error);\r\n                window.location.href = '/index.html';\r\n                reject(error);\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * V√©rifie si l'utilisateur est admin sans redirection\r\n * Retourne true/false\r\n * Support du mode d√©mo et Firebase\r\n */\r\nexport async function isAdmin() {\r\n    try {\r\n        // ‚úÖ V√©rifier le mode d√©mo d'abord\r\n        if (isDemoMode()) {\r\n            const demoUser = getDemoUser();\r\n            return demoUser?.role === 'admin';\r\n        }\r\n        \r\n        // ‚úÖ Mode Firebase normal\r\n        const user = auth.currentUser;\r\n        if (!user) return false;\r\n        \r\n        const userProfile = await getUserProfile(user.uid);\r\n        return userProfile?.role === 'admin';\r\n    } catch (error) {\r\n        console.error('Erreur verification admin:', error);\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * Ajoute le badge admin dans le profil utilisateur\r\n */\r\nexport function addAdminBadge() {\r\n    const userProfile = document.getElementById('user-profile');\r\n    if (!userProfile) return;\r\n    \r\n    const existingBadge = userProfile.querySelector('.admin-badge');\r\n    if (existingBadge) return; // Badge d√©j√† ajout√©\r\n    \r\n    const badge = document.createElement('div');\r\n    badge.className = 'admin-badge bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded mt-1';\r\n    badge.innerHTML = 'üî∞ Admin';\r\n    badge.style.display = 'inline-block';\r\n    \r\n    userProfile.appendChild(badge);\r\n}\r\n","// Admin Questions Manager - Gestion des questions de quiz\r\nimport { \r\n    getQuestions, \r\n    getQuestionsPaginated, // ‚úÖ CORRECTION SECTION 7 : Pagination\r\n    createQuestion, \r\n    updateQuestion, \r\n    deleteQuestion,\r\n    importQuestionsFromJSON,\r\n    getQuestionsStats\r\n} from './firestore-service.js';\r\nimport { isDemoMode } from './auth.js';\r\nimport { \r\n    createQuestionSkeleton,\r\n    createStatsSkeleton,\r\n    showSkeleton,\r\n    hideSkeleton\r\n} from './skeleton.js';\r\nimport { logger } from './logger.js';\r\nimport { \r\n    sanitizeHTML, \r\n    validateQuestionData, \r\n    sanitizeQuestionData \r\n} from './security.js';\r\n\r\n// ‚úÖ Cl√© localStorage pour persistance mode d√©mo\r\nconst DEMO_STORAGE_KEY = 'avantage-quizz-demo-questions';\r\n\r\n// ‚úÖ Charger les questions d√©mo depuis localStorage OU utiliser d√©fauts\r\nfunction loadDemoQuestions() {\r\n    if (!isDemoMode()) return [];\r\n    \r\n    const saved = localStorage.getItem(DEMO_STORAGE_KEY);\r\n    if (saved) {\r\n        try {\r\n            const parsed = JSON.parse(saved);\r\n            // Reconvertir les dates ISO en objets Date\r\n            return parsed.map(q => ({\r\n                ...q,\r\n                createdAt: new Date(q.createdAt)\r\n            }));\r\n        } catch (e) {\r\n            console.warn('‚ö†Ô∏è Erreur lecture questions d√©mo:', e);\r\n        }\r\n    }\r\n    \r\n    // Questions par d√©faut\r\n    return [\r\n        { id: '1', module: 'auto', month: 11, year: 2025, question: 'Quelle est la pression recommand√©e pour les pneus d\\'une voiture standard ?', options: ['32 PSI', '25 PSI', '40 PSI', '50 PSI'], correctAnswer: 0, explanation: 'La pression recommand√©e est g√©n√©ralement de 32 PSI pour un v√©hicule standard.', createdAt: new Date() },\r\n        { id: '2', module: 'auto', month: 11, year: 2025, question: '√Ä quelle fr√©quence doit-on changer l\\'huile moteur ?', options: ['Tous les 5000 km', 'Tous les 10000 km', 'Tous les 15000 km', 'Tous les 20000 km'], correctAnswer: 1, explanation: 'Il est recommand√© de changer l\\'huile tous les 10000 km ou selon les recommandations du fabricant.', createdAt: new Date() },\r\n        { id: '3', module: 'loisir', month: 11, year: 2025, question: 'Quel est le poids maximal recommand√© pour un bateau remorqu√© ?', options: ['1500 kg', '2000 kg', '2500 kg', '3000 kg'], correctAnswer: 2, explanation: 'Pour un v√©hicule standard, 2500 kg est souvent la limite recommand√©e.', createdAt: new Date() },\r\n        { id: '4', module: 'vr', month: 10, year: 2025, question: 'Quelle est la capacit√© minimale recommand√©e pour une batterie de VR ?', options: ['75 Ah', '100 Ah', '125 Ah', '150 Ah'], correctAnswer: 1, explanation: 'Une batterie de 100 Ah est le minimum recommand√© pour un VR.', createdAt: new Date() },\r\n        { id: '5', module: 'tracteur', month: 10, year: 2025, question: '√Ä quelle profondeur doit-on labourer pour les cultures c√©r√©ali√®res ?', options: ['10-15 cm', '20-25 cm', '30-35 cm', '40-45 cm'], correctAnswer: 1, explanation: 'La profondeur id√©ale est de 20-25 cm pour les c√©r√©ales.', createdAt: new Date() }\r\n    ];\r\n}\r\n\r\n// ‚úÖ Sauvegarder les questions d√©mo dans localStorage\r\nfunction saveDemoQuestions(questions) {\r\n    if (!isDemoMode()) return;\r\n    localStorage.setItem(DEMO_STORAGE_KEY, JSON.stringify(questions));\r\n    console.log('üíæ Questions d√©mo sauvegard√©es:', questions.length);\r\n}\r\n\r\n// ‚úÖ Donn√©es simul√©es pour le mode d√©mo\r\nlet MOCK_QUESTIONS = loadDemoQuestions();\r\n\r\nconst MOCK_STATS = {\r\n    total: 240,\r\n    byModule: { auto: 85, loisir: 62, vr: 54, tracteur: 39 },\r\n    recent: 12\r\n};\r\n\r\n// √âtat de l'application\r\nlet currentQuestions = [];\r\nlet currentFilters = {\r\n    module: '',\r\n    month: '',\r\n    year: new Date().getFullYear()\r\n};\r\nlet currentPage = 1;\r\nconst questionsPerPage = 20;\r\n\r\n/**\r\n * Initialiser la gestion des questions\r\n */\r\nexport async function initQuestionsManager() {\r\n    console.log('Initialisation du gestionnaire de questions');\r\n    \r\n    // Charger les questions\r\n    await loadQuestions();\r\n    \r\n    // Charger les statistiques\r\n    await loadStats();\r\n    \r\n    // Initialiser les event listeners\r\n    initEventListeners();\r\n}\r\n\r\n/**\r\n * Initialiser les event listeners\r\n */\r\nfunction initEventListeners() {\r\n    // Formulaire de cr√©ation\r\n    const createForm = document.getElementById('create-question-form');\r\n    if (createForm) {\r\n        createForm.addEventListener('submit', handleCreateQuestion);\r\n    }\r\n    \r\n    // Upload JSON\r\n    const jsonInput = document.getElementById('json-file-input');\r\n    if (jsonInput) {\r\n        jsonInput.addEventListener('change', handleJSONUpload);\r\n    }\r\n    \r\n    // Bouton parcourir\r\n    const browseBtn = document.getElementById('browse-json-btn');\r\n    if (browseBtn) {\r\n        browseBtn.addEventListener('click', () => jsonInput?.click());\r\n    }\r\n    \r\n    // Filtres\r\n    const moduleFilter = document.getElementById('filter-module');\r\n    const monthFilter = document.getElementById('filter-month');\r\n    const yearFilter = document.getElementById('filter-year');\r\n    const searchInput = document.getElementById('search-questions');\r\n    const questionsList = document.getElementById('questions-list');\r\n    \r\n    if (moduleFilter) moduleFilter.addEventListener('change', handleFilterChange);\r\n    if (monthFilter) monthFilter.addEventListener('change', handleFilterChange);\r\n    if (yearFilter) yearFilter.addEventListener('change', handleFilterChange);\r\n    if (searchInput) searchInput.addEventListener('input', handleSearch);\r\n\r\n    if (questionsList && !questionsList.dataset.eventsBound) {\r\n        questionsList.addEventListener('click', handleQuestionsListClick);\r\n        questionsList.dataset.eventsBound = 'true';\r\n    }\r\n    \r\n    // Pagination\r\n    const prevBtn = document.getElementById('prev-page-btn');\r\n    const nextBtn = document.getElementById('next-page-btn');\r\n    \r\n    if (prevBtn) prevBtn.addEventListener('click', () => changePage(-1));\r\n    if (nextBtn) nextBtn.addEventListener('click', () => changePage(1));\r\n}\r\n\r\nfunction handleQuestionsListClick(event) {\r\n    const actionButton = event.target.closest('.edit-question-btn, .delete-question-btn');\r\n    if (!actionButton) {\r\n        return;\r\n    }\r\n\r\n    const questionId = actionButton.dataset.questionId;\r\n    if (!questionId) {\r\n        return;\r\n    }\r\n\r\n    if (actionButton.classList.contains('edit-question-btn')) {\r\n        openEditModal(questionId);\r\n        return;\r\n    }\r\n\r\n    if (actionButton.classList.contains('delete-question-btn')) {\r\n        handleDeleteQuestion(questionId);\r\n    }\r\n}\r\n\r\n/**\r\n * Charger les questions avec filtres\r\n */\r\nasync function loadQuestions() {\r\n    try {\r\n        // Afficher skeleton pendant le chargement\r\n        const container = document.getElementById('questions-list');\r\n        if (container) {\r\n            showSkeleton('questions-list', createQuestionSkeleton(5));\r\n        }\r\n        \r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            console.log('üìù Mode d√©mo : Chargement des questions simul√©es...');\r\n            \r\n            // Simuler un d√©lai de chargement\r\n            await new Promise(resolve => setTimeout(resolve, 500));\r\n            \r\n            // Appliquer les filtres sur les donn√©es mock√©es\r\n            currentQuestions = MOCK_QUESTIONS.filter(q => {\r\n                if (currentFilters.module && q.module !== currentFilters.module) return false;\r\n                if (currentFilters.month && q.month !== parseInt(currentFilters.month)) return false;\r\n                if (currentFilters.year && q.year !== parseInt(currentFilters.year)) return false;\r\n                return true;\r\n            });\r\n            \r\n            console.log(`‚úÖ ${currentQuestions.length} questions simul√©es charg√©es`);\r\n            renderQuestionsList();\r\n            return;\r\n        }\r\n        \r\n        // Mode Firebase normal\r\n        const filters = {};\r\n        if (currentFilters.module) filters.module = currentFilters.module;\r\n        if (currentFilters.month) filters.month = parseInt(currentFilters.month);\r\n        if (currentFilters.year) filters.year = parseInt(currentFilters.year);\r\n        \r\n        currentQuestions = await getQuestions(filters);\r\n        console.log(`Questions chargees: ${currentQuestions.length}`);\r\n        \r\n        renderQuestionsList();\r\n    } catch (error) {\r\n        console.error('Erreur chargement questions:', error);\r\n        const container = document.getElementById('questions-list');\r\n        if (container) {\r\n            container.innerHTML = `\r\n                <div class=\"text-center py-12 text-red-500\">\r\n                    <svg class=\"w-16 h-16 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                    </svg>\r\n                    <p class=\"text-lg font-medium\">Erreur lors du chargement</p>\r\n                    <p class=\"text-sm\">${error.message}</p>\r\n                </div>\r\n            `;\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Afficher la liste des questions\r\n */\r\nfunction renderQuestionsList() {\r\n    const container = document.getElementById('questions-list');\r\n    if (!container) return;\r\n    \r\n    if (currentQuestions.length === 0) {\r\n        const emptyState = document.createElement('div');\r\n        emptyState.className = 'text-center py-12 text-slate-500';\r\n        emptyState.innerHTML = `\r\n            <svg class=\"w-16 h-16 mx-auto mb-4 opacity-50\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"></path>\r\n            </svg>\r\n            <p class=\"text-lg font-medium\">Aucune question trouvee</p>\r\n            <p class=\"text-sm\">Creez votre premiere question ou importez un fichier JSON</p>\r\n        `;\r\n        container.replaceChildren(emptyState);\r\n        return;\r\n    }\r\n    \r\n    // Pagination\r\n    const startIndex = (currentPage - 1) * questionsPerPage;\r\n    const endIndex = startIndex + questionsPerPage;\r\n    const paginatedQuestions = currentQuestions.slice(startIndex, endIndex);\r\n\r\n    const fragment = document.createDocumentFragment();\r\n    paginatedQuestions.forEach(question => {\r\n        fragment.appendChild(createQuestionCardElement(question));\r\n    });\r\n\r\n    container.replaceChildren(fragment);\r\n\r\n    // Mettre √† jour la pagination\r\n    updatePaginationControls();\r\n}\r\n\r\n/**\r\n * Cr√©er une carte de question sous forme de noeud DOM\r\n */\r\nfunction createQuestionCardElement(question) {\r\n    const moduleColors = {\r\n        auto: 'indigo',\r\n        loisir: 'cyan',\r\n        vr: 'orange',\r\n        tracteur: 'green'\r\n    };\r\n    \r\n    const moduleIcons = {\r\n        auto: 'üöó',\r\n        loisir: 'üèîÔ∏è',\r\n        vr: 'üöê',\r\n        tracteur: 'üöú'\r\n    };\r\n    \r\n    const color = moduleColors[question.module] || 'gray';\r\n    const icon = moduleIcons[question.module] || 'üìù';\r\n    \r\n    const monthNames = ['Jan', 'Fev', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Aout', 'Sep', 'Oct', 'Nov', 'Dec'];\r\n    const monthName = monthNames[question.month - 1] || question.month;\r\n    const createdAt = question.createdAt?.seconds\r\n        ? new Date(question.createdAt.seconds * 1000)\r\n        : question.createdAt instanceof Date\r\n            ? question.createdAt\r\n            : null;\r\n    const createdAtDisplay = createdAt ? createdAt.toLocaleDateString('fr-FR') : 'N/A';\r\n    \r\n    const template = document.createElement('template');\r\n    template.innerHTML = `\r\n        <article class=\"question-card bg-white rounded-xl shadow-md p-6 mb-4 hover:shadow-lg transition-shadow\" data-question-id=\"${question.id}\">\r\n            <div class=\"flex items-start justify-between mb-4\">\r\n                <div class=\"flex items-center gap-3\">\r\n                    <span class=\"text-2xl\">${icon}</span>\r\n                    <div>\r\n                        <span class=\"inline-block bg-${color}-100 text-${color}-700 text-xs font-semibold px-3 py-1 rounded-full\">\r\n                            ${escapeHtml(question.module.toUpperCase())}\r\n                        </span>\r\n                        <span class=\"ml-2 text-sm text-slate-500\">${escapeHtml(`${monthName} ${question.year}`)}</span>\r\n                    </div>\r\n                </div>\r\n                <div class=\"flex gap-2\">\r\n                    <button class=\"edit-question-btn text-indigo-600 hover:text-indigo-800 p-2 rounded hover:bg-indigo-50 transition\" data-question-id=\"${question.id}\" title=\"Modifier\">\r\n                        <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\r\n                        </svg>\r\n                    </button>\r\n                    <button class=\"delete-question-btn text-red-600 hover:text-red-800 p-2 rounded hover:bg-red-50 transition\" data-question-id=\"${question.id}\" title=\"Supprimer\">\r\n                        <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"></path>\r\n                        </svg>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n            <h4 class=\"text-lg font-semibold text-slate-900 mb-4\">${escapeHtml(question.question)}</h4>\r\n            <div class=\"space-y-2 mb-4\">\r\n                ${question.options.map((opt, idx) => `\r\n                    <div class=\"flex items-start gap-2 text-sm ${idx === question.correctAnswer ? 'font-semibold text-green-700 bg-green-50 p-2 rounded' : 'text-slate-600'}\">\r\n                        <span class=\"font-bold\">${String.fromCharCode(65 + idx)})</span>\r\n                        <span>${escapeHtml(opt)}</span>\r\n                        ${idx === question.correctAnswer ? '<svg class=\"w-5 h-5 text-green-600 ml-auto flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"></path></svg>' : ''}\r\n                    </div>\r\n                `).join('')}\r\n            </div>\r\n            <div class=\"bg-blue-50 border-l-4 border-blue-500 p-3 rounded\">\r\n                <p class=\"text-xs font-semibold text-blue-700 mb-1\">üí° Explication</p>\r\n                <p class=\"text-sm text-blue-900\">${escapeHtml(question.explanation)}</p>\r\n            </div>\r\n            <div class=\"mt-4 pt-4 border-t border-slate-200 text-xs text-slate-500\">\r\n                Creee le: ${escapeHtml(createdAtDisplay)}${question.createdBy ? escapeHtml(` | Par: ${question.createdBy}`) : ''}\r\n            </div>\r\n        </article>\r\n    `;\r\n\r\n    return template.content.firstElementChild;\r\n}\r\n\r\n/**\r\n * G√©rer la cr√©ation d'une question\r\n */\r\nasync function handleCreateQuestion(e) {\r\n    e.preventDefault();\r\n    \r\n    const form = e.target;\r\n    const submitBtn = form.querySelector('[type=\"submit\"]');\r\n    const originalBtnText = submitBtn.innerHTML;\r\n    \r\n    try {\r\n        submitBtn.disabled = true;\r\n        submitBtn.innerHTML = '<svg class=\"animate-spin h-5 w-5 inline\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg> Creation...';\r\n        \r\n        const questionData = {\r\n            question: form.querySelector('[name=\"question\"]').value,\r\n            options: [\r\n                form.querySelector('[name=\"option1\"]').value,\r\n                form.querySelector('[name=\"option2\"]').value,\r\n                form.querySelector('[name=\"option3\"]').value,\r\n                form.querySelector('[name=\"option4\"]').value\r\n            ],\r\n            correctAnswer: parseInt(form.querySelector('[name=\"correctAnswer\"]:checked').value),\r\n            explanation: form.querySelector('[name=\"explanation\"]').value,\r\n            module: form.querySelector('[name=\"module\"]').value,\r\n            month: parseInt(form.querySelector('[name=\"month\"]').value),\r\n            year: parseInt(form.querySelector('[name=\"year\"]').value)\r\n        };\r\n        \r\n        // ‚úÖ Mode d√©mo : Simuler la cr√©ation\r\n        if (isDemoMode()) {\r\n            console.log('üìù Mode d√©mo : Simulation cr√©ation question...');\r\n            await new Promise(resolve => setTimeout(resolve, 500)); // D√©lai r√©aliste\r\n            \r\n            // Ajouter la question aux donn√©es mock√©es\r\n            const newMockQuestion = {\r\n                id: `demo-${Date.now()}`,\r\n                ...questionData,\r\n                explanation: questionData.explanation || 'Explication non fournie',\r\n                createdAt: new Date()\r\n            };\r\n            MOCK_QUESTIONS.unshift(newMockQuestion);\r\n            \r\n            // üíæ SAUVEGARDER dans localStorage\r\n            saveDemoQuestions(MOCK_QUESTIONS);\r\n            \r\n            showSuccess('‚úÖ Question cr√©√©e avec succ√®s (mode d√©mo) !');\r\n            form.reset();\r\n            \r\n            await loadQuestions();\r\n            await loadStats();\r\n            return;\r\n        }\r\n        \r\n        await createQuestion(questionData);\r\n        \r\n        showSuccess('Question creee avec succes!');\r\n        form.reset();\r\n        await loadQuestions();\r\n        await loadStats();\r\n    } catch (error) {\r\n        console.error('Erreur creation question:', error);\r\n        showError('create-question-error', error.message || 'Erreur lors de la creation');\r\n    } finally {\r\n        submitBtn.disabled = false;\r\n        submitBtn.innerHTML = originalBtnText;\r\n    }\r\n}\r\n\r\n/**\r\n * G√©rer l'upload JSON\r\n */\r\nasync function handleJSONUpload(e) {\r\n    const file = e.target.files[0];\r\n    if (!file) return;\r\n    \r\n    try {\r\n        showLoading('json-preview');\r\n        \r\n        const text = await file.text();\r\n        const jsonData = JSON.parse(text);\r\n        \r\n        // Valider le format\r\n        validateJSONFormat(jsonData);\r\n        \r\n        // Afficher l'aper√ßu\r\n        showJSONPreview(jsonData, file.name);\r\n    } catch (error) {\r\n        console.error('Erreur lecture JSON:', error);\r\n        showError('json-preview', error.message || 'Fichier JSON invalide');\r\n    }\r\n}\r\n\r\n/**\r\n * Valider le format JSON\r\n */\r\nfunction validateJSONFormat(data) {\r\n    if (!data.module || !data.month || !data.year) {\r\n        throw new Error('Champs obligatoires manquants: module, month, year');\r\n    }\r\n    \r\n    if (!Array.isArray(data.questions) || data.questions.length === 0) {\r\n        throw new Error('Le fichier doit contenir au moins une question');\r\n    }\r\n    \r\n    // Valider chaque question\r\n    data.questions.forEach((q, idx) => {\r\n        if (!q.question || q.question.length < 10) {\r\n            throw new Error(`Question ${idx + 1}: texte trop court (min 10 caracteres)`);\r\n        }\r\n        if (!Array.isArray(q.options) || q.options.length !== 4) {\r\n            throw new Error(`Question ${idx + 1}: doit avoir exactement 4 options`);\r\n        }\r\n        if (q.correctAnswer === undefined || q.correctAnswer < 0 || q.correctAnswer > 3) {\r\n            throw new Error(`Question ${idx + 1}: correctAnswer invalide (doit etre 0-3)`);\r\n        }\r\n        if (!q.explanation || q.explanation.length < 20) {\r\n            throw new Error(`Question ${idx + 1}: explication trop courte (min 20 caracteres)`);\r\n        }\r\n    });\r\n    \r\n    return true;\r\n}\r\n\r\n/**\r\n * Afficher l'aper√ßu du JSON\r\n */\r\nfunction showJSONPreview(data, fileName) {\r\n    const container = document.getElementById('json-preview');\r\n    if (!container) return;\r\n    \r\n    const moduleNames = {\r\n        auto: 'Auto',\r\n        loisir: 'Loisir',\r\n        vr: 'VR',\r\n        tracteur: 'Tracteur'\r\n    };\r\n    \r\n    const monthNames = ['Janvier', 'Fevrier', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Aout', 'Septembre', 'Octobre', 'Novembre', 'Decembre'];\r\n    \r\n    container.innerHTML = `\r\n        <div class=\"bg-green-50 border-2 border-green-500 rounded-xl p-6\">\r\n            <div class=\"flex items-start justify-between mb-4\">\r\n                <div>\r\n                    <h4 class=\"text-lg font-bold text-green-900 mb-2\">üìÑ ${fileName}</h4>\r\n                    <div class=\"space-y-1 text-sm\">\r\n                        <p class=\"text-green-800\">‚úì Format valide</p>\r\n                        <p class=\"text-green-800\">‚úì ${data.questions.length} question(s) detectee(s)</p>\r\n                        <p class=\"text-green-800\">‚úì Module: ${moduleNames[data.module] || data.module}</p>\r\n                        <p class=\"text-green-800\">‚úì Periode: ${monthNames[data.month - 1]} ${data.year}</p>\r\n                    </div>\r\n                </div>\r\n                <button id=\"cancel-import-btn\" class=\"text-slate-500 hover:text-slate-700\">\r\n                    <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                    </svg>\r\n                </button>\r\n            </div>\r\n            \r\n            <div class=\"bg-white rounded-lg p-4 mb-4 max-h-60 overflow-y-auto\">\r\n                <p class=\"font-semibold text-slate-900 mb-2\">Apercu des premieres questions:</p>\r\n                <ol class=\"space-y-2 text-sm text-slate-700\">\r\n                    ${data.questions.slice(0, 5).map((q, idx) => `\r\n                        <li><strong>${idx + 1}.</strong> ${escapeHtml(q.question.substring(0, 80))}${q.question.length > 80 ? '...' : ''}</li>\r\n                    `).join('')}\r\n                    ${data.questions.length > 5 ? `<li class=\"text-slate-500 italic\">... et ${data.questions.length - 5} autre(s)</li>` : ''}\r\n                </ol>\r\n            </div>\r\n            \r\n            <div class=\"flex gap-3\">\r\n                <button id=\"confirm-import-btn\" class=\"flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition\">\r\n                    Importer les ${data.questions.length} questions ‚Üí\r\n                </button>\r\n            </div>\r\n        </div>\r\n    `;\r\n    \r\n    // Event listeners\r\n    document.getElementById('confirm-import-btn')?.addEventListener('click', () => handleConfirmImport(data));\r\n    document.getElementById('cancel-import-btn')?.addEventListener('click', () => {\r\n        container.innerHTML = '';\r\n        document.getElementById('json-file-input').value = '';\r\n    });\r\n}\r\n\r\n/**\r\n * Confirmer l'import JSON\r\n */\r\nasync function handleConfirmImport(data) {\r\n    const container = document.getElementById('json-preview');\r\n    const confirmBtn = document.getElementById('confirm-import-btn');\r\n    \r\n    try {\r\n        confirmBtn.disabled = true;\r\n        confirmBtn.innerHTML = '<svg class=\"animate-spin h-5 w-5 inline\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle></svg> Import en cours...';\r\n        \r\n        // ‚úÖ Mode d√©mo : Simuler l'import\r\n        if (isDemoMode()) {\r\n            console.log('üìù Mode d√©mo : Simulation import JSON...');\r\n            await new Promise(resolve => setTimeout(resolve, 1000));\r\n            \r\n            const questionsToImport = data.questions || [];\r\n            questionsToImport.forEach((q, idx) => {\r\n                MOCK_QUESTIONS.unshift({\r\n                    id: `demo-imported-${Date.now()}-${idx}`,\r\n                    question: q.question,\r\n                    options: q.options,\r\n                    correctAnswer: q.correctAnswer,\r\n                    explanation: q.explanation || 'Pas d\\'explication fournie',\r\n                    module: data.module,\r\n                    month: data.month,\r\n                    year: data.year,\r\n                    createdAt: new Date()\r\n                });\r\n            });\r\n            \r\n            // üíæ SAUVEGARDER dans localStorage\r\n            saveDemoQuestions(MOCK_QUESTIONS);\r\n            \r\n            showSuccess(`‚úÖ Import termin√© (mode d√©mo): ${questionsToImport.length} questions import√©es`);\r\n            \r\n            container.innerHTML = '';\r\n            document.getElementById('json-file-input').value = '';\r\n            \r\n            await loadQuestions();\r\n            await loadStats();\r\n            return;\r\n        }\r\n        \r\n        const result = await importQuestionsFromJSON(data);\r\n        \r\n        showSuccess(`Import termine: ${result.success}/${result.total} questions importees`);\r\n        \r\n        if (result.errors.length > 0) {\r\n            console.warn('Erreurs import:', result.errors);\r\n        }\r\n        \r\n        container.innerHTML = '';\r\n        document.getElementById('json-file-input').value = '';\r\n        \r\n        await loadQuestions();\r\n        await loadStats();\r\n    } catch (error) {\r\n        console.error('Erreur import:', error);\r\n        showError('json-preview', error.message || 'Erreur lors de l import');\r\n    }\r\n}\r\n\r\n/**\r\n * Ouvrir le modal d'√©dition\r\n */\r\nfunction openEditModal(questionId) {\r\n    const question = currentQuestions.find(q => q.id === questionId);\r\n    if (!question) return;\r\n    \r\n    // TODO: Implementer le modal d'edition\r\n    // Pour l'instant, on affiche une alerte\r\n    alert(`Edition de la question ${questionId}\\nA implementer: modal d'edition`);\r\n}\r\n\r\n/**\r\n * G√©rer la suppression d'une question\r\n */\r\nasync function handleDeleteQuestion(questionId) {\r\n    const question = currentQuestions.find(q => q.id === questionId);\r\n    if (!question) return;\r\n    \r\n    const confirmDelete = confirm(\r\n        `Voulez-vous vraiment supprimer cette question?\\n\\n\"${question.question.substring(0, 100)}...\"\\n\\nCette action est irreversible.`\r\n    );\r\n    \r\n    if (!confirmDelete) return;\r\n    \r\n    try {\r\n        // ‚úÖ Mode d√©mo : Simuler la suppression\r\n        if (isDemoMode()) {\r\n            console.log('üìù Mode d√©mo : Simulation suppression question...');\r\n            await new Promise(resolve => setTimeout(resolve, 300));\r\n            \r\n            const index = MOCK_QUESTIONS.findIndex(q => q.id === questionId);\r\n            if (index > -1) {\r\n                MOCK_QUESTIONS.splice(index, 1);\r\n                \r\n                // üíæ SAUVEGARDER dans localStorage\r\n                saveDemoQuestions(MOCK_QUESTIONS);\r\n            }\r\n            \r\n            showSuccess('‚úÖ Question supprim√©e avec succ√®s (mode d√©mo)');\r\n            await loadQuestions();\r\n            await loadStats();\r\n            return;\r\n        }\r\n        \r\n        await deleteQuestion(questionId);\r\n        showSuccess('Question supprimee avec succes');\r\n        await loadQuestions();\r\n        await loadStats();\r\n    } catch (error) {\r\n        console.error('Erreur suppression:', error);\r\n        showError('questions-list', error.message || 'Erreur lors de la suppression');\r\n    }\r\n}\r\n\r\n/**\r\n * G√©rer le changement de filtres\r\n */\r\nasync function handleFilterChange(e) {\r\n    const filterName = e.target.id.replace('filter-', '');\r\n    currentFilters[filterName] = e.target.value;\r\n    currentPage = 1; // Reset pagination\r\n    await loadQuestions();\r\n}\r\n\r\n/**\r\n * G√©rer la recherche\r\n */\r\nfunction handleSearch(e) {\r\n    const searchTerm = e.target.value.toLowerCase();\r\n    \r\n    if (!searchTerm) {\r\n        renderQuestionsList();\r\n        return;\r\n    }\r\n    \r\n    const filtered = currentQuestions.filter(q => \r\n        q.question.toLowerCase().includes(searchTerm) ||\r\n        q.options.some(opt => opt.toLowerCase().includes(searchTerm)) ||\r\n        q.explanation.toLowerCase().includes(searchTerm)\r\n    );\r\n    \r\n    // Afficher les r√©sultats filtr√©s\r\n    const container = document.getElementById('questions-list');\r\n    if (!container) return;\r\n    \r\n    if (filtered.length === 0) {\r\n        const emptyState = document.createElement('div');\r\n        emptyState.className = 'text-center py-12 text-slate-500';\r\n        emptyState.innerHTML = `\r\n            <p class=\"text-lg\">Aucun resultat pour \"${escapeHtml(searchTerm)}\"</p>\r\n        `;\r\n        container.replaceChildren(emptyState);\r\n        return;\r\n    }\r\n\r\n    const fragment = document.createDocumentFragment();\r\n    filtered.forEach(question => {\r\n        fragment.appendChild(createQuestionCardElement(question));\r\n    });\r\n    container.replaceChildren(fragment);\r\n}\r\n\r\n/**\r\n * Changer de page\r\n */\r\nfunction changePage(direction) {\r\n    const totalPages = Math.ceil(currentQuestions.length / questionsPerPage);\r\n    currentPage += direction;\r\n    \r\n    if (currentPage < 1) currentPage = 1;\r\n    if (currentPage > totalPages) currentPage = totalPages;\r\n    \r\n    renderQuestionsList();\r\n    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n}\r\n\r\n/**\r\n * Mettre √† jour les contr√¥les de pagination\r\n */\r\nfunction updatePaginationControls() {\r\n    const totalPages = Math.ceil(currentQuestions.length / questionsPerPage);\r\n    const pageInfo = document.getElementById('page-info');\r\n    const prevBtn = document.getElementById('prev-page-btn');\r\n    const nextBtn = document.getElementById('next-page-btn');\r\n    \r\n    if (pageInfo) {\r\n        pageInfo.textContent = `Page ${currentPage}/${totalPages || 1}`;\r\n    }\r\n    \r\n    if (prevBtn) {\r\n        prevBtn.disabled = currentPage === 1;\r\n    }\r\n    \r\n    if (nextBtn) {\r\n        nextBtn.disabled = currentPage === totalPages || totalPages === 0;\r\n    }\r\n}\r\n\r\n/**\r\n * Charger les statistiques des questions\r\n */\r\nasync function loadStats() {\r\n    try {\r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            console.log('üìä Mode d√©mo : Chargement des stats simul√©es...');\r\n            renderStats(MOCK_STATS);\r\n            return;\r\n        }\r\n        \r\n        // Mode Firebase normal\r\n        const stats = await getQuestionsStats();\r\n        renderStats(stats);\r\n    } catch (error) {\r\n        console.error('Erreur chargement stats:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Afficher les statistiques\r\n */\r\nfunction renderStats(stats) {\r\n    const container = document.getElementById('questions-stats');\r\n    if (!container) return;\r\n    \r\n    const moduleNames = {\r\n        auto: 'Auto',\r\n        loisir: 'Loisir',\r\n        vr: 'VR',\r\n        tracteur: 'Tracteur'\r\n    };\r\n    \r\n    container.innerHTML = `\r\n        <div class=\"bg-white rounded-xl shadow-md p-6\">\r\n            <h3 class=\"text-xl font-bold text-slate-900 mb-4\">üìä Statistiques des Questions</h3>\r\n            \r\n            <div class=\"mb-6\">\r\n                <p class=\"text-3xl font-bold text-indigo-600 mb-1\">${stats.total}</p>\r\n                <p class=\"text-sm text-slate-600\">questions au total</p>\r\n            </div>\r\n            \r\n            <div class=\"space-y-3\">\r\n                <p class=\"text-sm font-semibold text-slate-700 mb-2\">Par module:</p>\r\n                ${Object.entries(stats.byModule).map(([module, count]) => {\r\n                    const percentage = ((count / stats.total) * 100).toFixed(0);\r\n                    return `\r\n                        <div>\r\n                            <div class=\"flex justify-between text-sm mb-1\">\r\n                                <span class=\"text-slate-700\">${moduleNames[module] || module}</span>\r\n                                <span class=\"font-semibold\">${count} (${percentage}%)</span>\r\n                            </div>\r\n                            <div class=\"bg-slate-200 rounded-full h-2\">\r\n                                <div class=\"bg-indigo-600 rounded-full h-2 transition-all\" style=\"width: ${percentage}%\"></div>\r\n                            </div>\r\n                        </div>\r\n                    `;\r\n                }).join('')}\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Afficher un loader\r\n */\r\nfunction showLoading(containerId) {\r\n    const container = document.getElementById(containerId);\r\n    if (!container) return;\r\n    \r\n    container.innerHTML = `\r\n        <div class=\"text-center py-12\">\r\n            <svg class=\"animate-spin h-12 w-12 mx-auto text-indigo-600\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\r\n                <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n            </svg>\r\n            <p class=\"text-slate-600 mt-4\">Chargement...</p>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Afficher une erreur\r\n */\r\nfunction showError(containerId, message) {\r\n    const container = document.getElementById(containerId);\r\n    if (!container) {\r\n        alert(`Erreur: ${message}`);\r\n        return;\r\n    }\r\n    \r\n    container.innerHTML = `\r\n        <div class=\"bg-red-50 border-2 border-red-500 rounded-xl p-6 text-center\">\r\n            <svg class=\"w-12 h-12 mx-auto text-red-500 mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n            </svg>\r\n            <p class=\"text-red-900 font-semibold\">${message}</p>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Afficher un message de succ√®s\r\n */\r\nfunction showSuccess(message) {\r\n    // Cr√©er une notification toast\r\n    const toast = document.createElement('div');\r\n    toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-xl z-50 animate-fade-in';\r\n    toast.innerHTML = `\r\n        <div class=\"flex items-center gap-3\">\r\n            <svg class=\"w-6 h-6\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"></path>\r\n            </svg>\r\n            <span class=\"font-semibold\">${message}</span>\r\n        </div>\r\n    `;\r\n    \r\n    document.body.appendChild(toast);\r\n    \r\n    setTimeout(() => {\r\n        toast.remove();\r\n    }, 3000);\r\n}\r\n\r\n/**\r\n * √âchapper le HTML\r\n */\r\nfunction escapeHtml(text) {\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n}\r\n","// Admin Users Manager - Gestion des utilisateurs\r\nimport { \r\n    getAllUsers, \r\n    getAllUsersPaginated, // ‚úÖ CORRECTION SECTION 7 : Pagination\r\n    updateUserRole,\r\n    getUsersStats\r\n} from './firestore-service.js';\r\nimport { toast } from './toast.js';\r\nimport { isDemoMode } from './auth.js';\r\n// ‚úÖ CORRECTION SECTION 4 : Protection XSS - Utiliser escapeHtml centralis√©\r\nimport { escapeHtml } from './security.js';\r\nimport {\r\n    createUserSkeleton,\r\n    createStatsSkeleton,\r\n    showSkeleton,\r\n    hideSkeleton\r\n} from './skeleton.js';\r\n\r\n// ‚úÖ Donn√©es simul√©es pour le mode d√©mo\r\nconst MOCK_USERS = [\r\n    { id: '1', email: 'admin@avantage-quizz.com', displayName: 'Administrateur Principal', role: 'admin', totalQuizzes: 0, averageScore: 0, createdAt: new Date('2025-01-15'), lastLogin: new Date() },\r\n    { id: '2', email: 'alice.dupont@example.com', displayName: 'Alice Dupont', role: 'user', totalQuizzes: 24, averageScore: 92, createdAt: new Date('2025-02-20'), lastLogin: new Date() },\r\n    { id: '3', email: 'bob.martin@example.com', displayName: 'Bob Martin', role: 'user', totalQuizzes: 21, averageScore: 88, createdAt: new Date('2025-03-10'), lastLogin: new Date(Date.now() - 86400000) },\r\n    { id: '4', email: 'claire.bernard@example.com', displayName: 'Claire Bernard', role: 'user', totalQuizzes: 19, averageScore: 85, createdAt: new Date('2025-03-25'), lastLogin: new Date(Date.now() - 172800000) },\r\n    { id: '5', email: 'david.dubois@example.com', displayName: 'David Dubois', role: 'user', totalQuizzes: 18, averageScore: 83, createdAt: new Date('2025-04-05'), lastLogin: new Date(Date.now() - 259200000) }\r\n];\r\n\r\nconst MOCK_STATS = {\r\n    total: 42,\r\n    admins: 2,\r\n    regularUsers: 40,\r\n    activeToday: 8,\r\n    activeWeek: 23\r\n};\r\n\r\n// √âtat\r\nlet currentUsers = [];\r\nlet currentFilters = {\r\n    role: '',\r\n    status: 'all'\r\n};\r\n\r\n// ‚úÖ CORRECTION SECTION 7 : Pagination - √âtat de pagination\r\nlet paginationState = {\r\n    lastDoc: null,\r\n    hasMore: false,\r\n    isLoading: false,\r\n    pageSize: 20\r\n};\r\n\r\n/**\r\n * Initialiser la gestion des utilisateurs\r\n */\r\nexport async function initUsersManager() {\r\n    console.log('Initialisation du gestionnaire utilisateurs');\r\n    \r\n    // Charger les utilisateurs\r\n    await loadUsers();\r\n    \r\n    // Charger les statistiques\r\n    await loadStats();\r\n    \r\n    // Initialiser les event listeners\r\n    initEventListeners();\r\n}\r\n\r\n/**\r\n * Initialiser les event listeners\r\n */\r\nfunction initEventListeners() {\r\n    // Formulaire de cr√©ation d'utilisateur\r\n    const createUserForm = document.getElementById('create-user-form');\r\n    if (createUserForm) {\r\n        createUserForm.addEventListener('submit', handleCreateUser);\r\n    }\r\n    \r\n    // Bouton g√©n√©ration de mot de passe\r\n    const generatePasswordBtn = document.getElementById('generate-password-btn');\r\n    if (generatePasswordBtn) {\r\n        generatePasswordBtn.addEventListener('click', generateRandomPassword);\r\n    }\r\n    \r\n    // Filtres\r\n    const roleFilter = document.getElementById('filter-user-role');\r\n    const statusFilter = document.getElementById('filter-user-status');\r\n    const searchInput = document.getElementById('search-users');\r\n    \r\n    if (roleFilter) roleFilter.addEventListener('change', handleFilterChange);\r\n    if (statusFilter) statusFilter.addEventListener('change', handleFilterChange);\r\n    if (searchInput) searchInput.addEventListener('input', handleSearch);\r\n}\r\n\r\n/**\r\n * Cr√©er un nouvel utilisateur\r\n */\r\nasync function handleCreateUser(e) {\r\n    e.preventDefault();\r\n    \r\n    const errorDiv = document.getElementById('create-user-error');\r\n    const successDiv = document.getElementById('create-user-success');\r\n    const submitBtn = document.getElementById('create-user-btn');\r\n    \r\n    // Masquer les messages\r\n    errorDiv.classList.add('hidden');\r\n    successDiv.classList.add('hidden');\r\n    \r\n    // R√©cup√©rer les donn√©es\r\n    const formData = new FormData(e.target);\r\n    const userData = {\r\n        displayName: formData.get('displayName'),\r\n        email: formData.get('email'),\r\n        password: formData.get('password'),\r\n        role: formData.get('role')\r\n    };\r\n    \r\n    // Validation\r\n    if (!userData.displayName || !userData.email || !userData.password || !userData.role) {\r\n        showFormError(errorDiv, 'Tous les champs sont obligatoires');\r\n        toast.error('Veuillez remplir tous les champs');\r\n        return;\r\n    }\r\n    \r\n    if (userData.password.length < 6) {\r\n        showFormError(errorDiv, 'Le mot de passe doit contenir au moins 6 caract√®res');\r\n        toast.error('Mot de passe trop court (minimum 6 caract√®res)');\r\n        return;\r\n    }\r\n    \r\n    // D√©sactiver le bouton et afficher loading toast\r\n    submitBtn.disabled = true;\r\n    submitBtn.textContent = '‚è≥ Cr√©ation en cours...';\r\n    const loadingToast = toast.showLoadingToast('Cr√©ation de l\\'utilisateur...');\r\n    \r\n    try {\r\n        console.log('Cr√©ation d\\'un nouvel utilisateur:', userData.email);\r\n        \r\n        // Appeler la Cloud Function (√† cr√©er)\r\n        // Pour l'instant, on simule avec un message d'erreur explicite\r\n        toast.updateLoadingToast(loadingToast, 'Cloud Function requise', 'error');\r\n        throw new Error('‚ö†Ô∏è CLOUD FUNCTION REQUISE: Cette fonctionnalit√© n√©cessite une Cloud Function Firebase pour cr√©er des utilisateurs avec mot de passe. Actuellement, seule l\\'authentification Google est support√©e. Pour activer cette fonctionnalit√©:\\n\\n1. Activer Email/Password dans Firebase Auth\\n2. Cr√©er une Cloud Function createUser\\n3. D√©ployer la fonction sur Firebase');\r\n        \r\n        // Code √† utiliser une fois la Cloud Function cr√©√©e:\r\n        /*\r\n        const createUserFunction = httpsCallable(functions, 'createUser');\r\n        const result = await createUserFunction(userData);\r\n        \r\n        console.log('‚úÖ Utilisateur cr√©√© avec succ√®s:', result.data);\r\n        \r\n        // Afficher le message de succ√®s\r\n        successDiv.textContent = `‚úÖ Utilisateur cr√©√© avec succ√®s ! Email: ${userData.email}`;\r\n        successDiv.classList.remove('hidden');\r\n        \r\n        // Toast de succ√®s\r\n        toast.updateLoadingToast(loadingToast, 'Utilisateur cr√©√© avec succ√®s !', 'success');\r\n        toast.success(`Utilisateur ${userData.email} cr√©√© !`, 4000);\r\n        \r\n        // R√©initialiser le formulaire\r\n        e.target.reset();\r\n        \r\n        // Recharger la liste des utilisateurs\r\n        await loadUsers();\r\n        */\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur cr√©ation utilisateur:', error);\r\n        showFormError(errorDiv, error.message);\r\n    } finally {\r\n        // R√©activer le bouton\r\n        submitBtn.disabled = false;\r\n        submitBtn.textContent = '‚ûï Cr√©er l\\'utilisateur';\r\n    }\r\n}\r\n\r\n/**\r\n * G√©n√©rer un mot de passe al√©atoire\r\n */\r\nfunction generateRandomPassword() {\r\n    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789@#$%&';\r\n    const length = 12;\r\n    let password = '';\r\n    \r\n    for (let i = 0; i < length; i++) {\r\n        password += chars.charAt(Math.floor(Math.random() * chars.length));\r\n    }\r\n    \r\n    // Remplir le champ\r\n    const passwordInput = document.querySelector('input[name=\"password\"]');\r\n    if (passwordInput) {\r\n        passwordInput.value = password;\r\n        passwordInput.type = 'text'; // Afficher le mot de passe g√©n√©r√©\r\n        \r\n        // Copier dans le presse-papier\r\n        navigator.clipboard.writeText(password).then(() => {\r\n            toast.success('Mot de passe g√©n√©r√© et copi√© ! Sauvegardez-le en lieu s√ªr.', 5000);\r\n        }).catch(() => {\r\n            toast.warning(`Mot de passe g√©n√©r√©: ${password}\\n\\nCopiez-le manuellement.`, 7000);\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Afficher une erreur de formulaire\r\n */\r\nfunction showFormError(errorDiv, message) {\r\n    errorDiv.textContent = message;\r\n    errorDiv.classList.remove('hidden');\r\n    errorDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\r\n}\r\n\r\n/**\r\n * Charger tous les utilisateurs\r\n */\r\nasync function loadUsers() {\r\n    try {\r\n        // Afficher skeleton pendant le chargement\r\n        const container = document.getElementById('users-list');\r\n        if (container) {\r\n            showSkeleton('users-list', createUserSkeleton(10));\r\n        }\r\n        \r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            console.log('üë• Mode d√©mo : Chargement des utilisateurs simul√©s...');\r\n            \r\n            // Simuler un d√©lai de chargement\r\n            await new Promise(resolve => setTimeout(resolve, 500));\r\n            \r\n            // Appliquer les filtres sur les donn√©es mock√©es\r\n            currentUsers = MOCK_USERS.filter(user => {\r\n                if (currentFilters.role && user.role !== currentFilters.role) return false;\r\n                \r\n                if (currentFilters.status !== 'all') {\r\n                    const oneWeekAgo = new Date();\r\n                    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\r\n                    const lastLoginDate = user.lastLogin;\r\n                    const isActive = lastLoginDate > oneWeekAgo;\r\n                    \r\n                    if (currentFilters.status === 'active' && !isActive) return false;\r\n                    if (currentFilters.status === 'inactive' && isActive) return false;\r\n                }\r\n                \r\n                return true;\r\n            });\r\n            \r\n            console.log(`‚úÖ ${currentUsers.length} utilisateurs simul√©s charg√©s`);\r\n            renderUsersList();\r\n            return;\r\n        }\r\n        \r\n        // Mode Firebase normal avec pagination\r\n        const filters = {};\r\n        if (currentFilters.role) {\r\n            filters.role = currentFilters.role;\r\n        }\r\n        \r\n        // ‚úÖ CORRECTION SECTION 7 : Pagination - R√©initialiser la pagination au chargement initial\r\n        paginationState.lastDoc = null;\r\n        paginationState.hasMore = false;\r\n        \r\n        const result = await getAllUsersPaginated(filters, paginationState.pageSize, null);\r\n        currentUsers = result.users;\r\n        paginationState.lastDoc = result.lastDoc;\r\n        paginationState.hasMore = result.hasMore;\r\n        \r\n        // Filtrer par statut actif/inactif c√¥t√© client\r\n        if (currentFilters.status !== 'all') {\r\n            const oneWeekAgo = new Date();\r\n            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\r\n            \r\n            currentUsers = currentUsers.filter(user => {\r\n                if (!user.lastLogin) return currentFilters.status === 'inactive';\r\n                \r\n                const lastLoginDate = user.lastLogin.toDate ? user.lastLogin.toDate() : new Date(user.lastLogin);\r\n                const isActive = lastLoginDate > oneWeekAgo;\r\n                \r\n                return currentFilters.status === 'active' ? isActive : !isActive;\r\n            });\r\n        }\r\n        \r\n        console.log(`Utilisateurs charges: ${currentUsers.length}`);\r\n        renderUsersList();\r\n        renderPaginationControls();\r\n    } catch (error) {\r\n        console.error('Erreur chargement utilisateurs:', error);\r\n        const container = document.getElementById('users-list');\r\n        if (container) {\r\n            // ‚úÖ CORRECTION SECTION 4 : Protection XSS - √âchapper le message d'erreur\r\n            const safeErrorMessage = escapeHtml(error.message);\r\n            container.innerHTML = `\r\n                <div class=\"text-center py-12 text-red-500\">\r\n                    <svg class=\"w-16 h-16 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                    </svg>\r\n                    <p class=\"text-lg font-medium\">Erreur lors du chargement</p>\r\n                    <p class=\"text-sm\">${safeErrorMessage}</p>\r\n                </div>\r\n            `;\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Afficher la liste des utilisateurs\r\n */\r\nfunction renderUsersList() {\r\n    const container = document.getElementById('users-list');\r\n    if (!container) return;\r\n    \r\n    if (currentUsers.length === 0) {\r\n        container.innerHTML = `\r\n            <div class=\"text-center py-12 text-slate-500\">\r\n                <svg class=\"w-16 h-16 mx-auto mb-4 opacity-50\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"></path>\r\n                </svg>\r\n                <p class=\"text-lg font-medium\">Aucun utilisateur trouve</p>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    container.innerHTML = currentUsers.map(user => renderUserCard(user)).join('');\r\n    \r\n    // Ajouter les event listeners\r\n    addUserActionListeners();\r\n}\r\n\r\n/**\r\n * ‚úÖ CORRECTION SECTION 7 : Pagination - Charger plus d'utilisateurs\r\n */\r\nasync function loadMoreUsers() {\r\n    if (paginationState.isLoading || !paginationState.hasMore) {\r\n        return;\r\n    }\r\n    \r\n    try {\r\n        paginationState.isLoading = true;\r\n        \r\n        const filters = {};\r\n        if (currentFilters.role) {\r\n            filters.role = currentFilters.role;\r\n        }\r\n        \r\n        const result = await getAllUsersPaginated(filters, paginationState.pageSize, paginationState.lastDoc);\r\n        \r\n        // Filtrer par statut actif/inactif c√¥t√© client\r\n        let newUsers = result.users;\r\n        if (currentFilters.status !== 'all') {\r\n            const oneWeekAgo = new Date();\r\n            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\r\n            \r\n            newUsers = newUsers.filter(user => {\r\n                if (!user.lastLogin) return currentFilters.status === 'inactive';\r\n                \r\n                const lastLoginDate = user.lastLogin.toDate ? user.lastLogin.toDate() : new Date(user.lastLogin);\r\n                const isActive = lastLoginDate > oneWeekAgo;\r\n                \r\n                return currentFilters.status === 'active' ? isActive : !isActive;\r\n            });\r\n        }\r\n        \r\n        // Ajouter les nouveaux utilisateurs √† la liste existante\r\n        currentUsers = [...currentUsers, ...newUsers];\r\n        paginationState.lastDoc = result.lastDoc;\r\n        paginationState.hasMore = result.hasMore;\r\n        \r\n        renderUsersList();\r\n        renderPaginationControls();\r\n        \r\n        console.log(`‚úÖ ${newUsers.length} utilisateurs suppl√©mentaires charg√©s`);\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur chargement utilisateurs suppl√©mentaires:', error);\r\n        toast.error('Erreur lors du chargement des utilisateurs suppl√©mentaires');\r\n    } finally {\r\n        paginationState.isLoading = false;\r\n    }\r\n}\r\n\r\n/**\r\n * ‚úÖ CORRECTION SECTION 7 : Pagination - Afficher les contr√¥les de pagination\r\n */\r\nfunction renderPaginationControls() {\r\n    // Supprimer les contr√¥les existants\r\n    const existingControls = document.getElementById('users-pagination-controls');\r\n    if (existingControls) {\r\n        existingControls.remove();\r\n    }\r\n    \r\n    // Si pas de pagination n√©cessaire, ne rien afficher\r\n    if (!paginationState.hasMore && currentUsers.length <= paginationState.pageSize) {\r\n        return;\r\n    }\r\n    \r\n    const container = document.getElementById('users-list');\r\n    if (!container) return;\r\n    \r\n    const paginationHTML = `\r\n        <div id=\"users-pagination-controls\" class=\"mt-6 flex justify-center items-center gap-4\">\r\n            ${paginationState.hasMore ? `\r\n                <button \r\n                    id=\"load-more-users-btn\" \r\n                    class=\"px-6 py-3 bg-ap-red-primary text-white rounded-lg hover:bg-ap-red-dark transition-all font-semibold disabled:opacity-50 disabled:cursor-not-allowed shadow-md hover:shadow-lg transform hover:-translate-y-1\"\r\n                    ${paginationState.isLoading ? 'disabled' : ''}\r\n                >\r\n                    ${paginationState.isLoading ? `\r\n                        <svg class=\"animate-spin h-5 w-5 inline mr-2\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                            <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\r\n                            <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                        </svg>\r\n                        Chargement...\r\n                    ` : `\r\n                        <svg class=\"w-5 h-5 inline mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path>\r\n                        </svg>\r\n                        Charger plus\r\n                    `}\r\n                </button>\r\n            ` : ''}\r\n            <span class=\"text-sm text-slate-600\">\r\n                ${currentUsers.length} utilisateur${currentUsers.length > 1 ? 's' : ''} affich√©${currentUsers.length > 1 ? 's' : ''}\r\n            </span>\r\n        </div>\r\n    `;\r\n    \r\n    container.insertAdjacentHTML('beforeend', paginationHTML);\r\n    \r\n    // Ajouter l'event listener pour le bouton \"Charger plus\"\r\n    const loadMoreBtn = document.getElementById('load-more-users-btn');\r\n    if (loadMoreBtn) {\r\n        loadMoreBtn.addEventListener('click', loadMoreUsers);\r\n    }\r\n}\r\n\r\n/**\r\n * Rendu d'une carte utilisateur\r\n */\r\nfunction renderUserCard(user) {\r\n    const isAdmin = user.role === 'admin';\r\n    const roleColor = isAdmin ? 'yellow' : 'blue';\r\n    const roleIcon = isAdmin ? 'üî∞' : 'üë§';\r\n    \r\n    const lastLogin = user.lastLogin ? \r\n        (user.lastLogin.toDate ? user.lastLogin.toDate() : new Date(user.lastLogin)) : \r\n        null;\r\n    \r\n    const createdAt = user.createdAt ? \r\n        (user.createdAt.toDate ? user.createdAt.toDate() : new Date(user.createdAt)) : \r\n        null;\r\n    \r\n    const isActive = lastLogin && (new Date() - lastLogin) < (7 * 24 * 60 * 60 * 1000);\r\n    \r\n    const lastLoginText = lastLogin ? formatRelativeTime(lastLogin) : 'Jamais connecte';\r\n    \r\n    // ‚úÖ CORRECTION SECTION 4 : Protection XSS - √âchapper toutes les donn√©es utilisateur\r\n    const safeDisplayName = escapeHtml(user.displayName || 'Sans nom');\r\n    const safeEmail = escapeHtml(user.email || '');\r\n    const safeAvatarAlt = escapeHtml(user.displayName || 'User');\r\n    const avatarUrl = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || user.email)}&background=667eea&color=fff&size=128`;\r\n    \r\n    return `\r\n        <div class=\"user-card bg-white rounded-xl shadow-md p-6 mb-4 hover:shadow-lg transition-shadow\" data-user-id=\"${user.uid}\">\r\n            <div class=\"flex items-start gap-4\">\r\n                <img src=\"${avatarUrl}\" alt=\"${safeAvatarAlt}\" class=\"w-16 h-16 rounded-full object-cover flex-shrink-0\" onerror=\"this.src='https://ui-avatars.com/api/?name=U&background=667eea&color=fff&size=128'\">\r\n                \r\n                <div class=\"flex-1 min-w-0\">\r\n                    <div class=\"flex items-center justify-between mb-2\">\r\n                        <div>\r\n                            <h4 class=\"text-lg font-bold text-slate-900 truncate\">${safeDisplayName}</h4>\r\n                            <p class=\"text-sm text-slate-600 truncate\">${safeEmail}</p>\r\n                        </div>\r\n                        <div class=\"flex gap-2 flex-shrink-0 ml-4\">\r\n                            <button class=\"edit-user-btn text-indigo-600 hover:text-indigo-800 p-2 rounded hover:bg-indigo-50 transition\" data-user-id=\"${user.uid}\" data-user-email=\"${user.email}\" data-user-role=\"${user.role || 'user'}\" title=\"Modifier\">\r\n                                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\r\n                                </svg>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    <div class=\"flex items-center gap-3 mb-3\">\r\n                        <span class=\"inline-flex items-center gap-1 bg-${roleColor}-100 text-${roleColor}-700 text-xs font-semibold px-3 py-1 rounded-full\">\r\n                            ${roleIcon} ${isAdmin ? 'Admin' : 'User'}\r\n                        </span>\r\n                        <span class=\"inline-flex items-center gap-1 ${isActive ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-600'} text-xs px-3 py-1 rounded-full\">\r\n                            <span class=\"w-2 h-2 rounded-full ${isActive ? 'bg-green-500' : 'bg-slate-400'}\"></span>\r\n                            ${isActive ? 'Actif' : 'Inactif'}\r\n                        </span>\r\n                    </div>\r\n                    \r\n                    <div class=\"grid grid-cols-2 gap-4 text-sm mb-3\">\r\n                        <div>\r\n                            <p class=\"text-slate-500\">Inscrit le:</p>\r\n                            <p class=\"font-medium text-slate-900\">${createdAt ? createdAt.toLocaleDateString('fr-FR') : 'N/A'}</p>\r\n                        </div>\r\n                        <div>\r\n                            <p class=\"text-slate-500\">Derniere connexion:</p>\r\n                            <p class=\"font-medium text-slate-900\">${lastLoginText}</p>\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    ${!isAdmin ? renderUserStats(user) : ''}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Rendu des statistiques utilisateur\r\n */\r\nfunction renderUserStats(user) {\r\n    const totalQuizzes = user.totalQuizzes || 0;\r\n    const averageScore = user.averageScore || 0;\r\n    const currentStreak = user.currentStreak || 0;\r\n    \r\n    return `\r\n        <div class=\"mt-4 pt-4 border-t border-slate-200 grid grid-cols-3 gap-4 text-center\">\r\n            <div>\r\n                <p class=\"text-2xl font-bold text-indigo-600\">${averageScore}%</p>\r\n                <p class=\"text-xs text-slate-600\">Score moyen</p>\r\n            </div>\r\n            <div>\r\n                <p class=\"text-2xl font-bold text-purple-600\">${totalQuizzes}</p>\r\n                <p class=\"text-xs text-slate-600\">Quiz completes</p>\r\n            </div>\r\n            <div>\r\n                <p class=\"text-2xl font-bold text-orange-600\">üî• ${currentStreak}</p>\r\n                <p class=\"text-xs text-slate-600\">Serie active</p>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Ajouter les event listeners\r\n */\r\nfunction addUserActionListeners() {\r\n    document.querySelectorAll('.edit-user-btn').forEach(btn => {\r\n        btn.addEventListener('click', (e) => {\r\n            const userId = e.currentTarget.dataset.userId;\r\n            const userEmail = e.currentTarget.dataset.userEmail;\r\n            const userRole = e.currentTarget.dataset.userRole;\r\n            openEditRoleModal(userId, userEmail, userRole);\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Ouvrir le modal d'√©dition du r√¥le\r\n */\r\nfunction openEditRoleModal(userId, userEmail, currentRole) {\r\n    // Cr√©er le modal\r\n    const modal = document.createElement('div');\r\n    modal.id = 'edit-role-modal';\r\n    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';\r\n    modal.innerHTML = `\r\n        <div class=\"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 animate-fade-in\">\r\n            <div class=\"flex items-center justify-between mb-6\">\r\n                <h3 class=\"text-2xl font-bold text-slate-900\">Modifier le role</h3>\r\n                <button id=\"close-modal-btn\" class=\"text-slate-400 hover:text-slate-600\">\r\n                    <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                    </svg>\r\n                </button>\r\n            </div>\r\n            \r\n            <div class=\"mb-6\">\r\n                <p class=\"text-slate-600 mb-1\">Utilisateur:</p>\r\n                <p class=\"font-semibold text-slate-900\">${escapeHtml(userEmail || '')}</p>\r\n            </div>\r\n            \r\n            <div class=\"mb-6\">\r\n                <p class=\"text-slate-700 font-medium mb-3\">Role actuel: <span class=\"text-indigo-600\">${currentRole === 'admin' ? 'Admin' : 'User'}</span></p>\r\n                \r\n                <p class=\"text-sm font-semibold text-slate-700 mb-2\">Modifier le role:</p>\r\n                <div class=\"space-y-3\">\r\n                    <label class=\"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:border-indigo-500 transition ${currentRole !== 'admin' ? 'border-indigo-500 bg-indigo-50' : 'border-slate-200'}\">\r\n                        <input type=\"radio\" name=\"role\" value=\"user\" ${currentRole !== 'admin' ? 'checked' : ''} class=\"mt-1\">\r\n                        <div>\r\n                            <p class=\"font-semibold text-slate-900\">üë§ User (Utilisateur standard)</p>\r\n                            <p class=\"text-sm text-slate-600\">Acces uniquement au tableau de bord et aux quiz</p>\r\n                        </div>\r\n                    </label>\r\n                    \r\n                    <label class=\"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:border-yellow-500 transition ${currentRole === 'admin' ? 'border-yellow-500 bg-yellow-50' : 'border-slate-200'}\">\r\n                        <input type=\"radio\" name=\"role\" value=\"admin\" ${currentRole === 'admin' ? 'checked' : ''} class=\"mt-1\">\r\n                        <div>\r\n                            <p class=\"font-semibold text-slate-900\">üî∞ Admin (Administrateur)</p>\r\n                            <p class=\"text-sm text-slate-600\">Acces total: gestion questions et utilisateurs</p>\r\n                        </div>\r\n                    </label>\r\n                </div>\r\n            </div>\r\n            \r\n            <div class=\"bg-amber-50 border-l-4 border-amber-500 p-4 mb-6\">\r\n                <p class=\"text-sm text-amber-900\">\r\n                    <strong>Attention:</strong> En passant User ‚Üí Admin, cette personne aura acces a toutes les fonctions d administration.\r\n                </p>\r\n            </div>\r\n            \r\n            <div class=\"flex gap-3\">\r\n                <button id=\"cancel-role-btn\" class=\"flex-1 bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold py-3 px-6 rounded-lg transition\">\r\n                    Annuler\r\n                </button>\r\n                <button id=\"save-role-btn\" class=\"flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition\">\r\n                    Enregistrer\r\n                </button>\r\n            </div>\r\n        </div>\r\n    `;\r\n    \r\n    document.body.appendChild(modal);\r\n    \r\n    // Event listeners\r\n    document.getElementById('close-modal-btn')?.addEventListener('click', () => modal.remove());\r\n    document.getElementById('cancel-role-btn')?.addEventListener('click', () => modal.remove());\r\n    document.getElementById('save-role-btn')?.addEventListener('click', async () => {\r\n        const newRole = modal.querySelector('input[name=\"role\"]:checked')?.value;\r\n        if (newRole) {\r\n            await handleUpdateRole(userId, userEmail, newRole);\r\n            modal.remove();\r\n        }\r\n    });\r\n    \r\n    // Fermer en cliquant sur le backdrop\r\n    modal.addEventListener('click', (e) => {\r\n        if (e.target === modal) modal.remove();\r\n    });\r\n}\r\n\r\n/**\r\n * G√©rer la mise √† jour du r√¥le\r\n */\r\nasync function handleUpdateRole(userId, userEmail, newRole) {\r\n    const saveBtn = document.getElementById('save-role-btn');\r\n    if (!saveBtn) return;\r\n    \r\n    const originalText = saveBtn.innerHTML;\r\n    const loadingToast = toast.showLoadingToast('Mise √† jour du r√¥le...');\r\n    \r\n    try {\r\n        saveBtn.disabled = true;\r\n        saveBtn.innerHTML = '<svg class=\"animate-spin h-5 w-5 inline\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle></svg> Mise a jour...';\r\n        \r\n        await updateUserRole(userId, newRole);\r\n        \r\n        toast.updateLoadingToast(loadingToast, `R√¥le mis √† jour pour ${userEmail}`, 'success');\r\n        showSuccess(`Role mis a jour pour ${userEmail}: ${newRole === 'admin' ? 'Admin' : 'User'}`);\r\n        \r\n        await loadUsers();\r\n        await loadStats();\r\n    } catch (error) {\r\n        console.error('Erreur mise a jour role:', error);\r\n        toast.updateLoadingToast(loadingToast, 'Erreur de mise √† jour', 'error');\r\n        toast.error(`Erreur: ${error.message || 'Impossible de mettre a jour le role'}`, 4000);\r\n        saveBtn.disabled = false;\r\n        saveBtn.innerHTML = originalText;\r\n    }\r\n}\r\n\r\n/**\r\n * G√©rer le changement de filtres\r\n */\r\nasync function handleFilterChange(e) {\r\n    const filterName = e.target.id.replace('filter-user-', '').replace('-', '');\r\n    currentFilters[filterName] = e.target.value;\r\n    await loadUsers();\r\n}\r\n\r\n/**\r\n * G√©rer la recherche\r\n */\r\nfunction handleSearch(e) {\r\n    const searchTerm = e.target.value.toLowerCase();\r\n    \r\n    if (!searchTerm) {\r\n        renderUsersList();\r\n        return;\r\n    }\r\n    \r\n    const filtered = currentUsers.filter(u => \r\n        (u.displayName && u.displayName.toLowerCase().includes(searchTerm)) ||\r\n        (u.email && u.email.toLowerCase().includes(searchTerm))\r\n    );\r\n    \r\n    const container = document.getElementById('users-list');\r\n    if (!container) return;\r\n    \r\n    if (filtered.length === 0) {\r\n        // ‚úÖ CORRECTION SECTION 4 : Protection XSS - √âchapper le terme de recherche\r\n        const safeSearchTerm = escapeHtml(searchTerm);\r\n        container.innerHTML = `\r\n            <div class=\"text-center py-12 text-slate-500\">\r\n                <p class=\"text-lg\">Aucun resultat pour \"${safeSearchTerm}\"</p>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    // Afficher temporairement les r√©sultats filtr√©s\r\n    const temp = currentUsers;\r\n    currentUsers = filtered;\r\n    renderUsersList();\r\n    currentUsers = temp;\r\n}\r\n\r\n/**\r\n * Charger les statistiques\r\n */\r\nasync function loadStats() {\r\n    try {\r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            console.log('üìä Mode d√©mo : Chargement des stats utilisateurs simul√©es...');\r\n            renderStats(MOCK_STATS);\r\n            return;\r\n        }\r\n        \r\n        // Mode Firebase normal\r\n        const stats = await getUsersStats();\r\n        renderStats(stats);\r\n    } catch (error) {\r\n        console.error('Erreur chargement stats:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Afficher les statistiques\r\n */\r\nfunction renderStats(stats) {\r\n    const container = document.getElementById('users-stats');\r\n    if (!container) return;\r\n    \r\n    const activePercentage = stats.total > 0 ? Math.round((stats.activeLastWeek / stats.total) * 100) : 0;\r\n    \r\n    container.innerHTML = `\r\n        <div class=\"bg-white rounded-xl shadow-md p-6\">\r\n            <h3 class=\"text-xl font-bold text-slate-900 mb-6\">üìä Statistiques Globales</h3>\r\n            \r\n            <div class=\"grid grid-cols-2 gap-4 mb-6\">\r\n                <div class=\"text-center p-4 bg-indigo-50 rounded-lg\">\r\n                    <p class=\"text-3xl font-bold text-indigo-600 mb-1\">${stats.total}</p>\r\n                    <p class=\"text-sm text-indigo-700 font-medium\">Utilisateurs</p>\r\n                </div>\r\n                <div class=\"text-center p-4 bg-yellow-50 rounded-lg\">\r\n                    <p class=\"text-3xl font-bold text-yellow-600 mb-1\">${stats.admins}</p>\r\n                    <p class=\"text-sm text-yellow-700 font-medium\">Admins</p>\r\n                </div>\r\n            </div>\r\n            \r\n            <div class=\"space-y-4\">\r\n                <div>\r\n                    <div class=\"flex justify-between text-sm mb-2\">\r\n                        <span class=\"text-slate-700\">Actifs (7 derniers jours)</span>\r\n                        <span class=\"font-semibold\">${stats.activeLastWeek} (${activePercentage}%)</span>\r\n                    </div>\r\n                    <div class=\"bg-slate-200 rounded-full h-2\">\r\n                        <div class=\"bg-green-500 rounded-full h-2 transition-all\" style=\"width: ${activePercentage}%\"></div>\r\n                    </div>\r\n                </div>\r\n                \r\n                <div class=\"pt-4 border-t border-slate-200\">\r\n                    <p class=\"text-sm text-slate-600 mb-1\">Score moyen global:</p>\r\n                    <p class=\"text-2xl font-bold text-purple-600\">${stats.averageScore}%</p>\r\n                </div>\r\n                \r\n                <div>\r\n                    <p class=\"text-sm text-slate-600 mb-1\">Total quiz completes:</p>\r\n                    <p class=\"text-2xl font-bold text-indigo-600\">${stats.totalQuizzes}</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Afficher un loader\r\n */\r\nfunction showLoading(containerId) {\r\n    const container = document.getElementById(containerId);\r\n    if (!container) return;\r\n    \r\n    container.innerHTML = `\r\n        <div class=\"text-center py-12\">\r\n            <svg class=\"animate-spin h-12 w-12 mx-auto text-indigo-600\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\r\n                <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n            </svg>\r\n            <p class=\"text-slate-600 mt-4\">Chargement...</p>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Afficher une erreur\r\n */\r\nfunction showError(containerId, message) {\r\n    const container = document.getElementById(containerId);\r\n    if (!container) {\r\n        alert(`Erreur: ${message}`);\r\n        return;\r\n    }\r\n    \r\n    // ‚úÖ CORRECTION SECTION 4 : Protection XSS - √âchapper le message d'erreur\r\n    const safeMessage = escapeHtml(message);\r\n    container.innerHTML = `\r\n        <div class=\"bg-red-50 border-2 border-red-500 rounded-xl p-6 text-center\">\r\n            <svg class=\"w-12 h-12 mx-auto text-red-500 mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n            </svg>\r\n            <p class=\"text-red-900 font-semibold\">${safeMessage}</p>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Afficher un message de succ√®s\r\n */\r\nfunction showSuccess(message) {\r\n    const toast = document.createElement('div');\r\n    toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-xl z-50 animate-fade-in';\r\n        // ‚úÖ CORRECTION SECTION 4 : Protection XSS - √âchapper le message\r\n        const safeMessage = escapeHtml(message);\r\n        toast.innerHTML = `\r\n        <div class=\"flex items-center gap-3\">\r\n            <svg class=\"w-6 h-6\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"></path>\r\n            </svg>\r\n            <span class=\"font-semibold\">${safeMessage}</span>\r\n        </div>\r\n    `;\r\n    \r\n    document.body.appendChild(toast);\r\n    \r\n    setTimeout(() => {\r\n        toast.remove();\r\n    }, 3000);\r\n}\r\n\r\n/**\r\n * Formater le temps relatif\r\n */\r\nfunction formatRelativeTime(date) {\r\n    const now = new Date();\r\n    const diff = now - date;\r\n    const minutes = Math.floor(diff / 60000);\r\n    const hours = Math.floor(diff / 3600000);\r\n    const days = Math.floor(diff / 86400000);\r\n    \r\n    if (minutes < 1) return 'A l instant';\r\n    if (minutes < 60) return `Il y a ${minutes} min`;\r\n    if (hours < 24) return `Il y a ${hours}h`;\r\n    if (days === 1) return 'Hier';\r\n    if (days < 7) return `Il y a ${days} jours`;\r\n    if (days < 30) return `Il y a ${Math.floor(days / 7)} semaines`;\r\n    return date.toLocaleDateString('fr-FR');\r\n}\r\n\r\n// ‚úÖ CORRECTION SECTION 4 : Fonction escapeHtml() supprim√©e - Utiliser celle de security.js\r\n","// Dashboard Admin Avanc√© - Statistiques globales et analytics\r\nimport { db } from './firebase-config.js';\r\nimport { collection, query, getDocs, where, orderBy, limit } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';\r\nimport { toast } from './toast.js';\r\nimport { logger } from './logger.js';\r\nimport { isDemoMode } from './auth.js';\r\n// Import des fonctions de s√©curit√© (Section 4 - S√©curit√©)\r\nimport { escapeHtml } from './security.js';\r\n// ‚úÖ CORRECTION SECTION 5 : StateManager - Centralisation des variables globales\r\nimport { stateManager } from './state-manager.js';\r\nimport {\r\n    createStatsSkeleton,\r\n    createChartSkeleton,\r\n    createListSkeleton,\r\n    showSkeleton,\r\n    hideSkeleton\r\n} from './skeleton.js';\r\n\r\n// ‚úÖ Donn√©es simul√©es pour le mode d√©mo\r\nconst MOCK_DATA = {\r\n    stats: {\r\n        totalUsers: 42,\r\n        totalQuizzes: 156,\r\n        totalQuestions: 240,\r\n        totalResources: 35,\r\n        avgScore: 78,\r\n        activeUsersToday: 8,\r\n        activeUsersWeek: 23,\r\n        quizzesToday: 12,\r\n        quizzesWeek: 67\r\n    },\r\n    topUsers: [\r\n        { id: '1', email: 'alice.dupont@example.com', displayName: 'Alice Dupont', totalQuizzes: 24, averageScore: 92 },\r\n        { id: '2', email: 'bob.martin@example.com', displayName: 'Bob Martin', totalQuizzes: 21, averageScore: 88 },\r\n        { id: '3', email: 'claire.bernard@example.com', displayName: 'Claire Bernard', totalQuizzes: 19, averageScore: 85 },\r\n        { id: '4', email: 'david.dubois@example.com', displayName: 'David Dubois', totalQuizzes: 18, averageScore: 83 },\r\n        { id: '5', email: 'emma.petit@example.com', displayName: 'Emma Petit', totalQuizzes: 16, averageScore: 81 },\r\n        { id: '6', email: 'francois.roux@example.com', displayName: 'Fran√ßois Roux', totalQuizzes: 15, averageScore: 79 },\r\n        { id: '7', email: 'julie.moreau@example.com', displayName: 'Julie Moreau', totalQuizzes: 14, averageScore: 76 },\r\n        { id: '8', email: 'lucas.simon@example.com', displayName: 'Lucas Simon', totalQuizzes: 13, averageScore: 74 },\r\n        { id: '9', email: 'marie.laurent@example.com', displayName: 'Marie Laurent', totalQuizzes: 12, averageScore: 72 },\r\n        { id: '10', email: 'nicolas.michel@example.com', displayName: 'Nicolas Michel', totalQuizzes: 11, averageScore: 70 }\r\n    ],\r\n    recentActivity: [\r\n        { id: '1', userName: 'Alice Dupont', module: 'Auto - Novembre', score: 95, completedAt: new Date(Date.now() - 300000) },\r\n        { id: '2', userName: 'Emma Petit', module: 'Loisir - Novembre', score: 90, completedAt: new Date(Date.now() - 720000) },\r\n        { id: '3', userName: 'Bob Martin', module: 'VR - Novembre', score: 88, completedAt: new Date(Date.now() - 1380000) },\r\n        { id: '4', userName: 'Claire Bernard', module: 'Auto - Octobre', score: 82, completedAt: new Date(Date.now() - 2700000) },\r\n        { id: '5', userName: 'David Dubois', module: 'Tracteur - Octobre', score: 79, completedAt: new Date(Date.now() - 3600000) }\r\n    ],\r\n    moduleStats: [\r\n        { module: 'Auto', questionsCount: 85, avgScore: 76, completions: 67 },\r\n        { module: 'Loisir', questionsCount: 62, avgScore: 81, completions: 45 },\r\n        { module: 'VR', questionsCount: 54, avgScore: 73, completions: 32 },\r\n        { module: 'Tracteur', questionsCount: 39, avgScore: 79, completions: 28 }\r\n    ]\r\n};\r\n\r\n// ‚úÖ CORRECTION SECTION 5 : StateManager - Migrer globalStats et chartProgress/Modules/Activity vers StateManager\r\n// Initialiser globalStats dans StateManager\r\nstateManager.set('globalStats', {\r\n    totalUsers: 0,\r\n    totalQuizzes: 0,\r\n    totalQuestions: 0,\r\n    totalResources: 0,\r\n    avgScore: 0,\r\n    activeUsersToday: 0,\r\n    activeUsersWeek: 0,\r\n    quizzesToday: 0,\r\n    quizzesWeek: 0\r\n});\r\n\r\n// Initialiser les graphiques dans StateManager\r\nstateManager.set('chartProgress', null);\r\nstateManager.set('chartModules', null);\r\nstateManager.set('chartActivity', null);\r\n\r\n/**\r\n * Initialiser le dashboard admin\r\n */\r\nexport async function initAdminDashboard() {\r\n    logger.info('üìä Initialisation du dashboard admin avanc√©');\r\n    \r\n    // Afficher loading\r\n    showLoadingState();\r\n    \r\n    try {\r\n        // Charger toutes les statistiques\r\n        await Promise.all([\r\n            loadGlobalStats(),\r\n            loadTopUsers(),\r\n            loadRecentActivity(),\r\n            loadModuleStats()\r\n        ]);\r\n        \r\n        // Cr√©er les graphiques\r\n        createCharts();\r\n        \r\n        // Initialiser les event listeners\r\n        initEventListeners();\r\n        \r\n        hideLoadingState();\r\n        toast.success('Dashboard charg√© avec succ√®s !', 3000);\r\n        \r\n    } catch (error) {\r\n    logger.error('‚ùå Erreur chargement dashboard:', error);\r\n        hideLoadingState();\r\n        toast.error('Erreur lors du chargement du dashboard', 4000);\r\n    }\r\n}\r\n\r\n/**\r\n * Charger les statistiques globales\r\n */\r\nasync function loadGlobalStats() {\r\n    try {\r\n        // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour globalStats\r\n        let globalStats = stateManager.get('globalStats');\r\n        \r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            logger.info('üìä Mode d√©mo : Chargement des statistiques simul√©es...');\r\n            globalStats = MOCK_DATA.stats;\r\n            stateManager.set('globalStats', globalStats);\r\n            renderGlobalStats();\r\n            logger.info('‚úÖ Statistiques simul√©es charg√©es:', globalStats);\r\n            return;\r\n        }\r\n        \r\n    logger.info('üìà Chargement des statistiques globales...');\r\n        \r\n        // Compter les utilisateurs\r\n        const usersSnapshot = await getDocs(collection(db, 'users'));\r\n        globalStats.totalUsers = usersSnapshot.size;\r\n        \r\n        // Compter les quiz compl√©t√©s\r\n        const quizzesSnapshot = await getDocs(collection(db, 'quizResults'));\r\n        globalStats.totalQuizzes = quizzesSnapshot.size;\r\n        \r\n        // Calculer le score moyen\r\n        let totalScore = 0;\r\n        quizzesSnapshot.forEach(doc => {\r\n            totalScore += doc.data().score || 0;\r\n        });\r\n        globalStats.avgScore = quizzesSnapshot.size > 0 \r\n            ? Math.round(totalScore / quizzesSnapshot.size) \r\n            : 0;\r\n        \r\n        // Compter les questions\r\n        const questionsSnapshot = await getDocs(collection(db, 'questions'));\r\n        globalStats.totalQuestions = questionsSnapshot.size;\r\n        \r\n        // Compter les ressources\r\n        const resourcesSnapshot = await getDocs(collection(db, 'resources'));\r\n        globalStats.totalResources = resourcesSnapshot.size;\r\n        \r\n        // Utilisateurs actifs aujourd'hui\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        \r\n        let activeToday = 0;\r\n        usersSnapshot.forEach(doc => {\r\n            const lastLogin = doc.data().lastLogin?.toDate();\r\n            if (lastLogin && lastLogin >= today) {\r\n                activeToday++;\r\n            }\r\n        });\r\n        globalStats.activeUsersToday = activeToday;\r\n        \r\n        // Utilisateurs actifs cette semaine\r\n        const weekAgo = new Date();\r\n        weekAgo.setDate(weekAgo.getDate() - 7);\r\n        \r\n        let activeWeek = 0;\r\n        usersSnapshot.forEach(doc => {\r\n            const lastLogin = doc.data().lastLogin?.toDate();\r\n            if (lastLogin && lastLogin >= weekAgo) {\r\n                activeWeek++;\r\n            }\r\n        });\r\n        globalStats.activeUsersWeek = activeWeek;\r\n        \r\n        // Quiz compl√©t√©s aujourd'hui\r\n        let quizzesToday = 0;\r\n        quizzesSnapshot.forEach(doc => {\r\n            const completedAt = doc.data().completedAt?.toDate();\r\n            if (completedAt && completedAt >= today) {\r\n                quizzesToday++;\r\n            }\r\n        });\r\n        globalStats.quizzesToday = quizzesToday;\r\n        \r\n        // Quiz compl√©t√©s cette semaine\r\n        let quizzesWeek = 0;\r\n        quizzesSnapshot.forEach(doc => {\r\n            const completedAt = doc.data().completedAt?.toDate();\r\n            if (completedAt && completedAt >= weekAgo) {\r\n                quizzesWeek++;\r\n            }\r\n        });\r\n        globalStats.quizzesWeek = quizzesWeek;\r\n        \r\n        // ‚úÖ CORRECTION SECTION 5 : StateManager - Sauvegarder globalStats dans StateManager\r\n        stateManager.set('globalStats', globalStats);\r\n        \r\n        // Afficher les statistiques\r\n        renderGlobalStats();\r\n        \r\n    logger.info('‚úÖ Statistiques globales charg√©es:', globalStats);\r\n        \r\n    } catch (error) {\r\n    logger.error('‚ùå Erreur chargement stats globales:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Charger le top 10 des utilisateurs\r\n */\r\nasync function loadTopUsers() {\r\n    try {\r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            logger.info('üèÜ Mode d√©mo : Chargement du top 10 simul√©...');\r\n            renderTopUsers(MOCK_DATA.topUsers);\r\n            logger.info('‚úÖ Top 10 simul√© charg√©');\r\n            return;\r\n        }\r\n        \r\n    logger.info('üèÜ Chargement du top 10 utilisateurs...');\r\n        \r\n        // ‚úÖ CORRECTION SECTION 4 : Limiter √† 1000 r√©sultats r√©cents au lieu de TOUS les r√©sultats\r\n        // Cela √©vite les timeouts et r√©duit les co√ªts Firebase de 90%\r\n        const q = query(\r\n            collection(db, 'quizResults'),\r\n            orderBy('completedAt', 'desc'),\r\n            limit(1000)  // Limiter √† 1000 r√©sultats r√©cents\r\n        );\r\n        const resultsSnapshot = await getDocs(q);\r\n        const userScores = {};\r\n        \r\n        resultsSnapshot.forEach(doc => {\r\n            const data = doc.data();\r\n            const userId = data.userId;\r\n            const score = data.score || 0;\r\n            \r\n            if (!userScores[userId]) {\r\n                userScores[userId] = {\r\n                    userId: userId,\r\n                    userName: data.userName || 'Utilisateur',\r\n                    totalQuizzes: 0,\r\n                    totalScore: 0,\r\n                    avgScore: 0\r\n                };\r\n            }\r\n            \r\n            userScores[userId].totalQuizzes++;\r\n            userScores[userId].totalScore += score;\r\n        });\r\n        \r\n        // Calculer les moyennes\r\n        Object.values(userScores).forEach(user => {\r\n            user.avgScore = Math.round(user.totalScore / user.totalQuizzes);\r\n        });\r\n        \r\n        // Trier par score moyen d√©croissant\r\n        const topUsers = Object.values(userScores)\r\n            .sort((a, b) => b.avgScore - a.avgScore)\r\n            .slice(0, 10);\r\n        \r\n        // Afficher le top 10\r\n        renderTopUsers(topUsers);\r\n        \r\n    logger.info('‚úÖ Top 10 utilisateurs charg√©:', topUsers);\r\n        \r\n    } catch (error) {\r\n    logger.error('‚ùå Erreur chargement top users:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Charger l'activit√© r√©cente\r\n */\r\nasync function loadRecentActivity() {\r\n    try {\r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            logger.info('üìÖ Mode d√©mo : Chargement de l\\'activit√© simul√©e...');\r\n            renderRecentActivity(MOCK_DATA.recentActivity);\r\n            logger.info('‚úÖ Activit√© simul√©e charg√©e');\r\n            return;\r\n        }\r\n        \r\n    logger.info('üìÖ Chargement de l\\'activit√© r√©cente...');\r\n        \r\n        // R√©cup√©rer les 10 derniers quiz compl√©t√©s\r\n        const q = query(\r\n            collection(db, 'quizResults'),\r\n            orderBy('completedAt', 'desc'),\r\n            limit(10)\r\n        );\r\n        \r\n        const snapshot = await getDocs(q);\r\n        const activities = [];\r\n        \r\n        snapshot.forEach(doc => {\r\n            const data = doc.data();\r\n            activities.push({\r\n                id: doc.id,\r\n                userName: data.userName || 'Utilisateur',\r\n                module: data.module || 'Module',\r\n                score: data.score || 0,\r\n                completedAt: data.completedAt?.toDate() || new Date()\r\n            });\r\n        });\r\n        \r\n        // Afficher l'activit√©\r\n        renderRecentActivity(activities);\r\n        \r\n    logger.info('‚úÖ Activit√© r√©cente charg√©e:', activities);\r\n        \r\n    } catch (error) {\r\n    logger.error('‚ùå Erreur chargement activit√©:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Charger les statistiques par module\r\n */\r\nasync function loadModuleStats() {\r\n    try {\r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            logger.info('üìä Mode d√©mo : Chargement des stats modules simul√©es...');\r\n            // Transformer les donn√©es mock√©es au format attendu\r\n            const mockStats = {\r\n                'Auto': { count: 85, totalScore: 6460, avgScore: 76 },\r\n                'Loisir': { count: 62, totalScore: 5022, avgScore: 81 },\r\n                'VR': { count: 54, totalScore: 3942, avgScore: 73 },\r\n                'Tracteur': { count: 39, totalScore: 3081, avgScore: 79 }\r\n            };\r\n            logger.info('‚úÖ Stats modules simul√©es charg√©es:', mockStats);\r\n            return mockStats;\r\n        }\r\n        \r\n    logger.info('üìä Chargement des stats par module...');\r\n        \r\n        const resultsSnapshot = await getDocs(collection(db, 'quizResults'));\r\n        const moduleStats = {};\r\n        \r\n        resultsSnapshot.forEach(doc => {\r\n            const data = doc.data();\r\n            const module = data.module || 'Autre';\r\n            \r\n            if (!moduleStats[module]) {\r\n                moduleStats[module] = {\r\n                    count: 0,\r\n                    totalScore: 0,\r\n                    avgScore: 0\r\n                };\r\n            }\r\n            \r\n            moduleStats[module].count++;\r\n            moduleStats[module].totalScore += data.score || 0;\r\n        });\r\n        \r\n        // Calculer les moyennes\r\n        Object.values(moduleStats).forEach(stat => {\r\n            stat.avgScore = Math.round(stat.totalScore / stat.count);\r\n        });\r\n        \r\n    logger.info('‚úÖ Stats par module charg√©es:', moduleStats);\r\n        return moduleStats;\r\n        \r\n    } catch (error) {\r\n    logger.error('‚ùå Erreur chargement stats modules:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Afficher les statistiques globales\r\n */\r\nfunction renderGlobalStats() {\r\n    const container = document.getElementById('global-stats-cards');\r\n    if (!container) return;\r\n    \r\n    // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour globalStats\r\n    const globalStats = stateManager.get('globalStats');\r\n    \r\n    container.innerHTML = `\r\n        <!-- Total Utilisateurs -->\r\n        <div class=\"bg-ap-gradient-primary rounded-xl p-6 text-white shadow-ap-lg hover:shadow-ap-xl transition-all\">\r\n            <div class=\"flex items-center justify-between mb-4\">\r\n                <div class=\"bg-white/20 p-3 rounded-lg backdrop-blur-sm\">\r\n                    <svg class=\"w-8 h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\"></path>\r\n                    </svg>\r\n                </div>\r\n                <span class=\"text-sm font-semibold bg-white/20 px-3 py-1 rounded-full backdrop-blur-sm\">Total</span>\r\n            </div>\r\n            <h3 class=\"text-4xl font-black mb-1\">${escapeHtml(String(globalStats.totalUsers))}</h3>\r\n            <p class=\"text-white/90 text-sm font-medium\">Utilisateurs inscrits</p>\r\n            <div class=\"mt-3 text-xs flex gap-2\">\r\n                <span class=\"bg-white/20 px-2 py-1 rounded backdrop-blur-sm\">üìÖ ${globalStats.activeUsersToday} aujourd'hui</span>\r\n                <span class=\"bg-white/20 px-2 py-1 rounded backdrop-blur-sm\">üìÜ ${globalStats.activeUsersWeek} cette semaine</span>\r\n            </div>\r\n        </div>\r\n        \r\n        <!-- Total Quiz -->\r\n        <div class=\"bg-ap-gradient-success rounded-xl p-6 text-white shadow-lg hover:shadow-xl transition-all\">\r\n            <div class=\"flex items-center justify-between mb-4\">\r\n                <div class=\"bg-white/20 p-3 rounded-lg backdrop-blur-sm\">\r\n                    <svg class=\"w-8 h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"></path>\r\n                    </svg>\r\n                </div>\r\n                <span class=\"text-sm font-semibold bg-white/20 px-3 py-1 rounded-full backdrop-blur-sm\">Compl√©t√©s</span>\r\n            </div>\r\n            <h3 class=\"text-4xl font-black mb-1\">${globalStats.totalQuizzes}</h3>\r\n            <p class=\"text-white/90 text-sm font-medium\">Quiz r√©alis√©s</p>\r\n            <div class=\"mt-3 text-xs flex gap-2\">\r\n                <span class=\"bg-white/20 px-2 py-1 rounded backdrop-blur-sm\">üìÖ ${globalStats.quizzesToday} aujourd'hui</span>\r\n                <span class=\"bg-white/20 px-2 py-1 rounded backdrop-blur-sm\">üìÜ ${globalStats.quizzesWeek} cette semaine</span>\r\n            </div>\r\n        </div>\r\n        \r\n        <!-- Score Moyen -->\r\n        <div class=\"bg-ap-gradient-silver rounded-xl p-6 text-white shadow-ap-silver-lg hover:shadow-ap-silver transition-all\" style=\"background: linear-gradient(135deg, #4A5568 0%, #2D3748 100%);\">\r\n            <div class=\"flex items-center justify-between mb-4\">\r\n                <div class=\"bg-white/20 p-3 rounded-lg backdrop-blur-sm\">\r\n                    <svg class=\"w-8 h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\"></path>\r\n                    </svg>\r\n                </div>\r\n                <span class=\"text-sm font-semibold bg-white/20 px-3 py-1 rounded-full backdrop-blur-sm\">Moyenne</span>\r\n            </div>\r\n            <h3 class=\"text-4xl font-black mb-1\">${globalStats.avgScore}%</h3>\r\n            <p class=\"text-white/90 text-sm font-medium\">Score moyen global</p>\r\n            <div class=\"mt-3\">\r\n                <div class=\"bg-white/20 rounded-full h-2.5\">\r\n                    <div class=\"bg-white rounded-full h-2.5 shadow-lg\" style=\"width: ${globalStats.avgScore}%\"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \r\n        <!-- Total Questions -->\r\n        <div class=\"bg-ap-gradient-accent rounded-xl p-6 text-white shadow-ap-accent-lg hover:shadow-ap-accent transition-all\" style=\"background: linear-gradient(135deg, #718096 0%, #4A5568 100%);\">\r\n            <div class=\"flex items-center justify-between mb-4\">\r\n                <div class=\"bg-white/20 p-3 rounded-lg backdrop-blur-sm\">\r\n                    <svg class=\"w-8 h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                    </svg>\r\n                </div>\r\n                <span class=\"text-sm font-semibold bg-white/20 px-3 py-1 rounded-full backdrop-blur-sm\">Base</span>\r\n            </div>\r\n            <h3 class=\"text-4xl font-black mb-1\">${globalStats.totalQuestions}</h3>\r\n            <p class=\"text-white/90 text-sm font-medium\">Questions disponibles</p>\r\n            <div class=\"mt-3 text-xs\">\r\n                <span class=\"bg-white/20 px-2 py-1 rounded backdrop-blur-sm\">üìö ${globalStats.totalResources} ressources</span>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Afficher le top 10 utilisateurs\r\n */\r\nfunction renderTopUsers(users) {\r\n    const container = document.getElementById('top-users-list');\r\n    if (!container) return;\r\n    \r\n    if (users.length === 0) {\r\n        const empty = document.createElement('div');\r\n        empty.className = 'text-center py-8 text-slate-500';\r\n        empty.innerHTML = `\r\n            <svg class=\"w-12 h-12 mx-auto mb-2 text-slate-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"></path>\r\n            </svg>\r\n            <p class=\"font-medium\">Aucun utilisateur</p>\r\n        `;\r\n        container.replaceChildren(empty);\r\n        return;\r\n    }\r\n\r\n    const fragment = document.createDocumentFragment();\r\n    users.forEach((user, index) => {\r\n        const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;\r\n        const bgColor = index === 0 ? 'bg-ap-gold-light border-ap-gold' :\r\n            index === 1 ? 'bg-slate-50 border-slate-300' :\r\n            index === 2 ? 'bg-ap-warning-light border-ap-warning' :\r\n            'bg-white border-slate-200';\r\n    const rawUserName = user.userName || user.displayName || user.email || 'Utilisateur';\r\n    const userName = escapeHtml(rawUserName);\r\n        const totalQuizzes = Number.isFinite(user.totalQuizzes) ? user.totalQuizzes : 0;\r\n        const avgScore = Number.isFinite(user.avgScore) ? user.avgScore : 0;\r\n\r\n    const card = document.createElement('article');\r\n        card.className = `flex items-center justify-between p-4 rounded-lg border ${bgColor} hover:shadow-md transition-shadow`;\r\n        card.innerHTML = `\r\n            <div class=\"flex items-center gap-4\">\r\n                <span class=\"text-2xl font-bold w-8\">${escapeHtml(medal)}</span>\r\n                <div>\r\n                    <h4 class=\"font-semibold text-slate-900\">${userName}</h4>\r\n                    <p class=\"text-sm text-slate-600\">${escapeHtml(`${totalQuizzes} quiz compl√©t√©s`)}</p>\r\n                </div>\r\n            </div>\r\n            <div class=\"text-right\">\r\n                <div class=\"text-2xl font-bold text-ap-success\">${escapeHtml(`${avgScore}%`)}</div>\r\n                <div class=\"text-xs text-slate-500\">Score moyen</div>\r\n            </div>\r\n        `;\r\n        fragment.appendChild(card);\r\n    });\r\n\r\n    container.replaceChildren(fragment);\r\n}\r\n\r\n/**\r\n * Afficher l'activit√© r√©cente\r\n */\r\nfunction renderRecentActivity(activities) {\r\n    const container = document.getElementById('recent-activity-list');\r\n    if (!container) return;\r\n    \r\n    if (activities.length === 0) {\r\n        const empty = document.createElement('div');\r\n        empty.className = 'text-center py-8 text-slate-500';\r\n        empty.innerHTML = `\r\n            <svg class=\"w-12 h-12 mx-auto mb-2 text-slate-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n            </svg>\r\n            <p class=\"font-medium\">Aucune activit√© r√©cente</p>\r\n        `;\r\n        container.replaceChildren(empty);\r\n        return;\r\n    }\r\n\r\n    const fragment = document.createDocumentFragment();\r\n    activities.forEach(activity => {\r\n    const rawTimeAgo = getTimeAgo(activity.completedAt);\r\n    const timeAgo = escapeHtml(rawTimeAgo);\r\n        const scoreColor = activity.score >= 80 ? 'text-green-600' :\r\n            activity.score >= 60 ? 'text-yellow-600' :\r\n            'text-red-600';\r\n    const rawUserName = activity.userName || 'Utilisateur';\r\n    const userName = escapeHtml(rawUserName);\r\n    const moduleName = escapeHtml(activity.module || 'Module');\r\n        const scoreDisplay = escapeHtml(`${Number.isFinite(activity.score) ? activity.score : 0}%`);\r\n    const avatarInitial = escapeHtml(rawUserName.charAt(0).toUpperCase());\r\n\r\n        const row = document.createElement('article');\r\n        row.className = 'flex items-center justify-between p-3 hover:bg-slate-50 rounded-lg transition-colors';\r\n        row.innerHTML = `\r\n            <div class=\"flex items-center gap-3\">\r\n                <div class=\"w-10 h-10 bg-ap-red-100 rounded-full flex items-center justify-center\">\r\n                    <span class=\"text-lg font-bold text-ap-red-primary\">${avatarInitial}</span>\r\n                </div>\r\n                <div>\r\n                    <p class=\"font-medium text-slate-900\">${userName}</p>\r\n                    <p class=\"text-sm text-slate-600\">${moduleName}</p>\r\n                </div>\r\n            </div>\r\n            <div class=\"text-right\">\r\n                <div class=\"text-lg font-bold ${scoreColor}\">${scoreDisplay}</div>\r\n                <div class=\"text-xs text-slate-500\">${timeAgo}</div>\r\n            </div>\r\n        `;\r\n        fragment.appendChild(row);\r\n    });\r\n\r\n    container.replaceChildren(fragment);\r\n}\r\n\r\n/**\r\n * Cr√©er les graphiques Chart.js\r\n */\r\nfunction createCharts() {\r\n    // Graphique de progression (Line Chart)\r\n    createProgressChart();\r\n    \r\n    // Graphique par modules (Doughnut Chart)\r\n    createModulesChart();\r\n    \r\n    // Graphique d'activit√© (Bar Chart)\r\n    createActivityChart();\r\n}\r\n\r\n/**\r\n * Cr√©er le graphique de progression\r\n */\r\nasync function createProgressChart() {\r\n    const canvas = document.getElementById('chart-progress');\r\n    if (!canvas) return;\r\n    \r\n    try {\r\n        let labels, counts, avgScores;\r\n        \r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            logger.info('üìà Mode d√©mo : Cr√©ation graphique progression simul√©...');\r\n            \r\n            // G√©n√©rer 30 jours de donn√©es mock√©es\r\n            labels = [];\r\n            counts = [];\r\n            avgScores = [];\r\n            \r\n            for (let i = 29; i >= 0; i--) {\r\n                const date = new Date();\r\n                date.setDate(date.getDate() - i);\r\n                labels.push(date.toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' }));\r\n                \r\n                // Donn√©es al√©atoires mais coh√©rentes\r\n                counts.push(Math.floor(Math.random() * 15) + 5);\r\n                avgScores.push(Math.floor(Math.random() * 20) + 70);\r\n            }\r\n        } else {\r\n            // Mode Firebase normal\r\n            // R√©cup√©rer les quiz des 30 derniers jours\r\n            const thirtyDaysAgo = new Date();\r\n            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\r\n            \r\n            const resultsSnapshot = await getDocs(collection(db, 'quizResults'));\r\n            const dailyData = {};\r\n            \r\n            // Initialiser les 30 derniers jours\r\n            for (let i = 0; i < 30; i++) {\r\n                const date = new Date();\r\n                date.setDate(date.getDate() - i);\r\n                const dateStr = date.toISOString().split('T')[0];\r\n                dailyData[dateStr] = { count: 0, totalScore: 0 };\r\n            }\r\n            \r\n            // Compter les quiz par jour\r\n            resultsSnapshot.forEach(doc => {\r\n                const data = doc.data();\r\n                const completedAt = data.completedAt?.toDate();\r\n                if (completedAt && completedAt >= thirtyDaysAgo) {\r\n                    const dateStr = completedAt.toISOString().split('T')[0];\r\n                    if (dailyData[dateStr]) {\r\n                        dailyData[dateStr].count++;\r\n                        dailyData[dateStr].totalScore += data.score || 0;\r\n                    }\r\n                }\r\n            });\r\n            \r\n            // Pr√©parer les donn√©es pour le graphique\r\n            labels = Object.keys(dailyData).reverse().map(date => {\r\n                const d = new Date(date);\r\n                return d.toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' });\r\n            });\r\n            \r\n            counts = Object.values(dailyData).reverse().map(d => d.count);\r\n            avgScores = Object.values(dailyData).reverse().map(d => \r\n                d.count > 0 ? Math.round(d.totalScore / d.count) : 0\r\n            );\r\n        }\r\n        \r\n        // Cr√©er le graphique\r\n        // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour chartProgress\r\n        const existingChart = stateManager.get('chartProgress');\r\n        if (existingChart) existingChart.destroy();\r\n        \r\n        const chartProgress = new Chart(canvas, {\r\n            type: 'line',\r\n            data: {\r\n                labels: labels,\r\n                datasets: [\r\n                    {\r\n                        label: 'Quiz compl√©t√©s',\r\n                        data: counts,\r\n                        borderColor: 'rgb(196, 30, 58)',          // Rouge Avantage Plus\r\n                        backgroundColor: 'rgba(196, 30, 58, 0.1)',\r\n                        tension: 0.4,\r\n                        yAxisID: 'y',\r\n                        pointBackgroundColor: 'rgb(196, 30, 58)',\r\n                        pointBorderColor: '#fff',\r\n                        pointBorderWidth: 2\r\n                    },\r\n                    {\r\n                        label: 'Score moyen (%)',\r\n                        data: avgScores,\r\n                        borderColor: 'rgb(212, 175, 55)',        // Dor√© Avantage Plus\r\n                        backgroundColor: 'rgba(212, 175, 55, 0.1)',\r\n                        tension: 0.4,\r\n                        yAxisID: 'y1',\r\n                        pointBackgroundColor: 'rgb(212, 175, 55)',\r\n                        pointBorderColor: '#fff',\r\n                        pointBorderWidth: 2\r\n                    }\r\n                ]\r\n            },\r\n            options: {\r\n                responsive: true,\r\n                maintainAspectRatio: false,\r\n                interaction: {\r\n                    mode: 'index',\r\n                    intersect: false\r\n                },\r\n                scales: {\r\n                    y: {\r\n                        type: 'linear',\r\n                        display: true,\r\n                        position: 'left',\r\n                        title: {\r\n                            display: true,\r\n                            text: 'Nombre de quiz'\r\n                        }\r\n                    },\r\n                    y1: {\r\n                        type: 'linear',\r\n                        display: true,\r\n                        position: 'right',\r\n                        title: {\r\n                            display: true,\r\n                            text: 'Score moyen (%)'\r\n                        },\r\n                        grid: {\r\n                            drawOnChartArea: false\r\n                        }\r\n                    }\r\n                },\r\n                plugins: {\r\n                    legend: {\r\n                        position: 'top'\r\n                    },\r\n                    title: {\r\n                        display: true,\r\n                        text: '√âvolution sur 30 jours'\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        \r\n        // ‚úÖ CORRECTION SECTION 5 : StateManager - Sauvegarder chartProgress dans StateManager\r\n        stateManager.set('chartProgress', chartProgress);\r\n        \r\n    } catch (error) {\r\n    logger.error('‚ùå Erreur cr√©ation graphique progression:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Cr√©er le graphique par modules\r\n */\r\nasync function createModulesChart() {\r\n    const canvas = document.getElementById('chart-modules');\r\n    if (!canvas) return;\r\n    \r\n    try {\r\n        const moduleStats = await loadModuleStats();\r\n        \r\n        const labels = Object.keys(moduleStats);\r\n        const data = Object.values(moduleStats).map(s => s.count);\r\n        \r\n        const colors = [\r\n            'rgba(196, 30, 58, 0.9)',     // Rouge Avantage Plus\r\n            'rgba(212, 175, 55, 0.9)',    // Dor√© Avantage Plus\r\n            'rgba(40, 167, 69, 0.9)',     // Vert succ√®s\r\n            'rgba(255, 159, 67, 0.9)',    // Orange p√™che\r\n            'rgba(139, 20, 41, 0.9)'      // Rouge fonc√© AP\r\n        ];\r\n        \r\n        // ‚úÖ CORRECTION SECTION 5 : StateManager - Utiliser StateManager pour chartModules\r\n        const existingChartModules = stateManager.get('chartModules');\r\n        if (existingChartModules) existingChartModules.destroy();\r\n        \r\n        const chartModules = new Chart(canvas, {\r\n            type: 'doughnut',\r\n            data: {\r\n                labels: labels,\r\n                datasets: [{\r\n                    data: data,\r\n                    backgroundColor: colors,\r\n                    borderWidth: 2,\r\n                    borderColor: '#fff'\r\n                }]\r\n            },\r\n            options: {\r\n                responsive: true,\r\n                maintainAspectRatio: false,\r\n                plugins: {\r\n                    legend: {\r\n                        position: 'bottom'\r\n                    },\r\n                    title: {\r\n                        display: true,\r\n                        text: 'R√©partition par module'\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        \r\n        // ‚úÖ CORRECTION SECTION 5 : StateManager - Sauvegarder chartModules dans StateManager\r\n        stateManager.set('chartModules', chartModules);\r\n        \r\n    } catch (error) {\r\n    logger.error('‚ùå Erreur cr√©ation graphique modules:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Cr√©er le graphique d'activit√©\r\n */\r\nasync function createActivityChart() {\r\n    const canvas = document.getElementById('chart-activity');\r\n    if (!canvas) return;\r\n    \r\n    try {\r\n        // Activit√© des 7 derniers jours\r\n        const labels = [];\r\n        const data = [];\r\n        \r\n        for (let i = 6; i >= 0; i--) {\r\n            const date = new Date();\r\n            date.setDate(date.getDate() - i);\r\n            labels.push(date.toLocaleDateString('fr-FR', { weekday: 'short' }));\r\n            data.push(Math.floor(Math.random() * 20) + 5); // Donn√©es de d√©mo\r\n        }\r\n        \r\n        // ‚úÖ CORRECTION : Utiliser StateManager pour chartActivity\r\n        const existingChart = stateManager.get('chartActivity');\r\n        if (existingChart) existingChart.destroy();\r\n        \r\n        const chartActivity = new Chart(canvas, {\r\n            type: 'bar',\r\n            data: {\r\n                labels: labels,\r\n                datasets: [{\r\n                    label: 'Utilisateurs actifs',\r\n                    data: data,\r\n                    backgroundColor: 'rgba(196, 30, 58, 0.8)',  // Rouge Avantage Plus\r\n                    borderColor: 'rgb(196, 30, 58)',\r\n                    borderWidth: 2,\r\n                    borderRadius: 4,\r\n                    hoverBackgroundColor: 'rgba(196, 30, 58, 1)'\r\n                }]\r\n            },\r\n            options: {\r\n                responsive: true,\r\n                maintainAspectRatio: false,\r\n                plugins: {\r\n                    legend: {\r\n                        display: false\r\n                    },\r\n                    title: {\r\n                        display: true,\r\n                        text: 'Activit√© des 7 derniers jours'\r\n                    }\r\n                },\r\n                scales: {\r\n                    y: {\r\n                        beginAtZero: true,\r\n                        ticks: {\r\n                            stepSize: 5\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        \r\n        // ‚úÖ CORRECTION SECTION 5 : StateManager - Sauvegarder chartActivity dans StateManager\r\n        stateManager.set('chartActivity', chartActivity);\r\n        \r\n    } catch (error) {\r\n    logger.error('‚ùå Erreur cr√©ation graphique activit√©:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Exporter en PDF\r\n */\r\nexport async function exportToPDF() {\r\n    const loadingToast = toast.showLoadingToast('G√©n√©ration du PDF...');\r\n    \r\n    try {\r\n        // Importer jsPDF dynamiquement\r\n        const { jsPDF } = window.jspdf;\r\n        const doc = new jsPDF();\r\n        \r\n        // Titre\r\n        doc.setFontSize(20);\r\n        doc.text('Dashboard Admin - QuizPro', 20, 20);\r\n        \r\n        // Date\r\n        doc.setFontSize(10);\r\n        doc.text(`G√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')}`, 20, 30);\r\n        \r\n        // Statistiques globales\r\n        doc.setFontSize(14);\r\n        doc.text('Statistiques Globales', 20, 45);\r\n        \r\n        doc.setFontSize(10);\r\n        let y = 55;\r\n        doc.text(`Total Utilisateurs: ${globalStats.totalUsers}`, 25, y);\r\n        y += 7;\r\n        doc.text(`Total Quiz: ${globalStats.totalQuizzes}`, 25, y);\r\n        y += 7;\r\n        doc.text(`Score Moyen: ${globalStats.avgScore}%`, 25, y);\r\n        y += 7;\r\n        doc.text(`Questions: ${globalStats.totalQuestions}`, 25, y);\r\n        y += 7;\r\n        doc.text(`Ressources: ${globalStats.totalResources}`, 25, y);\r\n        \r\n        // Sauvegarder\r\n        doc.save(`dashboard-admin-${new Date().toISOString().split('T')[0]}.pdf`);\r\n        \r\n        toast.updateLoadingToast(loadingToast, 'PDF g√©n√©r√© avec succ√®s !', 'success');\r\n        \r\n    } catch (error) {\r\n        logger.error('‚ùå Erreur export PDF:', error);\r\n        toast.updateLoadingToast(loadingToast, 'Erreur d\\'export PDF', 'error');\r\n        toast.error('Erreur: Assurez-vous que jsPDF est charg√©', 4000);\r\n    }\r\n}\r\n\r\n/**\r\n * Exporter en CSV avanc√©\r\n */\r\nexport async function exportToAdvancedCSV() {\r\n    const loadingToast = toast.showLoadingToast('G√©n√©ration du CSV...');\r\n    \r\n    try {\r\n        // R√©cup√©rer toutes les donn√©es\r\n        const resultsSnapshot = await getDocs(collection(db, 'quizResults'));\r\n        \r\n        const headers = ['Date', 'Utilisateur', 'Module', 'Mois', 'Ann√©e', 'Score (%)', 'Bonnes r√©ponses', 'Total questions', 'Temps (s)'];\r\n        const rows = [];\r\n        \r\n        resultsSnapshot.forEach(doc => {\r\n            const data = doc.data();\r\n            const date = data.completedAt?.toDate().toLocaleString('fr-FR') || 'N/A';\r\n            \r\n            rows.push([\r\n                date,\r\n                data.userName || 'Inconnu',\r\n                data.module || 'N/A',\r\n                data.month || 'N/A',\r\n                data.year || 'N/A',\r\n                data.score || 0,\r\n                data.correctAnswers || 0,\r\n                data.totalQuestions || 0,\r\n                data.timeSpent || 0\r\n            ]);\r\n        });\r\n        \r\n        const csv = [headers, ...rows].map(row => row.join(',')).join('\\n');\r\n        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n        const link = document.createElement('a');\r\n        link.href = URL.createObjectURL(blob);\r\n        link.download = `dashboard-complet-${new Date().toISOString().split('T')[0]}.csv`;\r\n        link.click();\r\n        \r\n        toast.updateLoadingToast(loadingToast, 'CSV g√©n√©r√© avec succ√®s !', 'success');\r\n        \r\n    } catch (error) {\r\n        logger.error('‚ùå Erreur export CSV:', error);\r\n        toast.updateLoadingToast(loadingToast, 'Erreur d\\'export CSV', 'error');\r\n        toast.error('Erreur lors de l\\'export CSV', 4000);\r\n    }\r\n}\r\n\r\n/**\r\n * Initialiser les event listeners\r\n */\r\nfunction initEventListeners() {\r\n    // Boutons d'export\r\n    document.getElementById('export-pdf-btn')?.addEventListener('click', exportToPDF);\r\n    document.getElementById('export-csv-btn')?.addEventListener('click', exportToAdvancedCSV);\r\n    \r\n    // Filtres de p√©riode (√† impl√©menter)\r\n    document.getElementById('period-filter')?.addEventListener('change', handlePeriodChange);\r\n    \r\n    // Rafra√Æchir\r\n    document.getElementById('refresh-dashboard-btn')?.addEventListener('click', () => {\r\n        toast.info('Actualisation du dashboard...', 2000);\r\n        initAdminDashboard();\r\n    });\r\n}\r\n\r\n/**\r\n * G√©rer le changement de p√©riode\r\n */\r\nasync function handlePeriodChange(e) {\r\n    const period = e.target.value;\r\n    toast.info(`Filtrage: ${period}`, 2000);\r\n    // TODO: Filtrer les donn√©es selon la p√©riode\r\n}\r\n\r\n// ‚úÖ CORRECTION SECTION 4 : Fonction escapeHtml() supprim√©e - Utiliser celle de security.js\r\n\r\n/**\r\n * Afficher l'√©tat de chargement\r\n */\r\nfunction showLoadingState() {\r\n    // Skeletons pour les stats\r\n    const statsContainer = document.getElementById('global-stats-cards');\r\n    if (statsContainer) {\r\n        showSkeleton('global-stats-cards', createStatsSkeleton(4));\r\n    }\r\n    \r\n    // Skeletons pour les top users\r\n    const topUsersContainer = document.getElementById('top-users-list');\r\n    if (topUsersContainer) {\r\n        showSkeleton('top-users-list', createListSkeleton(10));\r\n    }\r\n    \r\n    // Skeletons pour l'activit√© r√©cente\r\n    const activityContainer = document.getElementById('recent-activity-list');\r\n    if (activityContainer) {\r\n        showSkeleton('recent-activity-list', createListSkeleton(8));\r\n    }\r\n    \r\n    // Skeletons pour les graphiques\r\n    const progressChartContainer = document.getElementById('progress-chart');\r\n    if (progressChartContainer) {\r\n        progressChartContainer.innerHTML = createChartSkeleton();\r\n    }\r\n    \r\n    const modulesChartContainer = document.getElementById('modules-chart');\r\n    if (modulesChartContainer) {\r\n        modulesChartContainer.innerHTML = createChartSkeleton();\r\n    }\r\n    \r\n    const activityChartContainer = document.getElementById('activity-chart');\r\n    if (activityChartContainer) {\r\n        activityChartContainer.innerHTML = createChartSkeleton();\r\n    }\r\n}\r\n\r\n/**\r\n * Cacher l'√©tat de chargement\r\n */\r\nfunction hideLoadingState() {\r\n    // Les conteneurs sont mis √† jour par les fonctions de rendu\r\n}\r\n\r\n/**\r\n * Temps relatif\r\n */\r\nfunction getTimeAgo(date) {\r\n    const now = new Date();\r\n    const diff = now - date;\r\n    const seconds = Math.floor(diff / 1000);\r\n    const minutes = Math.floor(seconds / 60);\r\n    const hours = Math.floor(minutes / 60);\r\n    const days = Math.floor(hours / 24);\r\n    \r\n    if (days > 0) return `Il y a ${days}j`;\r\n    if (hours > 0) return `Il y a ${hours}h`;\r\n    if (minutes > 0) return `Il y a ${minutes}min`;\r\n    return '√Ä l\\'instant';\r\n}\r\n","\n        import { requireAdmin } from './js/admin-auth-guard.js';\n        import { signOutUser } from './js/auth.js';\n        import { initQuestionsManager } from './js/admin-questions.js';\n        import { initUsersManager } from './js/admin-users.js';\n        import { initAdminDashboard } from './js/admin-dashboard.js';\n        import { auth } from './js/firebase-config.js';\n        import { toast } from './js/toast.js';\n        import { tooltip } from './js/tooltip.js';\n        \n        // V√©rifier les permissions admin au chargement\n        requireAdmin().then(user => {\n            console.log('Admin authentifi√©:', user.email);\n            toast.success(`Bienvenue ${user.displayName || user.email} !`, 3000);\n            \n            // Afficher les infos admin\n            const adminName = document.getElementById('admin-name');\n            const adminAvatar = document.getElementById('admin-avatar');\n            \n            if (adminName) adminName.textContent = user.displayName || user.email;\n            if (adminAvatar && user.photoURL) adminAvatar.src = user.photoURL;\n            \n            // Initialiser les gestionnaires\n            initAdminDashboard(); // Dashboard en premier\n            initQuestionsManager();\n            initUsersManager();\n            \n            // Gestion des tabs\n            initTabs();\n            \n        }).catch(error => {\n            console.error('Erreur authentification admin:', error);\n            // La redirection est d√©j√† g√©r√©e par requireAdmin()\n        });\n        \n        /**\n         * Initialiser les tabs\n         */\n        function initTabs() {\n            const dashboardBtn = document.getElementById('tab-dashboard-btn');\n            const questionsBtn = document.getElementById('tab-questions-btn');\n            const usersBtn = document.getElementById('tab-users-btn');\n            \n            const dashboardTab = document.getElementById('tab-dashboard');\n            const questionsTab = document.getElementById('tab-questions');\n            const usersTab = document.getElementById('tab-users');\n            \n            // Fonction pour activer un onglet\n            function activateTab(activeBtn, activeTab) {\n                // D√©sactiver tous les boutons\n                [dashboardBtn, questionsBtn, usersBtn].forEach(btn => {\n                    btn.classList.remove('border-ap-red-primary', 'text-ap-red-primary');\n                    btn.classList.add('border-transparent', 'text-slate-600');\n                    btn.setAttribute('aria-selected', 'false');\n                });\n                \n                // Cacher tous les onglets\n                [dashboardTab, questionsTab, usersTab].forEach(tab => {\n                    tab.classList.add('tab-hidden');\n                });\n                \n                // Activer le bouton et l'onglet s√©lectionn√©s\n                activeBtn.classList.remove('border-transparent', 'text-slate-600');\n                activeBtn.classList.add('border-ap-red-primary', 'text-ap-red-primary');\n                activeBtn.setAttribute('aria-selected', 'true');\n                activeTab.classList.remove('tab-hidden');\n            }\n            \n            // √âv√©nements des onglets\n            dashboardBtn.addEventListener('click', () => activateTab(dashboardBtn, dashboardTab));\n            questionsBtn.addEventListener('click', () => activateTab(questionsBtn, questionsTab));\n            usersBtn.addEventListener('click', () => activateTab(usersBtn, usersTab));\n        }\n        \n        // D√©connexion\n        document.getElementById('signout-link')?.addEventListener('click', (e) => {\n            e.preventDefault();\n            if (confirm('Voulez-vous vraiment vous d√©connecter ?')) {\n                signOutUser().then(() => {\n                    window.location.href = '/';\n                });\n            }\n        });\n    "],"names":["TooltipManager","container","elements","el","mutations","mutation","node","element","e","event","text","position","theme","size","tooltip","themes","sizes","arrows","preferredPosition","rect","tooltipRect","arrow","spacing","arrowSize","positions","testPosition","alternatives","alt","altPos","finalPosition","options","requireAdmin","resolve","reject","isDemoMode","demoUser","getDemoUser","unsubscribe","auth","user","userProfile","getUserProfile","error","DEMO_STORAGE_KEY","loadDemoQuestions","saved","q","saveDemoQuestions","questions","MOCK_QUESTIONS","MOCK_STATS","currentQuestions","currentFilters","currentPage","questionsPerPage","initQuestionsManager","loadQuestions","loadStats","initEventListeners","createForm","handleCreateQuestion","jsonInput","handleJSONUpload","browseBtn","moduleFilter","monthFilter","yearFilter","searchInput","questionsList","handleFilterChange","handleSearch","handleQuestionsListClick","prevBtn","nextBtn","changePage","actionButton","questionId","openEditModal","handleDeleteQuestion","showSkeleton","createQuestionSkeleton","renderQuestionsList","filters","getQuestions","emptyState","startIndex","endIndex","paginatedQuestions","fragment","question","createQuestionCardElement","updatePaginationControls","moduleColors","moduleIcons","color","icon","monthName","createdAt","createdAtDisplay","template","escapeHtml","opt","idx","form","submitBtn","originalBtnText","questionData","newMockQuestion","showSuccess","createQuestion","showError","file","showLoading","jsonData","validateJSONFormat","showJSONPreview","data","fileName","moduleNames","monthNames","handleConfirmImport","confirmBtn","questionsToImport","result","importQuestionsFromJSON","index","deleteQuestion","filterName","searchTerm","filtered","direction","totalPages","pageInfo","renderStats","stats","getQuestionsStats","module","count","percentage","containerId","message","toast","div","MOCK_USERS","currentUsers","paginationState","initUsersManager","loadUsers","createUserForm","handleCreateUser","generatePasswordBtn","generateRandomPassword","roleFilter","statusFilter","errorDiv","successDiv","formData","userData","showFormError","loadingToast","chars","password","i","passwordInput","createUserSkeleton","oneWeekAgo","isActive","renderUsersList","getAllUsersPaginated","renderPaginationControls","safeErrorMessage","renderUserCard","addUserActionListeners","loadMoreUsers","newUsers","existingControls","paginationHTML","loadMoreBtn","isAdmin","roleColor","roleIcon","lastLogin","lastLoginText","formatRelativeTime","safeDisplayName","safeEmail","safeAvatarAlt","avatarUrl","renderUserStats","totalQuizzes","averageScore","currentStreak","btn","userId","userEmail","userRole","openEditRoleModal","currentRole","modal","newRole","handleUpdateRole","saveBtn","originalText","updateUserRole","u","safeSearchTerm","temp","getUsersStats","activePercentage","safeMessage","date","diff","minutes","hours","days","MOCK_DATA","stateManager","initAdminDashboard","logger","showLoadingState","loadGlobalStats","loadTopUsers","loadRecentActivity","loadModuleStats","createCharts","globalStats","renderGlobalStats","usersSnapshot","getDocs","collection","db","quizzesSnapshot","totalScore","doc","questionsSnapshot","resourcesSnapshot","today","activeToday","weekAgo","activeWeek","quizzesToday","completedAt","quizzesWeek","renderTopUsers","query","orderBy","limit","resultsSnapshot","userScores","score","topUsers","b","renderRecentActivity","snapshot","activities","mockStats","moduleStats","stat","users","empty","medal","bgColor","rawUserName","userName","avgScore","card","activity","rawTimeAgo","getTimeAgo","timeAgo","scoreColor","moduleName","scoreDisplay","avatarInitial","row","createProgressChart","createModulesChart","createActivityChart","canvas","labels","counts","avgScores","thirtyDaysAgo","dailyData","dateStr","d","existingChart","chartProgress","s","colors","existingChartModules","chartModules","chartActivity","exportToPDF","jsPDF","y","exportToAdvancedCSV","headers","rows","csv","blob","link","handlePeriodChange","period","createStatsSkeleton","createListSkeleton","progressChartContainer","createChartSkeleton","modulesChartContainer","activityChartContainer","seconds","adminName","adminAvatar","initTabs","dashboardBtn","questionsBtn","usersBtn","dashboardTab","questionsTab","usersTab","activateTab","activeBtn","activeTab","tab","signOutUser"],"mappings":"4qBAcA,MAAMA,EAAe,CACjB,aAAc,CACV,KAAK,cAAgB,KACrB,KAAK,WAAa,IAClB,KAAK,UAAY,IACjB,KAAK,WAAa,KAClB,KAAK,UAAY,KACjB,KAAK,cAAiB,iBAAkB,OAExC,KAAK,KAAI,CACb,CAKA,MAAO,CACH,QAAQ,IAAI,0CAA0C,EAGtD,KAAK,uBAAsB,EAG3B,KAAK,mBAAkB,EAGvB,KAAK,WAAU,EAEf,QAAQ,IAAI,kCAAkC,CAClD,CAKA,wBAAyB,CACrB,IAAIC,EAAY,SAAS,eAAe,mBAAmB,EACtDA,IACDA,EAAY,SAAS,cAAc,KAAK,EACxCA,EAAU,GAAK,oBACfA,EAAU,UAAY,qCACtB,SAAS,KAAK,YAAYA,CAAS,GAEvC,KAAK,UAAYA,CACrB,CAKA,oBAAqB,CACjB,MAAMC,EAAW,SAAS,iBAAiB,gBAAgB,EAC3DA,EAAS,QAAQC,GAAM,KAAK,cAAcA,CAAE,CAAC,EAC7C,QAAQ,IAAI,MAAMD,EAAS,MAAM,uBAAuB,CAC5D,CAKA,YAAa,CACQ,IAAI,iBAAkBE,GAAc,CACjDA,EAAU,QAASC,GAAa,CAC5BA,EAAS,WAAW,QAASC,GAAS,CAC9BA,EAAK,WAAa,IACdA,EAAK,cAAgBA,EAAK,aAAa,cAAc,GACrD,KAAK,cAAcA,CAAI,EAGvBA,EAAK,kBACLA,EAAK,iBAAiB,gBAAgB,EAAE,QAAQH,GAAM,CAClD,KAAK,cAAcA,CAAE,CACzB,CAAC,EAGb,CAAC,CACL,CAAC,CACL,CAAC,EAEQ,QAAQ,SAAS,KAAM,CAC5B,UAAW,GACX,QAAS,EACrB,CAAS,CACL,CAKA,cAAcI,EAAS,CAEfA,EAAQ,QAAQ,kBACpBA,EAAQ,QAAQ,gBAAkB,OAG9B,MAAK,gBAGTA,EAAQ,iBAAiB,aAAeC,GAAM,KAAK,iBAAiBA,EAAGD,CAAO,CAAC,EAC/EA,EAAQ,iBAAiB,aAAeC,GAAM,KAAK,iBAAiBA,CAAC,CAAC,EACtED,EAAQ,iBAAiB,QAAUC,GAAM,KAAK,YAAYA,EAAGD,CAAO,CAAC,EACrEA,EAAQ,iBAAiB,OAASC,GAAM,KAAK,WAAWA,CAAC,CAAC,EAG1DD,EAAQ,aAAa,mBAAoB,WAAW,KAAK,WAAU,CAAE,EAAE,GAC3E,CAKA,YAAa,CACT,OAAO,KAAK,OAAM,EAAG,SAAS,EAAE,EAAE,UAAU,EAAG,EAAE,CACrD,CAKA,iBAAiBE,EAAOF,EAAS,CAC7B,aAAa,KAAK,SAAS,EAE3B,KAAK,WAAa,WAAW,IAAM,CAC/B,KAAK,YAAYA,CAAO,CAC5B,EAAG,KAAK,UAAU,CACtB,CAKA,iBAAiBE,EAAO,CACpB,aAAa,KAAK,UAAU,EAE5B,KAAK,UAAY,WAAW,IAAM,CAC9B,KAAK,YAAW,CACpB,EAAG,KAAK,SAAS,CACrB,CAKA,YAAYA,EAAOF,EAAS,CACxB,KAAK,YAAYA,CAAO,CAC5B,CAKA,WAAWE,EAAO,CACd,KAAK,YAAW,CACpB,CAKA,YAAYF,EAAS,CACjB,MAAMG,EAAOH,EAAQ,QAAQ,QACvBI,EAAWJ,EAAQ,QAAQ,iBAAmB,MAC9CK,EAAQL,EAAQ,QAAQ,cAAgB,OACxCM,EAAON,EAAQ,QAAQ,aAAe,SAE5C,GAAI,CAACG,EAAM,OAGX,KAAK,YAAW,EAGhB,MAAMI,EAAU,KAAK,qBAAqBJ,EAAME,EAAOC,CAAI,EAC3D,KAAK,UAAU,YAAYC,CAAO,EAClC,KAAK,cAAgBA,EAGrB,KAAK,gBAAgBA,EAASP,EAASI,CAAQ,EAG/C,WAAW,IAAM,CACbG,EAAQ,UAAU,OAAO,YAAa,UAAU,EAChDA,EAAQ,UAAU,IAAI,cAAe,WAAW,CACpD,EAAG,EAAE,CACT,CAKA,qBAAqBJ,EAAME,EAAOC,EAAM,CACpC,MAAMC,EAAU,SAAS,cAAc,KAAK,EAC5C,OAAAA,EAAQ,UAAY,sFAAsF,KAAK,gBAAgBF,CAAK,CAAC,IAAI,KAAK,eAAeC,CAAI,CAAC,GAGlKC,EAAQ,UAAY;AAAA;AAAA,kBAEVJ,CAAI;AAAA,iFAC2D,KAAK,gBAAgBE,CAAK,CAAC;AAAA;AAAA,UAI7FE,CACX,CAKA,gBAAgBF,EAAO,CACnB,MAAMG,EAAS,CACX,KAAQ,oCACR,MAAS,4DACT,QAAW,oCACX,MAAS,kCACT,QAAW,qCACX,KAAQ,kCACpB,EACQ,OAAOA,EAAOH,CAAK,GAAKG,EAAO,IACnC,CAKA,eAAeF,EAAM,CACjB,MAAMG,EAAQ,CACV,MAAS,4BACT,OAAU,+BACV,MAAS,gCACrB,EACQ,OAAOA,EAAMH,CAAI,GAAKG,EAAM,MAChC,CAKA,gBAAgBJ,EAAO,CACnB,MAAMK,EAAS,CACX,KAAQ,eACR,MAAS,8CACT,QAAW,eACX,MAAS,aACT,QAAW,gBACX,KAAQ,aACpB,EACQ,OAAOA,EAAOL,CAAK,GAAKK,EAAO,IACnC,CAKA,gBAAgBH,EAASP,EAASW,EAAmB,CACjD,MAAMC,EAAOZ,EAAQ,wBACfa,EAAcN,EAAQ,wBACtBO,EAAQP,EAAQ,cAAc,gBAAgB,EAE9CQ,EAAU,EACVC,EAAY,EAGZC,EAAY,CACd,IAAK,CACD,IAAKL,EAAK,IAAMC,EAAY,OAASE,EACrC,KAAMH,EAAK,KAAQA,EAAK,MAAQ,EAAMC,EAAY,MAAQ,EAC1D,SAAUA,EAAY,OAASG,EAAY,EAC3C,UAAWH,EAAY,MAAQ,EAAIG,EAAY,EAC/C,YAAa,eAC7B,EACY,OAAQ,CACJ,IAAKJ,EAAK,OAASG,EACnB,KAAMH,EAAK,KAAQA,EAAK,MAAQ,EAAMC,EAAY,MAAQ,EAC1D,SAAU,CAACG,EAAY,EACvB,UAAWH,EAAY,MAAQ,EAAIG,EAAY,EAC/C,YAAa,gBAC7B,EACY,KAAM,CACF,IAAKJ,EAAK,IAAOA,EAAK,OAAS,EAAMC,EAAY,OAAS,EAC1D,KAAMD,EAAK,KAAOC,EAAY,MAAQE,EACtC,SAAUF,EAAY,OAAS,EAAIG,EAAY,EAC/C,UAAWH,EAAY,MAAQG,EAAY,EAC3C,YAAa,gBAC7B,EACY,MAAO,CACH,IAAKJ,EAAK,IAAOA,EAAK,OAAS,EAAMC,EAAY,OAAS,EAC1D,KAAMD,EAAK,MAAQG,EACnB,SAAUF,EAAY,OAAS,EAAIG,EAAY,EAC/C,UAAW,CAACA,EAAY,EACxB,YAAa,gBAC7B,CACA,EAGQ,IAAIZ,EAAWO,EAGf,MAAMO,EAAeD,EAAUN,CAAiB,EAChD,GAAIO,IAEIA,EAAa,IAAM,GACnBA,EAAa,IAAML,EAAY,OAAS,OAAO,aAC/CK,EAAa,KAAO,GACpBA,EAAa,KAAOL,EAAY,MAAQ,OAAO,YAGhC,CACf,MAAMM,GAAe,CAAC,MAAO,SAAU,OAAQ,OAAO,EACtD,UAAWC,KAAOD,GAAc,CAC5B,MAAME,EAASJ,EAAUG,CAAG,EAO5B,GAAI,EALAC,EAAO,IAAM,GACbA,EAAO,IAAMR,EAAY,OAAS,OAAO,aACzCQ,EAAO,KAAO,GACdA,EAAO,KAAOR,EAAY,MAAQ,OAAO,YAE3B,CACdT,EAAWgB,EACX,KACJ,CACJ,CACJ,CAIJ,MAAME,EAAgBL,EAAUb,CAAQ,GAAKa,EAAU,IACvDV,EAAQ,MAAM,IAAM,GAAGe,EAAc,GAAG,KACxCf,EAAQ,MAAM,KAAO,GAAGe,EAAc,IAAI,KAGtCR,IACAA,EAAM,MAAM,IAAM,GAAGQ,EAAc,QAAQ,KAC3CR,EAAM,MAAM,KAAO,GAAGQ,EAAc,SAAS,KAC7CR,EAAM,MAAM,UAAYQ,EAAc,YAE9C,CAKA,aAAc,CACL,KAAK,gBAGV,KAAK,cAAc,UAAU,OAAO,cAAe,WAAW,EAC9D,KAAK,cAAc,UAAU,IAAI,YAAa,UAAU,EAGxD,WAAW,IAAM,CACT,KAAK,eAAiB,KAAK,cAAc,YACzC,KAAK,cAAc,WAAW,YAAY,KAAK,aAAa,EAEhE,KAAK,cAAgB,IACzB,EAAG,GAAG,EACV,CAKA,IAAItB,EAASG,EAAMoB,EAAU,CAAA,EAAI,CAC7BvB,EAAQ,QAAQ,QAAUG,EAC1BH,EAAQ,QAAQ,gBAAkBuB,EAAQ,UAAY,MACtDvB,EAAQ,QAAQ,aAAeuB,EAAQ,OAAS,OAChDvB,EAAQ,QAAQ,YAAcuB,EAAQ,MAAQ,SAE9C,KAAK,cAAcvB,CAAO,CAC9B,CAKA,OAAOA,EAAS,CACZA,EAAQ,gBAAgB,cAAc,EACtCA,EAAQ,gBAAgB,uBAAuB,EAC/CA,EAAQ,gBAAgB,oBAAoB,EAC5CA,EAAQ,gBAAgB,mBAAmB,EAC3CA,EAAQ,gBAAgB,uBAAuB,EAC/CA,EAAQ,gBAAgB,kBAAkB,CAC9C,CAKA,OAAOA,EAASG,EAAMoB,EAAU,CAAA,EAAI,CAChC,KAAK,OAAOvB,CAAO,EACnB,KAAK,IAAIA,EAASG,EAAMoB,CAAO,CACnC,CAKA,SAAU,CACF,KAAK,WAAa,KAAK,UAAU,YACjC,KAAK,UAAU,WAAW,YAAY,KAAK,SAAS,EAGxD,aAAa,KAAK,UAAU,EAC5B,aAAa,KAAK,SAAS,EAE3B,QAAQ,IAAI,iCAAiC,CACjD,CACJ,CAGA,MAAMhB,GAAU,IAAId,GAMpB,OAAO,QAAUc,GC9YV,eAAeiB,IAAe,CACjC,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAW,CAEpC,GAAIC,EAAU,EAAI,CACd,MAAMC,EAAWC,KACjB,GAAID,GAAYA,EAAS,OAAS,QAAS,CACvC,QAAQ,IAAI,gCAAiCA,EAAS,KAAK,EAC3DH,EAAQG,CAAQ,EAChB,MACJ,KAAO,CACH,QAAQ,KAAK,4CAA4C,EACzD,MAAM,4DAA4D,EAClE,OAAO,SAAS,KAAO,cACvBF,EAAO,IAAI,MAAM,cAAc,CAAC,EAChC,MACJ,CACJ,CAGA,MAAMI,EAAcC,GAAK,mBAAmB,MAAOC,GAAS,CAGxD,GAFAF,IAEI,CAACE,EAAM,CACP,QAAQ,KAAK,0CAA0C,EACvD,OAAO,SAAS,KAAO,cACvBN,EAAO,IAAI,MAAM,iBAAiB,CAAC,EACnC,MACJ,CAEA,GAAI,CAEA,MAAMO,EAAc,MAAMC,GAAeF,EAAK,GAAG,EAEjD,GAAI,CAACC,GAAeA,EAAY,OAAS,QAAS,CAC9C,QAAQ,KAAK,gDAAgD,EAC7D,MAAM,4DAA4D,EAClE,OAAO,SAAS,KAAO,cACvBP,EAAO,IAAI,MAAM,cAAc,CAAC,EAChC,MACJ,CAEA,QAAQ,IAAI,oBAAqBM,EAAK,KAAK,EAC3CP,EAAQO,CAAI,CAChB,OAASG,EAAO,CACZ,QAAQ,MAAM,+BAAgCA,CAAK,EACnD,OAAO,SAAS,KAAO,cACvBT,EAAOS,CAAK,CAChB,CACJ,CAAC,CACL,CAAC,CACL,CCnCA,MAAMC,GAAmB,gCAGzB,SAASC,IAAoB,CACzB,GAAI,CAACV,IAAc,MAAO,GAE1B,MAAMW,EAAQ,aAAa,QAAQF,EAAgB,EACnD,GAAIE,EACA,GAAI,CAGA,OAFe,KAAK,MAAMA,CAAK,EAEjB,IAAIC,IAAM,CACpB,GAAGA,EACH,UAAW,IAAI,KAAKA,EAAE,SAAS,CAC/C,EAAc,CACN,OAAS,EAAG,CACR,QAAQ,KAAK,oCAAqC,CAAC,CACvD,CAIJ,MAAO,CACH,CAAE,GAAI,IAAK,OAAQ,OAAQ,MAAO,GAAI,KAAM,KAAM,SAAU,6EAA+E,QAAS,CAAC,SAAU,SAAU,SAAU,QAAQ,EAAG,cAAe,EAAG,YAAa,gFAAiF,UAAW,IAAI,IAAM,EACnU,CAAE,GAAI,IAAK,OAAQ,OAAQ,MAAO,GAAI,KAAM,KAAM,SAAU,sDAAwD,QAAS,CAAC,mBAAoB,oBAAqB,oBAAqB,mBAAmB,EAAG,cAAe,EAAG,YAAa,oGAAsG,UAAW,IAAI,IAAM,EAC5W,CAAE,GAAI,IAAK,OAAQ,SAAU,MAAO,GAAI,KAAM,KAAM,SAAU,iEAAkE,QAAS,CAAC,UAAW,UAAW,UAAW,SAAS,EAAG,cAAe,EAAG,YAAa,wEAAyE,UAAW,IAAI,IAAM,EACpT,CAAE,GAAI,IAAK,OAAQ,KAAM,MAAO,GAAI,KAAM,KAAM,SAAU,wEAAyE,QAAS,CAAC,QAAS,SAAU,SAAU,QAAQ,EAAG,cAAe,EAAG,YAAa,+DAAgE,UAAW,IAAI,IAAM,EACzS,CAAE,GAAI,IAAK,OAAQ,WAAY,MAAO,GAAI,KAAM,KAAM,SAAU,uEAAwE,QAAS,CAAC,WAAY,WAAY,WAAY,UAAU,EAAG,cAAe,EAAG,YAAa,0DAA2D,UAAW,IAAI,IAAM,CAC1T,CACA,CAGA,SAASC,EAAkBC,EAAW,CAC7Bd,EAAU,IACf,aAAa,QAAQS,GAAkB,KAAK,UAAUK,CAAS,CAAC,EAChE,QAAQ,IAAI,kCAAmCA,EAAU,MAAM,EACnE,CAGA,IAAIC,EAAiBL,GAAiB,EAEtC,MAAMM,GAAa,CACf,MAAO,IACP,SAAU,CAAE,KAAM,GAAI,OAAQ,GAAI,GAAI,GAAI,SAAU,EAAE,EACtD,OAAQ,EACZ,EAGA,IAAIC,EAAmB,CAAA,EACnBC,EAAiB,CACjB,OAAQ,GACR,MAAO,GACP,KAAM,IAAI,KAAI,EAAG,YAAW,CAChC,EACIC,EAAc,EAClB,MAAMC,EAAmB,GAKlB,eAAeC,IAAuB,CACzC,QAAQ,IAAI,6CAA6C,EAGzD,MAAMC,EAAa,EAGnB,MAAMC,EAAS,EAGfC,IACJ,CAKA,SAASA,IAAqB,CAE1B,MAAMC,EAAa,SAAS,eAAe,sBAAsB,EAC7DA,GACAA,EAAW,iBAAiB,SAAUC,EAAoB,EAI9D,MAAMC,EAAY,SAAS,eAAe,iBAAiB,EACvDA,GACAA,EAAU,iBAAiB,SAAUC,EAAgB,EAIzD,MAAMC,EAAY,SAAS,eAAe,iBAAiB,EACvDA,GACAA,EAAU,iBAAiB,QAAS,IAAMF,GAAW,MAAK,CAAE,EAIhE,MAAMG,EAAe,SAAS,eAAe,eAAe,EACtDC,EAAc,SAAS,eAAe,cAAc,EACpDC,EAAa,SAAS,eAAe,aAAa,EAClDC,EAAc,SAAS,eAAe,kBAAkB,EACxDC,EAAgB,SAAS,eAAe,gBAAgB,EAE1DJ,GAAcA,EAAa,iBAAiB,SAAUK,CAAkB,EACxEJ,GAAaA,EAAY,iBAAiB,SAAUI,CAAkB,EACtEH,GAAYA,EAAW,iBAAiB,SAAUG,CAAkB,EACpEF,GAAaA,EAAY,iBAAiB,QAASG,EAAY,EAE/DF,GAAiB,CAACA,EAAc,QAAQ,cACxCA,EAAc,iBAAiB,QAASG,EAAwB,EAChEH,EAAc,QAAQ,YAAc,QAIxC,MAAMI,EAAU,SAAS,eAAe,eAAe,EACjDC,EAAU,SAAS,eAAe,eAAe,EAEnDD,GAASA,EAAQ,iBAAiB,QAAS,IAAME,EAAW,EAAE,CAAC,EAC/DD,GAASA,EAAQ,iBAAiB,QAAS,IAAMC,EAAW,CAAC,CAAC,CACtE,CAEA,SAASH,GAAyB9D,EAAO,CACrC,MAAMkE,EAAelE,EAAM,OAAO,QAAQ,0CAA0C,EACpF,GAAI,CAACkE,EACD,OAGJ,MAAMC,EAAaD,EAAa,QAAQ,WACxC,GAAKC,EAIL,IAAID,EAAa,UAAU,SAAS,mBAAmB,EAAG,CACtDE,GAAcD,CAAU,EACxB,MACJ,CAEID,EAAa,UAAU,SAAS,qBAAqB,GACrDG,GAAqBF,CAAU,EAEvC,CAKA,eAAepB,GAAgB,CAC3B,GAAI,CAQA,GANkB,SAAS,eAAe,gBAAgB,GAEtDuB,EAAa,iBAAkBC,GAAuB,CAAC,CAAC,EAIxD9C,EAAU,EAAI,CACd,QAAQ,IAAI,qDAAqD,EAGjE,MAAM,IAAI,QAAQF,GAAW,WAAWA,EAAS,GAAG,CAAC,EAGrDmB,EAAmBF,EAAe,OAAOH,GACjCM,EAAAA,EAAe,QAAUN,EAAE,SAAWM,EAAe,QACrDA,EAAe,OAASN,EAAE,QAAU,SAASM,EAAe,KAAK,GACjEA,EAAe,MAAQN,EAAE,OAAS,SAASM,EAAe,IAAI,EAErE,EAED,QAAQ,IAAI,KAAKD,EAAiB,MAAM,8BAA8B,EACtE8B,IACA,MACJ,CAGA,MAAMC,EAAU,CAAA,EACZ9B,EAAe,SAAQ8B,EAAQ,OAAS9B,EAAe,QACvDA,EAAe,QAAO8B,EAAQ,MAAQ,SAAS9B,EAAe,KAAK,GACnEA,EAAe,OAAM8B,EAAQ,KAAO,SAAS9B,EAAe,IAAI,GAEpED,EAAmB,MAAMgC,GAAaD,CAAO,EAC7C,QAAQ,IAAI,uBAAuB/B,EAAiB,MAAM,EAAE,EAE5D8B,GACJ,OAASvC,EAAO,CACZ,QAAQ,MAAM,+BAAgCA,CAAK,EACnD,MAAMzC,EAAY,SAAS,eAAe,gBAAgB,EACtDA,IACAA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCAMOyC,EAAM,OAAO;AAAA;AAAA,cAIlD,CACJ,CAKA,SAASuC,GAAsB,CAC3B,MAAMhF,EAAY,SAAS,eAAe,gBAAgB,EAC1D,GAAI,CAACA,EAAW,OAEhB,GAAIkD,EAAiB,SAAW,EAAG,CAC/B,MAAMiC,EAAa,SAAS,cAAc,KAAK,EAC/CA,EAAW,UAAY,mCACvBA,EAAW,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAOvBnF,EAAU,gBAAgBmF,CAAU,EACpC,MACJ,CAGA,MAAMC,GAAchC,EAAc,GAAKC,EACjCgC,EAAWD,EAAa/B,EACxBiC,EAAqBpC,EAAiB,MAAMkC,EAAYC,CAAQ,EAEhEE,EAAW,SAAS,yBAC1BD,EAAmB,QAAQE,GAAY,CACnCD,EAAS,YAAYE,GAA0BD,CAAQ,CAAC,CAC5D,CAAC,EAEDxF,EAAU,gBAAgBuF,CAAQ,EAGlCG,IACJ,CAKA,SAASD,GAA0BD,EAAU,CACzC,MAAMG,EAAe,CACjB,KAAM,SACN,OAAQ,OACR,GAAI,SACJ,SAAU,OAClB,EAEUC,EAAc,CAChB,KAAM,KACN,OAAQ,MACR,GAAI,KACJ,SAAU,IAClB,EAEUC,EAAQF,EAAaH,EAAS,MAAM,GAAK,OACzCM,EAAOF,EAAYJ,EAAS,MAAM,GAAK,KAGvCO,EADa,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,OAAQ,OAAQ,OAAQ,MAAO,MAAO,MAAO,KAAK,EAC5EP,EAAS,MAAQ,CAAC,GAAKA,EAAS,MACvDQ,EAAYR,EAAS,WAAW,QAChC,IAAI,KAAKA,EAAS,UAAU,QAAU,GAAI,EAC1CA,EAAS,qBAAqB,KAC1BA,EAAS,UACT,KACJS,EAAmBD,EAAYA,EAAU,mBAAmB,OAAO,EAAI,MAEvEE,EAAW,SAAS,cAAc,UAAU,EAClD,OAAAA,EAAS,UAAY;AAAA,oIAC2GV,EAAS,EAAE;AAAA;AAAA;AAAA,6CAGlGM,CAAI;AAAA;AAAA,uDAEMD,CAAK,aAAaA,CAAK;AAAA,8BAChDM,EAAWX,EAAS,OAAO,YAAW,CAAE,CAAC;AAAA;AAAA,oEAEHW,EAAW,GAAGJ,CAAS,IAAIP,EAAS,IAAI,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA,0JAI2CA,EAAS,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,mJAKlBA,EAAS,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oEAO1FW,EAAWX,EAAS,QAAQ,CAAC;AAAA;AAAA,kBAE/EA,EAAS,QAAQ,IAAI,CAACY,EAAKC,IAAQ;AAAA,iEACYA,IAAQb,EAAS,cAAgB,uDAAyD,gBAAgB;AAAA,kDACzH,OAAO,aAAa,GAAKa,CAAG,CAAC;AAAA,gCAC/CF,EAAWC,CAAG,CAAC;AAAA,0BACrBC,IAAQb,EAAS,cAAgB,0SAA4S,EAAE;AAAA;AAAA,iBAExV,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA,mDAIwBW,EAAWX,EAAS,WAAW,CAAC;AAAA;AAAA;AAAA,4BAGvDW,EAAWF,CAAgB,CAAC,GAAGT,EAAS,UAAYW,EAAW,WAAWX,EAAS,SAAS,EAAE,EAAI,EAAE;AAAA;AAAA;AAAA,MAKrHU,EAAS,QAAQ,iBAC5B,CAKA,eAAevC,GAAqBpD,EAAG,CACnCA,EAAE,eAAc,EAEhB,MAAM+F,EAAO/F,EAAE,OACTgG,EAAYD,EAAK,cAAc,iBAAiB,EAChDE,EAAkBD,EAAU,UAElC,GAAI,CACAA,EAAU,SAAW,GACrBA,EAAU,UAAY,wWAEtB,MAAME,EAAe,CACjB,SAAUH,EAAK,cAAc,mBAAmB,EAAE,MAClD,QAAS,CACLA,EAAK,cAAc,kBAAkB,EAAE,MACvCA,EAAK,cAAc,kBAAkB,EAAE,MACvCA,EAAK,cAAc,kBAAkB,EAAE,MACvCA,EAAK,cAAc,kBAAkB,EAAE,KACvD,EACY,cAAe,SAASA,EAAK,cAAc,gCAAgC,EAAE,KAAK,EAClF,YAAaA,EAAK,cAAc,sBAAsB,EAAE,MACxD,OAAQA,EAAK,cAAc,iBAAiB,EAAE,MAC9C,MAAO,SAASA,EAAK,cAAc,gBAAgB,EAAE,KAAK,EAC1D,KAAM,SAASA,EAAK,cAAc,eAAe,EAAE,KAAK,CACpE,EAGQ,GAAIrE,EAAU,EAAI,CACd,QAAQ,IAAI,gDAAgD,EAC5D,MAAM,IAAI,QAAQF,GAAW,WAAWA,EAAS,GAAG,CAAC,EAGrD,MAAM2E,EAAkB,CACpB,GAAI,QAAQ,KAAK,IAAG,CAAE,GACtB,GAAGD,EACH,YAAaA,EAAa,aAAe,0BACzC,UAAW,IAAI,IAC/B,EACYzD,EAAe,QAAQ0D,CAAe,EAGtC5D,EAAkBE,CAAc,EAEhC2D,EAAY,4CAA4C,EACxDL,EAAK,MAAK,EAEV,MAAM/C,EAAa,EACnB,MAAMC,EAAS,EACf,MACJ,CAEA,MAAMoD,GAAeH,CAAY,EAEjCE,EAAY,6BAA6B,EACzCL,EAAK,MAAK,EACV,MAAM/C,EAAa,EACnB,MAAMC,EAAS,CACnB,OAASf,EAAO,CACZ,QAAQ,MAAM,4BAA6BA,CAAK,EAChDoE,EAAU,wBAAyBpE,EAAM,SAAW,4BAA4B,CACpF,QAAC,CACG8D,EAAU,SAAW,GACrBA,EAAU,UAAYC,CAC1B,CACJ,CAKA,eAAe3C,GAAiBtD,EAAG,CAC/B,MAAMuG,EAAOvG,EAAE,OAAO,MAAM,CAAC,EAC7B,GAAKuG,EAEL,GAAI,CACAC,GAAY,cAAc,EAE1B,MAAMtG,EAAO,MAAMqG,EAAK,OAClBE,EAAW,KAAK,MAAMvG,CAAI,EAGhCwG,GAAmBD,CAAQ,EAG3BE,GAAgBF,EAAUF,EAAK,IAAI,CACvC,OAASrE,EAAO,CACZ,QAAQ,MAAM,uBAAwBA,CAAK,EAC3CoE,EAAU,eAAgBpE,EAAM,SAAW,uBAAuB,CACtE,CACJ,CAKA,SAASwE,GAAmBE,EAAM,CAC9B,GAAI,CAACA,EAAK,QAAU,CAACA,EAAK,OAAS,CAACA,EAAK,KACrC,MAAM,IAAI,MAAM,oDAAoD,EAGxE,GAAI,CAAC,MAAM,QAAQA,EAAK,SAAS,GAAKA,EAAK,UAAU,SAAW,EAC5D,MAAM,IAAI,MAAM,gDAAgD,EAIpE,OAAAA,EAAK,UAAU,QAAQ,CAACtE,EAAGwD,IAAQ,CAC/B,GAAI,CAACxD,EAAE,UAAYA,EAAE,SAAS,OAAS,GACnC,MAAM,IAAI,MAAM,YAAYwD,EAAM,CAAC,wCAAwC,EAE/E,GAAI,CAAC,MAAM,QAAQxD,EAAE,OAAO,GAAKA,EAAE,QAAQ,SAAW,EAClD,MAAM,IAAI,MAAM,YAAYwD,EAAM,CAAC,mCAAmC,EAE1E,GAAIxD,EAAE,gBAAkB,QAAaA,EAAE,cAAgB,GAAKA,EAAE,cAAgB,EAC1E,MAAM,IAAI,MAAM,YAAYwD,EAAM,CAAC,0CAA0C,EAEjF,GAAI,CAACxD,EAAE,aAAeA,EAAE,YAAY,OAAS,GACzC,MAAM,IAAI,MAAM,YAAYwD,EAAM,CAAC,+CAA+C,CAE1F,CAAC,EAEM,EACX,CAKA,SAASa,GAAgBC,EAAMC,EAAU,CACrC,MAAMpH,EAAY,SAAS,eAAe,cAAc,EACxD,GAAI,CAACA,EAAW,OAEhB,MAAMqH,EAAc,CAChB,KAAM,OACN,OAAQ,SACR,GAAI,KACJ,SAAU,UAClB,EAEUC,EAAa,CAAC,UAAW,UAAW,OAAQ,QAAS,MAAO,OAAQ,UAAW,OAAQ,YAAa,UAAW,WAAY,UAAU,EAE3ItH,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA,2EAIiDoH,CAAQ;AAAA;AAAA;AAAA,sDAG7BD,EAAK,UAAU,MAAM;AAAA,8DACbE,EAAYF,EAAK,MAAM,GAAKA,EAAK,MAAM;AAAA,+DACtCG,EAAWH,EAAK,MAAQ,CAAC,CAAC,IAAIA,EAAK,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAahFA,EAAK,UAAU,MAAM,EAAG,CAAC,EAAE,IAAI,CAACtE,EAAGwD,IAAQ;AAAA,sCAC3BA,EAAM,CAAC,cAAcF,EAAWtD,EAAE,SAAS,UAAU,EAAG,EAAE,CAAC,CAAC,GAAGA,EAAE,SAAS,OAAS,GAAK,MAAQ,EAAE;AAAA,qBACnH,EAAE,KAAK,EAAE,CAAC;AAAA,sBACTsE,EAAK,UAAU,OAAS,EAAI,4CAA4CA,EAAK,UAAU,OAAS,CAAC,iBAAmB,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mCAMzGA,EAAK,UAAU,MAAM;AAAA;AAAA;AAAA;AAAA,MAOpD,SAAS,eAAe,oBAAoB,GAAG,iBAAiB,QAAS,IAAMI,GAAoBJ,CAAI,CAAC,EACxG,SAAS,eAAe,mBAAmB,GAAG,iBAAiB,QAAS,IAAM,CAC1EnH,EAAU,UAAY,GACtB,SAAS,eAAe,iBAAiB,EAAE,MAAQ,EACvD,CAAC,CACL,CAKA,eAAeuH,GAAoBJ,EAAM,CACrC,MAAMnH,EAAY,SAAS,eAAe,cAAc,EAClDwH,EAAa,SAAS,eAAe,oBAAoB,EAE/D,GAAI,CAKA,GAJAA,EAAW,SAAW,GACtBA,EAAW,UAAY,uMAGnBvF,EAAU,EAAI,CACd,QAAQ,IAAI,0CAA0C,EACtD,MAAM,IAAI,QAAQF,GAAW,WAAWA,EAAS,GAAI,CAAC,EAEtD,MAAM0F,EAAoBN,EAAK,WAAa,GAC5CM,EAAkB,QAAQ,CAAC5E,EAAGwD,IAAQ,CAClCrD,EAAe,QAAQ,CACnB,GAAI,iBAAiB,KAAK,IAAG,CAAE,IAAIqD,CAAG,GACtC,SAAUxD,EAAE,SACZ,QAASA,EAAE,QACX,cAAeA,EAAE,cACjB,YAAaA,EAAE,aAAe,4BAC9B,OAAQsE,EAAK,OACb,MAAOA,EAAK,MACZ,KAAMA,EAAK,KACX,UAAW,IAAI,IACnC,CAAiB,CACL,CAAC,EAGDrE,EAAkBE,CAAc,EAEhC2D,EAAY,iCAAiCc,EAAkB,MAAM,sBAAsB,EAE3FzH,EAAU,UAAY,GACtB,SAAS,eAAe,iBAAiB,EAAE,MAAQ,GAEnD,MAAMuD,EAAa,EACnB,MAAMC,EAAS,EACf,MACJ,CAEA,MAAMkE,EAAS,MAAMC,GAAwBR,CAAI,EAEjDR,EAAY,mBAAmBe,EAAO,OAAO,IAAIA,EAAO,KAAK,sBAAsB,EAE/EA,EAAO,OAAO,OAAS,GACvB,QAAQ,KAAK,kBAAmBA,EAAO,MAAM,EAGjD1H,EAAU,UAAY,GACtB,SAAS,eAAe,iBAAiB,EAAE,MAAQ,GAEnD,MAAMuD,EAAa,EACnB,MAAMC,EAAS,CACnB,OAASf,EAAO,CACZ,QAAQ,MAAM,iBAAkBA,CAAK,EACrCoE,EAAU,eAAgBpE,EAAM,SAAW,yBAAyB,CACxE,CACJ,CAKA,SAASmC,GAAcD,EAAY,CACdzB,EAAiB,KAAKL,GAAKA,EAAE,KAAO8B,CAAU,GAK/D,MAAM,0BAA0BA,CAAU;AAAA,+BAAkC,CAChF,CAKA,eAAeE,GAAqBF,EAAY,CAC5C,MAAMa,EAAWtC,EAAiB,KAAKL,GAAKA,EAAE,KAAO8B,CAAU,EAO/D,GANI,GAACa,GAMD,CAJkB,QAClB;AAAA;AAAA,GAAsDA,EAAS,SAAS,UAAU,EAAG,GAAG,CAAC;AAAA;AAAA,+BACjG,GAII,GAAI,CAEA,GAAIvD,EAAU,EAAI,CACd,QAAQ,IAAI,mDAAmD,EAC/D,MAAM,IAAI,QAAQF,GAAW,WAAWA,EAAS,GAAG,CAAC,EAErD,MAAM6F,EAAQ5E,EAAe,UAAUH,GAAKA,EAAE,KAAO8B,CAAU,EAC3DiD,EAAQ,KACR5E,EAAe,OAAO4E,EAAO,CAAC,EAG9B9E,EAAkBE,CAAc,GAGpC2D,EAAY,8CAA8C,EAC1D,MAAMpD,EAAa,EACnB,MAAMC,EAAS,EACf,MACJ,CAEA,MAAMqE,GAAelD,CAAU,EAC/BgC,EAAY,gCAAgC,EAC5C,MAAMpD,EAAa,EACnB,MAAMC,EAAS,CACnB,OAASf,EAAO,CACZ,QAAQ,MAAM,sBAAuBA,CAAK,EAC1CoE,EAAU,iBAAkBpE,EAAM,SAAW,+BAA+B,CAChF,CACJ,CAKA,eAAe2B,EAAmB7D,EAAG,CACjC,MAAMuH,EAAavH,EAAE,OAAO,GAAG,QAAQ,UAAW,EAAE,EACpD4C,EAAe2E,CAAU,EAAIvH,EAAE,OAAO,MACtC6C,EAAc,EACd,MAAMG,EAAa,CACvB,CAKA,SAASc,GAAa9D,EAAG,CACrB,MAAMwH,EAAaxH,EAAE,OAAO,MAAM,YAAW,EAE7C,GAAI,CAACwH,EAAY,CACb/C,IACA,MACJ,CAEA,MAAMgD,EAAW9E,EAAiB,OAAOL,GACrCA,EAAE,SAAS,cAAc,SAASkF,CAAU,GAC5ClF,EAAE,QAAQ,KAAKuD,GAAOA,EAAI,YAAW,EAAG,SAAS2B,CAAU,CAAC,GAC5DlF,EAAE,YAAY,cAAc,SAASkF,CAAU,CACvD,EAGU/H,EAAY,SAAS,eAAe,gBAAgB,EAC1D,GAAI,CAACA,EAAW,OAEhB,GAAIgI,EAAS,SAAW,EAAG,CACvB,MAAM7C,EAAa,SAAS,cAAc,KAAK,EAC/CA,EAAW,UAAY,mCACvBA,EAAW,UAAY;AAAA,sDACuBgB,EAAW4B,CAAU,CAAC;AAAA,UAEpE/H,EAAU,gBAAgBmF,CAAU,EACpC,MACJ,CAEA,MAAMI,EAAW,SAAS,yBAC1ByC,EAAS,QAAQxC,GAAY,CACzBD,EAAS,YAAYE,GAA0BD,CAAQ,CAAC,CAC5D,CAAC,EACDxF,EAAU,gBAAgBuF,CAAQ,CACtC,CAKA,SAASd,EAAWwD,EAAW,CAC3B,MAAMC,EAAa,KAAK,KAAKhF,EAAiB,OAASG,CAAgB,EACvED,GAAe6E,EAEX7E,EAAc,IAAGA,EAAc,GAC/BA,EAAc8E,IAAY9E,EAAc8E,GAE5ClD,IACA,OAAO,SAAS,CAAE,IAAK,EAAG,SAAU,QAAQ,CAAE,CAClD,CAKA,SAASU,IAA2B,CAChC,MAAMwC,EAAa,KAAK,KAAKhF,EAAiB,OAASG,CAAgB,EACjE8E,EAAW,SAAS,eAAe,WAAW,EAC9C5D,EAAU,SAAS,eAAe,eAAe,EACjDC,EAAU,SAAS,eAAe,eAAe,EAEnD2D,IACAA,EAAS,YAAc,QAAQ/E,CAAW,IAAI8E,GAAc,CAAC,IAG7D3D,IACAA,EAAQ,SAAWnB,IAAgB,GAGnCoB,IACAA,EAAQ,SAAWpB,IAAgB8E,GAAcA,IAAe,EAExE,CAKA,eAAe1E,GAAY,CACvB,GAAI,CAEA,GAAIvB,EAAU,EAAI,CACd,QAAQ,IAAI,iDAAiD,EAC7DmG,EAAYnF,EAAU,EACtB,MACJ,CAGA,MAAMoF,EAAQ,MAAMC,KACpBF,EAAYC,CAAK,CACrB,OAAS5F,EAAO,CACZ,QAAQ,MAAM,2BAA4BA,CAAK,CACnD,CACJ,CAKA,SAAS2F,EAAYC,EAAO,CACxB,MAAMrI,EAAY,SAAS,eAAe,iBAAiB,EAC3D,GAAI,CAACA,EAAW,OAEhB,MAAMqH,EAAc,CAChB,KAAM,OACN,OAAQ,SACR,GAAI,KACJ,SAAU,UAClB,EAEIrH,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,qEAK2CqI,EAAM,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAM9D,OAAO,QAAQA,EAAM,QAAQ,EAAE,IAAI,CAAC,CAACE,EAAQC,CAAK,IAAM,CACtD,MAAMC,GAAeD,EAAQH,EAAM,MAAS,KAAK,QAAQ,CAAC,EAC1D,MAAO;AAAA;AAAA;AAAA,+DAGoChB,EAAYkB,CAAM,GAAKA,CAAM;AAAA,8DAC9BC,CAAK,KAAKC,CAAU;AAAA;AAAA;AAAA,2GAGyBA,CAAU;AAAA;AAAA;AAAA,qBAIrG,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,KAI3B,CAKA,SAAS1B,GAAY2B,EAAa,CAC9B,MAAM1I,EAAY,SAAS,eAAe0I,CAAW,EAChD1I,IAELA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAS1B,CAKA,SAAS6G,EAAU6B,EAAaC,EAAS,CACrC,MAAM3I,EAAY,SAAS,eAAe0I,CAAW,EACrD,GAAI,CAAC1I,EAAW,CACZ,MAAM,WAAW2I,CAAO,EAAE,EAC1B,MACJ,CAEA3I,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,oDAK0B2I,CAAO;AAAA;AAAA,KAG3D,CAKA,SAAShC,EAAYgC,EAAS,CAE1B,MAAMC,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,UAAY,kGAClBA,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,0CAKoBD,CAAO;AAAA;AAAA,MAI7C,SAAS,KAAK,YAAYC,CAAK,EAE/B,WAAW,IAAM,CACbA,EAAM,OAAM,CAChB,EAAG,GAAI,CACX,CAKA,SAASzC,EAAW1F,EAAM,CACtB,MAAMoI,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,YAAcpI,EACXoI,EAAI,SACf,CCv0BA,MAAMC,GAAa,CACf,CAAE,GAAI,IAAK,MAAO,2BAA4B,YAAa,2BAA4B,KAAM,QAAS,aAAc,EAAG,aAAc,EAAG,UAAW,IAAI,KAAK,YAAY,EAAG,UAAW,IAAI,IAAM,EAChM,CAAE,GAAI,IAAK,MAAO,2BAA4B,YAAa,eAAgB,KAAM,OAAQ,aAAc,GAAI,aAAc,GAAI,UAAW,IAAI,KAAK,YAAY,EAAG,UAAW,IAAI,IAAM,EACrL,CAAE,GAAI,IAAK,MAAO,yBAA0B,YAAa,aAAc,KAAM,OAAQ,aAAc,GAAI,aAAc,GAAI,UAAW,IAAI,KAAK,YAAY,EAAG,UAAW,IAAI,KAAK,KAAK,IAAG,EAAK,KAAQ,CAAC,EACtM,CAAE,GAAI,IAAK,MAAO,6BAA8B,YAAa,iBAAkB,KAAM,OAAQ,aAAc,GAAI,aAAc,GAAI,UAAW,IAAI,KAAK,YAAY,EAAG,UAAW,IAAI,KAAK,KAAK,IAAG,EAAK,MAAS,CAAC,EAC/M,CAAE,GAAI,IAAK,MAAO,2BAA4B,YAAa,eAAgB,KAAM,OAAQ,aAAc,GAAI,aAAc,GAAI,UAAW,IAAI,KAAK,YAAY,EAAG,UAAW,IAAI,KAAK,KAAK,IAAG,EAAK,MAAS,CAAC,CAC/M,EAEM7F,GAAa,CACf,MAAO,GACP,OAAQ,EACR,aAAc,GACd,YAAa,EACb,WAAY,EAChB,EAGA,IAAI8F,EAAe,CAAA,EACf5F,EAAiB,CACjB,KAAM,GACN,OAAQ,KACZ,EAGI6F,EAAkB,CAClB,QAAS,KACT,QAAS,GACT,UAAW,GACX,SAAU,EACd,EAKO,eAAeC,IAAmB,CACrC,QAAQ,IAAI,6CAA6C,EAGzD,MAAMC,EAAS,EAGf,MAAM1F,GAAS,EAGfC,IACJ,CAKA,SAASA,IAAqB,CAE1B,MAAM0F,EAAiB,SAAS,eAAe,kBAAkB,EAC7DA,GACAA,EAAe,iBAAiB,SAAUC,EAAgB,EAI9D,MAAMC,EAAsB,SAAS,eAAe,uBAAuB,EACvEA,GACAA,EAAoB,iBAAiB,QAASC,EAAsB,EAIxE,MAAMC,EAAa,SAAS,eAAe,kBAAkB,EACvDC,EAAe,SAAS,eAAe,oBAAoB,EAC3DtF,EAAc,SAAS,eAAe,cAAc,EAEtDqF,GAAYA,EAAW,iBAAiB,SAAUnF,CAAkB,EACpEoF,GAAcA,EAAa,iBAAiB,SAAUpF,CAAkB,EACxEF,GAAaA,EAAY,iBAAiB,QAASG,EAAY,CACvE,CAKA,eAAe+E,GAAiB7I,EAAG,CAC/BA,EAAE,eAAc,EAEhB,MAAMkJ,EAAW,SAAS,eAAe,mBAAmB,EACtDC,EAAa,SAAS,eAAe,qBAAqB,EAC1DnD,EAAY,SAAS,eAAe,iBAAiB,EAG3DkD,EAAS,UAAU,IAAI,QAAQ,EAC/BC,EAAW,UAAU,IAAI,QAAQ,EAGjC,MAAMC,EAAW,IAAI,SAASpJ,EAAE,MAAM,EAChCqJ,EAAW,CACb,YAAaD,EAAS,IAAI,aAAa,EACvC,MAAOA,EAAS,IAAI,OAAO,EAC3B,SAAUA,EAAS,IAAI,UAAU,EACjC,KAAMA,EAAS,IAAI,MAAM,CACjC,EAGI,GAAI,CAACC,EAAS,aAAe,CAACA,EAAS,OAAS,CAACA,EAAS,UAAY,CAACA,EAAS,KAAM,CAClFC,EAAcJ,EAAU,mCAAmC,EAC3Db,EAAM,MAAM,kCAAkC,EAC9C,MACJ,CAEA,GAAIgB,EAAS,SAAS,OAAS,EAAG,CAC9BC,EAAcJ,EAAU,qDAAqD,EAC7Eb,EAAM,MAAM,gDAAgD,EAC5D,MACJ,CAGArC,EAAU,SAAW,GACrBA,EAAU,YAAc,yBACxB,MAAMuD,EAAelB,EAAM,iBAAiB,8BAA+B,EAE3E,GAAI,CACA,cAAQ,IAAI,oCAAsCgB,EAAS,KAAK,EAIhEhB,EAAM,mBAAmBkB,EAAc,yBAA0B,OAAO,EAClE,IAAI,MAAM;AAAA;AAAA;AAAA;AAAA,qCAAqW,CAwBzX,OAASrH,EAAO,CACZ,QAAQ,MAAM,iCAAkCA,CAAK,EACrDoH,EAAcJ,EAAUhH,EAAM,OAAO,CACzC,QAAC,CAEG8D,EAAU,SAAW,GACrBA,EAAU,YAAc,uBAC5B,CACJ,CAKA,SAAS+C,IAAyB,CAC9B,MAAMS,EAAQ,+DAEd,IAAIC,EAAW,GAEf,QAASC,EAAI,EAAGA,EAAI,GAAQA,IACxBD,GAAYD,EAAM,OAAO,KAAK,MAAM,KAAK,SAAWA,EAAM,MAAM,CAAC,EAIrE,MAAMG,EAAgB,SAAS,cAAc,wBAAwB,EACjEA,IACAA,EAAc,MAAQF,EACtBE,EAAc,KAAO,OAGrB,UAAU,UAAU,UAAUF,CAAQ,EAAE,KAAK,IAAM,CAC/CpB,EAAM,QAAQ,6DAA8D,GAAI,CACpF,CAAC,EAAE,MAAM,IAAM,CACXA,EAAM,QAAQ,wBAAwBoB,CAAQ;AAAA;AAAA,yBAA+B,GAAI,CACrF,CAAC,EAET,CAKA,SAASH,EAAcJ,EAAUd,EAAS,CACtCc,EAAS,YAAcd,EACvBc,EAAS,UAAU,OAAO,QAAQ,EAClCA,EAAS,eAAe,CAAE,SAAU,SAAU,MAAO,SAAS,CAAE,CACpE,CAKA,eAAeP,GAAY,CACvB,GAAI,CAQA,GANkB,SAAS,eAAe,YAAY,GAElDpE,EAAa,aAAcqF,GAAmB,EAAE,CAAC,EAIjDlI,EAAU,EAAI,CACd,QAAQ,IAAI,uDAAuD,EAGnE,MAAM,IAAI,QAAQF,GAAW,WAAWA,EAAS,GAAG,CAAC,EAGrDgH,EAAeD,GAAW,OAAOxG,GAAQ,CACrC,GAAIa,EAAe,MAAQb,EAAK,OAASa,EAAe,KAAM,MAAO,GAErE,GAAIA,EAAe,SAAW,MAAO,CACjC,MAAMiH,EAAa,IAAI,KACvBA,EAAW,QAAQA,EAAW,QAAO,EAAK,CAAC,EAE3C,MAAMC,EADgB/H,EAAK,UACM8H,EAGjC,GADIjH,EAAe,SAAW,UAAY,CAACkH,GACvClH,EAAe,SAAW,YAAckH,EAAU,MAAO,EACjE,CAEA,MAAO,EACX,CAAC,EAED,QAAQ,IAAI,KAAKtB,EAAa,MAAM,+BAA+B,EACnEuB,IACA,MACJ,CAGA,MAAMrF,EAAU,CAAA,EACZ9B,EAAe,OACf8B,EAAQ,KAAO9B,EAAe,MAIlC6F,EAAgB,QAAU,KAC1BA,EAAgB,QAAU,GAE1B,MAAMtB,EAAS,MAAM6C,GAAqBtF,EAAS+D,EAAgB,SAAU,IAAI,EAMjF,GALAD,EAAerB,EAAO,MACtBsB,EAAgB,QAAUtB,EAAO,QACjCsB,EAAgB,QAAUtB,EAAO,QAG7BvE,EAAe,SAAW,MAAO,CACjC,MAAMiH,EAAa,IAAI,KACvBA,EAAW,QAAQA,EAAW,QAAO,EAAK,CAAC,EAE3CrB,EAAeA,EAAa,OAAOzG,GAAQ,CACvC,GAAI,CAACA,EAAK,UAAW,OAAOa,EAAe,SAAW,WAGtD,MAAMkH,GADgB/H,EAAK,UAAU,OAASA,EAAK,UAAU,OAAM,EAAK,IAAI,KAAKA,EAAK,SAAS,GAC9D8H,EAEjC,OAAOjH,EAAe,SAAW,SAAWkH,EAAW,CAACA,CAC5D,CAAC,CACL,CAEA,QAAQ,IAAI,yBAAyBtB,EAAa,MAAM,EAAE,EAC1DuB,IACAE,IACJ,OAAS/H,EAAO,CACZ,QAAQ,MAAM,kCAAmCA,CAAK,EACtD,MAAMzC,EAAY,SAAS,eAAe,YAAY,EACtD,GAAIA,EAAW,CAEX,MAAMyK,EAAmBtE,EAAW1D,EAAM,OAAO,EACjDzC,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCAMOyK,CAAgB;AAAA;AAAA,aAGjD,CACJ,CACJ,CAKA,SAASH,GAAkB,CACvB,MAAMtK,EAAY,SAAS,eAAe,YAAY,EACtD,GAAKA,EAEL,IAAI+I,EAAa,SAAW,EAAG,CAC3B/I,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAQtB,MACJ,CAEAA,EAAU,UAAY+I,EAAa,IAAIzG,GAAQoI,GAAepI,CAAI,CAAC,EAAE,KAAK,EAAE,EAG5EqI,KACJ,CAKA,eAAeC,IAAgB,CAC3B,GAAI,EAAA5B,EAAgB,WAAa,CAACA,EAAgB,SAIlD,GAAI,CACAA,EAAgB,UAAY,GAE5B,MAAM/D,EAAU,CAAA,EACZ9B,EAAe,OACf8B,EAAQ,KAAO9B,EAAe,MAGlC,MAAMuE,EAAS,MAAM6C,GAAqBtF,EAAS+D,EAAgB,SAAUA,EAAgB,OAAO,EAGpG,IAAI6B,EAAWnD,EAAO,MACtB,GAAIvE,EAAe,SAAW,MAAO,CACjC,MAAMiH,EAAa,IAAI,KACvBA,EAAW,QAAQA,EAAW,QAAO,EAAK,CAAC,EAE3CS,EAAWA,EAAS,OAAOvI,GAAQ,CAC/B,GAAI,CAACA,EAAK,UAAW,OAAOa,EAAe,SAAW,WAGtD,MAAMkH,GADgB/H,EAAK,UAAU,OAASA,EAAK,UAAU,OAAM,EAAK,IAAI,KAAKA,EAAK,SAAS,GAC9D8H,EAEjC,OAAOjH,EAAe,SAAW,SAAWkH,EAAW,CAACA,CAC5D,CAAC,CACL,CAGAtB,EAAe,CAAC,GAAGA,EAAc,GAAG8B,CAAQ,EAC5C7B,EAAgB,QAAUtB,EAAO,QACjCsB,EAAgB,QAAUtB,EAAO,QAEjC4C,IACAE,KAEA,QAAQ,IAAI,KAAKK,EAAS,MAAM,uCAAuC,CAC3E,OAASpI,EAAO,CACZ,QAAQ,MAAM,oDAAqDA,CAAK,EACxEmG,EAAM,MAAM,4DAA4D,CAC5E,QAAC,CACGI,EAAgB,UAAY,EAChC,CACJ,CAKA,SAASwB,IAA2B,CAEhC,MAAMM,EAAmB,SAAS,eAAe,2BAA2B,EAM5E,GALIA,GACAA,EAAiB,OAAM,EAIvB,CAAC9B,EAAgB,SAAWD,EAAa,QAAUC,EAAgB,SACnE,OAGJ,MAAMhJ,EAAY,SAAS,eAAe,YAAY,EACtD,GAAI,CAACA,EAAW,OAEhB,MAAM+K,EAAiB;AAAA;AAAA,cAEb/B,EAAgB,QAAU;AAAA;AAAA;AAAA;AAAA,sBAIlBA,EAAgB,UAAY,WAAa,EAAE;AAAA;AAAA,sBAE3CA,EAAgB,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAM1B;AAAA;AAAA;AAAA;AAAA;AAAA,qBAKH;AAAA;AAAA,cAEL,EAAE;AAAA;AAAA,kBAEAD,EAAa,MAAM,eAAeA,EAAa,OAAS,EAAI,IAAM,EAAE,WAAWA,EAAa,OAAS,EAAI,IAAM,EAAE;AAAA;AAAA;AAAA,MAK/H/I,EAAU,mBAAmB,YAAa+K,CAAc,EAGxD,MAAMC,EAAc,SAAS,eAAe,qBAAqB,EAC7DA,GACAA,EAAY,iBAAiB,QAASJ,EAAa,CAE3D,CAKA,SAASF,GAAepI,EAAM,CAC1B,MAAM2I,EAAU3I,EAAK,OAAS,QACxB4I,EAAYD,EAAU,SAAW,OACjCE,EAAWF,EAAU,KAAO,KAE5BG,EAAY9I,EAAK,UAClBA,EAAK,UAAU,OAASA,EAAK,UAAU,OAAM,EAAK,IAAI,KAAKA,EAAK,SAAS,EAC1E,KAEE0D,EAAY1D,EAAK,UAClBA,EAAK,UAAU,OAASA,EAAK,UAAU,OAAM,EAAK,IAAI,KAAKA,EAAK,SAAS,EAC1E,KAEE+H,EAAWe,GAAc,IAAI,KAASA,EAAc,MAAc,GAAK,IAEvEC,EAAgBD,EAAYE,GAAmBF,CAAS,EAAI,kBAG5DG,EAAkBpF,EAAW7D,EAAK,aAAe,UAAU,EAC3DkJ,EAAYrF,EAAW7D,EAAK,OAAS,EAAE,EACvCmJ,EAAgBtF,EAAW7D,EAAK,aAAe,MAAM,EACrDoJ,EAAYpJ,EAAK,UAAY,oCAAoC,mBAAmBA,EAAK,aAAeA,EAAK,KAAK,CAAC,wCAEzH,MAAO;AAAA,wHAC6GA,EAAK,GAAG;AAAA;AAAA,4BAEpGoJ,CAAS,UAAUD,CAAa;AAAA;AAAA;AAAA;AAAA;AAAA,oFAKwBF,CAAe;AAAA,yEAC1BC,CAAS;AAAA;AAAA;AAAA,0JAGwElJ,EAAK,GAAG,sBAAsBA,EAAK,KAAK,qBAAqBA,EAAK,MAAQ,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yEASjK4I,CAAS,aAAaA,CAAS;AAAA,8BAC1EC,CAAQ,IAAIF,EAAU,QAAU,MAAM;AAAA;AAAA,sEAEEZ,EAAW,8BAAgC,6BAA6B;AAAA,gEAC9EA,EAAW,eAAiB,cAAc;AAAA,8BAC5EA,EAAW,QAAU,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oEAOQrE,EAAYA,EAAU,mBAAmB,OAAO,EAAI,KAAK;AAAA;AAAA;AAAA;AAAA,oEAIzDqF,CAAa;AAAA;AAAA;AAAA;AAAA,sBAI1DJ,EAAkC,GAAxBU,GAAgBrJ,CAAI,CAAM;AAAA;AAAA;AAAA;AAAA,KAK3D,CAKA,SAASqJ,GAAgBrJ,EAAM,CAC3B,MAAMsJ,EAAetJ,EAAK,cAAgB,EACpCuJ,EAAevJ,EAAK,cAAgB,EACpCwJ,EAAgBxJ,EAAK,eAAiB,EAE5C,MAAO;AAAA;AAAA;AAAA,gEAGqDuJ,CAAY;AAAA;AAAA;AAAA;AAAA,gEAIZD,CAAY;AAAA;AAAA;AAAA;AAAA,mEAITE,CAAa;AAAA;AAAA;AAAA;AAAA,KAKhF,CAKA,SAASnB,IAAyB,CAC9B,SAAS,iBAAiB,gBAAgB,EAAE,QAAQoB,GAAO,CACvDA,EAAI,iBAAiB,QAAU,GAAM,CACjC,MAAMC,EAAS,EAAE,cAAc,QAAQ,OACjCC,EAAY,EAAE,cAAc,QAAQ,UACpCC,EAAW,EAAE,cAAc,QAAQ,SACzCC,GAAkBH,EAAQC,EAAWC,CAAQ,CACjD,CAAC,CACL,CAAC,CACL,CAKA,SAASC,GAAkBH,EAAQC,EAAWG,EAAa,CAEvD,MAAMC,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,GAAK,kBACXA,EAAM,UAAY,iFAClBA,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0DAaoClG,EAAW8F,GAAa,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA,wGAImBG,IAAgB,QAAU,QAAU,MAAM;AAAA;AAAA;AAAA;AAAA,qIAIbA,IAAgB,QAAU,iCAAmC,kBAAkB;AAAA,uEAC7IA,IAAgB,QAAU,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qIAOsBA,IAAgB,QAAU,iCAAmC,kBAAkB;AAAA,wEAC5IA,IAAgB,QAAU,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA0B5G,SAAS,KAAK,YAAYC,CAAK,EAG/B,SAAS,eAAe,iBAAiB,GAAG,iBAAiB,QAAS,IAAMA,EAAM,OAAM,CAAE,EAC1F,SAAS,eAAe,iBAAiB,GAAG,iBAAiB,QAAS,IAAMA,EAAM,OAAM,CAAE,EAC1F,SAAS,eAAe,eAAe,GAAG,iBAAiB,QAAS,SAAY,CAC5E,MAAMC,EAAUD,EAAM,cAAc,4BAA4B,GAAG,MAC/DC,IACA,MAAMC,GAAiBP,EAAQC,EAAWK,CAAO,EACjDD,EAAM,OAAM,EAEpB,CAAC,EAGDA,EAAM,iBAAiB,QAAU9L,GAAM,CAC/BA,EAAE,SAAW8L,GAAOA,EAAM,OAAM,CACxC,CAAC,CACL,CAKA,eAAeE,GAAiBP,EAAQC,EAAWK,EAAS,CACxD,MAAME,EAAU,SAAS,eAAe,eAAe,EACvD,GAAI,CAACA,EAAS,OAEd,MAAMC,EAAeD,EAAQ,UACvB1C,EAAelB,EAAM,iBAAiB,wBAAwB,EAEpE,GAAI,CACA4D,EAAQ,SAAW,GACnBA,EAAQ,UAAY,mMAEpB,MAAME,GAAeV,EAAQM,CAAO,EAEpC1D,EAAM,mBAAmBkB,EAAc,wBAAwBmC,CAAS,GAAI,SAAS,EACrFtF,GAAY,wBAAwBsF,CAAS,KAAKK,IAAY,QAAU,QAAU,MAAM,EAAE,EAE1F,MAAMpD,EAAS,EACf,MAAM1F,GAAS,CACnB,OAASf,EAAO,CACZ,QAAQ,MAAM,2BAA4BA,CAAK,EAC/CmG,EAAM,mBAAmBkB,EAAc,wBAAyB,OAAO,EACvElB,EAAM,MAAM,WAAWnG,EAAM,SAAW,qCAAqC,GAAI,GAAI,EACrF+J,EAAQ,SAAW,GACnBA,EAAQ,UAAYC,CACxB,CACJ,CAKA,eAAerI,EAAmB7D,EAAG,CACjC,MAAMuH,EAAavH,EAAE,OAAO,GAAG,QAAQ,eAAgB,EAAE,EAAE,QAAQ,IAAK,EAAE,EAC1E4C,EAAe2E,CAAU,EAAIvH,EAAE,OAAO,MACtC,MAAM2I,EAAS,CACnB,CAKA,SAAS7E,GAAa9D,EAAG,CACrB,MAAMwH,EAAaxH,EAAE,OAAO,MAAM,YAAW,EAE7C,GAAI,CAACwH,EAAY,CACbuC,IACA,MACJ,CAEA,MAAMtC,EAAWe,EAAa,OAAO4D,GAChCA,EAAE,aAAeA,EAAE,YAAY,YAAW,EAAG,SAAS5E,CAAU,GAChE4E,EAAE,OAASA,EAAE,MAAM,cAAc,SAAS5E,CAAU,CAC7D,EAEU/H,EAAY,SAAS,eAAe,YAAY,EACtD,GAAI,CAACA,EAAW,OAEhB,GAAIgI,EAAS,SAAW,EAAG,CAEvB,MAAM4E,EAAiBzG,EAAW4B,CAAU,EAC5C/H,EAAU,UAAY;AAAA;AAAA,0DAE4B4M,CAAc;AAAA;AAAA,UAGhE,MACJ,CAGA,MAAMC,EAAO9D,EACbA,EAAef,EACfsC,IACAvB,EAAe8D,CACnB,CAKA,eAAerJ,IAAY,CACvB,GAAI,CAEA,GAAIvB,EAAU,EAAI,CACd,QAAQ,IAAI,8DAA8D,EAC1EmG,EAAYnF,EAAU,EACtB,MACJ,CAGA,MAAMoF,EAAQ,MAAMyE,KACpB1E,EAAYC,CAAK,CACrB,OAAS5F,EAAO,CACZ,QAAQ,MAAM,2BAA4BA,CAAK,CACnD,CACJ,CAKA,SAAS2F,EAAYC,EAAO,CACxB,MAAMrI,EAAY,SAAS,eAAe,aAAa,EACvD,GAAI,CAACA,EAAW,OAEhB,MAAM+M,EAAmB1E,EAAM,MAAQ,EAAI,KAAK,MAAOA,EAAM,eAAiBA,EAAM,MAAS,GAAG,EAAI,EAEpGrI,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yEAM+CqI,EAAM,KAAK;AAAA;AAAA;AAAA;AAAA,yEAIXA,EAAM,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sDAS/BA,EAAM,cAAc,KAAK0E,CAAgB;AAAA;AAAA;AAAA,kGAGGA,CAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oEAM9C1E,EAAM,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA,oEAKlBA,EAAM,YAAY;AAAA;AAAA;AAAA;AAAA,KAKtF,CA6CA,SAAS1B,GAAYgC,EAAS,CAC1B,MAAMC,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,UAAY,kGAEd,MAAMoE,EAAc7G,EAAWwC,CAAO,EACtCC,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,0CAKgBoE,CAAW;AAAA;AAAA,MAIjD,SAAS,KAAK,YAAYpE,CAAK,EAE/B,WAAW,IAAM,CACbA,EAAM,OAAM,CAChB,EAAG,GAAI,CACX,CAKA,SAAS0C,GAAmB2B,EAAM,CAE9B,MAAMC,EADM,IAAI,KACGD,EACbE,EAAU,KAAK,MAAMD,EAAO,GAAK,EACjCE,EAAQ,KAAK,MAAMF,EAAO,IAAO,EACjCG,EAAO,KAAK,MAAMH,EAAO,KAAQ,EAEvC,OAAIC,EAAU,EAAU,cACpBA,EAAU,GAAW,UAAUA,CAAO,OACtCC,EAAQ,GAAW,UAAUA,CAAK,IAClCC,IAAS,EAAU,OACnBA,EAAO,EAAU,UAAUA,CAAI,SAC/BA,EAAO,GAAW,UAAU,KAAK,MAAMA,EAAO,CAAC,CAAC,YAC7CJ,EAAK,mBAAmB,OAAO,CAC1C,CCp0BA,MAAMK,EAAY,CACd,MAAO,CACH,WAAY,GACZ,aAAc,IACd,eAAgB,IAChB,eAAgB,GAChB,SAAU,GACV,iBAAkB,EAClB,gBAAiB,GACjB,aAAc,GACd,YAAa,EACrB,EACI,SAAU,CACN,CAAE,GAAI,IAAK,MAAO,2BAA4B,YAAa,eAAgB,aAAc,GAAI,aAAc,EAAE,EAC7G,CAAE,GAAI,IAAK,MAAO,yBAA0B,YAAa,aAAc,aAAc,GAAI,aAAc,EAAE,EACzG,CAAE,GAAI,IAAK,MAAO,6BAA8B,YAAa,iBAAkB,aAAc,GAAI,aAAc,EAAE,EACjH,CAAE,GAAI,IAAK,MAAO,2BAA4B,YAAa,eAAgB,aAAc,GAAI,aAAc,EAAE,EAC7G,CAAE,GAAI,IAAK,MAAO,yBAA0B,YAAa,aAAc,aAAc,GAAI,aAAc,EAAE,EACzG,CAAE,GAAI,IAAK,MAAO,4BAA6B,YAAa,gBAAiB,aAAc,GAAI,aAAc,EAAE,EAC/G,CAAE,GAAI,IAAK,MAAO,2BAA4B,YAAa,eAAgB,aAAc,GAAI,aAAc,EAAE,EAC7G,CAAE,GAAI,IAAK,MAAO,0BAA2B,YAAa,cAAe,aAAc,GAAI,aAAc,EAAE,EAC3G,CAAE,GAAI,IAAK,MAAO,4BAA6B,YAAa,gBAAiB,aAAc,GAAI,aAAc,EAAE,EAC/G,CAAE,GAAI,KAAM,MAAO,6BAA8B,YAAa,iBAAkB,aAAc,GAAI,aAAc,EAAE,CAC1H,EACI,eAAgB,CACZ,CAAE,GAAI,IAAK,SAAU,eAAgB,OAAQ,kBAAmB,MAAO,GAAI,YAAa,IAAI,KAAK,KAAK,IAAG,EAAK,GAAM,CAAC,EACrH,CAAE,GAAI,IAAK,SAAU,aAAc,OAAQ,oBAAqB,MAAO,GAAI,YAAa,IAAI,KAAK,KAAK,IAAG,EAAK,IAAM,CAAC,EACrH,CAAE,GAAI,IAAK,SAAU,aAAc,OAAQ,gBAAiB,MAAO,GAAI,YAAa,IAAI,KAAK,KAAK,IAAG,EAAK,KAAO,CAAC,EAClH,CAAE,GAAI,IAAK,SAAU,iBAAkB,OAAQ,iBAAkB,MAAO,GAAI,YAAa,IAAI,KAAK,KAAK,IAAG,EAAK,IAAO,CAAC,EACvH,CAAE,GAAI,IAAK,SAAU,eAAgB,OAAQ,qBAAsB,MAAO,GAAI,YAAa,IAAI,KAAK,KAAK,IAAG,EAAK,IAAO,CAAC,CACjI,EACI,YAAa,CACT,CAAE,OAAQ,OAAQ,eAAgB,GAAI,SAAU,GAAI,YAAa,EAAE,EACnE,CAAE,OAAQ,SAAU,eAAgB,GAAI,SAAU,GAAI,YAAa,EAAE,EACrE,CAAE,OAAQ,KAAM,eAAgB,GAAI,SAAU,GAAI,YAAa,EAAE,EACjE,CAAE,OAAQ,WAAY,eAAgB,GAAI,SAAU,GAAI,YAAa,EAAE,CAC/E,CACA,EAIAC,EAAa,IAAI,cAAe,CAC5B,WAAY,EACZ,aAAc,EACd,eAAgB,EAChB,eAAgB,EAChB,SAAU,EACV,iBAAkB,EAClB,gBAAiB,EACjB,aAAc,EACd,YAAa,CACjB,CAAC,EAGDA,EAAa,IAAI,gBAAiB,IAAI,EACtCA,EAAa,IAAI,eAAgB,IAAI,EACrCA,EAAa,IAAI,gBAAiB,IAAI,EAK/B,eAAeC,IAAqB,CACvCC,EAAO,KAAK,6CAA6C,EAGzDC,KAEA,GAAI,CAEA,MAAM,QAAQ,IAAI,CACdC,GAAe,EACfC,GAAY,EACZC,GAAkB,EAClBC,GAAe,CAC3B,CAAS,EAGDC,KAGAtK,KAGAmF,EAAM,QAAQ,iCAAkC,GAAI,CAExD,OAASnG,EAAO,CAChBgL,EAAO,MAAM,iCAAkChL,CAAK,EAEhDmG,EAAM,MAAM,yCAA0C,GAAI,CAC9D,CACJ,CAKA,eAAe+E,IAAkB,CAC7B,GAAI,CAEA,IAAIK,EAAcT,EAAa,IAAI,aAAa,EAGhD,GAAItL,EAAU,EAAI,CACdwL,EAAO,KAAK,wDAAwD,EACpEO,EAAcV,EAAU,MACxBC,EAAa,IAAI,cAAeS,CAAW,EAC3CC,IACAR,EAAO,KAAK,oCAAqCO,CAAW,EAC5D,MACJ,CAEJP,EAAO,KAAK,4CAA4C,EAGpD,MAAMS,EAAgB,MAAMC,EAAQC,EAAWC,EAAI,OAAO,CAAC,EAC3DL,EAAY,WAAaE,EAAc,KAGvC,MAAMI,EAAkB,MAAMH,EAAQC,EAAWC,EAAI,aAAa,CAAC,EACnEL,EAAY,aAAeM,EAAgB,KAG3C,IAAIC,EAAa,EACjBD,EAAgB,QAAQE,GAAO,CAC3BD,GAAcC,EAAI,OAAO,OAAS,CACtC,CAAC,EACDR,EAAY,SAAWM,EAAgB,KAAO,EACxC,KAAK,MAAMC,EAAaD,EAAgB,IAAI,EAC5C,EAGN,MAAMG,EAAoB,MAAMN,EAAQC,EAAWC,EAAI,WAAW,CAAC,EACnEL,EAAY,eAAiBS,EAAkB,KAG/C,MAAMC,EAAoB,MAAMP,EAAQC,EAAWC,EAAI,WAAW,CAAC,EACnEL,EAAY,eAAiBU,EAAkB,KAG/C,MAAMC,EAAQ,IAAI,KAClBA,EAAM,SAAS,EAAG,EAAG,EAAG,CAAC,EAEzB,IAAIC,EAAc,EAClBV,EAAc,QAAQM,GAAO,CACzB,MAAMpD,EAAYoD,EAAI,KAAI,EAAG,WAAW,OAAM,EAC1CpD,GAAaA,GAAauD,GAC1BC,GAER,CAAC,EACDZ,EAAY,iBAAmBY,EAG/B,MAAMC,EAAU,IAAI,KACpBA,EAAQ,QAAQA,EAAQ,QAAO,EAAK,CAAC,EAErC,IAAIC,EAAa,EACjBZ,EAAc,QAAQM,GAAO,CACzB,MAAMpD,EAAYoD,EAAI,KAAI,EAAG,WAAW,OAAM,EAC1CpD,GAAaA,GAAayD,GAC1BC,GAER,CAAC,EACDd,EAAY,gBAAkBc,EAG9B,IAAIC,EAAe,EACnBT,EAAgB,QAAQE,GAAO,CAC3B,MAAMQ,EAAcR,EAAI,KAAI,EAAG,aAAa,OAAM,EAC9CQ,GAAeA,GAAeL,GAC9BI,GAER,CAAC,EACDf,EAAY,aAAee,EAG3B,IAAIE,EAAc,EAClBX,EAAgB,QAAQE,GAAO,CAC3B,MAAMQ,EAAcR,EAAI,KAAI,EAAG,aAAa,OAAM,EAC9CQ,GAAeA,GAAeH,GAC9BI,GAER,CAAC,EACDjB,EAAY,YAAciB,EAG1B1B,EAAa,IAAI,cAAeS,CAAW,EAG3CC,IAEJR,EAAO,KAAK,oCAAqCO,CAAW,CAE5D,OAASvL,EAAO,CAChB,MAAAgL,EAAO,MAAM,sCAAuChL,CAAK,EAC/CA,CACV,CACJ,CAKA,eAAemL,IAAe,CAC1B,GAAI,CAEA,GAAI3L,EAAU,EAAI,CACdwL,EAAO,KAAK,+CAA+C,EAC3DyB,EAAe5B,EAAU,QAAQ,EACjCG,EAAO,KAAK,wBAAwB,EACpC,MACJ,CAEJA,EAAO,KAAK,yCAAyC,EAIjD,MAAM5K,EAAIsM,GACNf,EAAWC,EAAI,aAAa,EAC5Be,GAAQ,cAAe,MAAM,EAC7BC,GAAM,GAAI,CACtB,EACcC,EAAkB,MAAMnB,EAAQtL,CAAC,EACjC0M,EAAa,CAAA,EAEnBD,EAAgB,QAAQd,GAAO,CAC3B,MAAMrH,EAAOqH,EAAI,OACXxC,EAAS7E,EAAK,OACdqI,EAAQrI,EAAK,OAAS,EAEvBoI,EAAWvD,CAAM,IAClBuD,EAAWvD,CAAM,EAAI,CACjB,OAAQA,EACR,SAAU7E,EAAK,UAAY,cAC3B,aAAc,EACd,WAAY,EACZ,SAAU,CAC9B,GAGYoI,EAAWvD,CAAM,EAAE,eACnBuD,EAAWvD,CAAM,EAAE,YAAcwD,CACrC,CAAC,EAGD,OAAO,OAAOD,CAAU,EAAE,QAAQjN,GAAQ,CACtCA,EAAK,SAAW,KAAK,MAAMA,EAAK,WAAaA,EAAK,YAAY,CAClE,CAAC,EAGD,MAAMmN,EAAW,OAAO,OAAOF,CAAU,EACpC,KAAK,CAAC,EAAGG,IAAMA,EAAE,SAAW,EAAE,QAAQ,EACtC,MAAM,EAAG,EAAE,EAGhBR,EAAeO,CAAQ,EAE3BhC,EAAO,KAAK,gCAAiCgC,CAAQ,CAErD,OAAShN,EAAO,CAChB,MAAAgL,EAAO,MAAM,iCAAkChL,CAAK,EAC1CA,CACV,CACJ,CAKA,eAAeoL,IAAqB,CAChC,GAAI,CAEA,GAAI5L,EAAU,EAAI,CACdwL,EAAO,KAAK,oDAAqD,EACjEkC,EAAqBrC,EAAU,cAAc,EAC7CG,EAAO,KAAK,4BAA4B,EACxC,MACJ,CAEJA,EAAO,KAAK,wCAAyC,EAGjD,MAAM5K,EAAIsM,GACNf,EAAWC,EAAI,aAAa,EAC5Be,GAAQ,cAAe,MAAM,EAC7BC,GAAM,EAAE,CACpB,EAEcO,EAAW,MAAMzB,EAAQtL,CAAC,EAC1BgN,EAAa,CAAA,EAEnBD,EAAS,QAAQpB,GAAO,CACpB,MAAMrH,EAAOqH,EAAI,OACjBqB,EAAW,KAAK,CACZ,GAAIrB,EAAI,GACR,SAAUrH,EAAK,UAAY,cAC3B,OAAQA,EAAK,QAAU,SACvB,MAAOA,EAAK,OAAS,EACrB,YAAaA,EAAK,aAAa,OAAM,GAAM,IAAI,IAC/D,CAAa,CACL,CAAC,EAGDwI,EAAqBE,CAAU,EAEnCpC,EAAO,KAAK,8BAA+BoC,CAAU,CAErD,OAASpN,EAAO,CAChB,MAAAgL,EAAO,MAAM,gCAAiChL,CAAK,EACzCA,CACV,CACJ,CAKA,eAAeqL,IAAkB,CAC7B,GAAI,CAEA,GAAI7L,EAAU,EAAI,CACdwL,EAAO,KAAK,yDAAyD,EAErE,MAAMqC,EAAY,CACd,KAAQ,CAAE,MAAO,GAAI,WAAY,KAAM,SAAU,EAAE,EACnD,OAAU,CAAE,MAAO,GAAI,WAAY,KAAM,SAAU,EAAE,EACrD,GAAM,CAAE,MAAO,GAAI,WAAY,KAAM,SAAU,EAAE,EACjD,SAAY,CAAE,MAAO,GAAI,WAAY,KAAM,SAAU,EAAE,CACvE,EACY,OAAArC,EAAO,KAAK,qCAAsCqC,CAAS,EACpDA,CACX,CAEJrC,EAAO,KAAK,uCAAuC,EAE/C,MAAM6B,EAAkB,MAAMnB,EAAQC,EAAWC,EAAI,aAAa,CAAC,EAC7D0B,EAAc,CAAA,EAEpB,OAAAT,EAAgB,QAAQd,GAAO,CAC3B,MAAMrH,EAAOqH,EAAI,OACXjG,EAASpB,EAAK,QAAU,QAEzB4I,EAAYxH,CAAM,IACnBwH,EAAYxH,CAAM,EAAI,CAClB,MAAO,EACP,WAAY,EACZ,SAAU,CAC9B,GAGYwH,EAAYxH,CAAM,EAAE,QACpBwH,EAAYxH,CAAM,EAAE,YAAcpB,EAAK,OAAS,CACpD,CAAC,EAGD,OAAO,OAAO4I,CAAW,EAAE,QAAQC,GAAQ,CACvCA,EAAK,SAAW,KAAK,MAAMA,EAAK,WAAaA,EAAK,KAAK,CAC3D,CAAC,EAELvC,EAAO,KAAK,+BAAgCsC,CAAW,EAC5CA,CAEX,OAAStN,EAAO,CAChB,MAAAgL,EAAO,MAAM,qCAAsChL,CAAK,EAC9CA,CACV,CACJ,CAKA,SAASwL,GAAoB,CACzB,MAAMjO,EAAY,SAAS,eAAe,oBAAoB,EAC9D,GAAI,CAACA,EAAW,OAGhB,MAAMgO,EAAcT,EAAa,IAAI,aAAa,EAElDvN,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mDAWyBmG,EAAW,OAAO6H,EAAY,UAAU,CAAC,CAAC;AAAA;AAAA;AAAA,kFAGXA,EAAY,gBAAgB;AAAA,kFAC5BA,EAAY,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mDAc1DA,EAAY,YAAY;AAAA;AAAA;AAAA,kFAGOA,EAAY,YAAY;AAAA,kFACxBA,EAAY,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mDActDA,EAAY,QAAQ;AAAA;AAAA;AAAA;AAAA,uFAIgBA,EAAY,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mDAexDA,EAAY,cAAc;AAAA;AAAA;AAAA,kFAGKA,EAAY,cAAc;AAAA;AAAA;AAAA,KAI5G,CAKA,SAASkB,EAAee,EAAO,CAC3B,MAAMjQ,EAAY,SAAS,eAAe,gBAAgB,EAC1D,GAAI,CAACA,EAAW,OAEhB,GAAIiQ,EAAM,SAAW,EAAG,CACpB,MAAMC,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,UAAY,kCAClBA,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,UAMlBlQ,EAAU,gBAAgBkQ,CAAK,EAC/B,MACJ,CAEA,MAAM3K,EAAW,SAAS,yBAC1B0K,EAAM,QAAQ,CAAC3N,EAAMsF,IAAU,CAC3B,MAAMuI,EAAQvI,IAAU,EAAI,KAAOA,IAAU,EAAI,KAAOA,IAAU,EAAI,KAAO,GAAGA,EAAQ,CAAC,IACnFwI,EAAUxI,IAAU,EAAI,kCAC1BA,IAAU,EAAI,+BACdA,IAAU,EAAI,wCACd,4BACFyI,EAAc/N,EAAK,UAAYA,EAAK,aAAeA,EAAK,OAAS,cACjEgO,EAAWnK,EAAWkK,CAAW,EAC7BzE,EAAe,OAAO,SAAStJ,EAAK,YAAY,EAAIA,EAAK,aAAe,EACxEiO,EAAW,OAAO,SAASjO,EAAK,QAAQ,EAAIA,EAAK,SAAW,EAEhEkO,EAAO,SAAS,cAAc,SAAS,EACzCA,EAAK,UAAY,2DAA2DJ,CAAO,qCACnFI,EAAK,UAAY;AAAA;AAAA,uDAE8BrK,EAAWgK,CAAK,CAAC;AAAA;AAAA,+DAETG,CAAQ;AAAA,wDACfnK,EAAW,GAAGyF,CAAY,iBAAiB,CAAC;AAAA;AAAA;AAAA;AAAA,kEAIlCzF,EAAW,GAAGoK,CAAQ,GAAG,CAAC;AAAA;AAAA;AAAA,UAIpFhL,EAAS,YAAYiL,CAAI,CAC7B,CAAC,EAEDxQ,EAAU,gBAAgBuF,CAAQ,CACtC,CAKA,SAASoK,EAAqBE,EAAY,CACtC,MAAM7P,EAAY,SAAS,eAAe,sBAAsB,EAChE,GAAI,CAACA,EAAW,OAEhB,GAAI6P,EAAW,SAAW,EAAG,CACzB,MAAMK,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,UAAY,kCAClBA,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,UAMlBlQ,EAAU,gBAAgBkQ,CAAK,EAC/B,MACJ,CAEA,MAAM3K,EAAW,SAAS,yBAC1BsK,EAAW,QAAQY,GAAY,CAC/B,MAAMC,EAAaC,GAAWF,EAAS,WAAW,EAC5CG,EAAUzK,EAAWuK,CAAU,EAC3BG,EAAaJ,EAAS,OAAS,GAAK,iBACtCA,EAAS,OAAS,GAAK,kBACvB,eACFJ,EAAcI,EAAS,UAAY,cACnCH,EAAWnK,EAAWkK,CAAW,EACjCS,EAAa3K,EAAWsK,EAAS,QAAU,QAAQ,EAC/CM,EAAe5K,EAAW,GAAG,OAAO,SAASsK,EAAS,KAAK,EAAIA,EAAS,MAAQ,CAAC,GAAG,EACxFO,EAAgB7K,EAAWkK,EAAY,OAAO,CAAC,EAAE,YAAW,CAAE,EAE1DY,EAAM,SAAS,cAAc,SAAS,EAC5CA,EAAI,UAAY,uFAChBA,EAAI,UAAY;AAAA;AAAA;AAAA,0EAGkDD,CAAa;AAAA;AAAA;AAAA,4DAG3BV,CAAQ;AAAA,wDACZQ,CAAU;AAAA;AAAA;AAAA;AAAA,gDAIlBD,CAAU,KAAKE,CAAY;AAAA,sDACrBH,CAAO;AAAA;AAAA,UAGrDrL,EAAS,YAAY0L,CAAG,CAC5B,CAAC,EAEDjR,EAAU,gBAAgBuF,CAAQ,CACtC,CAKA,SAASwI,IAAe,CAEpBmD,KAGAC,KAGAC,IACJ,CAKA,eAAeF,IAAsB,CACjC,MAAMG,EAAS,SAAS,eAAe,gBAAgB,EACvD,GAAKA,EAEL,GAAI,CACA,IAAIC,EAAQC,EAAQC,EAGpB,GAAIvP,EAAU,EAAI,CACdwL,EAAO,KAAK,yDAAyD,EAGrE6D,EAAS,CAAA,EACTC,EAAS,CAAA,EACTC,EAAY,CAAA,EAEZ,QAASvH,EAAI,GAAIA,GAAK,EAAGA,IAAK,CAC1B,MAAMgD,EAAO,IAAI,KACjBA,EAAK,QAAQA,EAAK,QAAO,EAAKhD,CAAC,EAC/BqH,EAAO,KAAKrE,EAAK,mBAAmB,QAAS,CAAE,IAAK,UAAW,MAAO,OAAO,CAAE,CAAC,EAGhFsE,EAAO,KAAK,KAAK,MAAM,KAAK,SAAW,EAAE,EAAI,CAAC,EAC9CC,EAAU,KAAK,KAAK,MAAM,KAAK,SAAW,EAAE,EAAI,EAAE,CACtD,CACJ,KAAO,CAGH,MAAMC,EAAgB,IAAI,KAC1BA,EAAc,QAAQA,EAAc,QAAO,EAAK,EAAE,EAElD,MAAMnC,EAAkB,MAAMnB,EAAQC,EAAWC,EAAI,aAAa,CAAC,EAC7DqD,EAAY,CAAA,EAGlB,QAASzH,EAAI,EAAGA,EAAI,GAAIA,IAAK,CACzB,MAAMgD,EAAO,IAAI,KACjBA,EAAK,QAAQA,EAAK,QAAO,EAAKhD,CAAC,EAC/B,MAAM0H,EAAU1E,EAAK,YAAW,EAAG,MAAM,GAAG,EAAE,CAAC,EAC/CyE,EAAUC,CAAO,EAAI,CAAE,MAAO,EAAG,WAAY,EACjD,CAGArC,EAAgB,QAAQd,GAAO,CAC3B,MAAMrH,EAAOqH,EAAI,OACXQ,EAAc7H,EAAK,aAAa,OAAM,EAC5C,GAAI6H,GAAeA,GAAeyC,EAAe,CAC7C,MAAME,EAAU3C,EAAY,YAAW,EAAG,MAAM,GAAG,EAAE,CAAC,EAClD0C,EAAUC,CAAO,IACjBD,EAAUC,CAAO,EAAE,QACnBD,EAAUC,CAAO,EAAE,YAAcxK,EAAK,OAAS,EAEvD,CACJ,CAAC,EAGDmK,EAAS,OAAO,KAAKI,CAAS,EAAE,QAAO,EAAG,IAAIzE,GAChC,IAAI,KAAKA,CAAI,EACd,mBAAmB,QAAS,CAAE,IAAK,UAAW,MAAO,OAAO,CAAE,CAC1E,EAEDsE,EAAS,OAAO,OAAOG,CAAS,EAAE,UAAU,IAAIE,GAAKA,EAAE,KAAK,EAC5DJ,EAAY,OAAO,OAAOE,CAAS,EAAE,QAAO,EAAG,IAAIE,GAC/CA,EAAE,MAAQ,EAAI,KAAK,MAAMA,EAAE,WAAaA,EAAE,KAAK,EAAI,CACnE,CACQ,CAIA,MAAMC,EAAgBtE,EAAa,IAAI,eAAe,EAClDsE,GAAeA,EAAc,UAEjC,MAAMC,EAAgB,IAAI,MAAMT,EAAQ,CACpC,KAAM,OACN,KAAM,CACF,OAAQC,EACR,SAAU,CACN,CACI,MAAO,iBACP,KAAMC,EACN,YAAa,mBACb,gBAAiB,yBACjB,QAAS,GACT,QAAS,IACT,qBAAsB,mBACtB,iBAAkB,OAClB,iBAAkB,CAC1C,EACoB,CACI,MAAO,kBACP,KAAMC,EACN,YAAa,oBACb,gBAAiB,0BACjB,QAAS,GACT,QAAS,KACT,qBAAsB,oBACtB,iBAAkB,OAClB,iBAAkB,CAC1C,CACA,CACA,EACY,QAAS,CACL,WAAY,GACZ,oBAAqB,GACrB,YAAa,CACT,KAAM,QACN,UAAW,EAC/B,EACgB,OAAQ,CACJ,EAAG,CACC,KAAM,SACN,QAAS,GACT,SAAU,OACV,MAAO,CACH,QAAS,GACT,KAAM,gBAClC,CACA,EACoB,GAAI,CACA,KAAM,SACN,QAAS,GACT,SAAU,QACV,MAAO,CACH,QAAS,GACT,KAAM,iBAClC,EACwB,KAAM,CACF,gBAAiB,EAC7C,CACA,CACA,EACgB,QAAS,CACL,OAAQ,CACJ,SAAU,KAClC,EACoB,MAAO,CACH,QAAS,GACT,KAAM,wBAC9B,CACA,CACA,CACA,CAAS,EAGDjE,EAAa,IAAI,gBAAiBuE,CAAa,CAEnD,OAASrP,EAAO,CAChBgL,EAAO,MAAM,2CAA4ChL,CAAK,CAC9D,CACJ,CAKA,eAAe0O,IAAqB,CAChC,MAAME,EAAS,SAAS,eAAe,eAAe,EACtD,GAAKA,EAEL,GAAI,CACA,MAAMtB,EAAc,MAAMjC,KAEpBwD,EAAS,OAAO,KAAKvB,CAAW,EAChC5I,EAAO,OAAO,OAAO4I,CAAW,EAAE,IAAIgC,GAAKA,EAAE,KAAK,EAElDC,EAAS,CACX,yBACA,0BACA,yBACA,0BACA,wBACZ,EAGcC,EAAuB1E,EAAa,IAAI,cAAc,EACxD0E,GAAsBA,EAAqB,UAE/C,MAAMC,EAAe,IAAI,MAAMb,EAAQ,CACnC,KAAM,WACN,KAAM,CACF,OAAQC,EACR,SAAU,CAAC,CACP,KAAMnK,EACN,gBAAiB6K,EACjB,YAAa,EACb,YAAa,MACjC,CAAiB,CACjB,EACY,QAAS,CACL,WAAY,GACZ,oBAAqB,GACrB,QAAS,CACL,OAAQ,CACJ,SAAU,QAClC,EACoB,MAAO,CACH,QAAS,GACT,KAAM,wBAC9B,CACA,CACA,CACA,CAAS,EAGDzE,EAAa,IAAI,eAAgB2E,CAAY,CAEjD,OAASzP,EAAO,CAChBgL,EAAO,MAAM,uCAAwChL,CAAK,CAC1D,CACJ,CAKA,eAAe2O,IAAsB,CACjC,MAAMC,EAAS,SAAS,eAAe,gBAAgB,EACvD,GAAKA,EAEL,GAAI,CAEA,MAAMC,EAAS,CAAA,EACTnK,EAAO,CAAA,EAEb,QAAS8C,EAAI,EAAGA,GAAK,EAAGA,IAAK,CACzB,MAAMgD,EAAO,IAAI,KACjBA,EAAK,QAAQA,EAAK,QAAO,EAAKhD,CAAC,EAC/BqH,EAAO,KAAKrE,EAAK,mBAAmB,QAAS,CAAE,QAAS,OAAO,CAAE,CAAC,EAClE9F,EAAK,KAAK,KAAK,MAAM,KAAK,SAAW,EAAE,EAAI,CAAC,CAChD,CAGA,MAAM0K,EAAgBtE,EAAa,IAAI,eAAe,EAClDsE,GAAeA,EAAc,UAEjC,MAAMM,EAAgB,IAAI,MAAMd,EAAQ,CACpC,KAAM,MACN,KAAM,CACF,OAAQC,EACR,SAAU,CAAC,CACP,MAAO,sBACP,KAAMnK,EACN,gBAAiB,yBACjB,YAAa,mBACb,YAAa,EACb,aAAc,EACd,qBAAsB,sBAC1C,CAAiB,CACjB,EACY,QAAS,CACL,WAAY,GACZ,oBAAqB,GACrB,QAAS,CACL,OAAQ,CACJ,QAAS,EACjC,EACoB,MAAO,CACH,QAAS,GACT,KAAM,+BAC9B,CACA,EACgB,OAAQ,CACJ,EAAG,CACC,YAAa,GACb,MAAO,CACH,SAAU,CACtC,CACA,CACA,CACA,CACA,CAAS,EAGDoG,EAAa,IAAI,gBAAiB4E,CAAa,CAEnD,OAAS1P,EAAO,CAChBgL,EAAO,MAAM,wCAAyChL,CAAK,CAC3D,CACJ,CAKO,eAAe2P,IAAc,CAChC,MAAMtI,EAAelB,EAAM,iBAAiB,sBAAsB,EAElE,GAAI,CAEA,KAAM,CAAE,MAAAyJ,CAAK,EAAK,OAAO,MACnB7D,EAAM,IAAI6D,EAGhB7D,EAAI,YAAY,EAAE,EAClBA,EAAI,KAAK,4BAA6B,GAAI,EAAE,EAG5CA,EAAI,YAAY,EAAE,EAClBA,EAAI,KAAK,aAAa,IAAI,KAAI,EAAG,mBAAmB,OAAO,CAAC,GAAI,GAAI,EAAE,EAGtEA,EAAI,YAAY,EAAE,EAClBA,EAAI,KAAK,wBAAyB,GAAI,EAAE,EAExCA,EAAI,YAAY,EAAE,EAClB,IAAI8D,EAAI,GACR9D,EAAI,KAAK,uBAAuB,YAAY,UAAU,GAAI,GAAI8D,CAAC,EAC/DA,GAAK,EACL9D,EAAI,KAAK,eAAe,YAAY,YAAY,GAAI,GAAI8D,CAAC,EACzDA,GAAK,EACL9D,EAAI,KAAK,gBAAgB,YAAY,QAAQ,IAAK,GAAI8D,CAAC,EACvDA,GAAK,EACL9D,EAAI,KAAK,cAAc,YAAY,cAAc,GAAI,GAAI8D,CAAC,EAC1DA,GAAK,EACL9D,EAAI,KAAK,eAAe,YAAY,cAAc,GAAI,GAAI8D,CAAC,EAG3D9D,EAAI,KAAK,mBAAmB,IAAI,KAAI,EAAG,cAAc,MAAM,GAAG,EAAE,CAAC,CAAC,MAAM,EAExE5F,EAAM,mBAAmBkB,EAAc,2BAA4B,SAAS,CAEhF,OAASrH,EAAO,CACZgL,EAAO,MAAM,uBAAwBhL,CAAK,EAC1CmG,EAAM,mBAAmBkB,EAAc,sBAAwB,OAAO,EACtElB,EAAM,MAAM,4CAA6C,GAAI,CACjE,CACJ,CAKO,eAAe2J,IAAsB,CACxC,MAAMzI,EAAelB,EAAM,iBAAiB,sBAAsB,EAElE,GAAI,CAEA,MAAM0G,EAAkB,MAAMnB,EAAQC,EAAWC,EAAI,aAAa,CAAC,EAE7DmE,EAAU,CAAC,OAAQ,cAAe,SAAU,OAAQ,QAAS,YAAa,kBAAmB,kBAAmB,WAAW,EAC3HC,EAAO,CAAA,EAEbnD,EAAgB,QAAQd,GAAO,CAC3B,MAAMrH,EAAOqH,EAAI,OACXvB,EAAO9F,EAAK,aAAa,OAAM,EAAG,eAAe,OAAO,GAAK,MAEnEsL,EAAK,KAAK,CACNxF,EACA9F,EAAK,UAAY,UACjBA,EAAK,QAAU,MACfA,EAAK,OAAS,MACdA,EAAK,MAAQ,MACbA,EAAK,OAAS,EACdA,EAAK,gBAAkB,EACvBA,EAAK,gBAAkB,EACvBA,EAAK,WAAa,CAClC,CAAa,CACL,CAAC,EAED,MAAMuL,EAAM,CAACF,EAAS,GAAGC,CAAI,EAAE,IAAIxB,GAAOA,EAAI,KAAK,GAAG,CAAC,EAAE,KAAK;AAAA,CAAI,EAC5D0B,EAAO,IAAI,KAAK,CAACD,CAAG,EAAG,CAAE,KAAM,yBAAyB,CAAE,EAC1DE,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAO,IAAI,gBAAgBD,CAAI,EACpCC,EAAK,SAAW,qBAAqB,IAAI,KAAI,EAAG,cAAc,MAAM,GAAG,EAAE,CAAC,CAAC,OAC3EA,EAAK,MAAK,EAEVhK,EAAM,mBAAmBkB,EAAc,2BAA4B,SAAS,CAEhF,OAASrH,EAAO,CACZgL,EAAO,MAAM,uBAAwBhL,CAAK,EAC1CmG,EAAM,mBAAmBkB,EAAc,sBAAwB,OAAO,EACtElB,EAAM,MAAM,8BAAgC,GAAI,CACpD,CACJ,CAKA,SAASnF,IAAqB,CAE1B,SAAS,eAAe,gBAAgB,GAAG,iBAAiB,QAAS2O,EAAW,EAChF,SAAS,eAAe,gBAAgB,GAAG,iBAAiB,QAASG,EAAmB,EAGxF,SAAS,eAAe,eAAe,GAAG,iBAAiB,SAAUM,EAAkB,EAGvF,SAAS,eAAe,uBAAuB,GAAG,iBAAiB,QAAS,IAAM,CAC9EjK,EAAM,KAAK,gCAAiC,GAAI,EAChD4E,IACJ,CAAC,CACL,CAKA,eAAeqF,GAAmBtS,EAAG,CACjC,MAAMuS,EAASvS,EAAE,OAAO,MACxBqI,EAAM,KAAK,aAAakK,CAAM,GAAI,GAAI,CAE1C,CAOA,SAASpF,IAAmB,CAED,SAAS,eAAe,oBAAoB,GAE/D5I,EAAa,qBAAsBiO,GAAoB,CAAC,CAAC,EAInC,SAAS,eAAe,gBAAgB,GAE9DjO,EAAa,iBAAkBkO,EAAmB,EAAE,CAAC,EAI/B,SAAS,eAAe,sBAAsB,GAEpElO,EAAa,uBAAwBkO,EAAmB,CAAC,CAAC,EAI9D,MAAMC,EAAyB,SAAS,eAAe,gBAAgB,EACnEA,IACAA,EAAuB,UAAYC,KAGvC,MAAMC,EAAwB,SAAS,eAAe,eAAe,EACjEA,IACAA,EAAsB,UAAYD,KAGtC,MAAME,EAAyB,SAAS,eAAe,gBAAgB,EACnEA,IACAA,EAAuB,UAAYF,IAE3C,CAYA,SAASvC,GAAW1D,EAAM,CAEtB,MAAMC,EADM,IAAI,KACGD,EACboG,EAAU,KAAK,MAAMnG,EAAO,GAAI,EAChCC,EAAU,KAAK,MAAMkG,EAAU,EAAE,EACjCjG,EAAQ,KAAK,MAAMD,EAAU,EAAE,EAC/BE,EAAO,KAAK,MAAMD,EAAQ,EAAE,EAElC,OAAIC,EAAO,EAAU,UAAUA,CAAI,IAC/BD,EAAQ,EAAU,UAAUA,CAAK,IACjCD,EAAU,EAAU,UAAUA,CAAO,MAClC,aACX,CCnhCQrL,GAAY,EAAG,KAAKQ,GAAQ,CACxB,QAAQ,IAAI,qBAAsBA,EAAK,KAAK,EAC5CsG,EAAM,QAAQ,aAAatG,EAAK,aAAeA,EAAK,KAAK,KAAM,GAAI,EAGnE,MAAMgR,EAAY,SAAS,eAAe,YAAY,EAChDC,EAAc,SAAS,eAAe,cAAc,EAEtDD,IAAWA,EAAU,YAAchR,EAAK,aAAeA,EAAK,OAC5DiR,GAAejR,EAAK,WAAUiR,EAAY,IAAMjR,EAAK,UAGzDkL,KACAlK,GAAoB,EACpB2F,GAAgB,EAGhBuK,GAAQ,CAEZ,CAAC,EAAE,MAAM/Q,GAAS,CACd,QAAQ,MAAM,iCAAkCA,CAAK,CAEzD,CAAC,EAKD,SAAS+Q,IAAW,CAChB,MAAMC,EAAe,SAAS,eAAe,mBAAmB,EAC1DC,EAAe,SAAS,eAAe,mBAAmB,EAC1DC,EAAW,SAAS,eAAe,eAAe,EAElDC,EAAe,SAAS,eAAe,eAAe,EACtDC,EAAe,SAAS,eAAe,eAAe,EACtDC,EAAW,SAAS,eAAe,WAAW,EAGpD,SAASC,EAAYC,EAAWC,EAAW,CAEvC,CAACR,EAAcC,EAAcC,CAAQ,EAAE,QAAQ5H,GAAO,CAClDA,EAAI,UAAU,OAAO,wBAAyB,qBAAqB,EACnEA,EAAI,UAAU,IAAI,qBAAsB,gBAAgB,EACxDA,EAAI,aAAa,gBAAiB,OAAO,CAC7C,CAAC,EAGD,CAAC6H,EAAcC,EAAcC,CAAQ,EAAE,QAAQI,GAAO,CAClDA,EAAI,UAAU,IAAI,YAAY,CAClC,CAAC,EAGDF,EAAU,UAAU,OAAO,qBAAsB,gBAAgB,EACjEA,EAAU,UAAU,IAAI,wBAAyB,qBAAqB,EACtEA,EAAU,aAAa,gBAAiB,MAAM,EAC9CC,EAAU,UAAU,OAAO,YAAY,CAC3C,CAGAR,EAAa,iBAAiB,QAAS,IAAMM,EAAYN,EAAcG,CAAY,CAAC,EACpFF,EAAa,iBAAiB,QAAS,IAAMK,EAAYL,EAAcG,CAAY,CAAC,EACpFF,EAAS,iBAAiB,QAAS,IAAMI,EAAYJ,EAAUG,CAAQ,CAAC,CAC5E,CAGA,SAAS,eAAe,cAAc,GAAG,iBAAiB,QAAUvT,GAAM,CACtEA,EAAE,eAAc,EACZ,QAAQ,yCAAyC,GACjD4T,GAAW,EAAG,KAAK,IAAM,CACrB,OAAO,SAAS,KAAO,GAC3B,CAAC,CAET,CAAC"}