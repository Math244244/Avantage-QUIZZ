import{v as C,p,o as x,w as n,x as a,y as $,z as k}from"./auth-NyiblVhF.js";import{s as T,c as j}from"./skeleton-BmdGa2iR.js";import{getDocs as L,query as b,collection as h,where as A,orderBy as U,addDoc as M,deleteDoc as S,doc as N}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";let d=[],u=[],m=!1;const V={guides:{name:"Guides",icon:"üìñ",color:"blue"},manuels:{name:"Manuels",icon:"üìã",color:"green"},reglements:{name:"R√®glements",icon:"üõ°Ô∏è",color:"orange"},formulaires:{name:"Formulaires",icon:"üìù",color:"purple"},videos:{name:"Vid√©os",icon:"üé•",color:"red"}},F={tous:"Tous les modules",auto:"AT-AVE-AVEX",loisir:"VTT, Motoneige, etc.",vr:"V√©hicules R√©cr√©atifs",tracteur:"√âquipement Agricole"};document.addEventListener("DOMContentLoaded",async()=>{C(async e=>{if(!e){window.location.href="/index.html";return}q(e),await z(e.uid),await v()}),document.getElementById("logout-btn")?.addEventListener("click",B),document.getElementById("signout-link")?.addEventListener("click",B),document.getElementById("search-input")?.addEventListener("input",g),document.getElementById("filter-category")?.addEventListener("change",g),document.getElementById("filter-module")?.addEventListener("change",g),document.getElementById("reset-filters-btn")?.addEventListener("click",H),document.getElementById("upload-btn")?.addEventListener("click",O),document.getElementById("cancel-upload-btn")?.addEventListener("click",D),document.getElementById("upload-form")?.addEventListener("submit",_)});function q(e){document.getElementById("user-name")&&(document.getElementById("user-name").textContent=e.displayName||e.email),document.getElementById("user-photo")&&(document.getElementById("user-photo").src=e.photoURL||`https://ui-avatars.com/api/?name=${encodeURIComponent(e.displayName||e.email)}`),document.getElementById("user-display-name")&&(document.getElementById("user-display-name").textContent=e.displayName||e.email),document.getElementById("user-avatar")&&(document.getElementById("user-avatar").src=e.photoURL||`https://ui-avatars.com/api/?name=${encodeURIComponent(e.displayName||e.email)}`)}async function z(e){try{const t=await L(b(h(p,"users"),A("uid","==",e)));t.empty||(m=t.docs[0].data().role==="admin",m&&(document.getElementById("admin-section")?.classList.remove("hidden"),document.getElementById("nav-admin-item")?.classList.remove("hidden"),document.getElementById("admin-badge-nav")?.classList.remove("hidden")))}catch(t){console.error("Erreur lors de la v√©rification du r√¥le:",t)}}async function v(){console.log("üì• Chargement des ressources...");try{document.getElementById("resources-container")&&T("resources-container",j(6));const t=await x(),o=b(h(p,"resources"),A("clientId","==",t),U("createdAt","desc")),s=await L(o);d=[],s.forEach(r=>{d.push({id:r.id,...r.data(),createdAt:r.data().createdAt?.toDate()})}),console.log(`‚úÖ ${d.length} ressources charg√©es`),d.length===0?f():(u=[...d],E()),document.getElementById("resources-loading")?.classList.add("hidden")}catch(e){console.error("‚ùå Erreur lors du chargement des ressources:",e),n.error("Erreur lors du chargement des ressources"),f(),document.getElementById("resources-loading")?.classList.add("hidden")}}function E(){const e=document.getElementById("resources-container");if(e.classList.remove("hidden"),u.length===0){f();return}document.getElementById("no-resources")?.classList.add("hidden"),e.innerHTML=u.map(t=>{const o=V[t.category]||{name:t.category,icon:"üìÑ",color:"gray"},s=t.createdAt?new Date(t.createdAt).toLocaleDateString("fr-FR"):"Date inconnue",r=a(t.title||""),c=a(t.description||"Aucune description"),l=a(o.name),i=a(F[t.module]||t.module||""),y=a(s),R=a(t.id),I=a(t.url||"#"),w=t.downloads?a(String(t.downloads)):"";return`
            <div class="file-card bg-white rounded-xl shadow-md hover:shadow-xl transition-all overflow-hidden fade-in">
                <div class="p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div class="file-icon text-4xl">${o.icon}</div>
                        ${m?`
                            <button onclick="deleteResource('${R}')" class="text-red-600 hover:text-red-800 transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        `:""}
                    </div>
                    
                    <h3 class="text-lg font-bold text-slate-900 mb-2">${r}</h3>
                    <p class="text-sm text-slate-600 mb-4 line-clamp-2">${c}</p>
                    
                    <div class="flex flex-wrap gap-2 mb-4">
                        <span class="px-3 py-1 bg-${o.color}-100 text-${o.color}-700 text-xs font-medium rounded-full">
                            ${l}
                        </span>
                        <span class="px-3 py-1 bg-slate-100 text-slate-700 text-xs font-medium rounded-full">
                            ${i}
                        </span>
                    </div>
                    
                    <div class="flex items-center justify-between text-xs text-slate-500 mb-4">
                        <span>üìÖ ${y}</span>
                        ${w?`<span>‚¨áÔ∏è ${w} t√©l√©chargements</span>`:""}
                    </div>
                    
                    <div class="flex gap-2">
                        <a href="${I}" target="_blank" rel="noopener noreferrer" 
                           class="flex-1 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors font-medium text-center text-sm">
                            üì• T√©l√©charger
                        </a>
                        <a href="${I}" target="_blank" rel="noopener noreferrer" 
                           class="px-4 py-2 border-2 border-indigo-600 text-indigo-600 rounded-lg hover:bg-indigo-50 transition-colors font-medium text-center text-sm">
                            üëÅÔ∏è
                        </a>
                    </div>
                </div>
            </div>
        `}).join("")}function g(){const e=document.getElementById("search-input").value.toLowerCase(),t=document.getElementById("filter-category").value,o=document.getElementById("filter-module").value;u=d.filter(s=>{const r=!e||s.title.toLowerCase().includes(e)||s.description&&s.description.toLowerCase().includes(e),c=!t||s.category===t,l=!o||s.module===o;return r&&c&&l}),E()}function H(){document.getElementById("search-input").value="",document.getElementById("filter-category").value="",document.getElementById("filter-module").value="",u=[...d],E()}window.filterByCategory=function(e){document.getElementById("filter-category").value=e,g()};function O(){document.getElementById("upload-modal")?.classList.remove("hidden")}function D(){document.getElementById("upload-modal")?.classList.add("hidden"),document.getElementById("upload-form")?.reset()}async function _(e){if(e.preventDefault(),!m){n.error("Acc√®s refus√© : vous devez √™tre administrateur");return}const t=document.getElementById("doc-title").value,o=document.getElementById("doc-description").value,s=document.getElementById("doc-category").value,r=document.getElementById("doc-module").value,c=document.getElementById("doc-url").value;if(!t||!s||!r||!c){n.error("Veuillez remplir tous les champs obligatoires");return}const l=n.showLoadingToast("Ajout du document...");try{console.log("üì§ Ajout d'une nouvelle ressource...");const i=$(),y=await x();await M(h(p,"resources"),{title:t,description:o,category:s,module:r,url:c,clientId:y,downloads:0,createdAt:new Date,createdBy:i.uid}),console.log("‚úÖ Ressource ajout√©e avec succ√®s"),n.updateLoadingToast(l,"Document ajout√© avec succ√®s !","success"),D(),await v()}catch(i){console.error("‚ùå Erreur lors de l'ajout de la ressource:",i),n.updateLoadingToast(l,"Erreur d'ajout","error"),n.error("Erreur lors de l'ajout du document",4e3)}}window.deleteResource=async function(e){if(!m){n.error("Acc√®s refus√©");return}if(!confirm("Voulez-vous vraiment supprimer ce document ?")){n.info("Suppression annul√©e",2e3);return}const t=n.showLoadingToast("Suppression du document...");try{console.log("üóëÔ∏è Suppression de la ressource:",e),await S(N(p,"resources",e)),console.log("‚úÖ Ressource supprim√©e"),n.updateLoadingToast(t,"Document supprim√© avec succ√®s !","success"),await v()}catch(o){console.error("‚ùå Erreur lors de la suppression:",o),n.updateLoadingToast(t,"Erreur de suppression","error"),n.error("Erreur lors de la suppression",4e3)}};function f(){document.getElementById("resources-container")?.classList.add("hidden"),document.getElementById("no-resources")?.classList.remove("hidden")}async function B(){try{await k(),window.location.href="/"}catch(e){console.error("Erreur lors de la d√©connexion:",e)}}
//# sourceMappingURL=resources-BmpAT_ik.js.map
