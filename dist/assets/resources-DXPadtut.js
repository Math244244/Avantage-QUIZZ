import{i as L,m as x,o as b,d as g,t as r,A,f as D}from"./auth-BBQLVo24.js";import{s as R,g as $}from"./skeleton-DRQ05dn4.js";import{getDocs as B,query as I,collection as f,where as k,orderBy as T,addDoc as C,deleteDoc as U,doc as j}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";let s=[],a=[],d=!1;const M={guides:{name:"Guides",icon:"üìñ",color:"blue"},manuels:{name:"Manuels",icon:"üìã",color:"green"},reglements:{name:"R√®glements",icon:"üõ°Ô∏è",color:"orange"},formulaires:{name:"Formulaires",icon:"üìù",color:"purple"},videos:{name:"Vid√©os",icon:"üé•",color:"red"}},S={tous:"Tous les modules",auto:"AT-AVE-AVEX",loisir:"VTT, Motoneige, etc.",vr:"V√©hicules R√©cr√©atifs",tracteur:"√âquipement Agricole"};document.addEventListener("DOMContentLoaded",async()=>{if(L()){const e=x();if(e){v(e),e.role==="admin"&&(document.getElementById("nav-admin-item")?.classList.remove("hidden"),document.getElementById("admin-badge-nav")?.classList.remove("hidden"),document.getElementById("admin-section")?.classList.remove("hidden"),d=!0),await m();return}}b(async e=>{if(!e){window.location.href="/login.html";return}v(e),await V(e.uid),await m()}),document.getElementById("logout-btn")?.addEventListener("click",E),document.getElementById("signout-link")?.addEventListener("click",E),document.getElementById("search-input")?.addEventListener("input",u),document.getElementById("filter-category")?.addEventListener("change",u),document.getElementById("filter-module")?.addEventListener("change",u),document.getElementById("reset-filters-btn")?.addEventListener("click",N),document.getElementById("upload-btn")?.addEventListener("click",F),document.getElementById("cancel-upload-btn")?.addEventListener("click",w),document.getElementById("upload-form")?.addEventListener("submit",q)});function v(e){document.getElementById("user-name")&&(document.getElementById("user-name").textContent=e.displayName||e.email),document.getElementById("user-photo")&&(document.getElementById("user-photo").src=e.photoURL||`https://ui-avatars.com/api/?name=${encodeURIComponent(e.displayName||e.email)}`),document.getElementById("user-display-name")&&(document.getElementById("user-display-name").textContent=e.displayName||e.email),document.getElementById("user-avatar")&&(document.getElementById("user-avatar").src=e.photoURL||`https://ui-avatars.com/api/?name=${encodeURIComponent(e.displayName||e.email)}`)}async function V(e){try{const t=await B(I(f(g,"users"),k("uid","==",e)));t.empty||(d=t.docs[0].data().role==="admin",d&&(document.getElementById("admin-section")?.classList.remove("hidden"),document.getElementById("nav-admin-item")?.classList.remove("hidden"),document.getElementById("admin-badge-nav")?.classList.remove("hidden")))}catch(t){console.error("Erreur lors de la v√©rification du r√¥le:",t)}}async function m(){console.log("üì• Chargement des ressources...");try{document.getElementById("resources-container")&&R("resources-container",$(6));const t=I(f(g,"resources"),T("createdAt","desc")),o=await B(t);s=[],o.forEach(n=>{s.push({id:n.id,...n.data(),createdAt:n.data().createdAt?.toDate()})}),console.log(`‚úÖ ${s.length} ressources charg√©es`),s.length===0?y():(a=[...s],h()),document.getElementById("resources-loading")?.classList.add("hidden")}catch(e){console.error("‚ùå Erreur lors du chargement des ressources:",e),r.error("Erreur lors du chargement des ressources"),y(),document.getElementById("resources-loading")?.classList.add("hidden")}}function h(){const e=document.getElementById("resources-container");if(e.classList.remove("hidden"),a.length===0){y();return}document.getElementById("no-resources")?.classList.add("hidden"),e.innerHTML=a.map(t=>{const o=M[t.category]||{name:t.category,icon:"üìÑ",color:"gray"},n=t.createdAt?new Date(t.createdAt).toLocaleDateString("fr-FR"):"Date inconnue";return`
            <div class="file-card bg-white rounded-xl shadow-md hover:shadow-xl transition-all overflow-hidden fade-in">
                <div class="p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div class="file-icon text-4xl">${o.icon}</div>
                        ${d?`
                            <button onclick="deleteResource('${t.id}')" class="text-red-600 hover:text-red-800 transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        `:""}
                    </div>
                    
                    <h3 class="text-lg font-bold text-slate-900 mb-2">${t.title}</h3>
                    <p class="text-sm text-slate-600 mb-4 line-clamp-2">${t.description||"Aucune description"}</p>
                    
                    <div class="flex flex-wrap gap-2 mb-4">
                        <span class="px-3 py-1 bg-${o.color}-100 text-${o.color}-700 text-xs font-medium rounded-full">
                            ${o.name}
                        </span>
                        <span class="px-3 py-1 bg-slate-100 text-slate-700 text-xs font-medium rounded-full">
                            ${S[t.module]||t.module}
                        </span>
                    </div>
                    
                    <div class="flex items-center justify-between text-xs text-slate-500 mb-4">
                        <span>üìÖ ${n}</span>
                        ${t.downloads?`<span>‚¨áÔ∏è ${t.downloads} t√©l√©chargements</span>`:""}
                    </div>
                    
                    <div class="flex gap-2">
                        <a href="${t.url}" target="_blank" rel="noopener noreferrer" 
                           class="flex-1 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors font-medium text-center text-sm">
                            üì• T√©l√©charger
                        </a>
                        <a href="${t.url}" target="_blank" rel="noopener noreferrer" 
                           class="px-4 py-2 border-2 border-indigo-600 text-indigo-600 rounded-lg hover:bg-indigo-50 transition-colors font-medium text-center text-sm">
                            üëÅÔ∏è
                        </a>
                    </div>
                </div>
            </div>
        `}).join("")}function u(){const e=document.getElementById("search-input").value.toLowerCase(),t=document.getElementById("filter-category").value,o=document.getElementById("filter-module").value;a=s.filter(n=>{const c=!e||n.title.toLowerCase().includes(e)||n.description&&n.description.toLowerCase().includes(e),l=!t||n.category===t,i=!o||n.module===o;return c&&l&&i}),h()}function N(){document.getElementById("search-input").value="",document.getElementById("filter-category").value="",document.getElementById("filter-module").value="",a=[...s],h()}window.filterByCategory=function(e){document.getElementById("filter-category").value=e,u()};function F(){document.getElementById("upload-modal")?.classList.remove("hidden")}function w(){document.getElementById("upload-modal")?.classList.add("hidden"),document.getElementById("upload-form")?.reset()}async function q(e){if(e.preventDefault(),!d){r.error("Acc√®s refus√© : vous devez √™tre administrateur");return}const t=document.getElementById("doc-title").value,o=document.getElementById("doc-description").value,n=document.getElementById("doc-category").value,c=document.getElementById("doc-module").value,l=document.getElementById("doc-url").value;if(!t||!n||!c||!l){r.error("Veuillez remplir tous les champs obligatoires");return}const i=r.showLoadingToast("Ajout du document...");try{console.log("üì§ Ajout d'une nouvelle ressource...");const p=A();await C(f(g,"resources"),{title:t,description:o,category:n,module:c,url:l,downloads:0,createdAt:new Date,createdBy:p.uid}),console.log("‚úÖ Ressource ajout√©e avec succ√®s"),r.updateLoadingToast(i,"Document ajout√© avec succ√®s !","success"),w(),await m()}catch(p){console.error("‚ùå Erreur lors de l'ajout de la ressource:",p),r.updateLoadingToast(i,"Erreur d'ajout","error"),r.error("Erreur lors de l'ajout du document",4e3)}}window.deleteResource=async function(e){if(!d){r.error("Acc√®s refus√©");return}if(!confirm("Voulez-vous vraiment supprimer ce document ?")){r.info("Suppression annul√©e",2e3);return}const t=r.showLoadingToast("Suppression du document...");try{console.log("üóëÔ∏è Suppression de la ressource:",e),await U(j(g,"resources",e)),console.log("‚úÖ Ressource supprim√©e"),r.updateLoadingToast(t,"Document supprim√© avec succ√®s !","success"),await m()}catch(o){console.error("‚ùå Erreur lors de la suppression:",o),r.updateLoadingToast(t,"Erreur de suppression","error"),r.error("Erreur lors de la suppression",4e3)}};function y(){document.getElementById("resources-container")?.classList.add("hidden"),document.getElementById("no-resources")?.classList.remove("hidden")}async function E(){try{await D(),window.location.href="/"}catch(e){console.error("Erreur lors de la d√©connexion:",e)}}
//# sourceMappingURL=resources-DXPadtut.js.map
