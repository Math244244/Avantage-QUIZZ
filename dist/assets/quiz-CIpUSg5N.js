const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/admin-C2EvoKlF.js","assets/services-8itqxsnU.js","assets/main-B-0V6797.js","assets/micro-interactions-D_8Ux4Hy.js","assets/micro-interactions-BFjCaGVY.css","assets/main-DaFhL-Ce.css"])))=>i.map(i=>d[i]);
import{a as H,b as he,i as T,l as A,t as g,_ as v,s as fe,u as $,e as x,d as W,g as xe}from"./admin-C2EvoKlF.js";import{query as K,collection as Y,where as b,getDocs as G}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";import{s as u,k as Z}from"./services-8itqxsnU.js";import{getAnalytics as ve,setUserId as we,setUserProperties as be,logEvent as O}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";let f=null;function I(){try{return typeof window<"u"&&"serviceWorker"in navigator?(f=ve(he),console.log("‚úÖ Firebase Analytics initialis√©"),f):(console.warn("‚ö†Ô∏è Firebase Analytics non disponible dans cet environnement"),null)}catch(e){return console.error("‚ùå Erreur initialisation Analytics:",e),null}}function V(e,t={}){if(!f){console.log(`[Analytics] ${e}`,t);return}try{O(f,e,{...t,timestamp:Date.now(),page:window.location.pathname}),console.log(`üìä Event tracked: ${e}`,t)}catch(r){console.error("‚ùå Erreur tracking √©v√©nement:",r)}}function ye(e,t={}){if(!f){console.error("[Analytics Error]",e,t);return}try{O(f,"exception",{description:e.message||"Unknown error",fatal:!1,error_type:e.name||"Error",error_stack:e.stack?.substring(0,500)||"",...t}),console.error("üìä Error tracked:",e.message)}catch(r){console.error("‚ùå Erreur tracking erreur:",r)}}function J(e){if(f)try{we(f,e),console.log("‚úÖ Analytics user set:",e)}catch(t){console.error("‚ùå Erreur d√©finition utilisateur Analytics:",t)}}function ee(e){if(f)try{be(f,e),console.log("‚úÖ Analytics user properties set:",e)}catch(t){console.error("‚ùå Erreur d√©finition propri√©t√©s utilisateur:",t)}}function Ee(e,t=window.location.pathname){if(!f){console.log(`[Analytics PageView] ${e} - ${t}`);return}try{O(f,"page_view",{page_title:e,page_location:window.location.href,page_path:t}),console.log(`üìä Page view tracked: ${e}`)}catch(r){console.error("‚ùå Erreur tracking page view:",r)}}function te(e,t){V("quiz_start",{module_id:e,month:t,timestamp:Date.now()})}function re(e,t,r,s){V("quiz_complete",{module_id:e,score:t,time_elapsed:r,total_questions:s,passed:t>=60})}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{I()}):I(),H&&H.onAuthStateChanged(e=>{e&&(J(e.uid),ee({email:e.email||"",display_name:e.displayName||""}))}));const ze=Object.freeze(Object.defineProperty({__proto__:null,initAnalytics:I,setAnalyticsUser:J,setAnalyticsUserProperties:ee,trackError:ye,trackEvent:V,trackPageView:Ee,trackQuizComplete:re,trackQuizStart:te},Symbol.toStringTag,{value:"Module"}));class se{constructor(t,r){this.maxRequests=t,this.windowMs=r,this.requests=[]}async check(){const t=Date.now();if(this.requests=this.requests.filter(r=>t-r<this.windowMs),this.requests.length>=this.maxRequests){const r=this.requests[0],s=this.windowMs-(t-r);throw new Error(`Trop de requ√™tes. Veuillez patienter ${Math.ceil(s/1e3)} secondes.`)}this.requests.push(t)}reset(){this.requests=[]}getRemainingRequests(){const t=Date.now();return this.requests=this.requests.filter(r=>t-r<this.windowMs),Math.max(0,this.maxRequests-this.requests.length)}}const qe=new se(100,6e4),Ae=new se(50,6e4);async function oe(e,t={}){const r=t.isWrite?Ae:qe;try{return await r.check(),await e()}catch(s){throw s.message.includes("Trop de requ√™tes")&&console.warn("‚ö†Ô∏è Rate limit atteint:",s.message),s}}async function dt(e){return oe(e,{isWrite:!1})}async function mt(e){return oe(e,{isWrite:!0})}const h={NETWORK:"NETWORK",FIRESTORE:"FIRESTORE",AUTH:"AUTH",VALIDATION:"VALIDATION",UNKNOWN:"UNKNOWN"};class ke{constructor(){this.errorLog=[],this.maxLogSize=100,this.setupGlobalHandlers()}setupGlobalHandlers(){window.addEventListener("error",t=>{this.handleError({message:t.message,filename:t.filename,lineno:t.lineno,colno:t.colno,error:t.error,type:h.UNKNOWN},"Global error handler")}),window.addEventListener("unhandledrejection",t=>{this.handleError({message:t.reason?.message||"Unhandled promise rejection",error:t.reason,type:h.UNKNOWN},"Unhandled promise rejection")})}handleError(t,r="Unknown",s={}){const o=this.normalizeError(t,r,s);return this.logError(o),s.showToUser!==!1&&this.showUserMessage(o,s),s.critical&&!T()&&this.sendToFirestore(o).catch(a=>{A.error("Impossible d'envoyer l'erreur √† Firestore:",a)}),o}normalizeError(t,r,s){const o={message:t?.message||String(t)||"Erreur inconnue",stack:t?.stack,context:r,type:this.detectErrorType(t),timestamp:new Date().toISOString(),url:window.location.href,userAgent:navigator.userAgent,...s.metadata};return t?.code&&(o.code=t.code),t?.name&&(o.name=t.name),o}detectErrorType(t){if(!t)return h.UNKNOWN;const r=(t.message||"").toLowerCase(),s=t.code||"";return s==="unavailable"||s==="deadline-exceeded"||r.includes("network")||r.includes("fetch")?h.NETWORK:s==="permission-denied"||s==="unauthenticated"||r.includes("auth")?h.AUTH:s==="invalid-argument"||s==="failed-precondition"||r.includes("validation")?h.VALIDATION:r.includes("firestore")||s.startsWith("firestore")?h.FIRESTORE:h.UNKNOWN}logError(t){this.errorLog.push(t),this.errorLog.length>this.maxLogSize&&this.errorLog.shift();const r=`[${t.type}] ${t.context}: ${t.message}`;t.type===h.NETWORK?A.warn(r,t):A.error(r,t)}showUserMessage(t,r){let s=r.userMessage;if(!s)switch(t.type){case h.NETWORK:s="Probl√®me de connexion. V√©rifiez votre connexion internet.";break;case h.AUTH:s="Erreur d'authentification. Veuillez vous reconnecter.";break;case h.VALIDATION:s="Donn√©es invalides. Veuillez v√©rifier vos informations.";break;case h.FIRESTORE:s="Erreur lors de l'acc√®s aux donn√©es. Veuillez r√©essayer.";break;default:s="Une erreur est survenue. Veuillez r√©essayer."}const o=r.duration||(t.type===h.NETWORK?8e3:5e3);g.error(s,o)}async sendToFirestore(t){try{const{trackError:r}=await v(async()=>{const{trackError:s}=await Promise.resolve().then(()=>ze);return{trackError:s}},void 0);r(new Error(t.message),{error_type:t.type,error_source:t.source,user_id:t.userId||"anonymous"})}catch{console.warn("Analytics non disponible pour tracking erreur")}try{const{db:r}=await v(async()=>{const{db:i}=await import("./admin-C2EvoKlF.js").then(c=>c.y);return{db:i}},__vite__mapDeps([0,1])),{collection:s,addDoc:o,Timestamp:a}=await v(async()=>{const{collection:i,addDoc:c,Timestamp:d}=await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");return{collection:i,addDoc:c,Timestamp:d}},[]),{isCurrentUserAdmin:n}=await v(async()=>{const{isCurrentUserAdmin:i}=await import("./services-8itqxsnU.js").then(c=>c.r);return{isCurrentUserAdmin:i}},__vite__mapDeps([1,0]));if(!await n())return;await o(s(r,"errorLogs"),{...t,timestamp:a.now()})}catch(r){console.error("Impossible d'envoyer l'erreur √† Firestore:",r)}}getRecentErrors(t=10){return this.errorLog.slice(-t)}clearErrorLog(){this.errorLog=[]}}const Ce=new ke,Me={maxRetries:3,initialDelay:1e3,maxDelay:3e4,backoffMultiplier:2,retryableErrors:["unavailable","deadline-exceeded","internal","aborted"],onRetry:null};function X(e,t){if(!e)return!1;const r=e.code||"",s=(e.message||"").toLowerCase();return r==="unavailable"||r==="deadline-exceeded"||s.includes("network")||s.includes("fetch failed")?!0:t.some(o=>r===o||s.includes(o.toLowerCase()))}function Te(e,t,r,s){const o=t*Math.pow(s,e);return Math.min(o,r)}function Se(e){return new Promise(t=>setTimeout(t,e))}async function _e(e,t={}){const r={...Me,...t};let s;try{return await e()}catch(o){if(s=o,!X(o,r.retryableErrors))throw o}for(let o=0;o<r.maxRetries;o++){const a=Te(o,r.initialDelay,r.maxDelay,r.backoffMultiplier);r.onRetry?r.onRetry(o+1,a,s):A.warn(`Nouvelle tentative ${o+1}/${r.maxRetries} dans ${a}ms...`),await Se(a);try{return await e()}catch(n){if(s=n,!X(n,r.retryableErrors))throw n;if(o===r.maxRetries-1)throw Ce.handleError(n,"Retry handler - Max retries reached",{showToUser:!0,userMessage:`√âchec apr√®s ${r.maxRetries} tentatives. Veuillez r√©essayer plus tard.`}),n}}throw s}async function Re(e,t={}){return _e(e,{...t,retryableErrors:["unavailable","deadline-exceeded","internal","aborted","resource-exhausted"],onRetry:t.onRetry||((r,s)=>{A.warn(`Retry Firestore ${r}/${t.maxRetries||3} dans ${s}ms...`)})})}function Le(){const e=document.createElement("canvas");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.pointerEvents="none",e.style.zIndex="9999",document.body.appendChild(e);const t=e.getContext("2d");e.width=window.innerWidth,e.height=window.innerHeight;const r=[],s=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F7DC6F","#BB8FCE","#85C1E2"];for(let a=0;a<150;a++)r.push({x:Math.random()*e.width,y:e.height+Math.random()*100,size:Math.random()*8+4,speedY:-(Math.random()*3+3),speedX:Math.random()*6-3,color:s[Math.floor(Math.random()*s.length)],rotation:Math.random()*360,rotationSpeed:Math.random()*10-5,gravity:.15,opacity:1});function o(){t.clearRect(0,0,e.width,e.height);let a=0;r.forEach((n,l)=>{n.speedY+=n.gravity,n.y+=n.speedY,n.x+=n.speedX,n.rotation+=n.rotationSpeed,n.y>e.height-100&&(n.opacity-=.02),n.opacity>0&&n.y<e.height+50&&(a++,t.save(),t.translate(n.x,n.y),t.rotate(n.rotation*Math.PI/180),t.globalAlpha=n.opacity,t.fillStyle=n.color,t.fillRect(-n.size/2,-n.size/2,n.size,n.size),t.restore())}),a>0?requestAnimationFrame(o):e.remove()}o()}const Q={auto:{name:"AT-AVE-AVEX",color:"indigo",label:"Auto"},loisir:{name:"VTT, Motoneige, etc.",color:"cyan",label:"Loisir"},vr:{name:"V√©hicules R√©cr√©atifs",color:"orange",label:"VR"},tracteur:{name:"√âquipement Agricole",color:"green",label:"Tracteur"}},q=()=>u.get("currentQuiz"),$e=e=>u.set("currentQuiz",e),M=()=>u.get("currentQuestionIndex"),ne=e=>u.set("currentQuestionIndex",e),y=()=>u.get("userAnswers"),ae=e=>u.set("userAnswers",e),B=()=>u.get("startTime"),De=e=>u.set("startTime",e),Ie=()=>u.get("timerInterval"),ie=e=>u.set("timerInterval",e),Qe=()=>u.get("questionStartTime"),le=e=>u.set("questionStartTime",e),Be=()=>u.get("currentStreak"),ce=e=>u.set("currentStreak",e),P=()=>u.get("isPaused"),C=e=>u.set("isPaused",e),N=()=>u.get("pausedDuration"),S=e=>u.set("pausedDuration",e),j=()=>u.get("pauseStartedAt"),z=e=>u.set("pauseStartedAt",e),k=()=>u.get("currentModule"),Oe=e=>u.set("currentModule",e),E=()=>u.get("currentMonth"),Ve=e=>u.set("currentMonth",e),D=()=>u.get("currentYear"),Pe=e=>u.set("currentYear",e),Ne=()=>u.get("hasCurrentQuestionBeenAnswered"),_=e=>u.set("hasCurrentQuestionBeenAnswered",e),je=()=>u.get("quizEventDelegationInitialized"),Ue=e=>u.set("quizEventDelegationInitialized",e),U={indigo:{bg:"bg-ap-red-primary",text:"text-ap-red-primary",border:"border-ap-red-primary"},cyan:{bg:"bg-ap-gold",text:"text-ap-gold",border:"border-ap-gold"},orange:{bg:"bg-orange-600",text:"text-orange-600",border:"border-orange-600"},green:{bg:"bg-green-600",text:"text-green-600",border:"border-green-600"}};async function Fe(e,t,r){console.log(`üì• Chargement des questions: module=${e}, mois=${t}, ann√©e=${r}`);const s=o=>{const a=o.data();return{id:o.id,question:a.question,options:a.options.map((n,l)=>({id:String.fromCharCode(65+l),text:n,correct:l===a.correctAnswer})),explanation:a.explanation||"Pas d'explication disponible",reference:a.reference||"",tags:a.tags||[]}};if(T()){console.log("üìù Mode d√©mo : Chargement des questions simul√©es pour le quiz...");const a=localStorage.getItem("avantage-quizz-demo-questions");let n=[];if(a)try{const l=JSON.parse(a);console.log(`üíæ ${l.length} questions charg√©es depuis localStorage`),n=l.map(i=>({id:i.id,question:i.question,options:i.options.map((c,d)=>({id:String.fromCharCode(65+d),text:c,correct:d===i.correctAnswer})),explanation:i.explanation||"Pas d'explication disponible",reference:i.reference||"",tags:i.tags||[]})),n=n.filter(i=>{const c=!e||l.find(m=>m.id===i.id)?.module===e,d=!t||l.find(m=>m.id===i.id)?.month===t;return c&&d})}catch{console.warn("‚ö†Ô∏è Erreur lecture localStorage, utilisation questions par d√©faut")}return n.length===0&&(console.log("üì¶ Utilisation questions par d√©faut (aucune en localStorage)"),n=[{id:"demo-1",question:"Quelle est la vitesse maximale autoris√©e sur une autoroute au Qu√©bec ?",options:[{id:"A",text:"100 km/h",correct:!1},{id:"B",text:"110 km/h",correct:!1},{id:"C",text:"120 km/h",correct:!1},{id:"D",text:"100 km/h (conditions normales)",correct:!0}],explanation:"La vitesse maximale sur autoroute au Qu√©bec est de 100 km/h, sauf indication contraire.",reference:"Code de la s√©curit√© routi√®re du Qu√©bec",tags:["vitesse","autoroute"]},{id:"demo-2",question:"√Ä quelle distance minimale devez-vous vous arr√™ter derri√®re un autobus scolaire dont les feux clignotent ?",options:[{id:"A",text:"3 m√®tres",correct:!1},{id:"B",text:"5 m√®tres",correct:!0},{id:"C",text:"10 m√®tres",correct:!1},{id:"D",text:"15 m√®tres",correct:!1}],explanation:"Vous devez vous arr√™ter √† au moins 5 m√®tres d'un autobus scolaire.",reference:"Article 460 CSR",tags:["autobus","s√©curit√©"]},{id:"demo-3",question:"Quel est le taux d'alcool√©mie maximal pour conduire au Qu√©bec ?",options:[{id:"A",text:"0.05",correct:!1},{id:"B",text:"0.08",correct:!0},{id:"C",text:"0.10",correct:!1},{id:"D",text:"0.00",correct:!1}],explanation:"Le taux maximal est de 0.08 pour conducteurs exp√©riment√©s.",reference:"Code criminel du Canada",tags:["alcool","s√©curit√©"]},{id:"demo-4",question:"Combien de points d'inaptitude entra√Æne un exc√®s de vitesse de 30 km/h ?",options:[{id:"A",text:"2 points",correct:!1},{id:"B",text:"3 points",correct:!0},{id:"C",text:"4 points",correct:!1},{id:"D",text:"5 points",correct:!1}],explanation:"Un exc√®s de 21 √† 30 km/h entra√Æne 3 points.",reference:"SAAQ",tags:["vitesse","points"]},{id:"demo-5",question:"Quelle est la distance de s√©curit√© recommand√©e entre v√©hicules ?",options:[{id:"A",text:"1 seconde",correct:!1},{id:"B",text:"2 secondes",correct:!0},{id:"C",text:"3 secondes",correct:!1},{id:"D",text:"5 secondes",correct:!1}],explanation:"La r√®gle des 2 secondes est recommand√©e.",reference:"Guide SAAQ",tags:["distance","s√©curit√©"]}]),console.log(`‚úÖ ${n.length} questions d√©mo charg√©es pour le quiz`),n}try{let o=K(Y(W,"questions"),b("module","==",e),b("month","==",t),b("year","==",r)),a=await G(o);if(!a.empty){const d=[];return a.forEach(m=>d.push(s(m))),console.log(`‚úÖ ${d.length} questions (mois num√©rique)`),d}const l=["janvier","f√©vrier","mars","avril","mai","juin","juillet","ao√ªt","septembre","octobre","novembre","d√©cembre"][t-1],i=l.charAt(0).toUpperCase()+l.slice(1).toLowerCase();let c=K(Y(W,"questions"),b("module","==",e),b("month","==",i),b("year","==",r));if(a=await G(c),!a.empty){const d=[];return a.forEach(m=>d.push(s(m))),console.log(`‚úÖ ${d.length} questions (mois texte)`),d}return console.warn("‚ö†Ô∏è Aucune question trouv√©e pour ces crit√®res (num√©rique/texte)"),[]}catch(o){throw console.error("‚ùå Erreur lors du chargement des questions:",o),o}}async function He(e,t,r){try{const s=await fetch("/test-questions-valides.json");if(!s.ok)return[];const o=await s.json(),n=["janvier","f√©vrier","mars","avril","mai","juin","juillet","ao√ªt","septembre","octobre","novembre","d√©cembre"][t-1];return o.filter(i=>i.module===e&&i.year===r&&(i.month===n||i.month===t)).map((i,c)=>({id:`demo-${e}-${c}`,question:i.question,options:i.options.map((d,m)=>({id:String.fromCharCode(65+m),text:d,correct:m===i.correctAnswer})),explanation:i.explanation||"Pas d'explication disponible",reference:i.reference||"",tags:i.tags||[]}))}catch(s){return console.warn("Demo questions fallback error:",s),[]}}async function We(e){const t=Q[e];if(!t){console.error("Module de quiz non trouv√©:",e),g.error("Module non trouv√©. Veuillez r√©essayer.");return}const r=fe(`Chargement du quiz ${t.label}...`);Ke(t.label);try{const{getCurrentMonthNumber:s,getCurrentYear:o,normalizeMonthFormat:a}=await v(async()=>{const{getCurrentMonthNumber:m,getCurrentYear:R,normalizeMonthFormat:L}=await import("./services-8itqxsnU.js").then(p=>p.q);return{getCurrentMonthNumber:m,getCurrentYear:R,normalizeMonthFormat:L}},__vite__mapDeps([1,0])),n=s(),l=o(),i=a(n,l);Ve(i),Pe(l),Oe(e);try{window.__QUIZ_ACTIVE=!0}catch{}let c=await Fe(e,n,l);if(c.length===0&&T()&&(console.log("‚ÑπÔ∏è Mode D√©mo: chargement des questions locales de test"),c=await He(e,n,l)),c.length===0){$(r,"Aucune question disponible","error");const m=E();g.error(`Aucune question trouv√©e pour ${t.label} en ${m}.

Contactez l'administrateur.`,5e3);return}const d=E();$e({name:`Quiz ${t.label} - ${d}`,module:t.name,color:t.color,questions:c}),ne(0),ae([]),De(Date.now()),le(Date.now()),te(e,E()),ce(0),C(!1),S(0),z(null),_(!1),Ye(),de(),rt(),F(),$(r,`${c.length} questions charg√©es !`,"success")}catch(s){w(),console.error("‚ùå Erreur lors du d√©marrage du quiz:",s),$(r,"Erreur de chargement","error"),g.error("Erreur lors du chargement du quiz. Veuillez r√©essayer.",4e3)}}function Ke(e){const t=ue();t.innerHTML=`
        <div class="min-h-screen flex items-center justify-center">
            <div class="text-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-ap-red-primary mx-auto mb-6"></div>
                        <h2 class="text-2xl font-bold text-slate-900 mb-2">Chargement du quiz ${x(e)}</h2>
                <p class="text-slate-600">R√©cup√©ration des questions...</p>
            </div>
        </div>
    `,t.classList.remove("view-hidden")}function Ye(){document.getElementById("dashboard-view")?.classList.add("view-hidden"),document.getElementById("module-selection-view")?.classList.add("view-hidden"),document.getElementById("login-view")?.classList.add("view-hidden"),ue().classList.remove("view-hidden")}function ue(){let e=document.getElementById("quiz-view");return e||(e=document.createElement("div"),e.id="quiz-view",document.querySelector("main").appendChild(e)),Ge(e),e}function Ge(e){je()||!e||(e.addEventListener("click",t=>{const r=t.target.closest(".option-button");if(r&&!r.disabled){const l=r.dataset.optionId;l&&Ze(l);return}if(t.target.closest("#next-question-btn")){t.preventDefault(),Je();return}if(t.target.closest("#quit-quiz-btn")){t.preventDefault(),confirm("Voulez-vous vraiment quitter le quiz ? Votre progression sera perdue.")&&me();return}if(t.target.closest("#focus-mode-btn")){t.preventDefault(),st();return}if(t.target.closest("#pause-btn")){t.preventDefault(),ot();return}}),Ue(!0))}function de(){const e=q(),t=M(),r=e.questions[t],s=document.getElementById("quiz-view"),o=U[e.color];_(!1),s.innerHTML=`
        <!-- En-t√™te du quiz -->
        <div class="bg-white border-b border-gray-200 shadow-sm">
            <div class="max-w-5xl mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-xl font-bold text-slate-900">${x(e.name)}</h1>
                        <p class="text-sm text-slate-500">Question ${t+1} sur ${e.questions.length}</p>
                    </div>
                    <div class="flex items-center gap-6">
                        <button id="focus-mode-btn" class="text-sm font-medium text-slate-600 hover:text-slate-900 flex items-center gap-1" aria-pressed="false" aria-label="Activer le mode focus">
                            <svg aria-hidden="true" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                            Focus
                        </button>
                        <button id="pause-btn" class="text-sm font-medium text-slate-600 hover:text-slate-900 flex items-center gap-1" aria-pressed="false" aria-label="Mettre le quiz en pause">
                            <svg aria-hidden="true" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Pause
                        </button>
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5 text-ap-red-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span id="quiz-score" class="text-sm font-bold text-ap-red-primary">Score: 0%</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span id="quiz-timer" class="text-sm font-medium text-slate-600">0:00</span>
                        </div>
                        <button id="quit-quiz-btn" class="text-sm font-medium text-slate-600 hover:text-slate-900">
                            Quitter
                        </button>
                    </div>
                </div>
                
                <!-- Barre de progression - DOR√âE AVANTAGE PLUS -->
                <div class="mt-4 w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                    <div class="h-2 rounded-full transition-all duration-300 progress-bar-shine" style="background: var(--ap-gradient-gold); width: ${(t+1)/e.questions.length*100}%; box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);"></div>
                </div>
            </div>
        </div>

        <!-- Contenu de la question -->
        <div class="max-w-5xl mx-auto px-6 py-8">
            <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
                
                <!-- En-t√™te de question -->
                <div class="px-8 py-6 bg-gradient-to-r from-slate-50 to-white border-b border-gray-100">
                    <div class="mb-4">
                        <span class="text-sm font-medium ${o.text}">Question ${t+1} sur ${e.questions.length}</span>
                    </div>
                    
                    <h2 class="text-2xl font-bold text-slate-900 leading-relaxed">
                        ${x(r.question)}
                    </h2>
                    
                    <!-- Tags -->
                    ${r.tags&&r.tags.length>0?`
                        <div class="flex flex-wrap gap-2 mt-4">
                            ${r.tags.map(a=>`
                                <span class="px-3 py-1 bg-slate-100 text-slate-600 text-xs font-medium rounded-full">
                                    ${x(a)}
                                </span>
                            `).join("")}
                        </div>
                    `:""}
                </div>

                <!-- Options de r√©ponse -->
                <div class="p-8">
                    <div class="space-y-3">
                        ${r.options.map(a=>`
                            <button data-option-id="${x(a.id)}" 
                                    class="option-button w-full text-left px-6 py-5 rounded-xl border-2 border-gray-200 hover:border-ap-red-primary hover:bg-ap-red-50 transition-all duration-200 group">
                                <div class="flex items-center gap-4">
                                    <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-ap-red-100 flex items-center justify-center group-hover:bg-ap-red-primary group-hover:text-white transition-all">
                                        <span class="text-lg font-bold text-ap-red-primary group-hover:text-white">${x(a.id)}</span>
                                    </div>
                                    <span class="text-lg text-slate-700 group-hover:text-slate-900 font-medium">
                                        ${x(a.text)}
                                    </span>
                                </div>
                            </button>
                        `).join("")}
                    </div>
                </div>

                <!-- Zone d'explication (cach√©e initialement) -->
                <div id="explanation-area" class="hidden px-8 py-6 bg-slate-50 border-t border-gray-200">
                    <!-- Sera rempli apr√®s la r√©ponse -->
                </div>

                <!-- Bouton suivant (cach√© initialement) -->
                <div id="next-button-area" class="hidden px-8 py-6 border-t border-gray-200">
                    <div class="flex justify-between items-center">
                        <p class="text-sm text-slate-500">Question suivante dans quelques secondes...</p>
                        <button id="next-question-btn" class="bg-ap-red-primary hover:bg-ap-red-dark text-white px-6 py-3 rounded-lg font-semibold transition-all flex items-center gap-2 shadow-ap-md hover:shadow-ap-lg transform hover:-translate-y-1">
                            Question suivante
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `,F()}function Ze(e){if(Ne())return;const t=q(),r=M(),s=Qe(),o=t.questions[r],a=o.options.find(c=>c.id===e),n=Math.floor((Date.now()-s)/1e3);_(!0);const l=y();l.push({questionId:o.id,question:o.question,selectedAnswer:e,correctAnswer:o.options.find(c=>c.correct).id,isCorrect:a.correct,timeSpent:n}),ae(l);let i=Be();a.correct?i++:i=0,ce(i),document.querySelectorAll(".option-button").forEach(c=>{c.disabled=!0,c.classList.remove("hover:border-ap-red-primary","hover:bg-ap-red-50")}),Xe(e,a.correct,o),F(),setTimeout(()=>{document.getElementById("next-button-area")?.classList.remove("hidden")},1e3)}function Xe(e,t,r){const s=q();U[s.color];const o=r.options.find(n=>n.correct);document.querySelectorAll(".option-button").forEach(n=>{const l=n.dataset.optionId;l===o.id?(n.classList.add("border-green-500","bg-green-50"),n.classList.remove("border-gray-200")):l===e&&!t&&(n.classList.add("border-red-500","bg-red-50"),n.classList.remove("border-gray-200"))});const a=document.getElementById("explanation-area");a&&(a.innerHTML=`
            <div class="flex items-start gap-4">
                ${t?'<div class="flex-shrink-0 w-12 h-12 rounded-full bg-green-100 flex items-center justify-center"><svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div>':'<div class="flex-shrink-0 w-12 h-12 rounded-full bg-red-100 flex items-center justify-center"><svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></div>'}
                <div class="flex-1">
                    <h3 class="text-lg font-bold ${t?"text-green-700":"text-red-700"} mb-2">
                        ${t?"‚úÖ Bonne r√©ponse !":"‚ùå R√©ponse incorrecte"}
                    </h3>
                    <p class="text-slate-700 mb-2"><strong>Explication :</strong> ${x(r.explanation)}</p>
                    ${r.reference?`<p class="text-sm text-slate-500"><strong>R√©f√©rence :</strong> ${x(r.reference)}</p>`:""}
                </div>
            </div>
        `,a.classList.remove("hidden"))}function Je(){le(Date.now());const e=M();ne(e+1);const t=q();M()<t.questions.length?de():et()}async function et(){w();try{window.__QUIZ_ACTIVE=!1}catch{}const e=y();if(e.length===0){console.error("‚ùå Aucune r√©ponse enregistr√©e - quiz invalide"),g.error("Aucune r√©ponse enregistr√©e. Le quiz ne peut pas √™tre compl√©t√©.");return}const{calculateScore:t}=await v(async()=>{const{calculateScore:p}=await Promise.resolve().then(()=>pe);return{calculateScore:p}},void 0),r=t(e);if(isNaN(r)||r<0||r>100){console.error("‚ùå Score invalide calcul√©:",r),g.error("Erreur de calcul du score. Contactez le support.");return}const s=N(),o=P(),a=j();let n=s;o&&a&&(n+=Date.now()-a);const l=B(),i=Math.max(0,Math.floor((Date.now()-l-n)/1e3));C(!1),z(null),S(0);const c=Math.floor(i/60),d=i%60;tt(r,i);const m=q();if(!m){console.error("‚ùå currentQuiz non d√©fini dans showResults"),g.error("Erreur: Impossible d'afficher les r√©sultats. Veuillez r√©essayer.");return}U[m.color];const R=document.getElementById("quiz-view");R.innerHTML=`
        <div class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 py-12 px-4">
            <div class="max-w-4xl mx-auto">
                <!-- Carte de r√©sultat principale -->
                <div class="bg-white rounded-3xl shadow-2xl overflow-hidden mb-8 border-t-4 border-ap-gold">
                    <!-- Header avec score - GRADIENT AVANTAGE PLUS -->
                    <div class="px-8 py-12 text-center text-white" style="background: ${r>=80?"linear-gradient(135deg, #28A745 0%, #D4AF37 100%)":"var(--ap-gradient-primary)"};">
                        <h1 class="text-4xl font-bold mb-4">Quiz Termin√© ! üéâ</h1>
                        <div class="text-8xl font-bold mb-4" style="text-shadow: 0 4px 20px rgba(0,0,0,0.2);">${r}%</div>
                        <p class="text-xl opacity-90">${e.filter(p=>p.isCorrect).length} / ${e.length} bonnes r√©ponses</p>
                        <p class="text-lg opacity-75 mt-2">Temps total : ${c}:${d.toString().padStart(2,"0")}</p>
                    </div>
                    
                    <!-- Message de feedback -->
                    <div class="px-8 py-8 text-center border-b border-gray-200">
                        ${r>=90?'<h2 class="text-3xl font-bold text-green-600 mb-2">üèÜ Excellent !</h2><p class="text-slate-600 text-lg">Performance exceptionnelle ! Vous ma√Ætrisez parfaitement ce module.</p>':r>=75?'<h2 class="text-3xl font-bold text-blue-600 mb-2">üëè Tr√®s bien !</h2><p class="text-slate-600 text-lg">Bon travail ! Quelques r√©visions et vous serez au top.</p>':r>=60?`<h2 class="text-3xl font-bold text-yellow-600 mb-2">üìö Pas mal !</h2><p class="text-slate-600 text-lg">C'est un bon d√©but. Continuez √† r√©viser pour am√©liorer votre score.</p>`:'<h2 class="text-3xl font-bold text-red-600 mb-2">üí™ Continuez !</h2><p class="text-slate-600 text-lg">Ne vous d√©couragez pas. R√©visez les points faibles et r√©essayez !</p>'}
                    </div>
                    
                    <!-- D√©tails des r√©ponses -->
                    <div class="px-8 py-6">
                        <h3 class="text-xl font-bold text-slate-900 mb-4">D√©tails de vos r√©ponses :</h3>
                        <div class="space-y-3 max-h-96 overflow-y-auto">
                            ${e.map((p,ge)=>`
                                <div class="flex items-center justify-between p-4 rounded-lg ${p.isCorrect?"bg-green-50":"bg-red-50"}">
                                    <div class="flex items-center gap-3 flex-1">
                                        <span class="${p.isCorrect?"text-green-600":"text-red-600"} text-2xl">
                                            ${p.isCorrect?"‚úÖ":"‚ùå"}
                                        </span>
                                        <div class="flex-1">
                                            <p class="font-medium text-slate-900">Question ${ge+1}</p>
                                            <p class="text-sm text-slate-600">${p.question}</p>
                                            ${p.isCorrect?"":`<p class="text-xs text-slate-500 mt-1">Votre r√©ponse : ${p.selectedAnswer} | Correcte : ${p.correctAnswer}</p>`}
                                        </div>
                                    </div>
                                    <span class="text-sm text-slate-500">${p.timeSpent}s</span>
                                </div>
                            `).join("")}
                        </div>
                    </div>
                    
                    <!-- Boutons d'action -->
                    <div class="px-8 py-6 flex gap-4">
                        <button id="retry-quiz-btn" class="flex-1 bg-ap-red-primary hover:bg-ap-red-dark text-white px-6 py-3 rounded-xl font-semibold transition-all transform hover:-translate-y-1 shadow-ap-md hover:shadow-ap-lg">
                            Refaire le quiz
                        </button>
                        <button id="return-dashboard-btn" class="flex-1 border-2 border-ap-red-primary text-ap-red-primary px-6 py-3 rounded-xl font-semibold hover:bg-ap-red-50 transition-all">
                            Retour au tableau de bord
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `,r>=80&&setTimeout(()=>Le(),500);const L=Math.floor((Date.now()-B())/1e3);re(k(),r,L,m?.questions?.length||0),document.getElementById("retry-quiz-btn")?.addEventListener("click",()=>{const p=k();p?We(p):g.error("Erreur: Impossible de red√©marrer le quiz.")}),document.getElementById("return-dashboard-btn")?.addEventListener("click",me)}async function tt(e,t){try{if(!xe()){console.log("Aucun utilisateur - r√©sultat non sauvegard√©"),w();return}if(T()){console.log("Mode d√©mo - r√©sultat non sauvegard√© dans Firestore"),g.info("Mode D√©mo : les r√©sultats ne sont pas sauvegard√©s"),w();return}const s=k(),o=E(),a=D(),n=q(),l=y(),i=Q[s]||{},c={moduleId:s,moduleName:i.name||n.module||s,score:e,correctAnswers:l.filter(d=>d.isCorrect).length,totalQuestions:n.questions.length,timeElapsed:t,answers:l,month:o,year:a};await Re(()=>Z(c),{maxRetries:3,onRetry:(d,m)=>{g.info(`Nouvelle tentative de sauvegarde ${d}/3...`,3e3)}}),g.success("R√©sultat sauvegard√© avec succ√®s !",3e3),console.log("‚úÖ R√©sultat sauvegard√© dans Firestore")}catch(r){console.error("‚ùå Erreur lors de la sauvegarde:",r),w(),g.error("Erreur lors de la sauvegarde. Le r√©sultat sera sauvegard√© localement et synchronis√© plus tard.",8e3);try{const s=k(),o=E(),a=D(),n=y(),l={moduleId:s,moduleName:Q[s]?.name||s,score:e,correctAnswers:n.filter(c=>c.isCorrect).length,totalQuestions:n.length,timeElapsed:t,answers:n,month:o,year:a},{syncQueue:i}=await v(async()=>{const{syncQueue:c}=await import("./main-B-0V6797.js").then(d=>d.s);return{syncQueue:c}},__vite__mapDeps([2,3,4,0,1,5]));await i.add("quizResult",async c=>{await Z(c)},l),console.log("‚úÖ R√©sultat ajout√© √† la file d'attente de synchronisation")}catch(s){console.error("‚ùå Erreur ajout √† la file d'attente:",s);try{const o=`quiz_result_${Date.now()}`;localStorage.setItem(o,JSON.stringify({score:e,totalTime:t,moduleId:k(),month:E(),year:D(),userAnswers:y(),timestamp:Date.now()}))}catch(o){console.error("‚ùå Erreur sauvegarde locale de secours:",o)}}}}function rt(){w();const e=setInterval(()=>{const t=B();if(t===null)return;const r=N(),s=P(),o=j();let a=r;s&&o&&(a+=Date.now()-o);const n=Date.now()-t-a,l=Math.max(0,Math.floor(n/1e3)),i=Math.floor(l/60),c=l%60,d=document.getElementById("quiz-timer");d&&(d.textContent=`${i}:${c.toString().padStart(2,"0")}`)},1e3);ie(e)}function w(){const e=Ie();e&&(clearInterval(e),ie(null)),z(null)}window.addEventListener("beforeunload",()=>{w()});document.addEventListener("visibilitychange",()=>{});async function F(){const e=y();if(e.length===0)return;const{calculateScore:t}=await v(async()=>{const{calculateScore:o}=await Promise.resolve().then(()=>pe);return{calculateScore:o}},void 0),r=t(e),s=document.getElementById("quiz-score");s&&(s.textContent=`Score: ${r}%`)}function st(){document.body.classList.toggle("focus-mode")}function ot(){const e=document.getElementById("pause-btn");if(!e)return;if(!P())C(!0),z(Date.now()),e.setAttribute("aria-pressed","true"),e.setAttribute("aria-label","Reprendre le quiz"),e.innerHTML='<svg aria-hidden="true" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Reprendre',g.warning('Quiz en pause. Cliquez sur "Reprendre" pour continuer.',3e3);else{C(!1);const r=j();if(r){const s=N();S(s+(Date.now()-r))}z(null),e.setAttribute("aria-pressed","false"),e.setAttribute("aria-label","Mettre le quiz en pause"),e.innerHTML='<svg aria-hidden="true" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Pause',g.success("Quiz repris !",2e3)}}function me(){w();try{window.__QUIZ_ACTIVE=!1}catch{}C(!1),S(0),z(null),_(!1),document.getElementById("quiz-view")?.classList.add("view-hidden"),document.getElementById("dashboard-view")?.classList.remove("view-hidden"),document.querySelectorAll(".nav-link").forEach(e=>{e.classList.remove("bg-ap-red-dark","text-white"),e.classList.add("text-white")}),document.getElementById("nav-dashboard")?.classList.add("bg-ap-red-dark","text-white"),g.info("Retour au tableau de bord",2e3),setTimeout(()=>window.location.reload(),500)}function nt(e){if(!e||e.length===0)return 0;const t=e.filter(s=>s.isCorrect).length,r=Math.round(t/e.length*100);return isNaN(r)||r<0||r>100?(console.error("‚ùå Score invalide calcul√©:",r),0):r}function at(e,t,r=null){return e<t?r!==null?"completed":"incomplete":e===t?"active":"locked"}const pe=Object.freeze(Object.defineProperty({__proto__:null,calculateScore:nt,getMonthlyQuizStatus:at},Symbol.toStringTag,{value:"Module"}));export{mt as a,We as b,pe as q,dt as s,Ee as t};
//# sourceMappingURL=quiz-CIpUSg5N.js.map
