{"version":3,"file":"resources-BmpAT_ik.js","sources":["../../js/resources.js"],"sourcesContent":["// Page Ressources - Gestion de la biblioth√®que de documents\r\nimport { db } from './firebase-config.js';\r\nimport { collection, query, orderBy, getDocs, addDoc, deleteDoc, doc, where } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';\r\nimport { getCurrentUser, onAuthChange, signOutUser } from './auth.js';\r\nimport { toast } from './toast.js';\r\n// ‚úÖ CORRECTION SECTION 4 : Protection XSS\r\nimport { escapeHtml } from './security.js';\r\n// ‚úÖ P0 CRITIQUE: Import pour validation stricte du clientId\r\nimport { getCurrentClientId } from './client-manager.js';\r\nimport {\r\n    createResourceSkeleton,\r\n    showSkeleton,\r\n    hideSkeleton\r\n} from './skeleton.js';\r\n\r\n// √âtat\r\nlet allResources = [];\r\nlet filteredResources = [];\r\nlet isAdmin = false;\r\n\r\n// Configuration\r\nconst categoryNames = {\r\n    'guides': { name: 'Guides', icon: 'üìñ', color: 'blue' },\r\n    'manuels': { name: 'Manuels', icon: 'üìã', color: 'green' },\r\n    'reglements': { name: 'R√®glements', icon: 'üõ°Ô∏è', color: 'orange' },\r\n    'formulaires': { name: 'Formulaires', icon: 'üìù', color: 'purple' },\r\n    'videos': { name: 'Vid√©os', icon: 'üé•', color: 'red' }\r\n};\r\n\r\nconst moduleNames = {\r\n    'tous': 'Tous les modules',\r\n    'auto': 'AT-AVE-AVEX',\r\n    'loisir': 'VTT, Motoneige, etc.',\r\n    'vr': 'V√©hicules R√©cr√©atifs',\r\n    'tracteur': '√âquipement Agricole'\r\n};\r\n\r\n// Initialisation\r\ndocument.addEventListener('DOMContentLoaded', async () => {\r\n    // V√©rifier l'authentification Firebase\r\n    onAuthChange(async (user) => {\r\n        if (!user) {\r\n            window.location.href = '/index.html';\r\n            return;\r\n        }\r\n        \r\n        updateUserInfo(user);\r\n        await checkAdminStatus(user.uid);\r\n        await loadResources();\r\n    });\r\n    \r\n    // √âv√©nements\r\n    document.getElementById('logout-btn')?.addEventListener('click', handleLogout);\r\n    document.getElementById('signout-link')?.addEventListener('click', handleLogout);\r\n    document.getElementById('search-input')?.addEventListener('input', applyFilters);\r\n    document.getElementById('filter-category')?.addEventListener('change', applyFilters);\r\n    document.getElementById('filter-module')?.addEventListener('change', applyFilters);\r\n    document.getElementById('reset-filters-btn')?.addEventListener('click', resetFilters);\r\n    document.getElementById('upload-btn')?.addEventListener('click', showUploadModal);\r\n    document.getElementById('cancel-upload-btn')?.addEventListener('click', hideUploadModal);\r\n    document.getElementById('upload-form')?.addEventListener('submit', handleUpload);\r\n});\r\n\r\n// Mettre √† jour les infos utilisateur\r\nfunction updateUserInfo(user) {\r\n    // Anciens IDs (top nav - supprimer si pr√©sents)\r\n    if (document.getElementById('user-name')) {\r\n        document.getElementById('user-name').textContent = user.displayName || user.email;\r\n    }\r\n    if (document.getElementById('user-photo')) {\r\n        document.getElementById('user-photo').src = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || user.email)}`;\r\n    }\r\n    \r\n    // Nouveaux IDs (sidebar)\r\n    if (document.getElementById('user-display-name')) {\r\n        document.getElementById('user-display-name').textContent = user.displayName || user.email;\r\n    }\r\n    if (document.getElementById('user-avatar')) {\r\n        document.getElementById('user-avatar').src = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || user.email)}`;\r\n    }\r\n}\r\n\r\n// V√©rifier si l'utilisateur est admin\r\nasync function checkAdminStatus(userId) {\r\n    try {\r\n        const userDoc = await getDocs(query(collection(db, 'users'), where('uid', '==', userId)));\r\n        if (!userDoc.empty) {\r\n            const userData = userDoc.docs[0].data();\r\n            isAdmin = userData.role === 'admin';\r\n            \r\n            if (isAdmin) {\r\n                document.getElementById('admin-section')?.classList.remove('hidden');\r\n                document.getElementById('nav-admin-item')?.classList.remove('hidden');\r\n                document.getElementById('admin-badge-nav')?.classList.remove('hidden');\r\n            }\r\n        }\r\n    } catch (error) {\r\n        console.error('Erreur lors de la v√©rification du r√¥le:', error);\r\n    }\r\n}\r\n\r\n// Charger les ressources depuis Firestore\r\nasync function loadResources() {\r\n    console.log('üì• Chargement des ressources...');\r\n    \r\n    try {\r\n        // Afficher skeleton pendant le chargement\r\n        const container = document.getElementById('resources-container');\r\n        if (container) {\r\n            showSkeleton('resources-container', createResourceSkeleton(6));\r\n        }\r\n        \r\n        // ‚úÖ P0 CRITIQUE: Filtrer par clientId pour isolation multi-tenant\r\n        const clientId = await getCurrentClientId();\r\n        const q = query(\r\n            collection(db, 'resources'), \r\n            where('clientId', '==', clientId),\r\n            orderBy('createdAt', 'desc')\r\n        );\r\n        const querySnapshot = await getDocs(q);\r\n        \r\n        allResources = [];\r\n        querySnapshot.forEach((doc) => {\r\n            allResources.push({\r\n                id: doc.id,\r\n                ...doc.data(),\r\n                createdAt: doc.data().createdAt?.toDate()\r\n            });\r\n        });\r\n        \r\n        console.log(`‚úÖ ${allResources.length} ressources charg√©es`);\r\n        \r\n        if (allResources.length === 0) {\r\n            showNoResources();\r\n        } else {\r\n            filteredResources = [...allResources];\r\n            renderResources();\r\n        }\r\n        \r\n        document.getElementById('resources-loading')?.classList.add('hidden');\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur lors du chargement des ressources:', error);\r\n        toast.error('Erreur lors du chargement des ressources');\r\n        // Si la collection n'existe pas encore, afficher le message\r\n        showNoResources();\r\n        document.getElementById('resources-loading')?.classList.add('hidden');\r\n    }\r\n}\r\n\r\n// Afficher les ressources\r\nfunction renderResources() {\r\n    const container = document.getElementById('resources-container');\r\n    container.classList.remove('hidden');\r\n    \r\n    if (filteredResources.length === 0) {\r\n        showNoResources();\r\n        return;\r\n    }\r\n    \r\n    document.getElementById('no-resources')?.classList.add('hidden');\r\n    \r\n    // ‚úÖ CORRECTION SECTION 4 : Protection XSS - √âchapper toutes les donn√©es utilisateur\r\n    container.innerHTML = filteredResources.map(resource => {\r\n        const category = categoryNames[resource.category] || { name: resource.category, icon: 'üìÑ', color: 'gray' };\r\n        const date = resource.createdAt \r\n            ? new Date(resource.createdAt).toLocaleDateString('fr-FR')\r\n            : 'Date inconnue';\r\n        \r\n        // √âchapper toutes les donn√©es utilisateur\r\n        const safeTitle = escapeHtml(resource.title || '');\r\n        const safeDescription = escapeHtml(resource.description || 'Aucune description');\r\n        const safeCategoryName = escapeHtml(category.name);\r\n        const safeModuleName = escapeHtml(moduleNames[resource.module] || resource.module || '');\r\n        const safeDate = escapeHtml(date);\r\n        const safeResourceId = escapeHtml(resource.id);\r\n        // URL doit √™tre valid√©e avec sanitizeURL, mais pour l'instant on √©chappe juste l'affichage\r\n        const safeUrl = escapeHtml(resource.url || '#');\r\n        const safeDownloads = resource.downloads ? escapeHtml(String(resource.downloads)) : '';\r\n        \r\n        return `\r\n            <div class=\"file-card bg-white rounded-xl shadow-md hover:shadow-xl transition-all overflow-hidden fade-in\">\r\n                <div class=\"p-6\">\r\n                    <div class=\"flex items-start justify-between mb-4\">\r\n                        <div class=\"file-icon text-4xl\">${category.icon}</div>\r\n                        ${isAdmin ? `\r\n                            <button onclick=\"deleteResource('${safeResourceId}')\" class=\"text-red-600 hover:text-red-800 transition-colors\">\r\n                                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"></path>\r\n                                </svg>\r\n                            </button>\r\n                        ` : ''}\r\n                    </div>\r\n                    \r\n                    <h3 class=\"text-lg font-bold text-slate-900 mb-2\">${safeTitle}</h3>\r\n                    <p class=\"text-sm text-slate-600 mb-4 line-clamp-2\">${safeDescription}</p>\r\n                    \r\n                    <div class=\"flex flex-wrap gap-2 mb-4\">\r\n                        <span class=\"px-3 py-1 bg-${category.color}-100 text-${category.color}-700 text-xs font-medium rounded-full\">\r\n                            ${safeCategoryName}\r\n                        </span>\r\n                        <span class=\"px-3 py-1 bg-slate-100 text-slate-700 text-xs font-medium rounded-full\">\r\n                            ${safeModuleName}\r\n                        </span>\r\n                    </div>\r\n                    \r\n                    <div class=\"flex items-center justify-between text-xs text-slate-500 mb-4\">\r\n                        <span>üìÖ ${safeDate}</span>\r\n                        ${safeDownloads ? `<span>‚¨áÔ∏è ${safeDownloads} t√©l√©chargements</span>` : ''}\r\n                    </div>\r\n                    \r\n                    <div class=\"flex gap-2\">\r\n                        <a href=\"${safeUrl}\" target=\"_blank\" rel=\"noopener noreferrer\" \r\n                           class=\"flex-1 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors font-medium text-center text-sm\">\r\n                            üì• T√©l√©charger\r\n                        </a>\r\n                        <a href=\"${safeUrl}\" target=\"_blank\" rel=\"noopener noreferrer\" \r\n                           class=\"px-4 py-2 border-2 border-indigo-600 text-indigo-600 rounded-lg hover:bg-indigo-50 transition-colors font-medium text-center text-sm\">\r\n                            üëÅÔ∏è\r\n                        </a>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }).join('');\r\n}\r\n\r\n// Appliquer les filtres\r\nfunction applyFilters() {\r\n    const searchTerm = document.getElementById('search-input').value.toLowerCase();\r\n    const categoryFilter = document.getElementById('filter-category').value;\r\n    const moduleFilter = document.getElementById('filter-module').value;\r\n    \r\n    filteredResources = allResources.filter(resource => {\r\n        const matchSearch = !searchTerm || \r\n            resource.title.toLowerCase().includes(searchTerm) || \r\n            (resource.description && resource.description.toLowerCase().includes(searchTerm));\r\n        \r\n        const matchCategory = !categoryFilter || resource.category === categoryFilter;\r\n        const matchModule = !moduleFilter || resource.module === moduleFilter;\r\n        \r\n        return matchSearch && matchCategory && matchModule;\r\n    });\r\n    \r\n    renderResources();\r\n}\r\n\r\n// R√©initialiser les filtres\r\nfunction resetFilters() {\r\n    document.getElementById('search-input').value = '';\r\n    document.getElementById('filter-category').value = '';\r\n    document.getElementById('filter-module').value = '';\r\n    filteredResources = [...allResources];\r\n    renderResources();\r\n}\r\n\r\n// Filtrer par cat√©gorie (boutons rapides)\r\nwindow.filterByCategory = function(category) {\r\n    document.getElementById('filter-category').value = category;\r\n    applyFilters();\r\n};\r\n\r\n// Afficher la modal d'upload\r\nfunction showUploadModal() {\r\n    document.getElementById('upload-modal')?.classList.remove('hidden');\r\n}\r\n\r\n// Cacher la modal d'upload\r\nfunction hideUploadModal() {\r\n    document.getElementById('upload-modal')?.classList.add('hidden');\r\n    document.getElementById('upload-form')?.reset();\r\n}\r\n\r\n// G√©rer l'upload\r\nasync function handleUpload(e) {\r\n    e.preventDefault();\r\n    \r\n    if (!isAdmin) {\r\n        toast.error('Acc√®s refus√© : vous devez √™tre administrateur');\r\n        return;\r\n    }\r\n    \r\n    const title = document.getElementById('doc-title').value;\r\n    const description = document.getElementById('doc-description').value;\r\n    const category = document.getElementById('doc-category').value;\r\n    const module = document.getElementById('doc-module').value;\r\n    const url = document.getElementById('doc-url').value;\r\n    \r\n    if (!title || !category || !module || !url) {\r\n        toast.error('Veuillez remplir tous les champs obligatoires');\r\n        return;\r\n    }\r\n    \r\n    const loadingToast = toast.showLoadingToast('Ajout du document...');\r\n    \r\n    try {\r\n        console.log('üì§ Ajout d\\'une nouvelle ressource...');\r\n        \r\n        const user = getCurrentUser();\r\n        // ‚úÖ P0 CRITIQUE: Ajouter clientId pour isolation multi-tenant\r\n        const clientId = await getCurrentClientId();\r\n        await addDoc(collection(db, 'resources'), {\r\n            title,\r\n            description,\r\n            category,\r\n            module,\r\n            url,\r\n            clientId: clientId, // ‚úÖ P0 CRITIQUE: Isolation multi-tenant\r\n            downloads: 0,\r\n            createdAt: new Date(),\r\n            createdBy: user.uid\r\n        });\r\n        \r\n        console.log('‚úÖ Ressource ajout√©e avec succ√®s');\r\n        toast.updateLoadingToast(loadingToast, 'Document ajout√© avec succ√®s !', 'success');\r\n        \r\n        hideUploadModal();\r\n        await loadResources();\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur lors de l\\'ajout de la ressource:', error);\r\n        toast.updateLoadingToast(loadingToast, 'Erreur d\\'ajout', 'error');\r\n        toast.error('Erreur lors de l\\'ajout du document', 4000);\r\n    }\r\n}\r\n\r\n// Supprimer une ressource\r\nwindow.deleteResource = async function(resourceId) {\r\n    if (!isAdmin) {\r\n        toast.error('Acc√®s refus√©');\r\n        return;\r\n    }\r\n    \r\n    if (!confirm('Voulez-vous vraiment supprimer ce document ?')) {\r\n        toast.info('Suppression annul√©e', 2000);\r\n        return;\r\n    }\r\n    \r\n    const loadingToast = toast.showLoadingToast('Suppression du document...');\r\n    \r\n    try {\r\n        console.log('üóëÔ∏è Suppression de la ressource:', resourceId);\r\n        await deleteDoc(doc(db, 'resources', resourceId));\r\n        console.log('‚úÖ Ressource supprim√©e');\r\n        \r\n        toast.updateLoadingToast(loadingToast, 'Document supprim√© avec succ√®s !', 'success');\r\n        \r\n        await loadResources();\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur lors de la suppression:', error);\r\n        toast.updateLoadingToast(loadingToast, 'Erreur de suppression', 'error');\r\n        toast.error('Erreur lors de la suppression', 4000);\r\n    }\r\n};\r\n\r\n// Afficher message si aucune ressource\r\nfunction showNoResources() {\r\n    document.getElementById('resources-container')?.classList.add('hidden');\r\n    document.getElementById('no-resources')?.classList.remove('hidden');\r\n}\r\n\r\n// D√©connexion\r\nasync function handleLogout() {\r\n    try {\r\n        await signOutUser();\r\n        window.location.href = '/';\r\n    } catch (error) {\r\n        console.error('Erreur lors de la d√©connexion:', error);\r\n    }\r\n}\r\n"],"names":["allResources","filteredResources","isAdmin","categoryNames","moduleNames","onAuthChange","user","updateUserInfo","checkAdminStatus","loadResources","handleLogout","applyFilters","resetFilters","showUploadModal","hideUploadModal","handleUpload","userId","userDoc","getDocs","query","collection","db","where","error","showSkeleton","createResourceSkeleton","clientId","getCurrentClientId","q","orderBy","querySnapshot","doc","showNoResources","renderResources","toast","container","resource","category","date","safeTitle","escapeHtml","safeDescription","safeCategoryName","safeModuleName","safeDate","safeResourceId","safeUrl","safeDownloads","searchTerm","categoryFilter","moduleFilter","matchSearch","matchCategory","matchModule","title","description","module","url","loadingToast","getCurrentUser","addDoc","resourceId","deleteDoc","signOutUser"],"mappings":"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"}