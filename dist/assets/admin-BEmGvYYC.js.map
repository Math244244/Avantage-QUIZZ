{"version":3,"file":"admin-BEmGvYYC.js","sources":["../../js/tooltip.js","../../js/admin-auth-guard.js","../../js/admin-questions.js","../../js/admin-users.js","../../js/admin-dashboard.js","../../admin.html?html-proxy&index=3.js"],"sourcesContent":["// Syst√®me de Tooltips - Position-aware tooltips pour l'interface\r\n/**\r\n * Tooltip.js - Syst√®me complet de tooltips intelligents\r\n * \r\n * Features:\r\n * - Auto-positionnement (d√©tection de d√©bordement)\r\n * - Animations fluides (fade-in/fade-out)\r\n * - D√©lai configurable (hover delay)\r\n * - Support keyboard (focus)\r\n * - Personnalisation (th√®mes, tailles)\r\n * - Mobile-friendly (d√©sactiv√© sur touch)\r\n * - Accessibilit√© (ARIA attributes)\r\n */\r\n\r\nclass TooltipManager {\r\n    constructor() {\r\n        this.activeTooltip = null;\r\n        this.hoverDelay = 300; // ms avant affichage\r\n        this.hideDelay = 100; // ms avant masquage\r\n        this.hoverTimer = null;\r\n        this.hideTimer = null;\r\n        this.isTouchDevice = ('ontouchstart' in window);\r\n        \r\n        this.init();\r\n    }\r\n    \r\n    /**\r\n     * Initialiser le syst√®me de tooltips\r\n     */\r\n    init() {\r\n        console.log('üéØ Initialisation du syst√®me de tooltips');\r\n        \r\n        // Cr√©er le container global pour les tooltips\r\n        this.createTooltipContainer();\r\n        \r\n        // Scanner et initialiser tous les √©l√©ments avec data-tooltip\r\n        this.initializeTooltips();\r\n        \r\n        // Observer les nouveaux √©l√©ments ajout√©s au DOM\r\n        this.observeDOM();\r\n        \r\n        console.log('‚úÖ Syst√®me de tooltips initialis√©');\r\n    }\r\n    \r\n    /**\r\n     * Cr√©er le container pour les tooltips\r\n     */\r\n    createTooltipContainer() {\r\n        let container = document.getElementById('tooltip-container');\r\n        if (!container) {\r\n            container = document.createElement('div');\r\n            container.id = 'tooltip-container';\r\n            container.className = 'fixed pointer-events-none z-[9999]';\r\n            document.body.appendChild(container);\r\n        }\r\n        this.container = container;\r\n    }\r\n    \r\n    /**\r\n     * Initialiser tous les tooltips existants\r\n     */\r\n    initializeTooltips() {\r\n        const elements = document.querySelectorAll('[data-tooltip]');\r\n        elements.forEach(el => this.attachTooltip(el));\r\n        console.log(`üìå ${elements.length} tooltips initialis√©s`);\r\n    }\r\n    \r\n    /**\r\n     * Observer les mutations du DOM\r\n     */\r\n    observeDOM() {\r\n        const observer = new MutationObserver((mutations) => {\r\n            mutations.forEach((mutation) => {\r\n                mutation.addedNodes.forEach((node) => {\r\n                    if (node.nodeType === 1) { // Element node\r\n                        if (node.hasAttribute && node.hasAttribute('data-tooltip')) {\r\n                            this.attachTooltip(node);\r\n                        }\r\n                        // Chercher dans les enfants\r\n                        if (node.querySelectorAll) {\r\n                            node.querySelectorAll('[data-tooltip]').forEach(el => {\r\n                                this.attachTooltip(el);\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n        });\r\n        \r\n        observer.observe(document.body, {\r\n            childList: true,\r\n            subtree: true\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Attacher un tooltip √† un √©l√©ment\r\n     */\r\n    attachTooltip(element) {\r\n        // √âviter les doublons\r\n        if (element.dataset.tooltipAttached) return;\r\n        element.dataset.tooltipAttached = 'true';\r\n        \r\n        // D√©sactiver sur mobile touch\r\n        if (this.isTouchDevice) return;\r\n        \r\n        // Events\r\n        element.addEventListener('mouseenter', (e) => this.handleMouseEnter(e, element));\r\n        element.addEventListener('mouseleave', (e) => this.handleMouseLeave(e));\r\n        element.addEventListener('focus', (e) => this.handleFocus(e, element));\r\n        element.addEventListener('blur', (e) => this.handleBlur(e));\r\n        \r\n        // ARIA attributes pour accessibilit√©\r\n        element.setAttribute('aria-describedby', `tooltip-${this.generateId()}`);\r\n    }\r\n    \r\n    /**\r\n     * G√©n√©rer un ID unique\r\n     */\r\n    generateId() {\r\n        return Math.random().toString(36).substring(2, 11);\r\n    }\r\n    \r\n    /**\r\n     * G√©rer mouseenter\r\n     */\r\n    handleMouseEnter(event, element) {\r\n        clearTimeout(this.hideTimer);\r\n        \r\n        this.hoverTimer = setTimeout(() => {\r\n            this.showTooltip(element);\r\n        }, this.hoverDelay);\r\n    }\r\n    \r\n    /**\r\n     * G√©rer mouseleave\r\n     */\r\n    handleMouseLeave(event) {\r\n        clearTimeout(this.hoverTimer);\r\n        \r\n        this.hideTimer = setTimeout(() => {\r\n            this.hideTooltip();\r\n        }, this.hideDelay);\r\n    }\r\n    \r\n    /**\r\n     * G√©rer focus (keyboard)\r\n     */\r\n    handleFocus(event, element) {\r\n        this.showTooltip(element);\r\n    }\r\n    \r\n    /**\r\n     * G√©rer blur (keyboard)\r\n     */\r\n    handleBlur(event) {\r\n        this.hideTooltip();\r\n    }\r\n    \r\n    /**\r\n     * Afficher le tooltip\r\n     */\r\n    showTooltip(element) {\r\n        const text = element.dataset.tooltip;\r\n        const position = element.dataset.tooltipPosition || 'top';\r\n        const theme = element.dataset.tooltipTheme || 'dark';\r\n        const size = element.dataset.tooltipSize || 'medium';\r\n        \r\n        if (!text) return;\r\n        \r\n        // Cacher l'ancien tooltip\r\n        this.hideTooltip();\r\n        \r\n        // Cr√©er le nouveau tooltip\r\n        const tooltip = this.createTooltipElement(text, theme, size);\r\n        this.container.appendChild(tooltip);\r\n        this.activeTooltip = tooltip;\r\n        \r\n        // Positionner le tooltip\r\n        this.positionTooltip(tooltip, element, position);\r\n        \r\n        // Animation d'apparition\r\n        setTimeout(() => {\r\n            tooltip.classList.remove('opacity-0', 'scale-95');\r\n            tooltip.classList.add('opacity-100', 'scale-100');\r\n        }, 10);\r\n    }\r\n    \r\n    /**\r\n     * Cr√©er l'√©l√©ment tooltip\r\n     */\r\n    createTooltipElement(text, theme, size) {\r\n        const tooltip = document.createElement('div');\r\n        tooltip.className = `tooltip absolute opacity-0 scale-95 transform transition-all duration-200 ease-out ${this.getThemeClasses(theme)} ${this.getSizeClasses(size)}`;\r\n        \r\n        // Contenu\r\n        tooltip.innerHTML = `\r\n            <div class=\"tooltip-content relative\">\r\n                ${text}\r\n                <div class=\"tooltip-arrow absolute w-2 h-2 transform rotate-45 ${this.getArrowClasses(theme)}\"></div>\r\n            </div>\r\n        `;\r\n        \r\n        return tooltip;\r\n    }\r\n    \r\n    /**\r\n     * Obtenir les classes de th√®me\r\n     */\r\n    getThemeClasses(theme) {\r\n        const themes = {\r\n            'dark': 'bg-slate-900 text-white shadow-lg',\r\n            'light': 'bg-white text-slate-900 shadow-lg border border-slate-200',\r\n            'success': 'bg-green-600 text-white shadow-lg',\r\n            'error': 'bg-red-600 text-white shadow-lg',\r\n            'warning': 'bg-orange-600 text-white shadow-lg',\r\n            'info': 'bg-blue-600 text-white shadow-lg'\r\n        };\r\n        return themes[theme] || themes.dark;\r\n    }\r\n    \r\n    /**\r\n     * Obtenir les classes de taille\r\n     */\r\n    getSizeClasses(size) {\r\n        const sizes = {\r\n            'small': 'text-xs px-2 py-1 rounded',\r\n            'medium': 'text-sm px-3 py-2 rounded-md',\r\n            'large': 'text-base px-4 py-3 rounded-lg'\r\n        };\r\n        return sizes[size] || sizes.medium;\r\n    }\r\n    \r\n    /**\r\n     * Obtenir les classes de fl√®che\r\n     */\r\n    getArrowClasses(theme) {\r\n        const arrows = {\r\n            'dark': 'bg-slate-900',\r\n            'light': 'bg-white border-l border-b border-slate-200',\r\n            'success': 'bg-green-600',\r\n            'error': 'bg-red-600',\r\n            'warning': 'bg-orange-600',\r\n            'info': 'bg-blue-600'\r\n        };\r\n        return arrows[theme] || arrows.dark;\r\n    }\r\n    \r\n    /**\r\n     * Positionner le tooltip intelligemment\r\n     */\r\n    positionTooltip(tooltip, element, preferredPosition) {\r\n        const rect = element.getBoundingClientRect();\r\n        const tooltipRect = tooltip.getBoundingClientRect();\r\n        const arrow = tooltip.querySelector('.tooltip-arrow');\r\n        \r\n        const spacing = 8; // Espace entre √©l√©ment et tooltip\r\n        const arrowSize = 8;\r\n        \r\n        // Calculer toutes les positions possibles\r\n        const positions = {\r\n            top: {\r\n                top: rect.top - tooltipRect.height - spacing,\r\n                left: rect.left + (rect.width / 2) - (tooltipRect.width / 2),\r\n                arrowTop: tooltipRect.height - arrowSize / 2,\r\n                arrowLeft: tooltipRect.width / 2 - arrowSize / 2,\r\n                arrowRotate: 'rotate(45deg)'\r\n            },\r\n            bottom: {\r\n                top: rect.bottom + spacing,\r\n                left: rect.left + (rect.width / 2) - (tooltipRect.width / 2),\r\n                arrowTop: -arrowSize / 2,\r\n                arrowLeft: tooltipRect.width / 2 - arrowSize / 2,\r\n                arrowRotate: 'rotate(225deg)'\r\n            },\r\n            left: {\r\n                top: rect.top + (rect.height / 2) - (tooltipRect.height / 2),\r\n                left: rect.left - tooltipRect.width - spacing,\r\n                arrowTop: tooltipRect.height / 2 - arrowSize / 2,\r\n                arrowLeft: tooltipRect.width - arrowSize / 2,\r\n                arrowRotate: 'rotate(135deg)'\r\n            },\r\n            right: {\r\n                top: rect.top + (rect.height / 2) - (tooltipRect.height / 2),\r\n                left: rect.right + spacing,\r\n                arrowTop: tooltipRect.height / 2 - arrowSize / 2,\r\n                arrowLeft: -arrowSize / 2,\r\n                arrowRotate: 'rotate(315deg)'\r\n            }\r\n        };\r\n        \r\n        // D√©terminer la meilleure position\r\n        let position = preferredPosition;\r\n        \r\n        // V√©rifier si la position pr√©f√©r√©e d√©borde\r\n        const testPosition = positions[preferredPosition];\r\n        if (testPosition) {\r\n            const wouldOverflow = \r\n                testPosition.top < 0 || \r\n                testPosition.top + tooltipRect.height > window.innerHeight ||\r\n                testPosition.left < 0 || \r\n                testPosition.left + tooltipRect.width > window.innerWidth;\r\n            \r\n            // Trouver une position alternative\r\n            if (wouldOverflow) {\r\n                const alternatives = ['top', 'bottom', 'left', 'right'];\r\n                for (const alt of alternatives) {\r\n                    const altPos = positions[alt];\r\n                    const altOverflow = \r\n                        altPos.top < 0 || \r\n                        altPos.top + tooltipRect.height > window.innerHeight ||\r\n                        altPos.left < 0 || \r\n                        altPos.left + tooltipRect.width > window.innerWidth;\r\n                    \r\n                    if (!altOverflow) {\r\n                        position = alt;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Appliquer la position\r\n        const finalPosition = positions[position] || positions.top;\r\n        tooltip.style.top = `${finalPosition.top}px`;\r\n        tooltip.style.left = `${finalPosition.left}px`;\r\n        \r\n        // Positionner la fl√®che\r\n        if (arrow) {\r\n            arrow.style.top = `${finalPosition.arrowTop}px`;\r\n            arrow.style.left = `${finalPosition.arrowLeft}px`;\r\n            arrow.style.transform = finalPosition.arrowRotate;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Cacher le tooltip\r\n     */\r\n    hideTooltip() {\r\n        if (!this.activeTooltip) return;\r\n        \r\n        // Animation de disparition\r\n        this.activeTooltip.classList.remove('opacity-100', 'scale-100');\r\n        this.activeTooltip.classList.add('opacity-0', 'scale-95');\r\n        \r\n        // Supprimer apr√®s l'animation\r\n        setTimeout(() => {\r\n            if (this.activeTooltip && this.activeTooltip.parentNode) {\r\n                this.activeTooltip.parentNode.removeChild(this.activeTooltip);\r\n            }\r\n            this.activeTooltip = null;\r\n        }, 200);\r\n    }\r\n    \r\n    /**\r\n     * Ajouter un tooltip programmatiquement\r\n     */\r\n    add(element, text, options = {}) {\r\n        element.dataset.tooltip = text;\r\n        element.dataset.tooltipPosition = options.position || 'top';\r\n        element.dataset.tooltipTheme = options.theme || 'dark';\r\n        element.dataset.tooltipSize = options.size || 'medium';\r\n        \r\n        this.attachTooltip(element);\r\n    }\r\n    \r\n    /**\r\n     * Retirer un tooltip\r\n     */\r\n    remove(element) {\r\n        element.removeAttribute('data-tooltip');\r\n        element.removeAttribute('data-tooltip-position');\r\n        element.removeAttribute('data-tooltip-theme');\r\n        element.removeAttribute('data-tooltip-size');\r\n        element.removeAttribute('data-tooltip-attached');\r\n        element.removeAttribute('aria-describedby');\r\n    }\r\n    \r\n    /**\r\n     * Mettre √† jour un tooltip\r\n     */\r\n    update(element, text, options = {}) {\r\n        this.remove(element);\r\n        this.add(element, text, options);\r\n    }\r\n    \r\n    /**\r\n     * D√©truire le syst√®me de tooltips\r\n     */\r\n    destroy() {\r\n        if (this.container && this.container.parentNode) {\r\n            this.container.parentNode.removeChild(this.container);\r\n        }\r\n        \r\n        clearTimeout(this.hoverTimer);\r\n        clearTimeout(this.hideTimer);\r\n        \r\n        console.log('üóëÔ∏è Syst√®me de tooltips d√©truit');\r\n    }\r\n}\r\n\r\n// Cr√©er l'instance globale\r\nconst tooltip = new TooltipManager();\r\n\r\n// Export pour utilisation dans d'autres modules\r\nexport { tooltip, TooltipManager };\r\n\r\n// Rendre accessible globalement\r\nwindow.tooltip = tooltip;\r\n","// Admin Auth Guard - Protection des routes administrateur\r\nimport { auth } from './firebase-config.js';\r\nimport { getUserProfile } from './firestore-service.js';\r\nimport { isDemoMode, getDemoUser } from './auth.js';\r\n\r\n/**\r\n * V√©rifie si l'utilisateur actuel est admin\r\n * Redirige vers index.html si non autoris√©\r\n * Support du mode d√©mo et Firebase\r\n */\r\nexport async function requireAdmin() {\r\n    return new Promise((resolve, reject) => {\r\n        // ‚úÖ V√©rifier d'abord le mode d√©mo\r\n        if (isDemoMode()) {\r\n            const demoUser = getDemoUser();\r\n            if (demoUser && demoUser.role === 'admin') {\r\n                console.log('‚úÖ Admin autoris√© (mode d√©mo):', demoUser.email);\r\n                resolve(demoUser);\r\n                return;\r\n            } else {\r\n                console.warn('‚ùå Acc√®s refus√©: utilisateur d√©mo non admin');\r\n                alert('Acc√®s refus√©. Cette page est r√©serv√©e aux administrateurs.');\r\n                window.location.href = '/index.html';\r\n                reject(new Error('Non autoris√©'));\r\n                return;\r\n            }\r\n        }\r\n        \r\n        // ‚úÖ Mode Firebase normal\r\n        const unsubscribe = auth.onAuthStateChanged(async (user) => {\r\n            unsubscribe(); // Se d√©sabonner imm√©diatement\r\n            \r\n            if (!user) {\r\n                console.warn('‚ùå Acc√®s refus√©: Utilisateur non connect√©');\r\n                window.location.href = '/index.html';\r\n                reject(new Error('Non authentifi√©'));\r\n                return;\r\n            }\r\n            \r\n            try {\r\n                // V√©rifier le r√¥le\r\n                const userProfile = await getUserProfile(user.uid);\r\n                \r\n                if (!userProfile || userProfile.role !== 'admin') {\r\n                    console.warn('‚ùå Acc√®s refus√©: Utilisateur non administrateur');\r\n                    alert('Acc√®s refus√©. Cette page est r√©serv√©e aux administrateurs.');\r\n                    window.location.href = '/index.html';\r\n                    reject(new Error('Non autoris√©'));\r\n                    return;\r\n                }\r\n                \r\n                console.log('‚úÖ Admin autoris√©:', user.email);\r\n                resolve(user);\r\n            } catch (error) {\r\n                console.error('‚ùå Erreur v√©rification admin:', error);\r\n                window.location.href = '/index.html';\r\n                reject(error);\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * V√©rifie si l'utilisateur est admin sans redirection\r\n * Retourne true/false\r\n * Support du mode d√©mo et Firebase\r\n */\r\nexport async function isAdmin() {\r\n    try {\r\n        // ‚úÖ V√©rifier le mode d√©mo d'abord\r\n        if (isDemoMode()) {\r\n            const demoUser = getDemoUser();\r\n            return demoUser?.role === 'admin';\r\n        }\r\n        \r\n        // ‚úÖ Mode Firebase normal\r\n        const user = auth.currentUser;\r\n        if (!user) return false;\r\n        \r\n        const userProfile = await getUserProfile(user.uid);\r\n        return userProfile?.role === 'admin';\r\n    } catch (error) {\r\n        console.error('Erreur verification admin:', error);\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * Ajoute le badge admin dans le profil utilisateur\r\n */\r\nexport function addAdminBadge() {\r\n    const userProfile = document.getElementById('user-profile');\r\n    if (!userProfile) return;\r\n    \r\n    const existingBadge = userProfile.querySelector('.admin-badge');\r\n    if (existingBadge) return; // Badge d√©j√† ajout√©\r\n    \r\n    const badge = document.createElement('div');\r\n    badge.className = 'admin-badge bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded mt-1';\r\n    badge.innerHTML = 'üî∞ Admin';\r\n    badge.style.display = 'inline-block';\r\n    \r\n    userProfile.appendChild(badge);\r\n}\r\n","// Admin Questions Manager - Gestion des questions de quiz\r\nimport { \r\n    getQuestions, \r\n    createQuestion, \r\n    updateQuestion, \r\n    deleteQuestion,\r\n    importQuestionsFromJSON,\r\n    getQuestionsStats\r\n} from './firestore-service.js';\r\nimport { isDemoMode } from './auth.js';\r\nimport { \r\n    createQuestionSkeleton,\r\n    createStatsSkeleton,\r\n    showSkeleton,\r\n    hideSkeleton\r\n} from './skeleton.js';\r\nimport { logger } from './logger.js';\r\nimport { \r\n    sanitizeHTML, \r\n    validateQuestionData, \r\n    sanitizeQuestionData \r\n} from './security.js';\r\n\r\n// ‚úÖ Cl√© localStorage pour persistance mode d√©mo\r\nconst DEMO_STORAGE_KEY = 'avantage-quizz-demo-questions';\r\n\r\n// ‚úÖ Charger les questions d√©mo depuis localStorage OU utiliser d√©fauts\r\nfunction loadDemoQuestions() {\r\n    if (!isDemoMode()) return [];\r\n    \r\n    const saved = localStorage.getItem(DEMO_STORAGE_KEY);\r\n    if (saved) {\r\n        try {\r\n            const parsed = JSON.parse(saved);\r\n            // Reconvertir les dates ISO en objets Date\r\n            return parsed.map(q => ({\r\n                ...q,\r\n                createdAt: new Date(q.createdAt)\r\n            }));\r\n        } catch (e) {\r\n            console.warn('‚ö†Ô∏è Erreur lecture questions d√©mo:', e);\r\n        }\r\n    }\r\n    \r\n    // Questions par d√©faut\r\n    return [\r\n        { id: '1', module: 'auto', month: 11, year: 2025, question: 'Quelle est la pression recommand√©e pour les pneus d\\'une voiture standard ?', options: ['32 PSI', '25 PSI', '40 PSI', '50 PSI'], correctAnswer: 0, explanation: 'La pression recommand√©e est g√©n√©ralement de 32 PSI pour un v√©hicule standard.', createdAt: new Date() },\r\n        { id: '2', module: 'auto', month: 11, year: 2025, question: '√Ä quelle fr√©quence doit-on changer l\\'huile moteur ?', options: ['Tous les 5000 km', 'Tous les 10000 km', 'Tous les 15000 km', 'Tous les 20000 km'], correctAnswer: 1, explanation: 'Il est recommand√© de changer l\\'huile tous les 10000 km ou selon les recommandations du fabricant.', createdAt: new Date() },\r\n        { id: '3', module: 'loisir', month: 11, year: 2025, question: 'Quel est le poids maximal recommand√© pour un bateau remorqu√© ?', options: ['1500 kg', '2000 kg', '2500 kg', '3000 kg'], correctAnswer: 2, explanation: 'Pour un v√©hicule standard, 2500 kg est souvent la limite recommand√©e.', createdAt: new Date() },\r\n        { id: '4', module: 'vr', month: 10, year: 2025, question: 'Quelle est la capacit√© minimale recommand√©e pour une batterie de VR ?', options: ['75 Ah', '100 Ah', '125 Ah', '150 Ah'], correctAnswer: 1, explanation: 'Une batterie de 100 Ah est le minimum recommand√© pour un VR.', createdAt: new Date() },\r\n        { id: '5', module: 'tracteur', month: 10, year: 2025, question: '√Ä quelle profondeur doit-on labourer pour les cultures c√©r√©ali√®res ?', options: ['10-15 cm', '20-25 cm', '30-35 cm', '40-45 cm'], correctAnswer: 1, explanation: 'La profondeur id√©ale est de 20-25 cm pour les c√©r√©ales.', createdAt: new Date() }\r\n    ];\r\n}\r\n\r\n// ‚úÖ Sauvegarder les questions d√©mo dans localStorage\r\nfunction saveDemoQuestions(questions) {\r\n    if (!isDemoMode()) return;\r\n    localStorage.setItem(DEMO_STORAGE_KEY, JSON.stringify(questions));\r\n    console.log('üíæ Questions d√©mo sauvegard√©es:', questions.length);\r\n}\r\n\r\n// ‚úÖ Donn√©es simul√©es pour le mode d√©mo\r\nlet MOCK_QUESTIONS = loadDemoQuestions();\r\n\r\nconst MOCK_STATS = {\r\n    total: 240,\r\n    byModule: { auto: 85, loisir: 62, vr: 54, tracteur: 39 },\r\n    recent: 12\r\n};\r\n\r\n// √âtat de l'application\r\nlet currentQuestions = [];\r\nlet currentFilters = {\r\n    module: '',\r\n    month: '',\r\n    year: new Date().getFullYear()\r\n};\r\nlet currentPage = 1;\r\nconst questionsPerPage = 20;\r\n\r\n/**\r\n * Initialiser la gestion des questions\r\n */\r\nexport async function initQuestionsManager() {\r\n    console.log('Initialisation du gestionnaire de questions');\r\n    \r\n    // Charger les questions\r\n    await loadQuestions();\r\n    \r\n    // Charger les statistiques\r\n    await loadStats();\r\n    \r\n    // Initialiser les event listeners\r\n    initEventListeners();\r\n}\r\n\r\n/**\r\n * Initialiser les event listeners\r\n */\r\nfunction initEventListeners() {\r\n    // Formulaire de cr√©ation\r\n    const createForm = document.getElementById('create-question-form');\r\n    if (createForm) {\r\n        createForm.addEventListener('submit', handleCreateQuestion);\r\n    }\r\n    \r\n    // Upload JSON\r\n    const jsonInput = document.getElementById('json-file-input');\r\n    if (jsonInput) {\r\n        jsonInput.addEventListener('change', handleJSONUpload);\r\n    }\r\n    \r\n    // Bouton parcourir\r\n    const browseBtn = document.getElementById('browse-json-btn');\r\n    if (browseBtn) {\r\n        browseBtn.addEventListener('click', () => jsonInput?.click());\r\n    }\r\n    \r\n    // Filtres\r\n    const moduleFilter = document.getElementById('filter-module');\r\n    const monthFilter = document.getElementById('filter-month');\r\n    const yearFilter = document.getElementById('filter-year');\r\n    const searchInput = document.getElementById('search-questions');\r\n    \r\n    if (moduleFilter) moduleFilter.addEventListener('change', handleFilterChange);\r\n    if (monthFilter) monthFilter.addEventListener('change', handleFilterChange);\r\n    if (yearFilter) yearFilter.addEventListener('change', handleFilterChange);\r\n    if (searchInput) searchInput.addEventListener('input', handleSearch);\r\n    \r\n    // Pagination\r\n    const prevBtn = document.getElementById('prev-page-btn');\r\n    const nextBtn = document.getElementById('next-page-btn');\r\n    \r\n    if (prevBtn) prevBtn.addEventListener('click', () => changePage(-1));\r\n    if (nextBtn) nextBtn.addEventListener('click', () => changePage(1));\r\n}\r\n\r\n/**\r\n * Charger les questions avec filtres\r\n */\r\nasync function loadQuestions() {\r\n    try {\r\n        // Afficher skeleton pendant le chargement\r\n        const container = document.getElementById('questions-list');\r\n        if (container) {\r\n            showSkeleton('questions-list', createQuestionSkeleton(5));\r\n        }\r\n        \r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            console.log('üìù Mode d√©mo : Chargement des questions simul√©es...');\r\n            \r\n            // Simuler un d√©lai de chargement\r\n            await new Promise(resolve => setTimeout(resolve, 500));\r\n            \r\n            // Appliquer les filtres sur les donn√©es mock√©es\r\n            currentQuestions = MOCK_QUESTIONS.filter(q => {\r\n                if (currentFilters.module && q.module !== currentFilters.module) return false;\r\n                if (currentFilters.month && q.month !== parseInt(currentFilters.month)) return false;\r\n                if (currentFilters.year && q.year !== parseInt(currentFilters.year)) return false;\r\n                return true;\r\n            });\r\n            \r\n            console.log(`‚úÖ ${currentQuestions.length} questions simul√©es charg√©es`);\r\n            renderQuestionsList();\r\n            return;\r\n        }\r\n        \r\n        // Mode Firebase normal\r\n        const filters = {};\r\n        if (currentFilters.module) filters.module = currentFilters.module;\r\n        if (currentFilters.month) filters.month = parseInt(currentFilters.month);\r\n        if (currentFilters.year) filters.year = parseInt(currentFilters.year);\r\n        \r\n        currentQuestions = await getQuestions(filters);\r\n        console.log(`Questions chargees: ${currentQuestions.length}`);\r\n        \r\n        renderQuestionsList();\r\n    } catch (error) {\r\n        console.error('Erreur chargement questions:', error);\r\n        const container = document.getElementById('questions-list');\r\n        if (container) {\r\n            container.innerHTML = `\r\n                <div class=\"text-center py-12 text-red-500\">\r\n                    <svg class=\"w-16 h-16 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                    </svg>\r\n                    <p class=\"text-lg font-medium\">Erreur lors du chargement</p>\r\n                    <p class=\"text-sm\">${error.message}</p>\r\n                </div>\r\n            `;\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Afficher la liste des questions\r\n */\r\nfunction renderQuestionsList() {\r\n    const container = document.getElementById('questions-list');\r\n    if (!container) return;\r\n    \r\n    if (currentQuestions.length === 0) {\r\n        container.innerHTML = `\r\n            <div class=\"text-center py-12 text-slate-500\">\r\n                <svg class=\"w-16 h-16 mx-auto mb-4 opacity-50\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"></path>\r\n                </svg>\r\n                <p class=\"text-lg font-medium\">Aucune question trouvee</p>\r\n                <p class=\"text-sm\">Creez votre premiere question ou importez un fichier JSON</p>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    // Pagination\r\n    const startIndex = (currentPage - 1) * questionsPerPage;\r\n    const endIndex = startIndex + questionsPerPage;\r\n    const paginatedQuestions = currentQuestions.slice(startIndex, endIndex);\r\n    \r\n    container.innerHTML = paginatedQuestions.map(q => renderQuestionCard(q)).join('');\r\n    \r\n    // Mettre √† jour la pagination\r\n    updatePaginationControls();\r\n    \r\n    // Ajouter les event listeners pour les actions\r\n    addQuestionActionListeners();\r\n}\r\n\r\n/**\r\n * Rendu d'une carte de question\r\n */\r\nfunction renderQuestionCard(question) {\r\n    const moduleColors = {\r\n        auto: 'indigo',\r\n        loisir: 'cyan',\r\n        vr: 'orange',\r\n        tracteur: 'green'\r\n    };\r\n    \r\n    const moduleIcons = {\r\n        auto: 'üöó',\r\n        loisir: 'üèîÔ∏è',\r\n        vr: 'üöê',\r\n        tracteur: 'üöú'\r\n    };\r\n    \r\n    const color = moduleColors[question.module] || 'gray';\r\n    const icon = moduleIcons[question.module] || 'üìù';\r\n    \r\n    const monthNames = ['Jan', 'Fev', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Aout', 'Sep', 'Oct', 'Nov', 'Dec'];\r\n    const monthName = monthNames[question.month - 1] || question.month;\r\n    \r\n    return `\r\n        <div class=\"question-card bg-white rounded-xl shadow-md p-6 mb-4 hover:shadow-lg transition-shadow\" data-question-id=\"${question.id}\">\r\n            <div class=\"flex items-start justify-between mb-4\">\r\n                <div class=\"flex items-center gap-3\">\r\n                    <span class=\"text-2xl\">${icon}</span>\r\n                    <div>\r\n                        <span class=\"inline-block bg-${color}-100 text-${color}-700 text-xs font-semibold px-3 py-1 rounded-full\">\r\n                            ${question.module.toUpperCase()}\r\n                        </span>\r\n                        <span class=\"ml-2 text-sm text-slate-500\">${monthName} ${question.year}</span>\r\n                    </div>\r\n                </div>\r\n                <div class=\"flex gap-2\">\r\n                    <button class=\"edit-question-btn text-indigo-600 hover:text-indigo-800 p-2 rounded hover:bg-indigo-50 transition\" data-question-id=\"${question.id}\" title=\"Modifier\">\r\n                        <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\r\n                        </svg>\r\n                    </button>\r\n                    <button class=\"delete-question-btn text-red-600 hover:text-red-800 p-2 rounded hover:bg-red-50 transition\" data-question-id=\"${question.id}\" title=\"Supprimer\">\r\n                        <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"></path>\r\n                        </svg>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n            \r\n            <h4 class=\"text-lg font-semibold text-slate-900 mb-4\">${escapeHtml(question.question)}</h4>\r\n            \r\n            <div class=\"space-y-2 mb-4\">\r\n                ${question.options.map((opt, idx) => `\r\n                    <div class=\"flex items-start gap-2 text-sm ${idx === question.correctAnswer ? 'font-semibold text-green-700 bg-green-50 p-2 rounded' : 'text-slate-600'}\">\r\n                        <span class=\"font-bold\">${String.fromCharCode(65 + idx)})</span>\r\n                        <span>${escapeHtml(opt)}</span>\r\n                        ${idx === question.correctAnswer ? '<svg class=\"w-5 h-5 text-green-600 ml-auto flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"></path></svg>' : ''}\r\n                    </div>\r\n                `).join('')}\r\n            </div>\r\n            \r\n            <div class=\"bg-blue-50 border-l-4 border-blue-500 p-3 rounded\">\r\n                <p class=\"text-xs font-semibold text-blue-700 mb-1\">üí° Explication</p>\r\n                <p class=\"text-sm text-blue-900\">${escapeHtml(question.explanation)}</p>\r\n            </div>\r\n            \r\n            <div class=\"mt-4 pt-4 border-t border-slate-200 text-xs text-slate-500\">\r\n                Creee le: ${question.createdAt ? new Date(question.createdAt.seconds * 1000).toLocaleDateString('fr-FR') : 'N/A'}\r\n                ${question.createdBy ? ` | Par: ${question.createdBy}` : ''}\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Ajouter les event listeners pour les actions sur les questions\r\n */\r\nfunction addQuestionActionListeners() {\r\n    // Boutons Modifier\r\n    document.querySelectorAll('.edit-question-btn').forEach(btn => {\r\n        btn.addEventListener('click', (e) => {\r\n            const questionId = e.currentTarget.dataset.questionId;\r\n            openEditModal(questionId);\r\n        });\r\n    });\r\n    \r\n    // Boutons Supprimer\r\n    document.querySelectorAll('.delete-question-btn').forEach(btn => {\r\n        btn.addEventListener('click', (e) => {\r\n            const questionId = e.currentTarget.dataset.questionId;\r\n            handleDeleteQuestion(questionId);\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * G√©rer la cr√©ation d'une question\r\n */\r\nasync function handleCreateQuestion(e) {\r\n    e.preventDefault();\r\n    \r\n    const form = e.target;\r\n    const submitBtn = form.querySelector('[type=\"submit\"]');\r\n    const originalBtnText = submitBtn.innerHTML;\r\n    \r\n    try {\r\n        submitBtn.disabled = true;\r\n        submitBtn.innerHTML = '<svg class=\"animate-spin h-5 w-5 inline\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg> Creation...';\r\n        \r\n        const questionData = {\r\n            question: form.querySelector('[name=\"question\"]').value,\r\n            options: [\r\n                form.querySelector('[name=\"option1\"]').value,\r\n                form.querySelector('[name=\"option2\"]').value,\r\n                form.querySelector('[name=\"option3\"]').value,\r\n                form.querySelector('[name=\"option4\"]').value\r\n            ],\r\n            correctAnswer: parseInt(form.querySelector('[name=\"correctAnswer\"]:checked').value),\r\n            explanation: form.querySelector('[name=\"explanation\"]').value,\r\n            module: form.querySelector('[name=\"module\"]').value,\r\n            month: parseInt(form.querySelector('[name=\"month\"]').value),\r\n            year: parseInt(form.querySelector('[name=\"year\"]').value)\r\n        };\r\n        \r\n        // ‚úÖ Mode d√©mo : Simuler la cr√©ation\r\n        if (isDemoMode()) {\r\n            console.log('üìù Mode d√©mo : Simulation cr√©ation question...');\r\n            await new Promise(resolve => setTimeout(resolve, 500)); // D√©lai r√©aliste\r\n            \r\n            // Ajouter la question aux donn√©es mock√©es\r\n            const newMockQuestion = {\r\n                id: `demo-${Date.now()}`,\r\n                ...questionData,\r\n                explanation: questionData.explanation || 'Explication non fournie',\r\n                createdAt: new Date()\r\n            };\r\n            MOCK_QUESTIONS.unshift(newMockQuestion);\r\n            \r\n            // üíæ SAUVEGARDER dans localStorage\r\n            saveDemoQuestions(MOCK_QUESTIONS);\r\n            \r\n            showSuccess('‚úÖ Question cr√©√©e avec succ√®s (mode d√©mo) !');\r\n            form.reset();\r\n            \r\n            await loadQuestions();\r\n            await loadStats();\r\n            return;\r\n        }\r\n        \r\n        await createQuestion(questionData);\r\n        \r\n        showSuccess('Question creee avec succes!');\r\n        form.reset();\r\n        await loadQuestions();\r\n        await loadStats();\r\n    } catch (error) {\r\n        console.error('Erreur creation question:', error);\r\n        showError('create-question-error', error.message || 'Erreur lors de la creation');\r\n    } finally {\r\n        submitBtn.disabled = false;\r\n        submitBtn.innerHTML = originalBtnText;\r\n    }\r\n}\r\n\r\n/**\r\n * G√©rer l'upload JSON\r\n */\r\nasync function handleJSONUpload(e) {\r\n    const file = e.target.files[0];\r\n    if (!file) return;\r\n    \r\n    try {\r\n        showLoading('json-preview');\r\n        \r\n        const text = await file.text();\r\n        const jsonData = JSON.parse(text);\r\n        \r\n        // Valider le format\r\n        validateJSONFormat(jsonData);\r\n        \r\n        // Afficher l'aper√ßu\r\n        showJSONPreview(jsonData, file.name);\r\n    } catch (error) {\r\n        console.error('Erreur lecture JSON:', error);\r\n        showError('json-preview', error.message || 'Fichier JSON invalide');\r\n    }\r\n}\r\n\r\n/**\r\n * Valider le format JSON\r\n */\r\nfunction validateJSONFormat(data) {\r\n    if (!data.module || !data.month || !data.year) {\r\n        throw new Error('Champs obligatoires manquants: module, month, year');\r\n    }\r\n    \r\n    if (!Array.isArray(data.questions) || data.questions.length === 0) {\r\n        throw new Error('Le fichier doit contenir au moins une question');\r\n    }\r\n    \r\n    // Valider chaque question\r\n    data.questions.forEach((q, idx) => {\r\n        if (!q.question || q.question.length < 10) {\r\n            throw new Error(`Question ${idx + 1}: texte trop court (min 10 caracteres)`);\r\n        }\r\n        if (!Array.isArray(q.options) || q.options.length !== 4) {\r\n            throw new Error(`Question ${idx + 1}: doit avoir exactement 4 options`);\r\n        }\r\n        if (q.correctAnswer === undefined || q.correctAnswer < 0 || q.correctAnswer > 3) {\r\n            throw new Error(`Question ${idx + 1}: correctAnswer invalide (doit etre 0-3)`);\r\n        }\r\n        if (!q.explanation || q.explanation.length < 20) {\r\n            throw new Error(`Question ${idx + 1}: explication trop courte (min 20 caracteres)`);\r\n        }\r\n    });\r\n    \r\n    return true;\r\n}\r\n\r\n/**\r\n * Afficher l'aper√ßu du JSON\r\n */\r\nfunction showJSONPreview(data, fileName) {\r\n    const container = document.getElementById('json-preview');\r\n    if (!container) return;\r\n    \r\n    const moduleNames = {\r\n        auto: 'Auto',\r\n        loisir: 'Loisir',\r\n        vr: 'VR',\r\n        tracteur: 'Tracteur'\r\n    };\r\n    \r\n    const monthNames = ['Janvier', 'Fevrier', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Aout', 'Septembre', 'Octobre', 'Novembre', 'Decembre'];\r\n    \r\n    container.innerHTML = `\r\n        <div class=\"bg-green-50 border-2 border-green-500 rounded-xl p-6\">\r\n            <div class=\"flex items-start justify-between mb-4\">\r\n                <div>\r\n                    <h4 class=\"text-lg font-bold text-green-900 mb-2\">üìÑ ${fileName}</h4>\r\n                    <div class=\"space-y-1 text-sm\">\r\n                        <p class=\"text-green-800\">‚úì Format valide</p>\r\n                        <p class=\"text-green-800\">‚úì ${data.questions.length} question(s) detectee(s)</p>\r\n                        <p class=\"text-green-800\">‚úì Module: ${moduleNames[data.module] || data.module}</p>\r\n                        <p class=\"text-green-800\">‚úì Periode: ${monthNames[data.month - 1]} ${data.year}</p>\r\n                    </div>\r\n                </div>\r\n                <button id=\"cancel-import-btn\" class=\"text-slate-500 hover:text-slate-700\">\r\n                    <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                    </svg>\r\n                </button>\r\n            </div>\r\n            \r\n            <div class=\"bg-white rounded-lg p-4 mb-4 max-h-60 overflow-y-auto\">\r\n                <p class=\"font-semibold text-slate-900 mb-2\">Apercu des premieres questions:</p>\r\n                <ol class=\"space-y-2 text-sm text-slate-700\">\r\n                    ${data.questions.slice(0, 5).map((q, idx) => `\r\n                        <li><strong>${idx + 1}.</strong> ${escapeHtml(q.question.substring(0, 80))}${q.question.length > 80 ? '...' : ''}</li>\r\n                    `).join('')}\r\n                    ${data.questions.length > 5 ? `<li class=\"text-slate-500 italic\">... et ${data.questions.length - 5} autre(s)</li>` : ''}\r\n                </ol>\r\n            </div>\r\n            \r\n            <div class=\"flex gap-3\">\r\n                <button id=\"confirm-import-btn\" class=\"flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition\">\r\n                    Importer les ${data.questions.length} questions ‚Üí\r\n                </button>\r\n            </div>\r\n        </div>\r\n    `;\r\n    \r\n    // Event listeners\r\n    document.getElementById('confirm-import-btn')?.addEventListener('click', () => handleConfirmImport(data));\r\n    document.getElementById('cancel-import-btn')?.addEventListener('click', () => {\r\n        container.innerHTML = '';\r\n        document.getElementById('json-file-input').value = '';\r\n    });\r\n}\r\n\r\n/**\r\n * Confirmer l'import JSON\r\n */\r\nasync function handleConfirmImport(data) {\r\n    const container = document.getElementById('json-preview');\r\n    const confirmBtn = document.getElementById('confirm-import-btn');\r\n    \r\n    try {\r\n        confirmBtn.disabled = true;\r\n        confirmBtn.innerHTML = '<svg class=\"animate-spin h-5 w-5 inline\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle></svg> Import en cours...';\r\n        \r\n        // ‚úÖ Mode d√©mo : Simuler l'import\r\n        if (isDemoMode()) {\r\n            console.log('üìù Mode d√©mo : Simulation import JSON...');\r\n            await new Promise(resolve => setTimeout(resolve, 1000));\r\n            \r\n            const questionsToImport = data.questions || [];\r\n            questionsToImport.forEach((q, idx) => {\r\n                MOCK_QUESTIONS.unshift({\r\n                    id: `demo-imported-${Date.now()}-${idx}`,\r\n                    question: q.question,\r\n                    options: q.options,\r\n                    correctAnswer: q.correctAnswer,\r\n                    explanation: q.explanation || 'Pas d\\'explication fournie',\r\n                    module: data.module,\r\n                    month: data.month,\r\n                    year: data.year,\r\n                    createdAt: new Date()\r\n                });\r\n            });\r\n            \r\n            // üíæ SAUVEGARDER dans localStorage\r\n            saveDemoQuestions(MOCK_QUESTIONS);\r\n            \r\n            showSuccess(`‚úÖ Import termin√© (mode d√©mo): ${questionsToImport.length} questions import√©es`);\r\n            \r\n            container.innerHTML = '';\r\n            document.getElementById('json-file-input').value = '';\r\n            \r\n            await loadQuestions();\r\n            await loadStats();\r\n            return;\r\n        }\r\n        \r\n        const result = await importQuestionsFromJSON(data);\r\n        \r\n        showSuccess(`Import termine: ${result.success}/${result.total} questions importees`);\r\n        \r\n        if (result.errors.length > 0) {\r\n            console.warn('Erreurs import:', result.errors);\r\n        }\r\n        \r\n        container.innerHTML = '';\r\n        document.getElementById('json-file-input').value = '';\r\n        \r\n        await loadQuestions();\r\n        await loadStats();\r\n    } catch (error) {\r\n        console.error('Erreur import:', error);\r\n        showError('json-preview', error.message || 'Erreur lors de l import');\r\n    }\r\n}\r\n\r\n/**\r\n * Ouvrir le modal d'√©dition\r\n */\r\nfunction openEditModal(questionId) {\r\n    const question = currentQuestions.find(q => q.id === questionId);\r\n    if (!question) return;\r\n    \r\n    // TODO: Implementer le modal d'edition\r\n    // Pour l'instant, on affiche une alerte\r\n    alert(`Edition de la question ${questionId}\\nA implementer: modal d'edition`);\r\n}\r\n\r\n/**\r\n * G√©rer la suppression d'une question\r\n */\r\nasync function handleDeleteQuestion(questionId) {\r\n    const question = currentQuestions.find(q => q.id === questionId);\r\n    if (!question) return;\r\n    \r\n    const confirmDelete = confirm(\r\n        `Voulez-vous vraiment supprimer cette question?\\n\\n\"${question.question.substring(0, 100)}...\"\\n\\nCette action est irreversible.`\r\n    );\r\n    \r\n    if (!confirmDelete) return;\r\n    \r\n    try {\r\n        // ‚úÖ Mode d√©mo : Simuler la suppression\r\n        if (isDemoMode()) {\r\n            console.log('üìù Mode d√©mo : Simulation suppression question...');\r\n            await new Promise(resolve => setTimeout(resolve, 300));\r\n            \r\n            const index = MOCK_QUESTIONS.findIndex(q => q.id === questionId);\r\n            if (index > -1) {\r\n                MOCK_QUESTIONS.splice(index, 1);\r\n                \r\n                // üíæ SAUVEGARDER dans localStorage\r\n                saveDemoQuestions(MOCK_QUESTIONS);\r\n            }\r\n            \r\n            showSuccess('‚úÖ Question supprim√©e avec succ√®s (mode d√©mo)');\r\n            await loadQuestions();\r\n            await loadStats();\r\n            return;\r\n        }\r\n        \r\n        await deleteQuestion(questionId);\r\n        showSuccess('Question supprimee avec succes');\r\n        await loadQuestions();\r\n        await loadStats();\r\n    } catch (error) {\r\n        console.error('Erreur suppression:', error);\r\n        showError('questions-list', error.message || 'Erreur lors de la suppression');\r\n    }\r\n}\r\n\r\n/**\r\n * G√©rer le changement de filtres\r\n */\r\nasync function handleFilterChange(e) {\r\n    const filterName = e.target.id.replace('filter-', '');\r\n    currentFilters[filterName] = e.target.value;\r\n    currentPage = 1; // Reset pagination\r\n    await loadQuestions();\r\n}\r\n\r\n/**\r\n * G√©rer la recherche\r\n */\r\nfunction handleSearch(e) {\r\n    const searchTerm = e.target.value.toLowerCase();\r\n    \r\n    if (!searchTerm) {\r\n        renderQuestionsList();\r\n        return;\r\n    }\r\n    \r\n    const filtered = currentQuestions.filter(q => \r\n        q.question.toLowerCase().includes(searchTerm) ||\r\n        q.options.some(opt => opt.toLowerCase().includes(searchTerm)) ||\r\n        q.explanation.toLowerCase().includes(searchTerm)\r\n    );\r\n    \r\n    // Afficher les r√©sultats filtr√©s\r\n    const container = document.getElementById('questions-list');\r\n    if (!container) return;\r\n    \r\n    if (filtered.length === 0) {\r\n        container.innerHTML = `\r\n            <div class=\"text-center py-12 text-slate-500\">\r\n                <p class=\"text-lg\">Aucun resultat pour \"${searchTerm}\"</p>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    container.innerHTML = filtered.map(q => renderQuestionCard(q)).join('');\r\n    addQuestionActionListeners();\r\n}\r\n\r\n/**\r\n * Changer de page\r\n */\r\nfunction changePage(direction) {\r\n    const totalPages = Math.ceil(currentQuestions.length / questionsPerPage);\r\n    currentPage += direction;\r\n    \r\n    if (currentPage < 1) currentPage = 1;\r\n    if (currentPage > totalPages) currentPage = totalPages;\r\n    \r\n    renderQuestionsList();\r\n    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n}\r\n\r\n/**\r\n * Mettre √† jour les contr√¥les de pagination\r\n */\r\nfunction updatePaginationControls() {\r\n    const totalPages = Math.ceil(currentQuestions.length / questionsPerPage);\r\n    const pageInfo = document.getElementById('page-info');\r\n    const prevBtn = document.getElementById('prev-page-btn');\r\n    const nextBtn = document.getElementById('next-page-btn');\r\n    \r\n    if (pageInfo) {\r\n        pageInfo.textContent = `Page ${currentPage}/${totalPages || 1}`;\r\n    }\r\n    \r\n    if (prevBtn) {\r\n        prevBtn.disabled = currentPage === 1;\r\n    }\r\n    \r\n    if (nextBtn) {\r\n        nextBtn.disabled = currentPage === totalPages || totalPages === 0;\r\n    }\r\n}\r\n\r\n/**\r\n * Charger les statistiques des questions\r\n */\r\nasync function loadStats() {\r\n    try {\r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            console.log('üìä Mode d√©mo : Chargement des stats simul√©es...');\r\n            renderStats(MOCK_STATS);\r\n            return;\r\n        }\r\n        \r\n        // Mode Firebase normal\r\n        const stats = await getQuestionsStats();\r\n        renderStats(stats);\r\n    } catch (error) {\r\n        console.error('Erreur chargement stats:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Afficher les statistiques\r\n */\r\nfunction renderStats(stats) {\r\n    const container = document.getElementById('questions-stats');\r\n    if (!container) return;\r\n    \r\n    const moduleNames = {\r\n        auto: 'Auto',\r\n        loisir: 'Loisir',\r\n        vr: 'VR',\r\n        tracteur: 'Tracteur'\r\n    };\r\n    \r\n    container.innerHTML = `\r\n        <div class=\"bg-white rounded-xl shadow-md p-6\">\r\n            <h3 class=\"text-xl font-bold text-slate-900 mb-4\">üìä Statistiques des Questions</h3>\r\n            \r\n            <div class=\"mb-6\">\r\n                <p class=\"text-3xl font-bold text-indigo-600 mb-1\">${stats.total}</p>\r\n                <p class=\"text-sm text-slate-600\">questions au total</p>\r\n            </div>\r\n            \r\n            <div class=\"space-y-3\">\r\n                <p class=\"text-sm font-semibold text-slate-700 mb-2\">Par module:</p>\r\n                ${Object.entries(stats.byModule).map(([module, count]) => {\r\n                    const percentage = ((count / stats.total) * 100).toFixed(0);\r\n                    return `\r\n                        <div>\r\n                            <div class=\"flex justify-between text-sm mb-1\">\r\n                                <span class=\"text-slate-700\">${moduleNames[module] || module}</span>\r\n                                <span class=\"font-semibold\">${count} (${percentage}%)</span>\r\n                            </div>\r\n                            <div class=\"bg-slate-200 rounded-full h-2\">\r\n                                <div class=\"bg-indigo-600 rounded-full h-2 transition-all\" style=\"width: ${percentage}%\"></div>\r\n                            </div>\r\n                        </div>\r\n                    `;\r\n                }).join('')}\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Afficher un loader\r\n */\r\nfunction showLoading(containerId) {\r\n    const container = document.getElementById(containerId);\r\n    if (!container) return;\r\n    \r\n    container.innerHTML = `\r\n        <div class=\"text-center py-12\">\r\n            <svg class=\"animate-spin h-12 w-12 mx-auto text-indigo-600\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\r\n                <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n            </svg>\r\n            <p class=\"text-slate-600 mt-4\">Chargement...</p>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Afficher une erreur\r\n */\r\nfunction showError(containerId, message) {\r\n    const container = document.getElementById(containerId);\r\n    if (!container) {\r\n        alert(`Erreur: ${message}`);\r\n        return;\r\n    }\r\n    \r\n    container.innerHTML = `\r\n        <div class=\"bg-red-50 border-2 border-red-500 rounded-xl p-6 text-center\">\r\n            <svg class=\"w-12 h-12 mx-auto text-red-500 mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n            </svg>\r\n            <p class=\"text-red-900 font-semibold\">${message}</p>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Afficher un message de succ√®s\r\n */\r\nfunction showSuccess(message) {\r\n    // Cr√©er une notification toast\r\n    const toast = document.createElement('div');\r\n    toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-xl z-50 animate-fade-in';\r\n    toast.innerHTML = `\r\n        <div class=\"flex items-center gap-3\">\r\n            <svg class=\"w-6 h-6\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"></path>\r\n            </svg>\r\n            <span class=\"font-semibold\">${message}</span>\r\n        </div>\r\n    `;\r\n    \r\n    document.body.appendChild(toast);\r\n    \r\n    setTimeout(() => {\r\n        toast.remove();\r\n    }, 3000);\r\n}\r\n\r\n/**\r\n * √âchapper le HTML\r\n */\r\nfunction escapeHtml(text) {\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n}\r\n","// Admin Users Manager - Gestion des utilisateurs\r\nimport { \r\n    getAllUsers, \r\n    updateUserRole,\r\n    getUsersStats\r\n} from './firestore-service.js';\r\nimport { toast } from './toast.js';\r\nimport { isDemoMode } from './auth.js';\r\nimport {\r\n    createUserSkeleton,\r\n    createStatsSkeleton,\r\n    showSkeleton,\r\n    hideSkeleton\r\n} from './skeleton.js';\r\n\r\n// ‚úÖ Donn√©es simul√©es pour le mode d√©mo\r\nconst MOCK_USERS = [\r\n    { id: '1', email: 'admin@avantage-quizz.com', displayName: 'Administrateur Principal', role: 'admin', totalQuizzes: 0, averageScore: 0, createdAt: new Date('2025-01-15'), lastLogin: new Date() },\r\n    { id: '2', email: 'alice.dupont@example.com', displayName: 'Alice Dupont', role: 'user', totalQuizzes: 24, averageScore: 92, createdAt: new Date('2025-02-20'), lastLogin: new Date() },\r\n    { id: '3', email: 'bob.martin@example.com', displayName: 'Bob Martin', role: 'user', totalQuizzes: 21, averageScore: 88, createdAt: new Date('2025-03-10'), lastLogin: new Date(Date.now() - 86400000) },\r\n    { id: '4', email: 'claire.bernard@example.com', displayName: 'Claire Bernard', role: 'user', totalQuizzes: 19, averageScore: 85, createdAt: new Date('2025-03-25'), lastLogin: new Date(Date.now() - 172800000) },\r\n    { id: '5', email: 'david.dubois@example.com', displayName: 'David Dubois', role: 'user', totalQuizzes: 18, averageScore: 83, createdAt: new Date('2025-04-05'), lastLogin: new Date(Date.now() - 259200000) }\r\n];\r\n\r\nconst MOCK_STATS = {\r\n    total: 42,\r\n    admins: 2,\r\n    regularUsers: 40,\r\n    activeToday: 8,\r\n    activeWeek: 23\r\n};\r\n\r\n// √âtat\r\nlet currentUsers = [];\r\nlet currentFilters = {\r\n    role: '',\r\n    status: 'all'\r\n};\r\n\r\n/**\r\n * Initialiser la gestion des utilisateurs\r\n */\r\nexport async function initUsersManager() {\r\n    console.log('Initialisation du gestionnaire utilisateurs');\r\n    \r\n    // Charger les utilisateurs\r\n    await loadUsers();\r\n    \r\n    // Charger les statistiques\r\n    await loadStats();\r\n    \r\n    // Initialiser les event listeners\r\n    initEventListeners();\r\n}\r\n\r\n/**\r\n * Initialiser les event listeners\r\n */\r\nfunction initEventListeners() {\r\n    // Formulaire de cr√©ation d'utilisateur\r\n    const createUserForm = document.getElementById('create-user-form');\r\n    if (createUserForm) {\r\n        createUserForm.addEventListener('submit', handleCreateUser);\r\n    }\r\n    \r\n    // Bouton g√©n√©ration de mot de passe\r\n    const generatePasswordBtn = document.getElementById('generate-password-btn');\r\n    if (generatePasswordBtn) {\r\n        generatePasswordBtn.addEventListener('click', generateRandomPassword);\r\n    }\r\n    \r\n    // Filtres\r\n    const roleFilter = document.getElementById('filter-user-role');\r\n    const statusFilter = document.getElementById('filter-user-status');\r\n    const searchInput = document.getElementById('search-users');\r\n    \r\n    if (roleFilter) roleFilter.addEventListener('change', handleFilterChange);\r\n    if (statusFilter) statusFilter.addEventListener('change', handleFilterChange);\r\n    if (searchInput) searchInput.addEventListener('input', handleSearch);\r\n}\r\n\r\n/**\r\n * Cr√©er un nouvel utilisateur\r\n */\r\nasync function handleCreateUser(e) {\r\n    e.preventDefault();\r\n    \r\n    const errorDiv = document.getElementById('create-user-error');\r\n    const successDiv = document.getElementById('create-user-success');\r\n    const submitBtn = document.getElementById('create-user-btn');\r\n    \r\n    // Masquer les messages\r\n    errorDiv.classList.add('hidden');\r\n    successDiv.classList.add('hidden');\r\n    \r\n    // R√©cup√©rer les donn√©es\r\n    const formData = new FormData(e.target);\r\n    const userData = {\r\n        displayName: formData.get('displayName'),\r\n        email: formData.get('email'),\r\n        password: formData.get('password'),\r\n        role: formData.get('role')\r\n    };\r\n    \r\n    // Validation\r\n    if (!userData.displayName || !userData.email || !userData.password || !userData.role) {\r\n        showFormError(errorDiv, 'Tous les champs sont obligatoires');\r\n        toast.error('Veuillez remplir tous les champs');\r\n        return;\r\n    }\r\n    \r\n    if (userData.password.length < 6) {\r\n        showFormError(errorDiv, 'Le mot de passe doit contenir au moins 6 caract√®res');\r\n        toast.error('Mot de passe trop court (minimum 6 caract√®res)');\r\n        return;\r\n    }\r\n    \r\n    // D√©sactiver le bouton et afficher loading toast\r\n    submitBtn.disabled = true;\r\n    submitBtn.textContent = '‚è≥ Cr√©ation en cours...';\r\n    const loadingToast = toast.showLoadingToast('Cr√©ation de l\\'utilisateur...');\r\n    \r\n    try {\r\n        console.log('Cr√©ation d\\'un nouvel utilisateur:', userData.email);\r\n        \r\n        // Appeler la Cloud Function (√† cr√©er)\r\n        // Pour l'instant, on simule avec un message d'erreur explicite\r\n        toast.updateLoadingToast(loadingToast, 'Cloud Function requise', 'error');\r\n        throw new Error('‚ö†Ô∏è CLOUD FUNCTION REQUISE: Cette fonctionnalit√© n√©cessite une Cloud Function Firebase pour cr√©er des utilisateurs avec mot de passe. Actuellement, seule l\\'authentification Google est support√©e. Pour activer cette fonctionnalit√©:\\n\\n1. Activer Email/Password dans Firebase Auth\\n2. Cr√©er une Cloud Function createUser\\n3. D√©ployer la fonction sur Firebase');\r\n        \r\n        // Code √† utiliser une fois la Cloud Function cr√©√©e:\r\n        /*\r\n        const createUserFunction = httpsCallable(functions, 'createUser');\r\n        const result = await createUserFunction(userData);\r\n        \r\n        console.log('‚úÖ Utilisateur cr√©√© avec succ√®s:', result.data);\r\n        \r\n        // Afficher le message de succ√®s\r\n        successDiv.textContent = `‚úÖ Utilisateur cr√©√© avec succ√®s ! Email: ${userData.email}`;\r\n        successDiv.classList.remove('hidden');\r\n        \r\n        // Toast de succ√®s\r\n        toast.updateLoadingToast(loadingToast, 'Utilisateur cr√©√© avec succ√®s !', 'success');\r\n        toast.success(`Utilisateur ${userData.email} cr√©√© !`, 4000);\r\n        \r\n        // R√©initialiser le formulaire\r\n        e.target.reset();\r\n        \r\n        // Recharger la liste des utilisateurs\r\n        await loadUsers();\r\n        */\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur cr√©ation utilisateur:', error);\r\n        showFormError(errorDiv, error.message);\r\n    } finally {\r\n        // R√©activer le bouton\r\n        submitBtn.disabled = false;\r\n        submitBtn.textContent = '‚ûï Cr√©er l\\'utilisateur';\r\n    }\r\n}\r\n\r\n/**\r\n * G√©n√©rer un mot de passe al√©atoire\r\n */\r\nfunction generateRandomPassword() {\r\n    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789@#$%&';\r\n    const length = 12;\r\n    let password = '';\r\n    \r\n    for (let i = 0; i < length; i++) {\r\n        password += chars.charAt(Math.floor(Math.random() * chars.length));\r\n    }\r\n    \r\n    // Remplir le champ\r\n    const passwordInput = document.querySelector('input[name=\"password\"]');\r\n    if (passwordInput) {\r\n        passwordInput.value = password;\r\n        passwordInput.type = 'text'; // Afficher le mot de passe g√©n√©r√©\r\n        \r\n        // Copier dans le presse-papier\r\n        navigator.clipboard.writeText(password).then(() => {\r\n            toast.success('Mot de passe g√©n√©r√© et copi√© ! Sauvegardez-le en lieu s√ªr.', 5000);\r\n        }).catch(() => {\r\n            toast.warning(`Mot de passe g√©n√©r√©: ${password}\\n\\nCopiez-le manuellement.`, 7000);\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Afficher une erreur de formulaire\r\n */\r\nfunction showFormError(errorDiv, message) {\r\n    errorDiv.textContent = message;\r\n    errorDiv.classList.remove('hidden');\r\n    errorDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\r\n}\r\n\r\n/**\r\n * Charger tous les utilisateurs\r\n */\r\nasync function loadUsers() {\r\n    try {\r\n        // Afficher skeleton pendant le chargement\r\n        const container = document.getElementById('users-list');\r\n        if (container) {\r\n            showSkeleton('users-list', createUserSkeleton(10));\r\n        }\r\n        \r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            console.log('üë• Mode d√©mo : Chargement des utilisateurs simul√©s...');\r\n            \r\n            // Simuler un d√©lai de chargement\r\n            await new Promise(resolve => setTimeout(resolve, 500));\r\n            \r\n            // Appliquer les filtres sur les donn√©es mock√©es\r\n            currentUsers = MOCK_USERS.filter(user => {\r\n                if (currentFilters.role && user.role !== currentFilters.role) return false;\r\n                \r\n                if (currentFilters.status !== 'all') {\r\n                    const oneWeekAgo = new Date();\r\n                    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\r\n                    const lastLoginDate = user.lastLogin;\r\n                    const isActive = lastLoginDate > oneWeekAgo;\r\n                    \r\n                    if (currentFilters.status === 'active' && !isActive) return false;\r\n                    if (currentFilters.status === 'inactive' && isActive) return false;\r\n                }\r\n                \r\n                return true;\r\n            });\r\n            \r\n            console.log(`‚úÖ ${currentUsers.length} utilisateurs simul√©s charg√©s`);\r\n            renderUsersList();\r\n            return;\r\n        }\r\n        \r\n        // Mode Firebase normal\r\n        const filters = {};\r\n        if (currentFilters.role) {\r\n            filters.role = currentFilters.role;\r\n        }\r\n        \r\n        currentUsers = await getAllUsers(filters);\r\n        \r\n        // Filtrer par statut actif/inactif c√¥t√© client\r\n        if (currentFilters.status !== 'all') {\r\n            const oneWeekAgo = new Date();\r\n            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\r\n            \r\n            currentUsers = currentUsers.filter(user => {\r\n                if (!user.lastLogin) return currentFilters.status === 'inactive';\r\n                \r\n                const lastLoginDate = user.lastLogin.toDate ? user.lastLogin.toDate() : new Date(user.lastLogin);\r\n                const isActive = lastLoginDate > oneWeekAgo;\r\n                \r\n                return currentFilters.status === 'active' ? isActive : !isActive;\r\n            });\r\n        }\r\n        \r\n        console.log(`Utilisateurs charges: ${currentUsers.length}`);\r\n        renderUsersList();\r\n    } catch (error) {\r\n        console.error('Erreur chargement utilisateurs:', error);\r\n        const container = document.getElementById('users-list');\r\n        if (container) {\r\n            container.innerHTML = `\r\n                <div class=\"text-center py-12 text-red-500\">\r\n                    <svg class=\"w-16 h-16 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                    </svg>\r\n                    <p class=\"text-lg font-medium\">Erreur lors du chargement</p>\r\n                    <p class=\"text-sm\">${error.message}</p>\r\n                </div>\r\n            `;\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Afficher la liste des utilisateurs\r\n */\r\nfunction renderUsersList() {\r\n    const container = document.getElementById('users-list');\r\n    if (!container) return;\r\n    \r\n    if (currentUsers.length === 0) {\r\n        container.innerHTML = `\r\n            <div class=\"text-center py-12 text-slate-500\">\r\n                <svg class=\"w-16 h-16 mx-auto mb-4 opacity-50\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"></path>\r\n                </svg>\r\n                <p class=\"text-lg font-medium\">Aucun utilisateur trouve</p>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    container.innerHTML = currentUsers.map(user => renderUserCard(user)).join('');\r\n    \r\n    // Ajouter les event listeners\r\n    addUserActionListeners();\r\n}\r\n\r\n/**\r\n * Rendu d'une carte utilisateur\r\n */\r\nfunction renderUserCard(user) {\r\n    const isAdmin = user.role === 'admin';\r\n    const roleColor = isAdmin ? 'yellow' : 'blue';\r\n    const roleIcon = isAdmin ? 'üî∞' : 'üë§';\r\n    \r\n    const lastLogin = user.lastLogin ? \r\n        (user.lastLogin.toDate ? user.lastLogin.toDate() : new Date(user.lastLogin)) : \r\n        null;\r\n    \r\n    const createdAt = user.createdAt ? \r\n        (user.createdAt.toDate ? user.createdAt.toDate() : new Date(user.createdAt)) : \r\n        null;\r\n    \r\n    const isActive = lastLogin && (new Date() - lastLogin) < (7 * 24 * 60 * 60 * 1000);\r\n    \r\n    const lastLoginText = lastLogin ? formatRelativeTime(lastLogin) : 'Jamais connecte';\r\n    \r\n    const avatarUrl = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || user.email)}&background=667eea&color=fff&size=128`;\r\n    \r\n    return `\r\n        <div class=\"user-card bg-white rounded-xl shadow-md p-6 mb-4 hover:shadow-lg transition-shadow\" data-user-id=\"${user.uid}\">\r\n            <div class=\"flex items-start gap-4\">\r\n                <img src=\"${avatarUrl}\" alt=\"${user.displayName || 'User'}\" class=\"w-16 h-16 rounded-full object-cover flex-shrink-0\" onerror=\"this.src='https://ui-avatars.com/api/?name=U&background=667eea&color=fff&size=128'\">\r\n                \r\n                <div class=\"flex-1 min-w-0\">\r\n                    <div class=\"flex items-center justify-between mb-2\">\r\n                        <div>\r\n                            <h4 class=\"text-lg font-bold text-slate-900 truncate\">${escapeHtml(user.displayName || 'Sans nom')}</h4>\r\n                            <p class=\"text-sm text-slate-600 truncate\">${escapeHtml(user.email)}</p>\r\n                        </div>\r\n                        <div class=\"flex gap-2 flex-shrink-0 ml-4\">\r\n                            <button class=\"edit-user-btn text-indigo-600 hover:text-indigo-800 p-2 rounded hover:bg-indigo-50 transition\" data-user-id=\"${user.uid}\" data-user-email=\"${user.email}\" data-user-role=\"${user.role || 'user'}\" title=\"Modifier\">\r\n                                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\r\n                                </svg>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    <div class=\"flex items-center gap-3 mb-3\">\r\n                        <span class=\"inline-flex items-center gap-1 bg-${roleColor}-100 text-${roleColor}-700 text-xs font-semibold px-3 py-1 rounded-full\">\r\n                            ${roleIcon} ${isAdmin ? 'Admin' : 'User'}\r\n                        </span>\r\n                        <span class=\"inline-flex items-center gap-1 ${isActive ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-600'} text-xs px-3 py-1 rounded-full\">\r\n                            <span class=\"w-2 h-2 rounded-full ${isActive ? 'bg-green-500' : 'bg-slate-400'}\"></span>\r\n                            ${isActive ? 'Actif' : 'Inactif'}\r\n                        </span>\r\n                    </div>\r\n                    \r\n                    <div class=\"grid grid-cols-2 gap-4 text-sm mb-3\">\r\n                        <div>\r\n                            <p class=\"text-slate-500\">Inscrit le:</p>\r\n                            <p class=\"font-medium text-slate-900\">${createdAt ? createdAt.toLocaleDateString('fr-FR') : 'N/A'}</p>\r\n                        </div>\r\n                        <div>\r\n                            <p class=\"text-slate-500\">Derniere connexion:</p>\r\n                            <p class=\"font-medium text-slate-900\">${lastLoginText}</p>\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    ${!isAdmin ? renderUserStats(user) : ''}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Rendu des statistiques utilisateur\r\n */\r\nfunction renderUserStats(user) {\r\n    const totalQuizzes = user.totalQuizzes || 0;\r\n    const averageScore = user.averageScore || 0;\r\n    const currentStreak = user.currentStreak || 0;\r\n    \r\n    return `\r\n        <div class=\"mt-4 pt-4 border-t border-slate-200 grid grid-cols-3 gap-4 text-center\">\r\n            <div>\r\n                <p class=\"text-2xl font-bold text-indigo-600\">${averageScore}%</p>\r\n                <p class=\"text-xs text-slate-600\">Score moyen</p>\r\n            </div>\r\n            <div>\r\n                <p class=\"text-2xl font-bold text-purple-600\">${totalQuizzes}</p>\r\n                <p class=\"text-xs text-slate-600\">Quiz completes</p>\r\n            </div>\r\n            <div>\r\n                <p class=\"text-2xl font-bold text-orange-600\">üî• ${currentStreak}</p>\r\n                <p class=\"text-xs text-slate-600\">Serie active</p>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Ajouter les event listeners\r\n */\r\nfunction addUserActionListeners() {\r\n    document.querySelectorAll('.edit-user-btn').forEach(btn => {\r\n        btn.addEventListener('click', (e) => {\r\n            const userId = e.currentTarget.dataset.userId;\r\n            const userEmail = e.currentTarget.dataset.userEmail;\r\n            const userRole = e.currentTarget.dataset.userRole;\r\n            openEditRoleModal(userId, userEmail, userRole);\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Ouvrir le modal d'√©dition du r√¥le\r\n */\r\nfunction openEditRoleModal(userId, userEmail, currentRole) {\r\n    // Cr√©er le modal\r\n    const modal = document.createElement('div');\r\n    modal.id = 'edit-role-modal';\r\n    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';\r\n    modal.innerHTML = `\r\n        <div class=\"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 animate-fade-in\">\r\n            <div class=\"flex items-center justify-between mb-6\">\r\n                <h3 class=\"text-2xl font-bold text-slate-900\">Modifier le role</h3>\r\n                <button id=\"close-modal-btn\" class=\"text-slate-400 hover:text-slate-600\">\r\n                    <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                    </svg>\r\n                </button>\r\n            </div>\r\n            \r\n            <div class=\"mb-6\">\r\n                <p class=\"text-slate-600 mb-1\">Utilisateur:</p>\r\n                <p class=\"font-semibold text-slate-900\">${escapeHtml(userEmail)}</p>\r\n            </div>\r\n            \r\n            <div class=\"mb-6\">\r\n                <p class=\"text-slate-700 font-medium mb-3\">Role actuel: <span class=\"text-indigo-600\">${currentRole === 'admin' ? 'Admin' : 'User'}</span></p>\r\n                \r\n                <p class=\"text-sm font-semibold text-slate-700 mb-2\">Modifier le role:</p>\r\n                <div class=\"space-y-3\">\r\n                    <label class=\"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:border-indigo-500 transition ${currentRole !== 'admin' ? 'border-indigo-500 bg-indigo-50' : 'border-slate-200'}\">\r\n                        <input type=\"radio\" name=\"role\" value=\"user\" ${currentRole !== 'admin' ? 'checked' : ''} class=\"mt-1\">\r\n                        <div>\r\n                            <p class=\"font-semibold text-slate-900\">üë§ User (Utilisateur standard)</p>\r\n                            <p class=\"text-sm text-slate-600\">Acces uniquement au tableau de bord et aux quiz</p>\r\n                        </div>\r\n                    </label>\r\n                    \r\n                    <label class=\"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:border-yellow-500 transition ${currentRole === 'admin' ? 'border-yellow-500 bg-yellow-50' : 'border-slate-200'}\">\r\n                        <input type=\"radio\" name=\"role\" value=\"admin\" ${currentRole === 'admin' ? 'checked' : ''} class=\"mt-1\">\r\n                        <div>\r\n                            <p class=\"font-semibold text-slate-900\">üî∞ Admin (Administrateur)</p>\r\n                            <p class=\"text-sm text-slate-600\">Acces total: gestion questions et utilisateurs</p>\r\n                        </div>\r\n                    </label>\r\n                </div>\r\n            </div>\r\n            \r\n            <div class=\"bg-amber-50 border-l-4 border-amber-500 p-4 mb-6\">\r\n                <p class=\"text-sm text-amber-900\">\r\n                    <strong>Attention:</strong> En passant User ‚Üí Admin, cette personne aura acces a toutes les fonctions d administration.\r\n                </p>\r\n            </div>\r\n            \r\n            <div class=\"flex gap-3\">\r\n                <button id=\"cancel-role-btn\" class=\"flex-1 bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold py-3 px-6 rounded-lg transition\">\r\n                    Annuler\r\n                </button>\r\n                <button id=\"save-role-btn\" class=\"flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition\">\r\n                    Enregistrer\r\n                </button>\r\n            </div>\r\n        </div>\r\n    `;\r\n    \r\n    document.body.appendChild(modal);\r\n    \r\n    // Event listeners\r\n    document.getElementById('close-modal-btn')?.addEventListener('click', () => modal.remove());\r\n    document.getElementById('cancel-role-btn')?.addEventListener('click', () => modal.remove());\r\n    document.getElementById('save-role-btn')?.addEventListener('click', async () => {\r\n        const newRole = modal.querySelector('input[name=\"role\"]:checked')?.value;\r\n        if (newRole) {\r\n            await handleUpdateRole(userId, userEmail, newRole);\r\n            modal.remove();\r\n        }\r\n    });\r\n    \r\n    // Fermer en cliquant sur le backdrop\r\n    modal.addEventListener('click', (e) => {\r\n        if (e.target === modal) modal.remove();\r\n    });\r\n}\r\n\r\n/**\r\n * G√©rer la mise √† jour du r√¥le\r\n */\r\nasync function handleUpdateRole(userId, userEmail, newRole) {\r\n    const saveBtn = document.getElementById('save-role-btn');\r\n    if (!saveBtn) return;\r\n    \r\n    const originalText = saveBtn.innerHTML;\r\n    const loadingToast = toast.showLoadingToast('Mise √† jour du r√¥le...');\r\n    \r\n    try {\r\n        saveBtn.disabled = true;\r\n        saveBtn.innerHTML = '<svg class=\"animate-spin h-5 w-5 inline\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle></svg> Mise a jour...';\r\n        \r\n        await updateUserRole(userId, newRole);\r\n        \r\n        toast.updateLoadingToast(loadingToast, `R√¥le mis √† jour pour ${userEmail}`, 'success');\r\n        showSuccess(`Role mis a jour pour ${userEmail}: ${newRole === 'admin' ? 'Admin' : 'User'}`);\r\n        \r\n        await loadUsers();\r\n        await loadStats();\r\n    } catch (error) {\r\n        console.error('Erreur mise a jour role:', error);\r\n        toast.updateLoadingToast(loadingToast, 'Erreur de mise √† jour', 'error');\r\n        toast.error(`Erreur: ${error.message || 'Impossible de mettre a jour le role'}`, 4000);\r\n        saveBtn.disabled = false;\r\n        saveBtn.innerHTML = originalText;\r\n    }\r\n}\r\n\r\n/**\r\n * G√©rer le changement de filtres\r\n */\r\nasync function handleFilterChange(e) {\r\n    const filterName = e.target.id.replace('filter-user-', '').replace('-', '');\r\n    currentFilters[filterName] = e.target.value;\r\n    await loadUsers();\r\n}\r\n\r\n/**\r\n * G√©rer la recherche\r\n */\r\nfunction handleSearch(e) {\r\n    const searchTerm = e.target.value.toLowerCase();\r\n    \r\n    if (!searchTerm) {\r\n        renderUsersList();\r\n        return;\r\n    }\r\n    \r\n    const filtered = currentUsers.filter(u => \r\n        (u.displayName && u.displayName.toLowerCase().includes(searchTerm)) ||\r\n        (u.email && u.email.toLowerCase().includes(searchTerm))\r\n    );\r\n    \r\n    const container = document.getElementById('users-list');\r\n    if (!container) return;\r\n    \r\n    if (filtered.length === 0) {\r\n        container.innerHTML = `\r\n            <div class=\"text-center py-12 text-slate-500\">\r\n                <p class=\"text-lg\">Aucun resultat pour \"${searchTerm}\"</p>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    // Afficher temporairement les r√©sultats filtr√©s\r\n    const temp = currentUsers;\r\n    currentUsers = filtered;\r\n    renderUsersList();\r\n    currentUsers = temp;\r\n}\r\n\r\n/**\r\n * Charger les statistiques\r\n */\r\nasync function loadStats() {\r\n    try {\r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            console.log('üìä Mode d√©mo : Chargement des stats utilisateurs simul√©es...');\r\n            renderStats(MOCK_STATS);\r\n            return;\r\n        }\r\n        \r\n        // Mode Firebase normal\r\n        const stats = await getUsersStats();\r\n        renderStats(stats);\r\n    } catch (error) {\r\n        console.error('Erreur chargement stats:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Afficher les statistiques\r\n */\r\nfunction renderStats(stats) {\r\n    const container = document.getElementById('users-stats');\r\n    if (!container) return;\r\n    \r\n    const activePercentage = stats.total > 0 ? Math.round((stats.activeLastWeek / stats.total) * 100) : 0;\r\n    \r\n    container.innerHTML = `\r\n        <div class=\"bg-white rounded-xl shadow-md p-6\">\r\n            <h3 class=\"text-xl font-bold text-slate-900 mb-6\">üìä Statistiques Globales</h3>\r\n            \r\n            <div class=\"grid grid-cols-2 gap-4 mb-6\">\r\n                <div class=\"text-center p-4 bg-indigo-50 rounded-lg\">\r\n                    <p class=\"text-3xl font-bold text-indigo-600 mb-1\">${stats.total}</p>\r\n                    <p class=\"text-sm text-indigo-700 font-medium\">Utilisateurs</p>\r\n                </div>\r\n                <div class=\"text-center p-4 bg-yellow-50 rounded-lg\">\r\n                    <p class=\"text-3xl font-bold text-yellow-600 mb-1\">${stats.admins}</p>\r\n                    <p class=\"text-sm text-yellow-700 font-medium\">Admins</p>\r\n                </div>\r\n            </div>\r\n            \r\n            <div class=\"space-y-4\">\r\n                <div>\r\n                    <div class=\"flex justify-between text-sm mb-2\">\r\n                        <span class=\"text-slate-700\">Actifs (7 derniers jours)</span>\r\n                        <span class=\"font-semibold\">${stats.activeLastWeek} (${activePercentage}%)</span>\r\n                    </div>\r\n                    <div class=\"bg-slate-200 rounded-full h-2\">\r\n                        <div class=\"bg-green-500 rounded-full h-2 transition-all\" style=\"width: ${activePercentage}%\"></div>\r\n                    </div>\r\n                </div>\r\n                \r\n                <div class=\"pt-4 border-t border-slate-200\">\r\n                    <p class=\"text-sm text-slate-600 mb-1\">Score moyen global:</p>\r\n                    <p class=\"text-2xl font-bold text-purple-600\">${stats.averageScore}%</p>\r\n                </div>\r\n                \r\n                <div>\r\n                    <p class=\"text-sm text-slate-600 mb-1\">Total quiz completes:</p>\r\n                    <p class=\"text-2xl font-bold text-indigo-600\">${stats.totalQuizzes}</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Afficher un loader\r\n */\r\nfunction showLoading(containerId) {\r\n    const container = document.getElementById(containerId);\r\n    if (!container) return;\r\n    \r\n    container.innerHTML = `\r\n        <div class=\"text-center py-12\">\r\n            <svg class=\"animate-spin h-12 w-12 mx-auto text-indigo-600\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\r\n                <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n            </svg>\r\n            <p class=\"text-slate-600 mt-4\">Chargement...</p>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Afficher une erreur\r\n */\r\nfunction showError(containerId, message) {\r\n    const container = document.getElementById(containerId);\r\n    if (!container) {\r\n        alert(`Erreur: ${message}`);\r\n        return;\r\n    }\r\n    \r\n    container.innerHTML = `\r\n        <div class=\"bg-red-50 border-2 border-red-500 rounded-xl p-6 text-center\">\r\n            <svg class=\"w-12 h-12 mx-auto text-red-500 mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n            </svg>\r\n            <p class=\"text-red-900 font-semibold\">${message}</p>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Afficher un message de succ√®s\r\n */\r\nfunction showSuccess(message) {\r\n    const toast = document.createElement('div');\r\n    toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-xl z-50 animate-fade-in';\r\n    toast.innerHTML = `\r\n        <div class=\"flex items-center gap-3\">\r\n            <svg class=\"w-6 h-6\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"></path>\r\n            </svg>\r\n            <span class=\"font-semibold\">${message}</span>\r\n        </div>\r\n    `;\r\n    \r\n    document.body.appendChild(toast);\r\n    \r\n    setTimeout(() => {\r\n        toast.remove();\r\n    }, 3000);\r\n}\r\n\r\n/**\r\n * Formater le temps relatif\r\n */\r\nfunction formatRelativeTime(date) {\r\n    const now = new Date();\r\n    const diff = now - date;\r\n    const minutes = Math.floor(diff / 60000);\r\n    const hours = Math.floor(diff / 3600000);\r\n    const days = Math.floor(diff / 86400000);\r\n    \r\n    if (minutes < 1) return 'A l instant';\r\n    if (minutes < 60) return `Il y a ${minutes} min`;\r\n    if (hours < 24) return `Il y a ${hours}h`;\r\n    if (days === 1) return 'Hier';\r\n    if (days < 7) return `Il y a ${days} jours`;\r\n    if (days < 30) return `Il y a ${Math.floor(days / 7)} semaines`;\r\n    return date.toLocaleDateString('fr-FR');\r\n}\r\n\r\n/**\r\n * √âchapper le HTML\r\n */\r\nfunction escapeHtml(text) {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n}\r\n","// Dashboard Admin Avanc√© - Statistiques globales et analytics\r\nimport { db } from './firebase-config.js';\r\nimport { collection, query, getDocs, where, orderBy, limit } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';\r\nimport { toast } from './toast.js';\r\nimport { isDemoMode } from './auth.js';\r\nimport {\r\n    createStatsSkeleton,\r\n    createChartSkeleton,\r\n    createListSkeleton,\r\n    showSkeleton,\r\n    hideSkeleton\r\n} from './skeleton.js';\r\n\r\n// ‚úÖ Donn√©es simul√©es pour le mode d√©mo\r\nconst MOCK_DATA = {\r\n    stats: {\r\n        totalUsers: 42,\r\n        totalQuizzes: 156,\r\n        totalQuestions: 240,\r\n        totalResources: 35,\r\n        avgScore: 78,\r\n        activeUsersToday: 8,\r\n        activeUsersWeek: 23,\r\n        quizzesToday: 12,\r\n        quizzesWeek: 67\r\n    },\r\n    topUsers: [\r\n        { id: '1', email: 'alice.dupont@example.com', displayName: 'Alice Dupont', totalQuizzes: 24, averageScore: 92 },\r\n        { id: '2', email: 'bob.martin@example.com', displayName: 'Bob Martin', totalQuizzes: 21, averageScore: 88 },\r\n        { id: '3', email: 'claire.bernard@example.com', displayName: 'Claire Bernard', totalQuizzes: 19, averageScore: 85 },\r\n        { id: '4', email: 'david.dubois@example.com', displayName: 'David Dubois', totalQuizzes: 18, averageScore: 83 },\r\n        { id: '5', email: 'emma.petit@example.com', displayName: 'Emma Petit', totalQuizzes: 16, averageScore: 81 },\r\n        { id: '6', email: 'francois.roux@example.com', displayName: 'Fran√ßois Roux', totalQuizzes: 15, averageScore: 79 },\r\n        { id: '7', email: 'julie.moreau@example.com', displayName: 'Julie Moreau', totalQuizzes: 14, averageScore: 76 },\r\n        { id: '8', email: 'lucas.simon@example.com', displayName: 'Lucas Simon', totalQuizzes: 13, averageScore: 74 },\r\n        { id: '9', email: 'marie.laurent@example.com', displayName: 'Marie Laurent', totalQuizzes: 12, averageScore: 72 },\r\n        { id: '10', email: 'nicolas.michel@example.com', displayName: 'Nicolas Michel', totalQuizzes: 11, averageScore: 70 }\r\n    ],\r\n    recentActivity: [\r\n        { id: '1', userName: 'Alice Dupont', module: 'Auto - Novembre', score: 95, completedAt: new Date(Date.now() - 300000) },\r\n        { id: '2', userName: 'Emma Petit', module: 'Loisir - Novembre', score: 90, completedAt: new Date(Date.now() - 720000) },\r\n        { id: '3', userName: 'Bob Martin', module: 'VR - Novembre', score: 88, completedAt: new Date(Date.now() - 1380000) },\r\n        { id: '4', userName: 'Claire Bernard', module: 'Auto - Octobre', score: 82, completedAt: new Date(Date.now() - 2700000) },\r\n        { id: '5', userName: 'David Dubois', module: 'Tracteur - Octobre', score: 79, completedAt: new Date(Date.now() - 3600000) }\r\n    ],\r\n    moduleStats: [\r\n        { module: 'Auto', questionsCount: 85, avgScore: 76, completions: 67 },\r\n        { module: 'Loisir', questionsCount: 62, avgScore: 81, completions: 45 },\r\n        { module: 'VR', questionsCount: 54, avgScore: 73, completions: 32 },\r\n        { module: 'Tracteur', questionsCount: 39, avgScore: 79, completions: 28 }\r\n    ]\r\n};\r\n\r\n// √âtat\r\nlet globalStats = {\r\n    totalUsers: 0,\r\n    totalQuizzes: 0,\r\n    totalQuestions: 0,\r\n    totalResources: 0,\r\n    avgScore: 0,\r\n    activeUsersToday: 0,\r\n    activeUsersWeek: 0,\r\n    quizzesToday: 0,\r\n    quizzesWeek: 0\r\n};\r\n\r\nlet chartProgress = null;\r\nlet chartModules = null;\r\nlet chartActivity = null;\r\n\r\n/**\r\n * Initialiser le dashboard admin\r\n */\r\nexport async function initAdminDashboard() {\r\n    console.log('üìä Initialisation du dashboard admin avanc√©');\r\n    \r\n    // Afficher loading\r\n    showLoadingState();\r\n    \r\n    try {\r\n        // Charger toutes les statistiques\r\n        await Promise.all([\r\n            loadGlobalStats(),\r\n            loadTopUsers(),\r\n            loadRecentActivity(),\r\n            loadModuleStats()\r\n        ]);\r\n        \r\n        // Cr√©er les graphiques\r\n        createCharts();\r\n        \r\n        // Initialiser les event listeners\r\n        initEventListeners();\r\n        \r\n        hideLoadingState();\r\n        toast.success('Dashboard charg√© avec succ√®s !', 3000);\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur chargement dashboard:', error);\r\n        hideLoadingState();\r\n        toast.error('Erreur lors du chargement du dashboard', 4000);\r\n    }\r\n}\r\n\r\n/**\r\n * Charger les statistiques globales\r\n */\r\nasync function loadGlobalStats() {\r\n    try {\r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            console.log('üìä Mode d√©mo : Chargement des statistiques simul√©es...');\r\n            globalStats = MOCK_DATA.stats;\r\n            renderGlobalStats();\r\n            console.log('‚úÖ Statistiques simul√©es charg√©es:', globalStats);\r\n            return;\r\n        }\r\n        \r\n        console.log('üìà Chargement des statistiques globales...');\r\n        \r\n        // Compter les utilisateurs\r\n        const usersSnapshot = await getDocs(collection(db, 'users'));\r\n        globalStats.totalUsers = usersSnapshot.size;\r\n        \r\n        // Compter les quiz compl√©t√©s\r\n        const quizzesSnapshot = await getDocs(collection(db, 'quizResults'));\r\n        globalStats.totalQuizzes = quizzesSnapshot.size;\r\n        \r\n        // Calculer le score moyen\r\n        let totalScore = 0;\r\n        quizzesSnapshot.forEach(doc => {\r\n            totalScore += doc.data().score || 0;\r\n        });\r\n        globalStats.avgScore = quizzesSnapshot.size > 0 \r\n            ? Math.round(totalScore / quizzesSnapshot.size) \r\n            : 0;\r\n        \r\n        // Compter les questions\r\n        const questionsSnapshot = await getDocs(collection(db, 'questions'));\r\n        globalStats.totalQuestions = questionsSnapshot.size;\r\n        \r\n        // Compter les ressources\r\n        const resourcesSnapshot = await getDocs(collection(db, 'resources'));\r\n        globalStats.totalResources = resourcesSnapshot.size;\r\n        \r\n        // Utilisateurs actifs aujourd'hui\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        \r\n        let activeToday = 0;\r\n        usersSnapshot.forEach(doc => {\r\n            const lastLogin = doc.data().lastLogin?.toDate();\r\n            if (lastLogin && lastLogin >= today) {\r\n                activeToday++;\r\n            }\r\n        });\r\n        globalStats.activeUsersToday = activeToday;\r\n        \r\n        // Utilisateurs actifs cette semaine\r\n        const weekAgo = new Date();\r\n        weekAgo.setDate(weekAgo.getDate() - 7);\r\n        \r\n        let activeWeek = 0;\r\n        usersSnapshot.forEach(doc => {\r\n            const lastLogin = doc.data().lastLogin?.toDate();\r\n            if (lastLogin && lastLogin >= weekAgo) {\r\n                activeWeek++;\r\n            }\r\n        });\r\n        globalStats.activeUsersWeek = activeWeek;\r\n        \r\n        // Quiz compl√©t√©s aujourd'hui\r\n        let quizzesToday = 0;\r\n        quizzesSnapshot.forEach(doc => {\r\n            const completedAt = doc.data().completedAt?.toDate();\r\n            if (completedAt && completedAt >= today) {\r\n                quizzesToday++;\r\n            }\r\n        });\r\n        globalStats.quizzesToday = quizzesToday;\r\n        \r\n        // Quiz compl√©t√©s cette semaine\r\n        let quizzesWeek = 0;\r\n        quizzesSnapshot.forEach(doc => {\r\n            const completedAt = doc.data().completedAt?.toDate();\r\n            if (completedAt && completedAt >= weekAgo) {\r\n                quizzesWeek++;\r\n            }\r\n        });\r\n        globalStats.quizzesWeek = quizzesWeek;\r\n        \r\n        // Afficher les statistiques\r\n        renderGlobalStats();\r\n        \r\n        console.log('‚úÖ Statistiques globales charg√©es:', globalStats);\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur chargement stats globales:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Charger le top 10 des utilisateurs\r\n */\r\nasync function loadTopUsers() {\r\n    try {\r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            console.log('üèÜ Mode d√©mo : Chargement du top 10 simul√©...');\r\n            renderTopUsers(MOCK_DATA.topUsers);\r\n            console.log('‚úÖ Top 10 simul√© charg√©');\r\n            return;\r\n        }\r\n        \r\n        console.log('üèÜ Chargement du top 10 utilisateurs...');\r\n        \r\n        // R√©cup√©rer tous les r√©sultats group√©s par utilisateur\r\n        const resultsSnapshot = await getDocs(collection(db, 'quizResults'));\r\n        const userScores = {};\r\n        \r\n        resultsSnapshot.forEach(doc => {\r\n            const data = doc.data();\r\n            const userId = data.userId;\r\n            const score = data.score || 0;\r\n            \r\n            if (!userScores[userId]) {\r\n                userScores[userId] = {\r\n                    userId: userId,\r\n                    userName: data.userName || 'Utilisateur',\r\n                    totalQuizzes: 0,\r\n                    totalScore: 0,\r\n                    avgScore: 0\r\n                };\r\n            }\r\n            \r\n            userScores[userId].totalQuizzes++;\r\n            userScores[userId].totalScore += score;\r\n        });\r\n        \r\n        // Calculer les moyennes\r\n        Object.values(userScores).forEach(user => {\r\n            user.avgScore = Math.round(user.totalScore / user.totalQuizzes);\r\n        });\r\n        \r\n        // Trier par score moyen d√©croissant\r\n        const topUsers = Object.values(userScores)\r\n            .sort((a, b) => b.avgScore - a.avgScore)\r\n            .slice(0, 10);\r\n        \r\n        // Afficher le top 10\r\n        renderTopUsers(topUsers);\r\n        \r\n        console.log('‚úÖ Top 10 utilisateurs charg√©:', topUsers);\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur chargement top users:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Charger l'activit√© r√©cente\r\n */\r\nasync function loadRecentActivity() {\r\n    try {\r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            console.log('üìÖ Mode d√©mo : Chargement de l\\'activit√© simul√©e...');\r\n            renderRecentActivity(MOCK_DATA.recentActivity);\r\n            console.log('‚úÖ Activit√© simul√©e charg√©e');\r\n            return;\r\n        }\r\n        \r\n        console.log('üìÖ Chargement de l\\'activit√© r√©cente...');\r\n        \r\n        // R√©cup√©rer les 10 derniers quiz compl√©t√©s\r\n        const q = query(\r\n            collection(db, 'quizResults'),\r\n            orderBy('completedAt', 'desc'),\r\n            limit(10)\r\n        );\r\n        \r\n        const snapshot = await getDocs(q);\r\n        const activities = [];\r\n        \r\n        snapshot.forEach(doc => {\r\n            const data = doc.data();\r\n            activities.push({\r\n                id: doc.id,\r\n                userName: data.userName || 'Utilisateur',\r\n                module: data.module || 'Module',\r\n                score: data.score || 0,\r\n                completedAt: data.completedAt?.toDate() || new Date()\r\n            });\r\n        });\r\n        \r\n        // Afficher l'activit√©\r\n        renderRecentActivity(activities);\r\n        \r\n        console.log('‚úÖ Activit√© r√©cente charg√©e:', activities);\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur chargement activit√©:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Charger les statistiques par module\r\n */\r\nasync function loadModuleStats() {\r\n    try {\r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            console.log('üìä Mode d√©mo : Chargement des stats modules simul√©es...');\r\n            // Transformer les donn√©es mock√©es au format attendu\r\n            const mockStats = {\r\n                'Auto': { count: 85, totalScore: 6460, avgScore: 76 },\r\n                'Loisir': { count: 62, totalScore: 5022, avgScore: 81 },\r\n                'VR': { count: 54, totalScore: 3942, avgScore: 73 },\r\n                'Tracteur': { count: 39, totalScore: 3081, avgScore: 79 }\r\n            };\r\n            console.log('‚úÖ Stats modules simul√©es charg√©es:', mockStats);\r\n            return mockStats;\r\n        }\r\n        \r\n        console.log('üìä Chargement des stats par module...');\r\n        \r\n        const resultsSnapshot = await getDocs(collection(db, 'quizResults'));\r\n        const moduleStats = {};\r\n        \r\n        resultsSnapshot.forEach(doc => {\r\n            const data = doc.data();\r\n            const module = data.module || 'Autre';\r\n            \r\n            if (!moduleStats[module]) {\r\n                moduleStats[module] = {\r\n                    count: 0,\r\n                    totalScore: 0,\r\n                    avgScore: 0\r\n                };\r\n            }\r\n            \r\n            moduleStats[module].count++;\r\n            moduleStats[module].totalScore += data.score || 0;\r\n        });\r\n        \r\n        // Calculer les moyennes\r\n        Object.values(moduleStats).forEach(stat => {\r\n            stat.avgScore = Math.round(stat.totalScore / stat.count);\r\n        });\r\n        \r\n        console.log('‚úÖ Stats par module charg√©es:', moduleStats);\r\n        return moduleStats;\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur chargement stats modules:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Afficher les statistiques globales\r\n */\r\nfunction renderGlobalStats() {\r\n    const container = document.getElementById('global-stats-cards');\r\n    if (!container) return;\r\n    \r\n    container.innerHTML = `\r\n        <!-- Total Utilisateurs -->\r\n        <div class=\"bg-gradient-to-br from-blue-500 to-blue-700 rounded-xl p-6 text-white shadow-lg\">\r\n            <div class=\"flex items-center justify-between mb-4\">\r\n                <div class=\"bg-white/20 p-3 rounded-lg\">\r\n                    <svg class=\"w-8 h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\"></path>\r\n                    </svg>\r\n                </div>\r\n                <span class=\"text-sm font-medium bg-white/20 px-3 py-1 rounded-full\">Total</span>\r\n            </div>\r\n            <h3 class=\"text-3xl font-bold mb-1\">${globalStats.totalUsers}</h3>\r\n            <p class=\"text-blue-100 text-sm\">Utilisateurs inscrits</p>\r\n            <div class=\"mt-3 text-xs\">\r\n                <span class=\"bg-white/20 px-2 py-1 rounded\">üìÖ ${globalStats.activeUsersToday} aujourd'hui</span>\r\n                <span class=\"bg-white/20 px-2 py-1 rounded ml-2\">üìÜ ${globalStats.activeUsersWeek} cette semaine</span>\r\n            </div>\r\n        </div>\r\n        \r\n        <!-- Total Quiz -->\r\n        <div class=\"bg-gradient-to-br from-green-500 to-green-700 rounded-xl p-6 text-white shadow-lg\">\r\n            <div class=\"flex items-center justify-between mb-4\">\r\n                <div class=\"bg-white/20 p-3 rounded-lg\">\r\n                    <svg class=\"w-8 h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"></path>\r\n                    </svg>\r\n                </div>\r\n                <span class=\"text-sm font-medium bg-white/20 px-3 py-1 rounded-full\">Compl√©t√©s</span>\r\n            </div>\r\n            <h3 class=\"text-3xl font-bold mb-1\">${globalStats.totalQuizzes}</h3>\r\n            <p class=\"text-green-100 text-sm\">Quiz r√©alis√©s</p>\r\n            <div class=\"mt-3 text-xs\">\r\n                <span class=\"bg-white/20 px-2 py-1 rounded\">üìÖ ${globalStats.quizzesToday} aujourd'hui</span>\r\n                <span class=\"bg-white/20 px-2 py-1 rounded ml-2\">üìÜ ${globalStats.quizzesWeek} cette semaine</span>\r\n            </div>\r\n        </div>\r\n        \r\n        <!-- Score Moyen -->\r\n        <div class=\"bg-gradient-to-br from-purple-500 to-purple-700 rounded-xl p-6 text-white shadow-lg\">\r\n            <div class=\"flex items-center justify-between mb-4\">\r\n                <div class=\"bg-white/20 p-3 rounded-lg\">\r\n                    <svg class=\"w-8 h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\"></path>\r\n                    </svg>\r\n                </div>\r\n                <span class=\"text-sm font-medium bg-white/20 px-3 py-1 rounded-full\">Moyenne</span>\r\n            </div>\r\n            <h3 class=\"text-3xl font-bold mb-1\">${globalStats.avgScore}%</h3>\r\n            <p class=\"text-purple-100 text-sm\">Score moyen global</p>\r\n            <div class=\"mt-3\">\r\n                <div class=\"bg-white/20 rounded-full h-2\">\r\n                    <div class=\"bg-white rounded-full h-2\" style=\"width: ${globalStats.avgScore}%\"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \r\n        <!-- Total Questions -->\r\n        <div class=\"bg-gradient-to-br from-orange-500 to-orange-700 rounded-xl p-6 text-white shadow-lg\">\r\n            <div class=\"flex items-center justify-between mb-4\">\r\n                <div class=\"bg-white/20 p-3 rounded-lg\">\r\n                    <svg class=\"w-8 h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                    </svg>\r\n                </div>\r\n                <span class=\"text-sm font-medium bg-white/20 px-3 py-1 rounded-full\">Base</span>\r\n            </div>\r\n            <h3 class=\"text-3xl font-bold mb-1\">${globalStats.totalQuestions}</h3>\r\n            <p class=\"text-orange-100 text-sm\">Questions disponibles</p>\r\n            <div class=\"mt-3 text-xs\">\r\n                <span class=\"bg-white/20 px-2 py-1 rounded\">üìö ${globalStats.totalResources} ressources</span>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Afficher le top 10 utilisateurs\r\n */\r\nfunction renderTopUsers(users) {\r\n    const container = document.getElementById('top-users-list');\r\n    if (!container) return;\r\n    \r\n    if (users.length === 0) {\r\n        container.innerHTML = `\r\n            <div class=\"text-center py-8 text-slate-500\">\r\n                <svg class=\"w-12 h-12 mx-auto mb-2 text-slate-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"></path>\r\n                </svg>\r\n                <p class=\"font-medium\">Aucun utilisateur</p>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    container.innerHTML = users.map((user, index) => {\r\n        const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;\r\n        const bgColor = index === 0 ? 'bg-yellow-50 border-yellow-200' : \r\n                       index === 1 ? 'bg-slate-50 border-slate-200' :\r\n                       index === 2 ? 'bg-orange-50 border-orange-200' : \r\n                       'bg-white border-slate-200';\r\n        \r\n        return `\r\n            <div class=\"flex items-center justify-between p-4 rounded-lg border ${bgColor} hover:shadow-md transition-shadow\">\r\n                <div class=\"flex items-center gap-4\">\r\n                    <span class=\"text-2xl font-bold w-8\">${medal}</span>\r\n                    <div>\r\n                        <h4 class=\"font-semibold text-slate-900\">${user.userName}</h4>\r\n                        <p class=\"text-sm text-slate-600\">${user.totalQuizzes} quiz compl√©t√©s</p>\r\n                    </div>\r\n                </div>\r\n                <div class=\"text-right\">\r\n                    <div class=\"text-2xl font-bold text-indigo-600\">${user.avgScore}%</div>\r\n                    <div class=\"text-xs text-slate-500\">Score moyen</div>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }).join('');\r\n}\r\n\r\n/**\r\n * Afficher l'activit√© r√©cente\r\n */\r\nfunction renderRecentActivity(activities) {\r\n    const container = document.getElementById('recent-activity-list');\r\n    if (!container) return;\r\n    \r\n    if (activities.length === 0) {\r\n        container.innerHTML = `\r\n            <div class=\"text-center py-8 text-slate-500\">\r\n                <svg class=\"w-12 h-12 mx-auto mb-2 text-slate-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                </svg>\r\n                <p class=\"font-medium\">Aucune activit√© r√©cente</p>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    container.innerHTML = activities.map(activity => {\r\n        const timeAgo = getTimeAgo(activity.completedAt);\r\n        const scoreColor = activity.score >= 80 ? 'text-green-600' : \r\n                          activity.score >= 60 ? 'text-yellow-600' : \r\n                          'text-red-600';\r\n        \r\n        return `\r\n            <div class=\"flex items-center justify-between p-3 hover:bg-slate-50 rounded-lg transition-colors\">\r\n                <div class=\"flex items-center gap-3\">\r\n                    <div class=\"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center\">\r\n                        <span class=\"text-lg font-bold text-indigo-600\">${activity.userName.charAt(0).toUpperCase()}</span>\r\n                    </div>\r\n                    <div>\r\n                        <p class=\"font-medium text-slate-900\">${activity.userName}</p>\r\n                        <p class=\"text-sm text-slate-600\">${activity.module}</p>\r\n                    </div>\r\n                </div>\r\n                <div class=\"text-right\">\r\n                    <div class=\"text-lg font-bold ${scoreColor}\">${activity.score}%</div>\r\n                    <div class=\"text-xs text-slate-500\">${timeAgo}</div>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }).join('');\r\n}\r\n\r\n/**\r\n * Cr√©er les graphiques Chart.js\r\n */\r\nfunction createCharts() {\r\n    // Graphique de progression (Line Chart)\r\n    createProgressChart();\r\n    \r\n    // Graphique par modules (Doughnut Chart)\r\n    createModulesChart();\r\n    \r\n    // Graphique d'activit√© (Bar Chart)\r\n    createActivityChart();\r\n}\r\n\r\n/**\r\n * Cr√©er le graphique de progression\r\n */\r\nasync function createProgressChart() {\r\n    const canvas = document.getElementById('chart-progress');\r\n    if (!canvas) return;\r\n    \r\n    try {\r\n        let labels, counts, avgScores;\r\n        \r\n        // ‚úÖ Mode d√©mo : Utiliser donn√©es simul√©es\r\n        if (isDemoMode()) {\r\n            console.log('üìà Mode d√©mo : Cr√©ation graphique progression simul√©...');\r\n            \r\n            // G√©n√©rer 30 jours de donn√©es mock√©es\r\n            labels = [];\r\n            counts = [];\r\n            avgScores = [];\r\n            \r\n            for (let i = 29; i >= 0; i--) {\r\n                const date = new Date();\r\n                date.setDate(date.getDate() - i);\r\n                labels.push(date.toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' }));\r\n                \r\n                // Donn√©es al√©atoires mais coh√©rentes\r\n                counts.push(Math.floor(Math.random() * 15) + 5);\r\n                avgScores.push(Math.floor(Math.random() * 20) + 70);\r\n            }\r\n        } else {\r\n            // Mode Firebase normal\r\n            // R√©cup√©rer les quiz des 30 derniers jours\r\n            const thirtyDaysAgo = new Date();\r\n            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\r\n            \r\n            const resultsSnapshot = await getDocs(collection(db, 'quizResults'));\r\n            const dailyData = {};\r\n            \r\n            // Initialiser les 30 derniers jours\r\n            for (let i = 0; i < 30; i++) {\r\n                const date = new Date();\r\n                date.setDate(date.getDate() - i);\r\n                const dateStr = date.toISOString().split('T')[0];\r\n                dailyData[dateStr] = { count: 0, totalScore: 0 };\r\n            }\r\n            \r\n            // Compter les quiz par jour\r\n            resultsSnapshot.forEach(doc => {\r\n                const data = doc.data();\r\n                const completedAt = data.completedAt?.toDate();\r\n                if (completedAt && completedAt >= thirtyDaysAgo) {\r\n                    const dateStr = completedAt.toISOString().split('T')[0];\r\n                    if (dailyData[dateStr]) {\r\n                        dailyData[dateStr].count++;\r\n                        dailyData[dateStr].totalScore += data.score || 0;\r\n                    }\r\n                }\r\n            });\r\n            \r\n            // Pr√©parer les donn√©es pour le graphique\r\n            labels = Object.keys(dailyData).reverse().map(date => {\r\n                const d = new Date(date);\r\n                return d.toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' });\r\n            });\r\n            \r\n            counts = Object.values(dailyData).reverse().map(d => d.count);\r\n            avgScores = Object.values(dailyData).reverse().map(d => \r\n                d.count > 0 ? Math.round(d.totalScore / d.count) : 0\r\n            );\r\n        }\r\n        \r\n        // Cr√©er le graphique\r\n        if (chartProgress) chartProgress.destroy();\r\n        \r\n        chartProgress = new Chart(canvas, {\r\n            type: 'line',\r\n            data: {\r\n                labels: labels,\r\n                datasets: [\r\n                    {\r\n                        label: 'Quiz compl√©t√©s',\r\n                        data: counts,\r\n                        borderColor: 'rgb(99, 102, 241)',\r\n                        backgroundColor: 'rgba(99, 102, 241, 0.1)',\r\n                        tension: 0.4,\r\n                        yAxisID: 'y'\r\n                    },\r\n                    {\r\n                        label: 'Score moyen (%)',\r\n                        data: avgScores,\r\n                        borderColor: 'rgb(34, 197, 94)',\r\n                        backgroundColor: 'rgba(34, 197, 94, 0.1)',\r\n                        tension: 0.4,\r\n                        yAxisID: 'y1'\r\n                    }\r\n                ]\r\n            },\r\n            options: {\r\n                responsive: true,\r\n                maintainAspectRatio: false,\r\n                interaction: {\r\n                    mode: 'index',\r\n                    intersect: false\r\n                },\r\n                scales: {\r\n                    y: {\r\n                        type: 'linear',\r\n                        display: true,\r\n                        position: 'left',\r\n                        title: {\r\n                            display: true,\r\n                            text: 'Nombre de quiz'\r\n                        }\r\n                    },\r\n                    y1: {\r\n                        type: 'linear',\r\n                        display: true,\r\n                        position: 'right',\r\n                        title: {\r\n                            display: true,\r\n                            text: 'Score moyen (%)'\r\n                        },\r\n                        grid: {\r\n                            drawOnChartArea: false\r\n                        }\r\n                    }\r\n                },\r\n                plugins: {\r\n                    legend: {\r\n                        position: 'top'\r\n                    },\r\n                    title: {\r\n                        display: true,\r\n                        text: '√âvolution sur 30 jours'\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur cr√©ation graphique progression:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Cr√©er le graphique par modules\r\n */\r\nasync function createModulesChart() {\r\n    const canvas = document.getElementById('chart-modules');\r\n    if (!canvas) return;\r\n    \r\n    try {\r\n        const moduleStats = await loadModuleStats();\r\n        \r\n        const labels = Object.keys(moduleStats);\r\n        const data = Object.values(moduleStats).map(s => s.count);\r\n        \r\n        const colors = [\r\n            'rgba(99, 102, 241, 0.8)',\r\n            'rgba(34, 197, 94, 0.8)',\r\n            'rgba(251, 146, 60, 0.8)',\r\n            'rgba(236, 72, 153, 0.8)',\r\n            'rgba(14, 165, 233, 0.8)'\r\n        ];\r\n        \r\n        if (chartModules) chartModules.destroy();\r\n        \r\n        chartModules = new Chart(canvas, {\r\n            type: 'doughnut',\r\n            data: {\r\n                labels: labels,\r\n                datasets: [{\r\n                    data: data,\r\n                    backgroundColor: colors,\r\n                    borderWidth: 2,\r\n                    borderColor: '#fff'\r\n                }]\r\n            },\r\n            options: {\r\n                responsive: true,\r\n                maintainAspectRatio: false,\r\n                plugins: {\r\n                    legend: {\r\n                        position: 'bottom'\r\n                    },\r\n                    title: {\r\n                        display: true,\r\n                        text: 'R√©partition par module'\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur cr√©ation graphique modules:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Cr√©er le graphique d'activit√©\r\n */\r\nasync function createActivityChart() {\r\n    const canvas = document.getElementById('chart-activity');\r\n    if (!canvas) return;\r\n    \r\n    try {\r\n        // Activit√© des 7 derniers jours\r\n        const labels = [];\r\n        const data = [];\r\n        \r\n        for (let i = 6; i >= 0; i--) {\r\n            const date = new Date();\r\n            date.setDate(date.getDate() - i);\r\n            labels.push(date.toLocaleDateString('fr-FR', { weekday: 'short' }));\r\n            data.push(Math.floor(Math.random() * 20) + 5); // Donn√©es de d√©mo\r\n        }\r\n        \r\n        if (chartActivity) chartActivity.destroy();\r\n        \r\n        chartActivity = new Chart(canvas, {\r\n            type: 'bar',\r\n            data: {\r\n                labels: labels,\r\n                datasets: [{\r\n                    label: 'Utilisateurs actifs',\r\n                    data: data,\r\n                    backgroundColor: 'rgba(99, 102, 241, 0.8)',\r\n                    borderColor: 'rgb(99, 102, 241)',\r\n                    borderWidth: 1\r\n                }]\r\n            },\r\n            options: {\r\n                responsive: true,\r\n                maintainAspectRatio: false,\r\n                plugins: {\r\n                    legend: {\r\n                        display: false\r\n                    },\r\n                    title: {\r\n                        display: true,\r\n                        text: 'Activit√© des 7 derniers jours'\r\n                    }\r\n                },\r\n                scales: {\r\n                    y: {\r\n                        beginAtZero: true,\r\n                        ticks: {\r\n                            stepSize: 5\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur cr√©ation graphique activit√©:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Exporter en PDF\r\n */\r\nexport async function exportToPDF() {\r\n    const loadingToast = toast.showLoadingToast('G√©n√©ration du PDF...');\r\n    \r\n    try {\r\n        // Importer jsPDF dynamiquement\r\n        const { jsPDF } = window.jspdf;\r\n        const doc = new jsPDF();\r\n        \r\n        // Titre\r\n        doc.setFontSize(20);\r\n        doc.text('Dashboard Admin - QuizPro', 20, 20);\r\n        \r\n        // Date\r\n        doc.setFontSize(10);\r\n        doc.text(`G√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')}`, 20, 30);\r\n        \r\n        // Statistiques globales\r\n        doc.setFontSize(14);\r\n        doc.text('Statistiques Globales', 20, 45);\r\n        \r\n        doc.setFontSize(10);\r\n        let y = 55;\r\n        doc.text(`Total Utilisateurs: ${globalStats.totalUsers}`, 25, y);\r\n        y += 7;\r\n        doc.text(`Total Quiz: ${globalStats.totalQuizzes}`, 25, y);\r\n        y += 7;\r\n        doc.text(`Score Moyen: ${globalStats.avgScore}%`, 25, y);\r\n        y += 7;\r\n        doc.text(`Questions: ${globalStats.totalQuestions}`, 25, y);\r\n        y += 7;\r\n        doc.text(`Ressources: ${globalStats.totalResources}`, 25, y);\r\n        \r\n        // Sauvegarder\r\n        doc.save(`dashboard-admin-${new Date().toISOString().split('T')[0]}.pdf`);\r\n        \r\n        toast.updateLoadingToast(loadingToast, 'PDF g√©n√©r√© avec succ√®s !', 'success');\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur export PDF:', error);\r\n        toast.updateLoadingToast(loadingToast, 'Erreur d\\'export PDF', 'error');\r\n        toast.error('Erreur: Assurez-vous que jsPDF est charg√©', 4000);\r\n    }\r\n}\r\n\r\n/**\r\n * Exporter en CSV avanc√©\r\n */\r\nexport async function exportToAdvancedCSV() {\r\n    const loadingToast = toast.showLoadingToast('G√©n√©ration du CSV...');\r\n    \r\n    try {\r\n        // R√©cup√©rer toutes les donn√©es\r\n        const resultsSnapshot = await getDocs(collection(db, 'quizResults'));\r\n        \r\n        const headers = ['Date', 'Utilisateur', 'Module', 'Mois', 'Ann√©e', 'Score (%)', 'Bonnes r√©ponses', 'Total questions', 'Temps (s)'];\r\n        const rows = [];\r\n        \r\n        resultsSnapshot.forEach(doc => {\r\n            const data = doc.data();\r\n            const date = data.completedAt?.toDate().toLocaleString('fr-FR') || 'N/A';\r\n            \r\n            rows.push([\r\n                date,\r\n                data.userName || 'Inconnu',\r\n                data.module || 'N/A',\r\n                data.month || 'N/A',\r\n                data.year || 'N/A',\r\n                data.score || 0,\r\n                data.correctAnswers || 0,\r\n                data.totalQuestions || 0,\r\n                data.timeSpent || 0\r\n            ]);\r\n        });\r\n        \r\n        const csv = [headers, ...rows].map(row => row.join(',')).join('\\n');\r\n        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n        const link = document.createElement('a');\r\n        link.href = URL.createObjectURL(blob);\r\n        link.download = `dashboard-complet-${new Date().toISOString().split('T')[0]}.csv`;\r\n        link.click();\r\n        \r\n        toast.updateLoadingToast(loadingToast, 'CSV g√©n√©r√© avec succ√®s !', 'success');\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur export CSV:', error);\r\n        toast.updateLoadingToast(loadingToast, 'Erreur d\\'export CSV', 'error');\r\n        toast.error('Erreur lors de l\\'export CSV', 4000);\r\n    }\r\n}\r\n\r\n/**\r\n * Initialiser les event listeners\r\n */\r\nfunction initEventListeners() {\r\n    // Boutons d'export\r\n    document.getElementById('export-pdf-btn')?.addEventListener('click', exportToPDF);\r\n    document.getElementById('export-csv-btn')?.addEventListener('click', exportToAdvancedCSV);\r\n    \r\n    // Filtres de p√©riode (√† impl√©menter)\r\n    document.getElementById('period-filter')?.addEventListener('change', handlePeriodChange);\r\n    \r\n    // Rafra√Æchir\r\n    document.getElementById('refresh-dashboard-btn')?.addEventListener('click', () => {\r\n        toast.info('Actualisation du dashboard...', 2000);\r\n        initAdminDashboard();\r\n    });\r\n}\r\n\r\n/**\r\n * G√©rer le changement de p√©riode\r\n */\r\nasync function handlePeriodChange(e) {\r\n    const period = e.target.value;\r\n    toast.info(`Filtrage: ${period}`, 2000);\r\n    // TODO: Filtrer les donn√©es selon la p√©riode\r\n}\r\n\r\n/**\r\n * Afficher l'√©tat de chargement\r\n */\r\nfunction showLoadingState() {\r\n    // Skeletons pour les stats\r\n    const statsContainer = document.getElementById('global-stats-cards');\r\n    if (statsContainer) {\r\n        showSkeleton('global-stats-cards', createStatsSkeleton(4));\r\n    }\r\n    \r\n    // Skeletons pour les top users\r\n    const topUsersContainer = document.getElementById('top-users-list');\r\n    if (topUsersContainer) {\r\n        showSkeleton('top-users-list', createListSkeleton(10));\r\n    }\r\n    \r\n    // Skeletons pour l'activit√© r√©cente\r\n    const activityContainer = document.getElementById('recent-activity-list');\r\n    if (activityContainer) {\r\n        showSkeleton('recent-activity-list', createListSkeleton(8));\r\n    }\r\n    \r\n    // Skeletons pour les graphiques\r\n    const progressChartContainer = document.getElementById('progress-chart');\r\n    if (progressChartContainer) {\r\n        progressChartContainer.innerHTML = createChartSkeleton();\r\n    }\r\n    \r\n    const modulesChartContainer = document.getElementById('modules-chart');\r\n    if (modulesChartContainer) {\r\n        modulesChartContainer.innerHTML = createChartSkeleton();\r\n    }\r\n    \r\n    const activityChartContainer = document.getElementById('activity-chart');\r\n    if (activityChartContainer) {\r\n        activityChartContainer.innerHTML = createChartSkeleton();\r\n    }\r\n}\r\n\r\n/**\r\n * Cacher l'√©tat de chargement\r\n */\r\nfunction hideLoadingState() {\r\n    // Les conteneurs sont mis √† jour par les fonctions de rendu\r\n}\r\n\r\n/**\r\n * Temps relatif\r\n */\r\nfunction getTimeAgo(date) {\r\n    const now = new Date();\r\n    const diff = now - date;\r\n    const seconds = Math.floor(diff / 1000);\r\n    const minutes = Math.floor(seconds / 60);\r\n    const hours = Math.floor(minutes / 60);\r\n    const days = Math.floor(hours / 24);\r\n    \r\n    if (days > 0) return `Il y a ${days}j`;\r\n    if (hours > 0) return `Il y a ${hours}h`;\r\n    if (minutes > 0) return `Il y a ${minutes}min`;\r\n    return '√Ä l\\'instant';\r\n}\r\n","\n        import { requireAdmin } from './js/admin-auth-guard.js';\n        import { initQuestionsManager } from './js/admin-questions.js';\n        import { initUsersManager } from './js/admin-users.js';\n        import { initAdminDashboard } from './js/admin-dashboard.js';\n        import { auth } from './js/firebase-config.js';\n        import { toast } from './js/toast.js';\n        import { tooltip } from './js/tooltip.js';\n        \n        // V√©rifier les permissions admin au chargement\n        requireAdmin().then(user => {\n            console.log('Admin authentifi√©:', user.email);\n            toast.success(`Bienvenue ${user.displayName || user.email} !`, 3000);\n            \n            // Afficher les infos admin\n            const adminName = document.getElementById('admin-name');\n            const adminAvatar = document.getElementById('admin-avatar');\n            \n            if (adminName) adminName.textContent = user.displayName || user.email;\n            if (adminAvatar && user.photoURL) adminAvatar.src = user.photoURL;\n            \n            // Initialiser les gestionnaires\n            initAdminDashboard(); // Dashboard en premier\n            initQuestionsManager();\n            initUsersManager();\n            \n            // Gestion des tabs\n            initTabs();\n            \n        }).catch(error => {\n            console.error('Erreur authentification admin:', error);\n            // La redirection est d√©j√† g√©r√©e par requireAdmin()\n        });\n        \n        /**\n         * Initialiser les tabs\n         */\n        function initTabs() {\n            const dashboardBtn = document.getElementById('tab-dashboard-btn');\n            const questionsBtn = document.getElementById('tab-questions-btn');\n            const usersBtn = document.getElementById('tab-users-btn');\n            \n            const dashboardTab = document.getElementById('tab-dashboard');\n            const questionsTab = document.getElementById('tab-questions');\n            const usersTab = document.getElementById('tab-users');\n            \n            // Fonction pour activer un onglet\n            function activateTab(activeBtn, activeTab) {\n                // D√©sactiver tous les boutons\n                [dashboardBtn, questionsBtn, usersBtn].forEach(btn => {\n                    btn.classList.remove('border-indigo-600', 'text-indigo-600');\n                    btn.classList.add('border-transparent', 'text-slate-600');\n                    btn.setAttribute('aria-selected', 'false');\n                });\n                \n                // Cacher tous les onglets\n                [dashboardTab, questionsTab, usersTab].forEach(tab => {\n                    tab.classList.add('tab-hidden');\n                });\n                \n                // Activer le bouton et l'onglet s√©lectionn√©s\n                activeBtn.classList.remove('border-transparent', 'text-slate-600');\n                activeBtn.classList.add('border-indigo-600', 'text-indigo-600');\n                activeBtn.setAttribute('aria-selected', 'true');\n                activeTab.classList.remove('tab-hidden');\n            }\n            \n            // √âv√©nements des onglets\n            dashboardBtn.addEventListener('click', () => activateTab(dashboardBtn, dashboardTab));\n            questionsBtn.addEventListener('click', () => activateTab(questionsBtn, questionsTab));\n            usersBtn.addEventListener('click', () => activateTab(usersBtn, usersTab));\n        }\n    "],"names":["TooltipManager","container","elements","el","mutations","mutation","node","element","e","event","text","position","theme","size","tooltip","themes","sizes","arrows","preferredPosition","rect","tooltipRect","arrow","spacing","arrowSize","positions","testPosition","alternatives","alt","altPos","finalPosition","options","requireAdmin","resolve","reject","isDemoMode","demoUser","getDemoUser","unsubscribe","auth","user","userProfile","getUserProfile","error","DEMO_STORAGE_KEY","loadDemoQuestions","saved","q","saveDemoQuestions","questions","MOCK_QUESTIONS","MOCK_STATS","currentQuestions","currentFilters","currentPage","questionsPerPage","initQuestionsManager","loadQuestions","loadStats","initEventListeners","createForm","handleCreateQuestion","jsonInput","handleJSONUpload","browseBtn","moduleFilter","monthFilter","yearFilter","searchInput","handleFilterChange","handleSearch","prevBtn","nextBtn","changePage","showSkeleton","createQuestionSkeleton","renderQuestionsList","filters","getQuestions","startIndex","endIndex","paginatedQuestions","renderQuestionCard","updatePaginationControls","addQuestionActionListeners","question","moduleColors","moduleIcons","color","icon","monthName","escapeHtml","opt","idx","btn","questionId","openEditModal","handleDeleteQuestion","form","submitBtn","originalBtnText","questionData","newMockQuestion","showSuccess","createQuestion","showError","file","showLoading","jsonData","validateJSONFormat","showJSONPreview","data","fileName","moduleNames","monthNames","handleConfirmImport","confirmBtn","questionsToImport","result","importQuestionsFromJSON","index","deleteQuestion","filterName","searchTerm","filtered","direction","totalPages","pageInfo","renderStats","stats","getQuestionsStats","module","count","percentage","containerId","message","toast","div","MOCK_USERS","currentUsers","initUsersManager","loadUsers","createUserForm","handleCreateUser","generatePasswordBtn","generateRandomPassword","roleFilter","statusFilter","errorDiv","successDiv","formData","userData","showFormError","loadingToast","chars","password","i","passwordInput","createUserSkeleton","oneWeekAgo","isActive","renderUsersList","getAllUsers","renderUserCard","addUserActionListeners","isAdmin","roleColor","roleIcon","lastLogin","createdAt","lastLoginText","formatRelativeTime","avatarUrl","renderUserStats","totalQuizzes","averageScore","currentStreak","userId","userEmail","userRole","openEditRoleModal","currentRole","modal","newRole","handleUpdateRole","saveBtn","originalText","updateUserRole","u","temp","getUsersStats","activePercentage","date","diff","minutes","hours","days","MOCK_DATA","globalStats","chartProgress","chartModules","chartActivity","initAdminDashboard","showLoadingState","loadGlobalStats","loadTopUsers","loadRecentActivity","loadModuleStats","createCharts","renderGlobalStats","usersSnapshot","getDocs","collection","db","quizzesSnapshot","totalScore","doc","questionsSnapshot","resourcesSnapshot","today","activeToday","weekAgo","activeWeek","quizzesToday","completedAt","quizzesWeek","renderTopUsers","resultsSnapshot","userScores","score","topUsers","a","b","renderRecentActivity","query","orderBy","limit","snapshot","activities","mockStats","moduleStats","stat","users","medal","activity","timeAgo","getTimeAgo","scoreColor","createProgressChart","createModulesChart","createActivityChart","canvas","labels","counts","avgScores","thirtyDaysAgo","dailyData","dateStr","d","s","colors","exportToPDF","jsPDF","y","exportToAdvancedCSV","headers","rows","csv","row","blob","link","handlePeriodChange","period","createStatsSkeleton","createListSkeleton","progressChartContainer","createChartSkeleton","modulesChartContainer","activityChartContainer","seconds","adminName","adminAvatar","initTabs","dashboardBtn","questionsBtn","usersBtn","dashboardTab","questionsTab","usersTab","activateTab","activeBtn","activeTab","tab"],"mappings":"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"}