{"version":3,"file":"index-BhgvxFRa.js","sources":["../../js/toast.js","../../js/firebase-config.js","../../js/firestore-service.js","../../js/auth.js","../../js/index-init.js","../../js/confetti.js","../../js/quiz.js","../../js/dashboard.js"],"sourcesContent":["// Syst√®me de Notifications Toast - Feedback utilisateur moderne\r\n// Utilisation: showToast('Message', 'success|error|warning|info')\r\n\r\n/**\r\n * Afficher une notification toast\r\n * @param {string} message - Le message √† afficher\r\n * @param {string} type - Type: 'success', 'error', 'warning', 'info'\r\n * @param {number} duration - Dur√©e en ms (d√©faut: 3000)\r\n */\r\nexport function showToast(message, type = 'info', duration = 3000) {\r\n    const container = getOrCreateToastContainer();\r\n    \r\n    const toast = createToastElement(message, type);\r\n    container.appendChild(toast);\r\n    \r\n    // Animation d'entr√©e\r\n    setTimeout(() => toast.classList.add('show'), 10);\r\n    \r\n    // Auto-fermeture\r\n    if (duration > 0) {\r\n        setTimeout(() => {\r\n            closeToast(toast);\r\n        }, duration);\r\n    }\r\n    \r\n    return toast;\r\n}\r\n\r\n/**\r\n * Cr√©er ou r√©cup√©rer le conteneur de toasts\r\n */\r\nfunction getOrCreateToastContainer() {\r\n    let container = document.getElementById('toast-container');\r\n    \r\n    if (!container) {\r\n        container = document.createElement('div');\r\n        container.id = 'toast-container';\r\n        container.className = 'fixed top-4 right-4 z-50 flex flex-col gap-3';\r\n        document.body.appendChild(container);\r\n    }\r\n    \r\n    return container;\r\n}\r\n\r\n/**\r\n * Cr√©er un √©l√©ment toast\r\n */\r\nfunction createToastElement(message, type) {\r\n    const toast = document.createElement('div');\r\n    toast.className = `toast toast-${type} transform translate-x-full transition-all duration-300`;\r\n    \r\n    const config = getToastConfig(type);\r\n    \r\n    toast.innerHTML = `\r\n        <div class=\"flex items-center gap-3 bg-white rounded-lg shadow-lg border-l-4 ${config.borderColor} p-4 min-w-[320px] max-w-md\">\r\n            <div class=\"flex-shrink-0\">\r\n                ${config.icon}\r\n            </div>\r\n            <div class=\"flex-1\">\r\n                <p class=\"text-sm font-medium text-slate-900\">${message}</p>\r\n            </div>\r\n            <button class=\"toast-close flex-shrink-0 text-slate-400 hover:text-slate-600 transition-colors\">\r\n                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                </svg>\r\n            </button>\r\n        </div>\r\n    `;\r\n    \r\n    // √âv√©nement de fermeture\r\n    const closeBtn = toast.querySelector('.toast-close');\r\n    closeBtn.addEventListener('click', () => closeToast(toast));\r\n    \r\n    return toast;\r\n}\r\n\r\n/**\r\n * Configuration par type de toast\r\n */\r\nfunction getToastConfig(type) {\r\n    const configs = {\r\n        success: {\r\n            borderColor: 'border-green-500',\r\n            icon: `<div class=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center\">\r\n                <svg class=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path>\r\n                </svg>\r\n            </div>`\r\n        },\r\n        error: {\r\n            borderColor: 'border-red-500',\r\n            icon: `<div class=\"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center\">\r\n                <svg class=\"w-5 h-5 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                </svg>\r\n            </div>`\r\n        },\r\n        warning: {\r\n            borderColor: 'border-yellow-500',\r\n            icon: `<div class=\"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center\">\r\n                <svg class=\"w-5 h-5 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"></path>\r\n                </svg>\r\n            </div>`\r\n        },\r\n        info: {\r\n            borderColor: 'border-blue-500',\r\n            icon: `<div class=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center\">\r\n                <svg class=\"w-5 h-5 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                </svg>\r\n            </div>`\r\n        }\r\n    };\r\n    \r\n    return configs[type] || configs.info;\r\n}\r\n\r\n/**\r\n * Fermer un toast\r\n */\r\nfunction closeToast(toast) {\r\n    toast.classList.remove('show');\r\n    toast.classList.add('translate-x-full');\r\n    \r\n    setTimeout(() => {\r\n        toast.remove();\r\n        \r\n        // Nettoyer le conteneur si vide\r\n        const container = document.getElementById('toast-container');\r\n        if (container && container.children.length === 0) {\r\n            container.remove();\r\n        }\r\n    }, 300);\r\n}\r\n\r\n/**\r\n * Raccourcis pour les types de toasts\r\n */\r\nexport const toast = {\r\n    success: (message, duration) => showToast(message, 'success', duration),\r\n    error: (message, duration) => showToast(message, 'error', duration),\r\n    warning: (message, duration) => showToast(message, 'warning', duration),\r\n    info: (message, duration) => showToast(message, 'info', duration)\r\n};\r\n\r\n/**\r\n * Toast avec action\r\n */\r\nexport function showToastWithAction(message, type, actionText, actionCallback) {\r\n    const container = getOrCreateToastContainer();\r\n    \r\n    const toast = document.createElement('div');\r\n    toast.className = `toast toast-${type} transform translate-x-full transition-all duration-300`;\r\n    \r\n    const config = getToastConfig(type);\r\n    \r\n    toast.innerHTML = `\r\n        <div class=\"flex items-center gap-3 bg-white rounded-lg shadow-lg border-l-4 ${config.borderColor} p-4 min-w-[320px] max-w-md\">\r\n            <div class=\"flex-shrink-0\">\r\n                ${config.icon}\r\n            </div>\r\n            <div class=\"flex-1\">\r\n                <p class=\"text-sm font-medium text-slate-900 mb-2\">${message}</p>\r\n                <button class=\"toast-action text-sm font-semibold text-indigo-600 hover:text-indigo-700 transition-colors\">\r\n                    ${actionText}\r\n                </button>\r\n            </div>\r\n            <button class=\"toast-close flex-shrink-0 text-slate-400 hover:text-slate-600 transition-colors\">\r\n                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                </svg>\r\n            </button>\r\n        </div>\r\n    `;\r\n    \r\n    container.appendChild(toast);\r\n    \r\n    // Animation d'entr√©e\r\n    setTimeout(() => toast.classList.add('show'), 10);\r\n    \r\n    // √âv√©nements\r\n    toast.querySelector('.toast-close').addEventListener('click', () => closeToast(toast));\r\n    toast.querySelector('.toast-action').addEventListener('click', () => {\r\n        actionCallback();\r\n        closeToast(toast);\r\n    });\r\n    \r\n    return toast;\r\n}\r\n\r\n/**\r\n * Toast de chargement\r\n */\r\nexport function showLoadingToast(message) {\r\n    const container = getOrCreateToastContainer();\r\n    \r\n    const toast = document.createElement('div');\r\n    toast.className = 'toast toast-loading transform translate-x-full transition-all duration-300';\r\n    toast.setAttribute('data-loading', 'true');\r\n    \r\n    toast.innerHTML = `\r\n        <div class=\"flex items-center gap-3 bg-white rounded-lg shadow-lg border-l-4 border-indigo-500 p-4 min-w-[320px] max-w-md\">\r\n            <div class=\"flex-shrink-0\">\r\n                <div class=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600\"></div>\r\n            </div>\r\n            <div class=\"flex-1\">\r\n                <p class=\"text-sm font-medium text-slate-900\">${message}</p>\r\n            </div>\r\n        </div>\r\n    `;\r\n    \r\n    container.appendChild(toast);\r\n    \r\n    // Animation d'entr√©e\r\n    setTimeout(() => toast.classList.add('show'), 10);\r\n    \r\n    return toast;\r\n}\r\n\r\n/**\r\n * Mettre √† jour un toast de chargement\r\n */\r\nexport function updateLoadingToast(toast, message, type = 'success') {\r\n    if (!toast || !toast.getAttribute('data-loading')) return;\r\n    \r\n    const config = getToastConfig(type);\r\n    // Mettre √† jour les classes pour refl√©ter le statut final (et √™tre d√©tectable par les tests)\r\n    const hadShow = toast.classList.contains('show');\r\n    toast.className = `toast toast-${type} transform transition-all duration-300${hadShow ? ' show' : ''}`;\r\n    \r\n    toast.innerHTML = `\r\n        <div class=\"flex items-center gap-3 bg-white rounded-lg shadow-lg border-l-4 ${config.borderColor} p-4 min-w-[320px] max-w-md\">\r\n            <div class=\"flex-shrink-0\">\r\n                ${config.icon}\r\n            </div>\r\n            <div class=\"flex-1\">\r\n                <p class=\"text-sm font-medium text-slate-900\">${message}</p>\r\n            </div>\r\n            <button class=\"toast-close flex-shrink-0 text-slate-400 hover:text-slate-600 transition-colors\">\r\n                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                </svg>\r\n            </button>\r\n        </div>\r\n    `;\r\n    \r\n    toast.removeAttribute('data-loading');\r\n    toast.querySelector('.toast-close').addEventListener('click', () => closeToast(toast));\r\n    \r\n    // Auto-fermeture apr√®s 3s\r\n    setTimeout(() => closeToast(toast), 3000);\r\n}\r\n\r\n/**\r\n * Fonctions helper pour faciliter l'utilisation\r\n */\r\nexport function showSuccessToast(message, duration = 3000) {\r\n    return showToast(message, 'success', duration);\r\n}\r\n\r\nexport function showErrorToast(message, duration = 3000) {\r\n    return showToast(message, 'error', duration);\r\n}\r\n\r\nexport function showWarningToast(message, duration = 3000) {\r\n    return showToast(message, 'warning', duration);\r\n}\r\n\r\nexport function showInfoToast(message, duration = 3000) {\r\n    return showToast(message, 'info', duration);\r\n}\r\n\r\n// CSS pour les animations (√† ajouter dans un <style> ou fichier CSS)\r\nexport const toastStyles = `\r\n    <style>\r\n        .toast.show {\r\n            transform: translateX(0) !important;\r\n        }\r\n        \r\n        @media (max-width: 640px) {\r\n            #toast-container {\r\n                left: 1rem;\r\n                right: 1rem;\r\n                top: 1rem;\r\n            }\r\n            \r\n            .toast > div {\r\n                min-width: auto !important;\r\n                width: 100%;\r\n            }\r\n        }\r\n    </style>\r\n`;\r\n\r\n// Injecter les styles au chargement\r\nif (typeof document !== 'undefined') {\r\n    const styleElement = document.createElement('style');\r\n    styleElement.textContent = `\r\n        .toast.show {\r\n            transform: translateX(0) !important;\r\n        }\r\n        \r\n        @media (max-width: 640px) {\r\n            #toast-container {\r\n                left: 1rem;\r\n                right: 1rem;\r\n                top: 1rem;\r\n            }\r\n            \r\n            .toast > div {\r\n                min-width: auto !important;\r\n                width: 100%;\r\n            }\r\n        }\r\n    `;\r\n    document.head.appendChild(styleElement);\r\n}\r\n","// Import Firebase SDK modules\r\nimport { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';\r\nimport { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';\r\nimport { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';\r\nimport { getDatabase } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';\r\n\r\n// Configuration Firebase - Avantage QUIZZ\r\n// Configuration compl√®te avec Firestore + Realtime Database\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyD8w7Em_xdMGplscfGLrnM72vmm4z5ZTr0\",\r\n  authDomain: \"avantage-quizz.firebaseapp.com\",\r\n  databaseURL: \"https://avantage-quizz-default-rtdb.firebaseio.com\",\r\n  projectId: \"avantage-quizz\",\r\n  storageBucket: \"avantage-quizz.firebasestorage.app\",\r\n  messagingSenderId: \"919472910099\",\r\n  appId: \"1:919472910099:web:e17d4c1cdc7a04c6cab4e6\"\r\n};\r\n\r\n// Initialize Firebase\r\nconst app = initializeApp(firebaseConfig);\r\n\r\n// Initialize Firebase services\r\nexport const auth = getAuth(app);\r\nexport const db = getFirestore(app);\r\nexport const realtimeDB = getDatabase(app);\r\n\r\nconsole.log('‚úÖ Firebase initialis√© avec succ√®s');\r\nconsole.log('üìä Projet:', firebaseConfig.projectId);\r\nconsole.log('üîê Services: Authentication, Firestore, Realtime Database');\r\n","// Module Firestore - Gestion des donn√©es\r\nimport { db, auth } from './firebase-config.js';\r\nimport { \r\n    collection, \r\n    doc, \r\n    getDoc, \r\n    getDocs, \r\n    setDoc, \r\n    updateDoc, \r\n    addDoc,\r\n    deleteDoc,\r\n    query,\r\n    where,\r\n    orderBy,\r\n    limit,\r\n    Timestamp\r\n} from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';\r\n\r\n// ===== COLLECTIONS =====\r\nconst COLLECTIONS = {\r\n    users: 'users',\r\n    quizResults: 'quizResults',\r\n    monthlyProgress: 'monthlyProgress',\r\n    questions: 'questions'\r\n};\r\n\r\n// ===== GESTION DES UTILISATEURS =====\r\n\r\n/**\r\n * Cr√©er ou mettre √† jour le profil utilisateur\r\n */\r\nexport async function createOrUpdateUser(user) {\r\n    try {\r\n        const userRef = doc(db, COLLECTIONS.users, user.uid);\r\n        const userData = {\r\n            uid: user.uid,\r\n            email: user.email,\r\n            displayName: user.displayName,\r\n            photoURL: user.photoURL,\r\n            lastLogin: Timestamp.now(),\r\n            updatedAt: Timestamp.now()\r\n        };\r\n        \r\n        // V√©rifier si l'utilisateur existe\r\n        const userDoc = await getDoc(userRef);\r\n        \r\n        if (!userDoc.exists()) {\r\n            // Nouvel utilisateur\r\n            userData.createdAt = Timestamp.now();\r\n            userData.totalQuizzes = 0;\r\n            userData.averageScore = 0;\r\n            userData.currentStreak = 0;\r\n            userData.longestStreak = 0;\r\n            userData.role = 'user'; // ‚úÖ R√¥le par d√©faut pour nouveaux utilisateurs\r\n            console.log('üë§ Cr√©ation du profil utilisateur:', user.email);\r\n        }\r\n        \r\n        await setDoc(userRef, userData, { merge: true });\r\n        console.log('‚úÖ Profil utilisateur sauvegard√©');\r\n        return userData;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur cr√©ation utilisateur:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * R√©cup√©rer le profil utilisateur\r\n */\r\nexport async function getUserProfile(uid) {\r\n    try {\r\n        const userRef = doc(db, COLLECTIONS.users, uid);\r\n        const userDoc = await getDoc(userRef);\r\n        \r\n        if (userDoc.exists()) {\r\n            return userDoc.data();\r\n        }\r\n        return null;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur r√©cup√©ration profil:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// ===== GESTION DES R√âSULTATS DE QUIZ =====\r\n\r\n/**\r\n * Sauvegarder un r√©sultat de quiz\r\n */\r\nexport async function saveQuizResult(quizData) {\r\n    try {\r\n        const user = auth.currentUser;\r\n        if (!user) throw new Error('Utilisateur non connect√©');\r\n        \r\n        const resultData = {\r\n            userId: user.uid,\r\n            userEmail: user.email,\r\n            moduleId: quizData.moduleId,\r\n            moduleName: quizData.moduleName,\r\n            score: quizData.score,\r\n            correctAnswers: quizData.correctAnswers,\r\n            totalQuestions: quizData.totalQuestions,\r\n            timeElapsed: quizData.timeElapsed,\r\n            answers: quizData.answers,\r\n            date: Timestamp.now(),\r\n            month: quizData.month || new Date().toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' })\r\n        };\r\n        \r\n        // Ajouter le r√©sultat\r\n        const resultRef = await addDoc(collection(db, COLLECTIONS.quizResults), resultData);\r\n        console.log('‚úÖ R√©sultat de quiz sauvegard√©:', resultRef.id);\r\n        \r\n        // Mettre √† jour les statistiques utilisateur\r\n        await updateUserStats(user.uid, quizData.score);\r\n        \r\n        // Mettre √† jour la progression mensuelle\r\n        await updateMonthlyProgress(user.uid, quizData.month, quizData.score);\r\n        \r\n        return resultRef.id;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur sauvegarde r√©sultat:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * R√©cup√©rer tous les r√©sultats d'un utilisateur\r\n */\r\nexport async function getUserQuizResults(uid, limitCount = 50) {\r\n    try {\r\n        const q = query(\r\n            collection(db, COLLECTIONS.quizResults),\r\n            where('userId', '==', uid),\r\n            orderBy('date', 'desc'),\r\n            limit(limitCount)\r\n        );\r\n        \r\n        const querySnapshot = await getDocs(q);\r\n        const results = [];\r\n        \r\n        querySnapshot.forEach((doc) => {\r\n            results.push({ id: doc.id, ...doc.data() });\r\n        });\r\n        \r\n        console.log(`üìä ${results.length} r√©sultats charg√©s`);\r\n        return results;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur r√©cup√©ration r√©sultats:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * R√©cup√©rer les r√©sultats d'un mois sp√©cifique\r\n */\r\nexport async function getMonthlyResults(uid, month) {\r\n    try {\r\n        const q = query(\r\n            collection(db, COLLECTIONS.quizResults),\r\n            where('userId', '==', uid),\r\n            where('month', '==', month),\r\n            orderBy('date', 'desc')\r\n        );\r\n        \r\n        const querySnapshot = await getDocs(q);\r\n        const results = [];\r\n        \r\n        querySnapshot.forEach((doc) => {\r\n            results.push({ id: doc.id, ...doc.data() });\r\n        });\r\n        \r\n        return results;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur r√©cup√©ration r√©sultats mensuels:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// ===== GESTION DE LA PROGRESSION MENSUELLE =====\r\n\r\n/**\r\n * Mettre √† jour la progression mensuelle\r\n */\r\nexport async function updateMonthlyProgress(uid, month, score) {\r\n    try {\r\n        const progressRef = doc(db, COLLECTIONS.monthlyProgress, `${uid}_${month}`);\r\n        \r\n        const progressData = {\r\n            userId: uid,\r\n            month: month,\r\n            score: score,\r\n            completed: true,\r\n            completedAt: Timestamp.now(),\r\n            updatedAt: Timestamp.now()\r\n        };\r\n        \r\n        await setDoc(progressRef, progressData, { merge: true });\r\n        console.log('‚úÖ Progression mensuelle mise √† jour');\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur mise √† jour progression:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * R√©cup√©rer la progression annuelle\r\n */\r\nexport async function getAnnualProgress(uid, year = new Date().getFullYear()) {\r\n    try {\r\n        const q = query(\r\n            collection(db, COLLECTIONS.monthlyProgress),\r\n            where('userId', '==', uid)\r\n        );\r\n        \r\n        const querySnapshot = await getDocs(q);\r\n        const progress = {};\r\n        \r\n        querySnapshot.forEach((doc) => {\r\n            const data = doc.data();\r\n            progress[data.month] = data;\r\n        });\r\n        \r\n        console.log('üìÖ Progression annuelle charg√©e');\r\n        return progress;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur r√©cup√©ration progression:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// ===== STATISTIQUES UTILISATEUR =====\r\n\r\n/**\r\n * Mettre √† jour les statistiques utilisateur\r\n */\r\nasync function updateUserStats(uid, newScore) {\r\n    try {\r\n        const userRef = doc(db, COLLECTIONS.users, uid);\r\n        const userDoc = await getDoc(userRef);\r\n        \r\n        if (userDoc.exists()) {\r\n            const userData = userDoc.data();\r\n            const totalQuizzes = (userData.totalQuizzes || 0) + 1;\r\n            const currentAverage = userData.averageScore || 0;\r\n            const newAverage = ((currentAverage * (totalQuizzes - 1)) + newScore) / totalQuizzes;\r\n            \r\n            await updateDoc(userRef, {\r\n                totalQuizzes: totalQuizzes,\r\n                averageScore: Math.round(newAverage),\r\n                lastQuizDate: Timestamp.now(),\r\n                updatedAt: Timestamp.now()\r\n            });\r\n            \r\n            console.log('üìä Statistiques mises √† jour');\r\n        }\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur mise √† jour statistiques:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Calculer et mettre √† jour la s√©rie (streak)\r\n */\r\nexport async function updateStreak(uid) {\r\n    try {\r\n        const results = await getUserQuizResults(uid, 12);\r\n        \r\n        // Calculer la s√©rie de mois cons√©cutifs avec score >= 60%\r\n        let currentStreak = 0;\r\n        const monthsSet = new Set();\r\n        \r\n        for (const result of results) {\r\n            if (result.score >= 60) {\r\n                monthsSet.add(result.month);\r\n            }\r\n        }\r\n        \r\n        // Compter les mois cons√©cutifs\r\n        const months = Array.from(monthsSet).sort().reverse();\r\n        for (let i = 0; i < months.length; i++) {\r\n            currentStreak++;\r\n            // V√©rifier si le mois suivant est cons√©cutif\r\n            if (i < months.length - 1) {\r\n                // Logique de v√©rification de cons√©cutivit√©\r\n                // (simplifi√©e ici)\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n        \r\n        const userRef = doc(db, COLLECTIONS.users, uid);\r\n        const userDoc = await getDoc(userRef);\r\n        \r\n        if (userDoc.exists()) {\r\n            const userData = userDoc.data();\r\n            const longestStreak = Math.max(currentStreak, userData.longestStreak || 0);\r\n            \r\n            await updateDoc(userRef, {\r\n                currentStreak: currentStreak,\r\n                longestStreak: longestStreak,\r\n                updatedAt: Timestamp.now()\r\n            });\r\n            \r\n            console.log(`üî• S√©rie mise √† jour: ${currentStreak} mois`);\r\n        }\r\n        \r\n        return currentStreak;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur mise √† jour s√©rie:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// ===== LEADERBOARD =====\r\n\r\n/**\r\n * R√©cup√©rer le classement g√©n√©ral\r\n */\r\nexport async function getLeaderboard(limitCount = 10) {\r\n    try {\r\n        const q = query(\r\n            collection(db, COLLECTIONS.users),\r\n            orderBy('averageScore', 'desc'),\r\n            orderBy('totalQuizzes', 'desc'),\r\n            limit(limitCount)\r\n        );\r\n        \r\n        const querySnapshot = await getDocs(q);\r\n        const leaderboard = [];\r\n        \r\n        querySnapshot.forEach((doc) => {\r\n            const data = doc.data();\r\n            leaderboard.push({\r\n                uid: doc.id,\r\n                displayName: data.displayName,\r\n                photoURL: data.photoURL,\r\n                averageScore: data.averageScore,\r\n                totalQuizzes: data.totalQuizzes,\r\n                currentStreak: data.currentStreak\r\n            });\r\n        });\r\n        \r\n        console.log('üèÜ Classement charg√©');\r\n        return leaderboard;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur r√©cup√©ration classement:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// ===== FONCTIONS ADMINISTRATEUR =====\r\n\r\n/**\r\n * V√©rifier si l'utilisateur actuel est admin\r\n */\r\nexport async function isCurrentUserAdmin() {\r\n    try {\r\n        const user = auth.currentUser;\r\n        if (!user) return false;\r\n        \r\n        const userProfile = await getUserProfile(user.uid);\r\n        return userProfile?.role === 'admin';\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur v√©rification admin:', error);\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: R√©cup√©rer toutes les questions avec filtres optionnels\r\n */\r\nexport async function getQuestions(filters = {}) {\r\n    try {\r\n        let q = collection(db, COLLECTIONS.questions);\r\n        const constraints = [];\r\n        \r\n        // Filtres optionnels\r\n        if (filters.module) {\r\n            constraints.push(where('module', '==', filters.module));\r\n        }\r\n        if (filters.month) {\r\n            constraints.push(where('month', '==', filters.month));\r\n        }\r\n        if (filters.year) {\r\n            constraints.push(where('year', '==', filters.year));\r\n        }\r\n        \r\n        // Tri par date de cr√©ation\r\n        constraints.push(orderBy('createdAt', 'desc'));\r\n        \r\n        if (constraints.length > 0) {\r\n            q = query(q, ...constraints);\r\n        }\r\n        \r\n        const querySnapshot = await getDocs(q);\r\n        const questions = [];\r\n        \r\n        querySnapshot.forEach((doc) => {\r\n            questions.push({ id: doc.id, ...doc.data() });\r\n        });\r\n        \r\n        console.log(`üìö ${questions.length} questions charg√©es`);\r\n        return questions;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur r√©cup√©ration questions:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: Cr√©er une nouvelle question\r\n */\r\nexport async function createQuestion(questionData) {\r\n    try {\r\n        const user = auth.currentUser;\r\n        if (!user) throw new Error('Utilisateur non connect√©');\r\n        \r\n        // Validation\r\n        if (!questionData.question || questionData.question.length < 10) {\r\n            throw new Error('La question doit contenir au moins 10 caract√®res');\r\n        }\r\n        if (!questionData.options || questionData.options.length !== 4) {\r\n            throw new Error('La question doit avoir exactement 4 options');\r\n        }\r\n        if (questionData.correctAnswer === undefined || questionData.correctAnswer < 0 || questionData.correctAnswer > 3) {\r\n            throw new Error('La r√©ponse correcte doit √™tre entre 0 et 3');\r\n        }\r\n        if (!questionData.explanation || questionData.explanation.length < 20) {\r\n            throw new Error('L\\'explication doit contenir au moins 20 caract√®res');\r\n        }\r\n        if (!['auto', 'loisir', 'vr', 'tracteur'].includes(questionData.module)) {\r\n            throw new Error('Module invalide');\r\n        }\r\n        if (!questionData.month || questionData.month < 1 || questionData.month > 12) {\r\n            throw new Error('Mois invalide');\r\n        }\r\n        \r\n        const newQuestion = {\r\n            question: questionData.question.trim(),\r\n            options: questionData.options.map(opt => opt.trim()),\r\n            correctAnswer: parseInt(questionData.correctAnswer),\r\n            explanation: questionData.explanation.trim(),\r\n            module: questionData.module,\r\n            month: parseInt(questionData.month),\r\n            year: questionData.year || new Date().getFullYear(),\r\n            createdAt: Timestamp.now(),\r\n            createdBy: user.uid,\r\n            updatedAt: Timestamp.now()\r\n        };\r\n        \r\n        const questionRef = await addDoc(collection(db, COLLECTIONS.questions), newQuestion);\r\n        console.log('‚úÖ Question cr√©√©e:', questionRef.id);\r\n        \r\n        // Log d'audit\r\n        await createAuditLog({\r\n            action: 'CREATE_QUESTION',\r\n            questionId: questionRef.id,\r\n            adminId: user.uid,\r\n            adminEmail: user.email\r\n        });\r\n        \r\n        return questionRef.id;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur cr√©ation question:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: Mettre √† jour une question existante\r\n */\r\nexport async function updateQuestion(questionId, questionData) {\r\n    try {\r\n        const user = auth.currentUser;\r\n        if (!user) throw new Error('Utilisateur non connect√©');\r\n        \r\n        const questionRef = doc(db, COLLECTIONS.questions, questionId);\r\n        \r\n        const updatedData = {\r\n            ...questionData,\r\n            updatedAt: Timestamp.now()\r\n        };\r\n        \r\n        // Ne pas permettre la modification de certains champs\r\n        delete updatedData.createdAt;\r\n        delete updatedData.createdBy;\r\n        \r\n        await updateDoc(questionRef, updatedData);\r\n        console.log('‚úÖ Question mise √† jour:', questionId);\r\n        \r\n        // Log d'audit\r\n        await createAuditLog({\r\n            action: 'UPDATE_QUESTION',\r\n            questionId: questionId,\r\n            adminId: user.uid,\r\n            adminEmail: user.email,\r\n            changes: questionData\r\n        });\r\n        \r\n        return true;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur mise √† jour question:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: Supprimer une question\r\n */\r\nexport async function deleteQuestion(questionId) {\r\n    try {\r\n        const user = auth.currentUser;\r\n        if (!user) throw new Error('Utilisateur non connect√©');\r\n        \r\n        const questionRef = doc(db, COLLECTIONS.questions, questionId);\r\n        \r\n        // R√©cup√©rer les donn√©es avant suppression pour le log\r\n        const questionDoc = await getDoc(questionRef);\r\n        const questionData = questionDoc.data();\r\n        \r\n        await deleteDoc(questionRef);\r\n        console.log('üóëÔ∏è Question supprim√©e:', questionId);\r\n        \r\n        // Log d'audit\r\n        await createAuditLog({\r\n            action: 'DELETE_QUESTION',\r\n            questionId: questionId,\r\n            adminId: user.uid,\r\n            adminEmail: user.email,\r\n            deletedData: questionData\r\n        });\r\n        \r\n        return true;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur suppression question:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: Importer des questions depuis JSON\r\n */\r\nexport async function importQuestionsFromJSON(jsonData) {\r\n    try {\r\n        const user = auth.currentUser;\r\n        if (!user) throw new Error('Utilisateur non connect√©');\r\n        \r\n        // Validation du JSON\r\n        if (!jsonData.module || !jsonData.month || !jsonData.year || !jsonData.questions) {\r\n            throw new Error('Format JSON invalide - champs obligatoires manquants');\r\n        }\r\n        \r\n        if (!Array.isArray(jsonData.questions) || jsonData.questions.length === 0) {\r\n            throw new Error('Le fichier JSON doit contenir au moins une question');\r\n        }\r\n        \r\n        const importedIds = [];\r\n        const errors = [];\r\n        \r\n        // Importer chaque question\r\n        for (let i = 0; i < jsonData.questions.length; i++) {\r\n            const question = jsonData.questions[i];\r\n            \r\n            try {\r\n                const questionData = {\r\n                    question: question.question,\r\n                    options: question.options,\r\n                    correctAnswer: question.correctAnswer,\r\n                    explanation: question.explanation,\r\n                    module: jsonData.module,\r\n                    month: jsonData.month,\r\n                    year: jsonData.year\r\n                };\r\n                \r\n                const questionId = await createQuestion(questionData);\r\n                importedIds.push(questionId);\r\n            } catch (err) {\r\n                errors.push({ index: i, error: err.message });\r\n                console.error(`‚ùå Erreur question ${i + 1}:`, err.message);\r\n            }\r\n        }\r\n        \r\n        // Log d'import\r\n        await createImportLog({\r\n            importedBy: user.uid,\r\n            module: jsonData.module,\r\n            month: jsonData.month,\r\n            year: jsonData.year,\r\n            totalQuestions: jsonData.questions.length,\r\n            successCount: importedIds.length,\r\n            errorCount: errors.length,\r\n            status: errors.length === 0 ? 'success' : 'partial'\r\n        });\r\n        \r\n        console.log(`‚úÖ Import termin√©: ${importedIds.length}/${jsonData.questions.length} questions import√©es`);\r\n        \r\n        return {\r\n            success: importedIds.length,\r\n            total: jsonData.questions.length,\r\n            errors: errors,\r\n            ids: importedIds\r\n        };\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur import JSON:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: R√©cup√©rer tous les utilisateurs\r\n */\r\nexport async function getAllUsers(filters = {}) {\r\n    try {\r\n        let q = collection(db, COLLECTIONS.users);\r\n        const constraints = [];\r\n        \r\n        // Filtres optionnels\r\n        if (filters.role) {\r\n            constraints.push(where('role', '==', filters.role));\r\n        }\r\n        \r\n        // Tri\r\n        constraints.push(orderBy('createdAt', 'desc'));\r\n        \r\n        if (constraints.length > 0) {\r\n            q = query(q, ...constraints);\r\n        }\r\n        \r\n        const querySnapshot = await getDocs(q);\r\n        const users = [];\r\n        \r\n        querySnapshot.forEach((doc) => {\r\n            users.push({ id: doc.id, ...doc.data() });\r\n        });\r\n        \r\n        console.log(`üë• ${users.length} utilisateurs charg√©s`);\r\n        return users;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur r√©cup√©ration utilisateurs:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: Mettre √† jour le r√¥le d'un utilisateur\r\n */\r\nexport async function updateUserRole(userId, newRole) {\r\n    try {\r\n        const user = auth.currentUser;\r\n        if (!user) throw new Error('Utilisateur non connect√©');\r\n        \r\n        if (!['user', 'admin'].includes(newRole)) {\r\n            throw new Error('R√¥le invalide - doit √™tre \"user\" ou \"admin\"');\r\n        }\r\n        \r\n        const userRef = doc(db, COLLECTIONS.users, userId);\r\n        \r\n        await updateDoc(userRef, {\r\n            role: newRole,\r\n            updatedAt: Timestamp.now()\r\n        });\r\n        \r\n        console.log(`‚úÖ R√¥le mis √† jour pour ${userId}: ${newRole}`);\r\n        \r\n        // Log d'audit\r\n        await createAuditLog({\r\n            action: 'UPDATE_USER_ROLE',\r\n            targetUserId: userId,\r\n            newRole: newRole,\r\n            adminId: user.uid,\r\n            adminEmail: user.email\r\n        });\r\n        \r\n        return true;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur mise √† jour r√¥le:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: Cr√©er un log d'import\r\n */\r\nasync function createImportLog(logData) {\r\n    try {\r\n        const log = {\r\n            ...logData,\r\n            importedAt: Timestamp.now()\r\n        };\r\n        \r\n        await addDoc(collection(db, 'importLogs'), log);\r\n        console.log('Log import cree');\r\n    } catch (error) {\r\n        console.error('Erreur creation log import:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: Cr√©er un log d'audit\r\n */\r\nasync function createAuditLog(logData) {\r\n    try {\r\n        const log = {\r\n            ...logData,\r\n            timestamp: Timestamp.now()\r\n        };\r\n        \r\n        await addDoc(collection(db, 'auditLogs'), log);\r\n        console.log('Log audit cree');\r\n    } catch (error) {\r\n        console.error('Erreur creation log audit:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: R√©cup√©rer les statistiques des questions\r\n */\r\nexport async function getQuestionsStats() {\r\n    try {\r\n        const questions = await getQuestions();\r\n        \r\n        const stats = {\r\n            total: questions.length,\r\n            byModule: {},\r\n            byMonth: {},\r\n            byYear: {}\r\n        };\r\n        \r\n        questions.forEach(q => {\r\n            // Par module\r\n            stats.byModule[q.module] = (stats.byModule[q.module] || 0) + 1;\r\n            \r\n            // Par mois\r\n            stats.byMonth[q.month] = (stats.byMonth[q.month] || 0) + 1;\r\n            \r\n            // Par ann√©e\r\n            stats.byYear[q.year] = (stats.byYear[q.year] || 0) + 1;\r\n        });\r\n        \r\n        return stats;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur statistiques questions:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: R√©cup√©rer les statistiques des utilisateurs\r\n */\r\nexport async function getUsersStats() {\r\n    try {\r\n        const users = await getAllUsers();\r\n        \r\n        const stats = {\r\n            total: users.length,\r\n            admins: users.filter(u => u.role === 'admin').length,\r\n            regularUsers: users.filter(u => u.role !== 'admin').length,\r\n            activeLastWeek: 0,\r\n            averageScore: 0,\r\n            totalQuizzes: 0\r\n        };\r\n        \r\n        const oneWeekAgo = new Date();\r\n        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\r\n        \r\n        users.forEach(u => {\r\n            if (u.lastLogin && u.lastLogin.toDate() > oneWeekAgo) {\r\n                stats.activeLastWeek++;\r\n            }\r\n            stats.totalQuizzes += (u.totalQuizzes || 0);\r\n            stats.averageScore += (u.averageScore || 0);\r\n        });\r\n        \r\n        stats.averageScore = stats.total > 0 ? Math.round(stats.averageScore / stats.total) : 0;\r\n        \r\n        return stats;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur statistiques utilisateurs:', error);\r\n        throw error;\r\n    }\r\n}\r\n","// Module Authentication - Gestion de l'authentification Google\r\nimport { auth } from './firebase-config.js';\r\nimport { \r\n    GoogleAuthProvider, \r\n    signInWithPopup, \r\n    signOut, \r\n    onAuthStateChanged \r\n} from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';\r\nimport { createOrUpdateUser } from './firestore-service.js';\r\n\r\nconst provider = new GoogleAuthProvider();\r\nprovider.setCustomParameters({\r\n    prompt: 'select_account'\r\n});\r\n\r\n// Sign in with Google\r\nexport async function signInWithGoogle() {\r\n    try {\r\n        console.log('üîê Tentative de connexion Google...');\r\n        const result = await signInWithPopup(auth, provider);\r\n        const user = result.user;\r\n        \r\n        console.log('‚úÖ Authentification r√©ussie:', user.displayName);\r\n        console.log('üìß Email:', user.email);\r\n        \r\n        // Cr√©er ou mettre √† jour le profil utilisateur dans Firestore\r\n        await createOrUpdateUser(user);\r\n        \r\n        return user;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur de connexion:', error);\r\n        \r\n        // Messages d'erreur personnalis√©s\r\n        let errorMessage = 'Erreur lors de la connexion. Veuillez r√©essayer.';\r\n        \r\n        if (error.code === 'auth/popup-closed-by-user') {\r\n            errorMessage = 'Connexion annul√©e. Veuillez r√©essayer.';\r\n        } else if (error.code === 'auth/popup-blocked') {\r\n            errorMessage = 'Pop-up bloqu√©e. Autorisez les pop-ups pour ce site.';\r\n        } else if (error.code === 'auth/unauthorized-domain') {\r\n            errorMessage = 'Domaine non autoris√©. Configurez Firebase Authentication.';\r\n        }\r\n        \r\n        alert(errorMessage);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// Sign out\r\nexport async function signOutUser() {\r\n    try {\r\n        const userName = auth.currentUser?.displayName || 'Utilisateur';\r\n        await signOut(auth);\r\n        console.log('‚úÖ D√©connexion r√©ussie:', userName);\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur de d√©connexion:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// Listen for auth state changes\r\nexport function onAuthChange(callback) {\r\n    return onAuthStateChanged(auth, (user) => {\r\n        if (user) {\r\n            console.log('üë§ Utilisateur connect√©:', user.email);\r\n        } else {\r\n            console.log('üë§ Aucun utilisateur connect√©');\r\n        }\r\n        callback(user);\r\n    });\r\n}\r\n\r\n// Get current user\r\nexport function getCurrentUser() {\r\n    return auth.currentUser;\r\n}\r\n\r\n// Check if user is authenticated\r\nexport function isAuthenticated() {\r\n    return auth.currentUser !== null;\r\n}\r\n\r\n// Show admin UI elements if user is admin\r\nexport async function showAdminUIIfAdmin(userProfile) {\r\n    if (!userProfile) return;\r\n    \r\n    const isAdmin = userProfile.role === 'admin';\r\n    \r\n    if (isAdmin) {\r\n        // Afficher l'onglet Admin dans la navigation\r\n        const navAdminItem = document.getElementById('nav-admin-item');\r\n        if (navAdminItem) {\r\n            navAdminItem.classList.remove('hidden');\r\n        }\r\n        \r\n        // Afficher le badge Admin\r\n        const adminBadgeNav = document.getElementById('admin-badge-nav');\r\n        if (adminBadgeNav) {\r\n            adminBadgeNav.classList.remove('hidden');\r\n        }\r\n        \r\n        console.log('Admin UI elements shown');\r\n    }\r\n}\r\n\r\n// ============================================\r\n// MODE D√âMO\r\n// ============================================\r\n\r\n/**\r\n * Activer le mode d√©mo sans authentification Firebase\r\n * Cr√©e un utilisateur fictif en localStorage\r\n */\r\nexport async function activateDemoMode() {\r\n    try {\r\n        console.log('üé≠ Activation du mode d√©mo...');\r\n        \r\n        // Cr√©er un utilisateur d√©mo\r\n        const demoUser = {\r\n            uid: 'demo-user-' + Date.now(),\r\n            email: 'demo@avantage-quizz.local',\r\n            displayName: 'Utilisateur D√©mo',\r\n            photoURL: null,\r\n            isDemo: true,\r\n            role: 'admin', // Admin par d√©faut pour tester toutes les fonctionnalit√©s\r\n            createdAt: new Date().toISOString()\r\n        };\r\n        \r\n        // Stocker en localStorage\r\n        localStorage.setItem('demoUser', JSON.stringify(demoUser));\r\n        localStorage.setItem('authMode', 'demo');\r\n        \r\n        console.log('‚úÖ Mode d√©mo activ√©:', demoUser.displayName);\r\n        console.log('üìß Email:', demoUser.email);\r\n        console.log('üëë R√¥le:', demoUser.role);\r\n        \r\n        return demoUser;\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur activation mode d√©mo:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * D√©sactiver le mode d√©mo\r\n */\r\nexport function deactivateDemoMode() {\r\n    localStorage.removeItem('demoUser');\r\n    localStorage.removeItem('authMode');\r\n    console.log('‚úÖ Mode d√©mo d√©sactiv√©');\r\n}\r\n\r\n/**\r\n * V√©rifier si le mode d√©mo est actif\r\n */\r\nexport function isDemoMode() {\r\n    return localStorage.getItem('authMode') === 'demo';\r\n}\r\n\r\n/**\r\n * R√©cup√©rer l'utilisateur d√©mo depuis localStorage\r\n */\r\nexport function getDemoUser() {\r\n    try {\r\n        const demoUserJson = localStorage.getItem('demoUser');\r\n        if (!demoUserJson) return null;\r\n        \r\n        const demoUser = JSON.parse(demoUserJson);\r\n        return demoUser;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur lecture utilisateur d√©mo:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\n/**\r\n * Obtenir l'utilisateur actuel (Firebase ou D√©mo)\r\n */\r\nexport function getCurrentUserUnified() {\r\n    // Mode d√©mo\r\n    if (isDemoMode()) {\r\n        return getDemoUser();\r\n    }\r\n    \r\n    // Mode Firebase normal\r\n    return getCurrentUser();\r\n}\r\n","// Initialisation de la page d'accueil (index.html)\r\nimport { signInWithGoogle, activateDemoMode } from './auth.js';\r\nimport { showErrorToast, showSuccessToast, showLoadingToast, updateLoadingToast } from './toast.js';\r\n\r\nconsole.log('Initialisation de la page d accueil...');\r\n\r\n// Attendre que le DOM soit charg√©\r\ndocument.addEventListener('DOMContentLoaded', initIndexPage);\r\n\r\nfunction initIndexPage() {\r\n    console.log('üìÑ DOM charg√© - configuration des boutons...');\r\n    \r\n    // Bouton Google Sign-In\r\n    const googleBtn = document.getElementById('google-signin-btn');\r\n    if (googleBtn) {\r\n        googleBtn.addEventListener('click', handleGoogleSignIn);\r\n        console.log('‚úÖ Bouton Google configur√©');\r\n    } else {\r\n        console.warn('‚ö†Ô∏è Bouton Google non trouv√©');\r\n    }\r\n    \r\n    // Bouton Mode D√©mo\r\n    const demoBtn = document.getElementById('demo-mode-btn');\r\n    if (demoBtn) {\r\n        demoBtn.addEventListener('click', handleDemoMode);\r\n        console.log('‚úÖ Bouton Mode D√©mo configur√©');\r\n    } else {\r\n        console.warn('‚ö†Ô∏è Bouton Mode D√©mo non trouv√©');\r\n    }\r\n}\r\n\r\n/**\r\n * Handler pour le bouton Google Sign-In\r\n */\r\nasync function handleGoogleSignIn() {\r\n    console.log('üîê Clic sur connexion Google...');\r\n    \r\n    const loadingToast = showLoadingToast('Connexion en cours...');\r\n    \r\n    try {\r\n        const user = await signInWithGoogle();\r\n        \r\n    // Succ√®s\r\n    updateLoadingToast(loadingToast, `Bienvenue ${user.displayName} !`, 'success');\r\n        \r\n        // Recharger la page pour que le dashboard d√©tecte l'utilisateur connect√©\r\n        setTimeout(() => {\r\n            window.location.reload();\r\n        }, 800);\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur connexion Google:', error);\r\n        \r\n        // Messages d'erreur personnalis√©s\r\n        let errorMessage = 'Erreur lors de la connexion';\r\n        \r\n        if (error.code === 'auth/popup-closed-by-user') {\r\n            errorMessage = 'Connexion annul√©e';\r\n        } else if (error.code === 'auth/popup-blocked') {\r\n            errorMessage = 'Pop-up bloqu√©e. Autorisez les pop-ups.';\r\n        } else if (error.code === 'auth/unauthorized-domain') {\r\n            errorMessage = 'Domaine non autoris√© dans Firebase';\r\n        } else if (error.code === 'auth/network-request-failed') {\r\n            errorMessage = 'Erreur r√©seau. V√©rifiez votre connexion.';\r\n        }\r\n        \r\n    updateLoadingToast(loadingToast, errorMessage, 'error');\r\n    }\r\n}\r\n\r\n/**\r\n * Handler pour le bouton Mode D√©mo\r\n */\r\nasync function handleDemoMode() {\r\n    console.log('üé≠ Clic sur Mode D√©mo...');\r\n    \r\n    const loadingToast = showLoadingToast('Activation du mode d√©mo...');\r\n    \r\n    try {\r\n        const demoUser = await activateDemoMode();\r\n        \r\n        console.log('‚úÖ Mode d√©mo activ√©:', demoUser);\r\n        \r\n    // Succ√®s\r\n    updateLoadingToast(loadingToast, 'Mode d√©mo activ√© ! Rechargement...', 'success');\r\n        \r\n        // Recharger la page pour que le dashboard d√©tecte le mode d√©mo\r\n        setTimeout(() => {\r\n            window.location.reload();\r\n        }, 500);\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur activation mode d√©mo:', error);\r\n        updateLoadingToast(loadingToast, 'error', 'Impossible d\\'activer le mode d√©mo');\r\n    }\r\n}\r\n\r\n// Export pour tests\r\nexport { handleGoogleSignIn, handleDemoMode };\r\n","// Simple confetti animation using canvas\r\nexport function launchConfetti() {\r\n    const canvas = document.createElement('canvas');\r\n    canvas.style.position = 'fixed';\r\n    canvas.style.top = '0';\r\n    canvas.style.left = '0';\r\n    canvas.style.width = '100%';\r\n    canvas.style.height = '100%';\r\n    canvas.style.pointerEvents = 'none';\r\n    canvas.style.zIndex = '9999';\r\n    document.body.appendChild(canvas);\r\n\r\n    const ctx = canvas.getContext('2d');\r\n    canvas.width = window.innerWidth;\r\n    canvas.height = window.innerHeight;\r\n\r\n    const particles = [];\r\n    const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2'];\r\n    \r\n    // Create particles\r\n    for (let i = 0; i < 150; i++) {\r\n        particles.push({\r\n            x: Math.random() * canvas.width,\r\n            y: canvas.height + Math.random() * 100,\r\n            size: Math.random() * 8 + 4,\r\n            speedY: -(Math.random() * 3 + 3),\r\n            speedX: Math.random() * 6 - 3,\r\n            color: colors[Math.floor(Math.random() * colors.length)],\r\n            rotation: Math.random() * 360,\r\n            rotationSpeed: Math.random() * 10 - 5,\r\n            gravity: 0.15,\r\n            opacity: 1\r\n        });\r\n    }\r\n\r\n    function animate() {\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        \r\n        let activeParticles = 0;\r\n        \r\n        particles.forEach((p, index) => {\r\n            p.speedY += p.gravity;\r\n            p.y += p.speedY;\r\n            p.x += p.speedX;\r\n            p.rotation += p.rotationSpeed;\r\n            \r\n            // Fade out near the bottom\r\n            if (p.y > canvas.height - 100) {\r\n                p.opacity -= 0.02;\r\n            }\r\n            \r\n            if (p.opacity > 0 && p.y < canvas.height + 50) {\r\n                activeParticles++;\r\n                \r\n                ctx.save();\r\n                ctx.translate(p.x, p.y);\r\n                ctx.rotate((p.rotation * Math.PI) / 180);\r\n                ctx.globalAlpha = p.opacity;\r\n                ctx.fillStyle = p.color;\r\n                \r\n                // Draw rectangle confetti\r\n                ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);\r\n                \r\n                ctx.restore();\r\n            }\r\n        });\r\n        \r\n        if (activeParticles > 0) {\r\n            requestAnimationFrame(animate);\r\n        } else {\r\n            canvas.remove();\r\n        }\r\n    }\r\n    \r\n    animate();\r\n}\r\n","// Module Quiz - Interface de questions style professionnel (VERSION 2.0 - Firestore)\r\nimport { db } from './firebase-config.js';\r\nimport { collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';\r\nimport { getCurrentUserUnified, isDemoMode } from './auth.js';\r\nimport { launchConfetti } from './confetti.js';\r\nimport { saveQuizResult } from './firestore-service.js';\r\nimport { toast, showLoadingToast, updateLoadingToast } from './toast.js';\r\n\r\n// Configuration des modules (m√©tadonn√©es uniquement - pas de questions hardcod√©es)\r\nconst moduleConfig = {\r\n    'auto': {\r\n        name: 'AT-AVE-AVEX',\r\n        color: 'indigo',\r\n        label: 'Auto'\r\n    },\r\n    'loisir': {\r\n        name: 'VTT, Motoneige, etc.',\r\n        color: 'cyan',\r\n        label: 'Loisir'\r\n    },\r\n    'vr': {\r\n        name: 'V√©hicules R√©cr√©atifs',\r\n        color: 'orange',\r\n        label: 'VR'\r\n    },\r\n    'tracteur': {\r\n        name: '√âquipement Agricole',\r\n        color: 'green',\r\n        label: 'Tracteur'\r\n    }\r\n};\r\n\r\n// √âtat du quiz\r\nlet currentQuiz = null;\r\nlet currentQuestionIndex = 0;\r\nlet userAnswers = [];\r\nlet startTime = null;\r\nlet timerInterval = null;\r\nlet questionStartTime = null;\r\nlet currentStreak = 0;\r\nlet isPaused = false;\r\nlet pausedTime = 0;\r\nlet currentModule = null;\r\nlet currentMonth = null;\r\nlet currentYear = null;\r\n\r\n// Couleurs par module\r\nconst moduleColors = {\r\n    'indigo': { bg: 'bg-indigo-600', text: 'text-indigo-600', border: 'border-indigo-600' },\r\n    'cyan': { bg: 'bg-cyan-600', text: 'text-cyan-600', border: 'border-cyan-600' },\r\n    'orange': { bg: 'bg-orange-600', text: 'text-orange-600', border: 'border-orange-600' },\r\n    'green': { bg: 'bg-green-600', text: 'text-green-600', border: 'border-green-600' }\r\n};\r\n\r\n// Charger les questions depuis Firestore, compatible mois num√©rique ou texte (r√©tro-compatibilit√©)\r\nasync function loadQuizFromFirestore(moduleId, monthNumber, year) {\r\n    console.log(`üì• Chargement des questions: module=${moduleId}, mois=${monthNumber}, ann√©e=${year}`);\r\n\r\n    const toQuestionObjects = (doc) => {\r\n        const data = doc.data();\r\n        return {\r\n            id: doc.id,\r\n            question: data.question,\r\n            options: data.options.map((opt, index) => ({\r\n                id: String.fromCharCode(65 + index), // A, B, C, D\r\n                text: opt,\r\n                correct: index === data.correctAnswer\r\n            })),\r\n            explanation: data.explanation || 'Pas d\\'explication disponible',\r\n            reference: data.reference || '',\r\n            tags: data.tags || []\r\n        };\r\n    };\r\n\r\n    // ‚úÖ MODE D√âMO : Utiliser les questions mock√©es de localStorage OU d√©fauts\r\n    if (isDemoMode()) {\r\n        console.log('üìù Mode d√©mo : Chargement des questions simul√©es pour le quiz...');\r\n        \r\n        // üíæ Charger depuis localStorage (synchronis√© avec admin)\r\n        const DEMO_STORAGE_KEY = 'avantage-quizz-demo-questions';\r\n        const saved = localStorage.getItem(DEMO_STORAGE_KEY);\r\n        \r\n        let demoQuestions = [];\r\n        \r\n        if (saved) {\r\n            try {\r\n                const parsed = JSON.parse(saved);\r\n                console.log(`üíæ ${parsed.length} questions charg√©es depuis localStorage`);\r\n                \r\n                // Convertir au format attendu par le quiz\r\n                demoQuestions = parsed.map(q => ({\r\n                    id: q.id,\r\n                    question: q.question,\r\n                    options: q.options.map((opt, index) => ({\r\n                        id: String.fromCharCode(65 + index), // A, B, C, D\r\n                        text: opt,\r\n                        correct: index === q.correctAnswer\r\n                    })),\r\n                    explanation: q.explanation || 'Pas d\\'explication disponible',\r\n                    reference: q.reference || '',\r\n                    tags: q.tags || []\r\n                }));\r\n                \r\n                // Filtrer par module et mois si n√©cessaire\r\n                demoQuestions = demoQuestions.filter(q => {\r\n                    const matchModule = !moduleId || parsed.find(p => p.id === q.id)?.module === moduleId;\r\n                    const matchMonth = !monthNumber || parsed.find(p => p.id === q.id)?.month === monthNumber;\r\n                    return matchModule && matchMonth;\r\n                });\r\n                \r\n            } catch (e) {\r\n                console.warn('‚ö†Ô∏è Erreur lecture localStorage, utilisation questions par d√©faut');\r\n            }\r\n        }\r\n        \r\n        // Si pas de questions en localStorage, utiliser les 5 par d√©faut\r\n        if (demoQuestions.length === 0) {\r\n            console.log('üì¶ Utilisation questions par d√©faut (aucune en localStorage)');\r\n            demoQuestions = [\r\n                {\r\n                    id: 'demo-1',\r\n                    question: 'Quelle est la vitesse maximale autoris√©e sur une autoroute au Qu√©bec ?',\r\n                    options: [\r\n                        { id: 'A', text: '100 km/h', correct: false },\r\n                        { id: 'B', text: '110 km/h', correct: false },\r\n                        { id: 'C', text: '120 km/h', correct: false },\r\n                        { id: 'D', text: '100 km/h (conditions normales)', correct: true }\r\n                    ],\r\n                    explanation: 'La vitesse maximale sur autoroute au Qu√©bec est de 100 km/h, sauf indication contraire.',\r\n                    reference: 'Code de la s√©curit√© routi√®re du Qu√©bec',\r\n                    tags: ['vitesse', 'autoroute']\r\n                },\r\n                {\r\n                    id: 'demo-2',\r\n                    question: '√Ä quelle distance minimale devez-vous vous arr√™ter derri√®re un autobus scolaire dont les feux clignotent ?',\r\n                    options: [\r\n                        { id: 'A', text: '3 m√®tres', correct: false },\r\n                        { id: 'B', text: '5 m√®tres', correct: true },\r\n                        { id: 'C', text: '10 m√®tres', correct: false },\r\n                        { id: 'D', text: '15 m√®tres', correct: false }\r\n                    ],\r\n                    explanation: 'Vous devez vous arr√™ter √† au moins 5 m√®tres d\\'un autobus scolaire.',\r\n                    reference: 'Article 460 CSR',\r\n                    tags: ['autobus', 's√©curit√©']\r\n                },\r\n                {\r\n                    id: 'demo-3',\r\n                    question: 'Quel est le taux d\\'alcool√©mie maximal pour conduire au Qu√©bec ?',\r\n                    options: [\r\n                        { id: 'A', text: '0.05', correct: false },\r\n                        { id: 'B', text: '0.08', correct: true },\r\n                        { id: 'C', text: '0.10', correct: false },\r\n                        { id: 'D', text: '0.00', correct: false }\r\n                    ],\r\n                    explanation: 'Le taux maximal est de 0.08 pour conducteurs exp√©riment√©s.',\r\n                    reference: 'Code criminel du Canada',\r\n                    tags: ['alcool', 's√©curit√©']\r\n                },\r\n                {\r\n                    id: 'demo-4',\r\n                    question: 'Combien de points d\\'inaptitude entra√Æne un exc√®s de vitesse de 30 km/h ?',\r\n                    options: [\r\n                        { id: 'A', text: '2 points', correct: false },\r\n                        { id: 'B', text: '3 points', correct: true },\r\n                        { id: 'C', text: '4 points', correct: false },\r\n                        { id: 'D', text: '5 points', correct: false }\r\n                    ],\r\n                    explanation: 'Un exc√®s de 21 √† 30 km/h entra√Æne 3 points.',\r\n                    reference: 'SAAQ',\r\n                    tags: ['vitesse', 'points']\r\n                },\r\n                {\r\n                    id: 'demo-5',\r\n                    question: 'Quelle est la distance de s√©curit√© recommand√©e entre v√©hicules ?',\r\n                    options: [\r\n                        { id: 'A', text: '1 seconde', correct: false },\r\n                        { id: 'B', text: '2 secondes', correct: true },\r\n                        { id: 'C', text: '3 secondes', correct: false },\r\n                        { id: 'D', text: '5 secondes', correct: false }\r\n                    ],\r\n                    explanation: 'La r√®gle des 2 secondes est recommand√©e.',\r\n                    reference: 'Guide SAAQ',\r\n                    tags: ['distance', 's√©curit√©']\r\n                }\r\n            ];\r\n        }\r\n        \r\n        console.log(`‚úÖ ${demoQuestions.length} questions d√©mo charg√©es pour le quiz`);\r\n        return demoQuestions;\r\n    }\r\n\r\n    try {\r\n        // 1) Essayer avec mois num√©rique (sch√©ma actuel de l'admin)\r\n        let q1 = query(\r\n            collection(db, 'questions'),\r\n            where('module', '==', moduleId),\r\n            where('month', '==', monthNumber),\r\n            where('year', '==', year)\r\n        );\r\n        let snap = await getDocs(q1);\r\n        if (!snap.empty) {\r\n            const res = [];\r\n            snap.forEach((d) => res.push(toQuestionObjects(d)));\r\n            console.log(`‚úÖ ${res.length} questions (mois num√©rique)`);\r\n            return res;\r\n        }\r\n\r\n        // 2) R√©tro-compatibilit√©: essayer avec mois texte (ex: \"Novembre\")\r\n        const monthNames = ['janvier', 'f√©vrier', 'mars', 'avril', 'mai', 'juin', 'juillet', 'ao√ªt', 'septembre', 'octobre', 'novembre', 'd√©cembre'];\r\n        const monthText = monthNames[monthNumber - 1];\r\n        const normalizedMonth = monthText.charAt(0).toUpperCase() + monthText.slice(1).toLowerCase();\r\n\r\n        let q2 = query(\r\n            collection(db, 'questions'),\r\n            where('module', '==', moduleId),\r\n            where('month', '==', normalizedMonth),\r\n            where('year', '==', year)\r\n        );\r\n        snap = await getDocs(q2);\r\n        if (!snap.empty) {\r\n            const res = [];\r\n            snap.forEach((d) => res.push(toQuestionObjects(d)));\r\n            console.log(`‚úÖ ${res.length} questions (mois texte)`);\r\n            return res;\r\n        }\r\n\r\n        console.warn('‚ö†Ô∏è Aucune question trouv√©e pour ces crit√®res (num√©rique/texte)');\r\n        return [];\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur lors du chargement des questions:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// Fallback Demo: charger depuis un JSON local lorsque le Mode D√©mo est actif\r\nasync function loadDemoQuestions(moduleId, monthNumber, year) {\r\n    try {\r\n        const resp = await fetch('/test-questions-valides.json');\r\n        if (!resp.ok) return [];\r\n        const data = await resp.json();\r\n        const monthNames = ['janvier', 'f√©vrier', 'mars', 'avril', 'mai', 'juin', 'juillet', 'ao√ªt', 'septembre', 'octobre', 'novembre', 'd√©cembre'];\r\n        const monthText = monthNames[monthNumber - 1];\r\n\r\n        const filtered = data.filter(q => q.module === moduleId && q.year === year && (q.month === monthText || q.month === monthNumber));\r\n        return filtered.map((q, idx) => ({\r\n            id: `demo-${moduleId}-${idx}`,\r\n            question: q.question,\r\n            options: q.options.map((opt, index) => ({\r\n                id: String.fromCharCode(65 + index),\r\n                text: opt,\r\n                correct: index === q.correctAnswer\r\n            })),\r\n            explanation: q.explanation || 'Pas d\\'explication disponible',\r\n            reference: q.reference || '',\r\n            tags: q.tags || []\r\n        }));\r\n    } catch (e) {\r\n        console.warn('Demo questions fallback error:', e);\r\n        return [];\r\n    }\r\n}\r\n\r\n// **FONCTION MODIFI√âE** : Initialiser le quiz avec chargement Firestore\r\nexport async function startQuiz(moduleId) {\r\n    const config = moduleConfig[moduleId];\r\n    if (!config) {\r\n        console.error('Module de quiz non trouv√©:', moduleId);\r\n        toast.error('Module non trouv√©. Veuillez r√©essayer.');\r\n        return;\r\n    }\r\n    \r\n    // Afficher un √©cran de chargement avec toast\r\n    const loadingToast = showLoadingToast(`Chargement du quiz ${config.label}...`);\r\n    showLoadingScreen(config.label);\r\n    \r\n    try {\r\n        // D√©terminer le mois (num√©rique) et l'ann√©e actuels\r\n        const now = new Date();\r\n        const monthNames = ['janvier', 'f√©vrier', 'mars', 'avril', 'mai', 'juin', 'juillet', 'ao√ªt', 'septembre', 'octobre', 'novembre', 'd√©cembre'];\r\n        const monthNumber = now.getMonth() + 1;\r\n        currentMonth = monthNames[monthNumber - 1];\r\n        currentYear = now.getFullYear();\r\n        currentModule = moduleId;\r\n        \r\n    // Indiquer qu'un quiz est en cours (utilis√© pour confirmations de navigation)\r\n    try { window.__QUIZ_ACTIVE = true; } catch (e) {}\r\n\r\n    // Charger les questions depuis Firestore (num√©rique/texte)\r\n        let questions = await loadQuizFromFirestore(moduleId, monthNumber, currentYear);\r\n\r\n        // En mode D√©mo, si aucune question en base, charger depuis JSON local\r\n        if (questions.length === 0 && isDemoMode()) {\r\n            console.log('‚ÑπÔ∏è Mode D√©mo: chargement des questions locales de test');\r\n            questions = await loadDemoQuestions(moduleId, monthNumber, currentYear);\r\n        }\r\n        \r\n        if (questions.length === 0) {\r\n            hideLoadingScreen();\r\n            updateLoadingToast(loadingToast, 'Aucune question disponible', 'error');\r\n            toast.error(`Aucune question trouv√©e pour ${config.label} en ${currentMonth} ${currentYear}.\\n\\nContactez l'administrateur.`, 5000);\r\n            return;\r\n        }\r\n        \r\n        // Cr√©er l'objet quiz\r\n        currentQuiz = {\r\n            name: `Quiz ${config.label} - ${currentMonth.charAt(0).toUpperCase() + currentMonth.slice(1)}`,\r\n            module: config.name,\r\n            color: config.color,\r\n            questions: questions\r\n        };\r\n        \r\n        // R√©initialiser l'√©tat\r\n        currentQuestionIndex = 0;\r\n        userAnswers = [];\r\n        startTime = Date.now();\r\n        questionStartTime = Date.now();\r\n        currentStreak = 0;\r\n        \r\n        // Cacher l'√©cran de chargement et d√©marrer\r\n        hideLoadingScreen();\r\n        showQuizView();\r\n        renderQuestion();\r\n        startTimer();\r\n        updateScoreDisplay();\r\n        \r\n        // Toast de succ√®s\r\n        updateLoadingToast(loadingToast, `${questions.length} questions charg√©es !`, 'success');\r\n        \r\n    } catch (error) {\r\n        hideLoadingScreen();\r\n        console.error('‚ùå Erreur lors du d√©marrage du quiz:', error);\r\n        updateLoadingToast(loadingToast, 'Erreur de chargement', 'error');\r\n        toast.error('Erreur lors du chargement du quiz. Veuillez r√©essayer.', 4000);\r\n    }\r\n}\r\n\r\n// √âcran de chargement\r\nfunction showLoadingScreen(moduleName) {\r\n    const quizView = getOrCreateQuizView();\r\n    quizView.innerHTML = `\r\n        <div class=\"min-h-screen flex items-center justify-center\">\r\n            <div class=\"text-center\">\r\n                <div class=\"animate-spin rounded-full h-16 w-16 border-b-4 border-indigo-600 mx-auto mb-6\"></div>\r\n                <h2 class=\"text-2xl font-bold text-slate-900 mb-2\">Chargement du quiz ${moduleName}</h2>\r\n                <p class=\"text-slate-600\">R√©cup√©ration des questions...</p>\r\n            </div>\r\n        </div>\r\n    `;\r\n    quizView.classList.remove('view-hidden');\r\n}\r\n\r\nfunction hideLoadingScreen() {\r\n    // L'√©cran sera remplac√© par le contenu du quiz\r\n}\r\n\r\n// Afficher la vue du quiz\r\nfunction showQuizView() {\r\n    document.getElementById('dashboard-view')?.classList.add('view-hidden');\r\n    document.getElementById('module-selection-view')?.classList.add('view-hidden');\r\n    document.getElementById('login-view')?.classList.add('view-hidden');\r\n    \r\n    const quizView = getOrCreateQuizView();\r\n    quizView.classList.remove('view-hidden');\r\n}\r\n\r\nfunction getOrCreateQuizView() {\r\n    let quizView = document.getElementById('quiz-view');\r\n    if (!quizView) {\r\n        quizView = document.createElement('div');\r\n        quizView.id = 'quiz-view';\r\n        document.querySelector('main').appendChild(quizView);\r\n    }\r\n    return quizView;\r\n}\r\n\r\n// Rendre la question actuelle\r\nfunction renderQuestion() {\r\n    const question = currentQuiz.questions[currentQuestionIndex];\r\n    const quizView = document.getElementById('quiz-view');\r\n    const colorScheme = moduleColors[currentQuiz.color];\r\n    \r\n    quizView.innerHTML = `\r\n        <!-- En-t√™te du quiz -->\r\n        <div class=\"bg-white border-b border-gray-200 shadow-sm\">\r\n            <div class=\"max-w-5xl mx-auto px-6 py-4\">\r\n                <div class=\"flex items-center justify-between\">\r\n                    <div>\r\n                        <h1 class=\"text-xl font-bold text-slate-900\">${currentQuiz.name}</h1>\r\n                        <p class=\"text-sm text-slate-500\">Question ${currentQuestionIndex + 1} sur ${currentQuiz.questions.length}</p>\r\n                    </div>\r\n                    <div class=\"flex items-center gap-6\">\r\n                        <button id=\"focus-mode-btn\" class=\"text-sm font-medium text-slate-600 hover:text-slate-900 flex items-center gap-1\">\r\n                            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"></path>\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"></path>\r\n                            </svg>\r\n                            Focus\r\n                        </button>\r\n                        <button id=\"pause-btn\" class=\"text-sm font-medium text-slate-600 hover:text-slate-900 flex items-center gap-1\">\r\n                            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                            </svg>\r\n                            Pause\r\n                        </button>\r\n                        <div class=\"flex items-center gap-2\">\r\n                            <svg class=\"w-5 h-5 text-indigo-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                            </svg>\r\n                            <span id=\"quiz-score\" class=\"text-sm font-bold text-indigo-600\">Score: 0%</span>\r\n                        </div>\r\n                        <div class=\"flex items-center gap-2\">\r\n                            <svg class=\"w-5 h-5 text-slate-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                            </svg>\r\n                            <span id=\"quiz-timer\" class=\"text-sm font-medium text-slate-600\">0:00</span>\r\n                        </div>\r\n                        <button id=\"quit-quiz-btn\" class=\"text-sm font-medium text-slate-600 hover:text-slate-900\">\r\n                            Quitter\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n                \r\n                <!-- Barre de progression -->\r\n                <div class=\"mt-4 w-full bg-gray-200 rounded-full h-2\">\r\n                    <div class=\"${colorScheme.bg} h-2 rounded-full transition-all duration-300\" style=\"width: ${((currentQuestionIndex + 1) / currentQuiz.questions.length) * 100}%\"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Contenu de la question -->\r\n        <div class=\"max-w-5xl mx-auto px-6 py-8\">\r\n            <div class=\"bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden\">\r\n                \r\n                <!-- En-t√™te de question -->\r\n                <div class=\"px-8 py-6 bg-gradient-to-r from-slate-50 to-white border-b border-gray-100\">\r\n                    <div class=\"mb-4\">\r\n                        <span class=\"text-sm font-medium ${colorScheme.text}\">Question ${currentQuestionIndex + 1} sur ${currentQuiz.questions.length}</span>\r\n                    </div>\r\n                    \r\n                    <h2 class=\"text-2xl font-bold text-slate-900 leading-relaxed\">\r\n                        ${question.question}\r\n                    </h2>\r\n                    \r\n                    <!-- Tags -->\r\n                    ${question.tags && question.tags.length > 0 ? `\r\n                        <div class=\"flex flex-wrap gap-2 mt-4\">\r\n                            ${question.tags.map(tag => `\r\n                                <span class=\"px-3 py-1 bg-slate-100 text-slate-600 text-xs font-medium rounded-full\">\r\n                                    ${tag}\r\n                                </span>\r\n                            `).join('')}\r\n                        </div>\r\n                    ` : ''}\r\n                </div>\r\n\r\n                <!-- Options de r√©ponse -->\r\n                <div class=\"p-8\">\r\n                    <div class=\"space-y-3\">\r\n                        ${question.options.map(option => `\r\n                            <button data-option-id=\"${option.id}\" \r\n                                    class=\"option-button w-full text-left px-6 py-5 rounded-xl border-2 border-gray-200 hover:border-${currentQuiz.color}-400 hover:bg-${currentQuiz.color}-50 transition-all duration-200 group\">\r\n                                <div class=\"flex items-center gap-4\">\r\n                                    <div class=\"flex-shrink-0 w-10 h-10 rounded-lg ${colorScheme.bg} bg-opacity-10 flex items-center justify-center group-hover:bg-opacity-20 transition-colors\">\r\n                                        <span class=\"text-lg font-bold ${colorScheme.text}\">${option.id}</span>\r\n                                    </div>\r\n                                    <span class=\"text-lg text-slate-700 group-hover:text-slate-900 font-medium\">\r\n                                        ${option.text}\r\n                                    </span>\r\n                                </div>\r\n                            </button>\r\n                        `).join('')}\r\n                    </div>\r\n                </div>\r\n\r\n                <!-- Zone d'explication (cach√©e initialement) -->\r\n                <div id=\"explanation-area\" class=\"hidden px-8 py-6 bg-slate-50 border-t border-gray-200\">\r\n                    <!-- Sera rempli apr√®s la r√©ponse -->\r\n                </div>\r\n\r\n                <!-- Bouton suivant (cach√© initialement) -->\r\n                <div id=\"next-button-area\" class=\"hidden px-8 py-6 border-t border-gray-200\">\r\n                    <div class=\"flex justify-between items-center\">\r\n                        <p class=\"text-sm text-slate-500\">Question suivante dans quelques secondes...</p>\r\n                        <button id=\"next-question-btn\" class=\"${colorScheme.bg} text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-all flex items-center gap-2\">\r\n                            Question suivante\r\n                            <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 7l5 5m0 0l-5 5m5-5H6\"></path>\r\n                            </svg>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n\r\n    // Attacher les √©v√©nements\r\n    attachQuestionEvents();\r\n    updateScoreDisplay();\r\n}\r\n\r\n// Attacher les √©v√©nements aux boutons\r\nfunction attachQuestionEvents() {\r\n    // Options de r√©ponse\r\n    document.querySelectorAll('.option-button').forEach(button => {\r\n        button.addEventListener('click', () => handleAnswer(button.dataset.optionId));\r\n    });\r\n    \r\n    // Bouton suivant\r\n    document.getElementById('next-question-btn')?.addEventListener('click', nextQuestion);\r\n    \r\n    // Bouton quitter\r\n    document.getElementById('quit-quiz-btn')?.addEventListener('click', () => {\r\n        if (confirm('Voulez-vous vraiment quitter le quiz ? Votre progression sera perdue.')) {\r\n            returnToDashboard();\r\n        }\r\n    });\r\n    \r\n    // Bouton focus\r\n    document.getElementById('focus-mode-btn')?.addEventListener('click', toggleFocusMode);\r\n    \r\n    // Bouton pause\r\n    document.getElementById('pause-btn')?.addEventListener('click', togglePause);\r\n}\r\n\r\n// G√©rer la r√©ponse de l'utilisateur\r\nfunction handleAnswer(optionId) {\r\n    const question = currentQuiz.questions[currentQuestionIndex];\r\n    const selectedOption = question.options.find(opt => opt.id === optionId);\r\n    const timeSpent = Math.floor((Date.now() - questionStartTime) / 1000);\r\n    \r\n    // Enregistrer la r√©ponse\r\n    userAnswers.push({\r\n        questionId: question.id,\r\n        question: question.question,\r\n        selectedAnswer: optionId,\r\n        correctAnswer: question.options.find(opt => opt.correct).id,\r\n        isCorrect: selectedOption.correct,\r\n        timeSpent: timeSpent\r\n    });\r\n    \r\n    // Mettre √† jour le streak\r\n    if (selectedOption.correct) {\r\n        currentStreak++;\r\n    } else {\r\n        currentStreak = 0;\r\n    }\r\n    \r\n    // D√©sactiver tous les boutons\r\n    document.querySelectorAll('.option-button').forEach(btn => {\r\n        btn.disabled = true;\r\n        btn.classList.remove('hover:border-indigo-400', 'hover:bg-indigo-50');\r\n    });\r\n    \r\n    // Afficher le r√©sultat\r\n    showAnswerFeedback(optionId, selectedOption.correct, question);\r\n    \r\n    // Mettre √† jour le score\r\n    updateScoreDisplay();\r\n    \r\n    // Passer √† la question suivante apr√®s un d√©lai\r\n    setTimeout(() => {\r\n        document.getElementById('next-button-area')?.classList.remove('hidden');\r\n    }, 1000);\r\n}\r\n\r\n// Afficher le feedback de la r√©ponse\r\nfunction showAnswerFeedback(selectedId, isCorrect, question) {\r\n    const colorScheme = moduleColors[currentQuiz.color];\r\n    const correctOption = question.options.find(opt => opt.correct);\r\n    \r\n    // Colorier les options\r\n    document.querySelectorAll('.option-button').forEach(btn => {\r\n        const optId = btn.dataset.optionId;\r\n        \r\n        if (optId === correctOption.id) {\r\n            // Bonne r√©ponse en vert\r\n            btn.classList.add('border-green-500', 'bg-green-50');\r\n            btn.classList.remove('border-gray-200');\r\n        } else if (optId === selectedId && !isCorrect) {\r\n            // Mauvaise r√©ponse en rouge\r\n            btn.classList.add('border-red-500', 'bg-red-50');\r\n            btn.classList.remove('border-gray-200');\r\n        }\r\n    });\r\n    \r\n    // Afficher l'explication\r\n    const explanationArea = document.getElementById('explanation-area');\r\n    if (explanationArea) {\r\n        explanationArea.innerHTML = `\r\n            <div class=\"flex items-start gap-4\">\r\n                ${isCorrect ? \r\n                    '<div class=\"flex-shrink-0 w-12 h-12 rounded-full bg-green-100 flex items-center justify-center\"><svg class=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path></svg></div>' :\r\n                    '<div class=\"flex-shrink-0 w-12 h-12 rounded-full bg-red-100 flex items-center justify-center\"><svg class=\"w-6 h-6 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path></svg></div>'\r\n                }\r\n                <div class=\"flex-1\">\r\n                    <h3 class=\"text-lg font-bold ${isCorrect ? 'text-green-700' : 'text-red-700'} mb-2\">\r\n                        ${isCorrect ? '‚úÖ Bonne r√©ponse !' : '‚ùå R√©ponse incorrecte'}\r\n                    </h3>\r\n                    <p class=\"text-slate-700 mb-2\"><strong>Explication :</strong> ${question.explanation}</p>\r\n                    ${question.reference ? `<p class=\"text-sm text-slate-500\"><strong>R√©f√©rence :</strong> ${question.reference}</p>` : ''}\r\n                </div>\r\n            </div>\r\n        `;\r\n        explanationArea.classList.remove('hidden');\r\n    }\r\n}\r\n\r\n// Passer √† la question suivante\r\nfunction nextQuestion() {\r\n    questionStartTime = Date.now();\r\n    currentQuestionIndex++;\r\n    \r\n    if (currentQuestionIndex < currentQuiz.questions.length) {\r\n        renderQuestion();\r\n    } else {\r\n        showResults();\r\n    }\r\n}\r\n\r\n// Afficher les r√©sultats finaux\r\nfunction showResults() {\r\n    stopTimer();\r\n    try { window.__QUIZ_ACTIVE = false; } catch (e) {}\r\n    \r\n    const score = Math.round((userAnswers.filter(a => a.isCorrect).length / userAnswers.length) * 100);\r\n    const totalTime = Math.floor((Date.now() - startTime) / 1000);\r\n    const minutes = Math.floor(totalTime / 60);\r\n    const seconds = totalTime % 60;\r\n    \r\n    // Sauvegarder dans Firestore\r\n    saveQuizToFirestore(score, totalTime);\r\n    \r\n    const colorScheme = moduleColors[currentQuiz.color];\r\n    const quizView = document.getElementById('quiz-view');\r\n    \r\n    quizView.innerHTML = `\r\n        <div class=\"min-h-screen bg-gradient-to-br from-slate-50 to-indigo-50 py-12 px-4\">\r\n            <div class=\"max-w-4xl mx-auto\">\r\n                <!-- Carte de r√©sultat principale -->\r\n                <div class=\"bg-white rounded-3xl shadow-2xl overflow-hidden mb-8\">\r\n                    <!-- Header avec score -->\r\n                    <div class=\"bg-gradient-to-r from-${currentQuiz.color}-500 to-${currentQuiz.color}-700 px-8 py-12 text-center text-white\">\r\n                        <h1 class=\"text-4xl font-bold mb-4\">Quiz Termin√© ! üéâ</h1>\r\n                        <div class=\"text-8xl font-bold mb-4\">${score}%</div>\r\n                        <p class=\"text-xl opacity-90\">${userAnswers.filter(a => a.isCorrect).length} / ${userAnswers.length} bonnes r√©ponses</p>\r\n                        <p class=\"text-lg opacity-75 mt-2\">Temps total : ${minutes}:${seconds.toString().padStart(2, '0')}</p>\r\n                    </div>\r\n                    \r\n                    <!-- Message de feedback -->\r\n                    <div class=\"px-8 py-8 text-center border-b border-gray-200\">\r\n                        ${score >= 90 ? \r\n                            '<h2 class=\"text-3xl font-bold text-green-600 mb-2\">üèÜ Excellent !</h2><p class=\"text-slate-600 text-lg\">Performance exceptionnelle ! Vous ma√Ætrisez parfaitement ce module.</p>' :\r\n                        score >= 75 ?\r\n                            '<h2 class=\"text-3xl font-bold text-blue-600 mb-2\">üëè Tr√®s bien !</h2><p class=\"text-slate-600 text-lg\">Bon travail ! Quelques r√©visions et vous serez au top.</p>' :\r\n                        score >= 60 ?\r\n                            '<h2 class=\"text-3xl font-bold text-yellow-600 mb-2\">üìö Pas mal !</h2><p class=\"text-slate-600 text-lg\">C\\'est un bon d√©but. Continuez √† r√©viser pour am√©liorer votre score.</p>' :\r\n                            '<h2 class=\"text-3xl font-bold text-red-600 mb-2\">üí™ Continuez !</h2><p class=\"text-slate-600 text-lg\">Ne vous d√©couragez pas. R√©visez les points faibles et r√©essayez !</p>'\r\n                        }\r\n                    </div>\r\n                    \r\n                    <!-- D√©tails des r√©ponses -->\r\n                    <div class=\"px-8 py-6\">\r\n                        <h3 class=\"text-xl font-bold text-slate-900 mb-4\">D√©tails de vos r√©ponses :</h3>\r\n                        <div class=\"space-y-3 max-h-96 overflow-y-auto\">\r\n                            ${userAnswers.map((answer, index) => `\r\n                                <div class=\"flex items-center justify-between p-4 rounded-lg ${answer.isCorrect ? 'bg-green-50' : 'bg-red-50'}\">\r\n                                    <div class=\"flex items-center gap-3 flex-1\">\r\n                                        <span class=\"${answer.isCorrect ? 'text-green-600' : 'text-red-600'} text-2xl\">\r\n                                            ${answer.isCorrect ? '‚úÖ' : '‚ùå'}\r\n                                        </span>\r\n                                        <div class=\"flex-1\">\r\n                                            <p class=\"font-medium text-slate-900\">Question ${index + 1}</p>\r\n                                            <p class=\"text-sm text-slate-600\">${answer.question}</p>\r\n                                            ${!answer.isCorrect ? `<p class=\"text-xs text-slate-500 mt-1\">Votre r√©ponse : ${answer.selectedAnswer} | Correcte : ${answer.correctAnswer}</p>` : ''}\r\n                                        </div>\r\n                                    </div>\r\n                                    <span class=\"text-sm text-slate-500\">${answer.timeSpent}s</span>\r\n                                </div>\r\n                            `).join('')}\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    <!-- Boutons d'action -->\r\n                    <div class=\"px-8 py-6 flex gap-4\">\r\n                        <button id=\"retry-quiz-btn\" class=\"flex-1 ${colorScheme.bg} text-white px-6 py-3 rounded-xl font-semibold hover:opacity-90 transition-all\">\r\n                            Refaire le quiz\r\n                        </button>\r\n                        <button id=\"return-dashboard-btn\" class=\"flex-1 border-2 border-gray-300 text-slate-700 px-6 py-3 rounded-xl font-semibold hover:bg-slate-50 transition-all\">\r\n                            Retour au tableau de bord\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n    \r\n    // Confettis si bon score\r\n    if (score >= 80) {\r\n        setTimeout(() => launchConfetti(), 500);\r\n    }\r\n    \r\n    // √âv√©nements\r\n    document.getElementById('retry-quiz-btn')?.addEventListener('click', () => {\r\n        startQuiz(currentModule);\r\n    });\r\n    \r\n    document.getElementById('return-dashboard-btn')?.addEventListener('click', returnToDashboard);\r\n}\r\n\r\n// Sauvegarder le r√©sultat dans Firestore\r\nasync function saveQuizToFirestore(score, totalTime) {\r\n    try {\r\n        const user = getCurrentUserUnified();\r\n        if (!user) {\r\n            console.log('Aucun utilisateur - r√©sultat non sauvegard√©');\r\n            return;\r\n        }\r\n        \r\n        // En mode d√©mo, ne pas sauvegarder dans Firestore\r\n        if (isDemoMode()) {\r\n            console.log('Mode d√©mo - r√©sultat non sauvegard√© dans Firestore');\r\n            toast.info('Mode D√©mo : les r√©sultats ne sont pas sauvegard√©s');\r\n            return;\r\n        }\r\n        \r\n        await saveQuizResult(user.uid, {\r\n            module: currentModule,\r\n            month: currentMonth,\r\n            year: currentYear,\r\n            score: score,\r\n            totalQuestions: currentQuiz.questions.length,\r\n            correctAnswers: userAnswers.filter(a => a.isCorrect).length,\r\n            timeSpent: totalTime,\r\n            answers: userAnswers,\r\n            completedAt: new Date()\r\n        });\r\n        \r\n        console.log('‚úÖ R√©sultat sauvegard√© dans Firestore');\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur lors de la sauvegarde:', error);\r\n    }\r\n}\r\n\r\n// Timer du quiz\r\nfunction startTimer() {\r\n    timerInterval = setInterval(() => {\r\n        if (!isPaused) {\r\n            const elapsed = Math.floor((Date.now() - startTime - pausedTime) / 1000);\r\n            const minutes = Math.floor(elapsed / 60);\r\n            const seconds = elapsed % 60;\r\n            const timerElement = document.getElementById('quiz-timer');\r\n            if (timerElement) {\r\n                timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;\r\n            }\r\n        }\r\n    }, 1000);\r\n}\r\n\r\nfunction stopTimer() {\r\n    if (timerInterval) {\r\n        clearInterval(timerInterval);\r\n        timerInterval = null;\r\n    }\r\n}\r\n\r\n// Mettre √† jour l'affichage du score\r\nfunction updateScoreDisplay() {\r\n    if (userAnswers.length === 0) return;\r\n    \r\n    const score = Math.round((userAnswers.filter(a => a.isCorrect).length / userAnswers.length) * 100);\r\n    const scoreElement = document.getElementById('quiz-score');\r\n    if (scoreElement) {\r\n        scoreElement.textContent = `Score: ${score}%`;\r\n    }\r\n}\r\n\r\n// Mode focus\r\nfunction toggleFocusMode() {\r\n    document.body.classList.toggle('focus-mode');\r\n}\r\n\r\n// Pause\r\nfunction togglePause() {\r\n    isPaused = !isPaused;\r\n    const pauseBtn = document.getElementById('pause-btn');\r\n    if (isPaused) {\r\n        pausedTime += Date.now();\r\n        pauseBtn.innerHTML = '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z\"></path><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg> Reprendre';\r\n        toast.warning('Quiz en pause. Cliquez sur \"Reprendre\" pour continuer.', 3000);\r\n    } else {\r\n        pausedTime = Date.now() - pausedTime;\r\n        pauseBtn.innerHTML = '<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg> Pause';\r\n        toast.success('Quiz repris !', 2000);\r\n    }\r\n}\r\n\r\n// Retour au dashboard\r\nfunction returnToDashboard() {\r\n    stopTimer();\r\n    try { window.__QUIZ_ACTIVE = false; } catch (e) {}\r\n    document.getElementById('quiz-view')?.classList.add('view-hidden');\r\n    document.getElementById('dashboard-view')?.classList.remove('view-hidden');\r\n    \r\n    // Mettre √† jour la navigation\r\n    document.querySelectorAll('.nav-link').forEach(link => {\r\n        link.classList.remove('bg-indigo-800', 'text-indigo-100');\r\n        link.classList.add('text-indigo-300');\r\n    });\r\n    document.getElementById('nav-dashboard')?.classList.add('bg-indigo-800', 'text-indigo-100');\r\n    \r\n    // Toast de confirmation\r\n    toast.info('Retour au tableau de bord', 2000);\r\n    \r\n    // Recharger le dashboard pour mettre √† jour les stats\r\n    setTimeout(() => window.location.reload(), 500);\r\n}\r\n","// Dashboard principal - Gestion de l'interface QuizPro\r\nimport { onAuthChange, signInWithGoogle, signOutUser, getCurrentUserUnified, showAdminUIIfAdmin, isDemoMode, deactivateDemoMode } from './auth.js';\r\nimport { startQuiz } from './quiz.js';\r\nimport { \r\n    getUserProfile, \r\n    getAnnualProgress, \r\n    getUserQuizResults,\r\n    updateStreak\r\n} from './firestore-service.js';\r\n\r\n// --- CONSTANTES GLOBALES ---\r\nconst currentMonthIndex = 10; // 0 = Jan, 10 = Nov (Novembre 2025)\r\nconst MONTH_NAMES = [\r\n    'Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin',\r\n    'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'\r\n];\r\n\r\n// Donn√©es des mois (sera remplac√© par les donn√©es Firebase)\r\nlet monthsData = MONTH_NAMES.map(name => ({ name, score: null }));\r\n\r\n// --- √âL√âMENTS DOM ---\r\nconst views = {\r\n    login: document.getElementById('login-view'),\r\n    dashboard: document.getElementById('dashboard-view'),\r\n    moduleSelection: document.getElementById('module-selection-view')\r\n};\r\n\r\nconst elements = {\r\n    modulesGrid: document.getElementById('modules-grid'),\r\n    annualProgressBar: document.getElementById('annual-progress-bar'),\r\n    annualProgressText: document.getElementById('annual-progress-text'),\r\n    moduleSelectionTitle: document.getElementById('module-selection-title'),\r\n    welcomeMessage: document.getElementById('welcome-message'),\r\n    userAvatar: document.getElementById('user-avatar'),\r\n    userName: document.getElementById('user-name'),\r\n    googleSigninBtn: document.getElementById('google-signin-btn'),\r\n    signoutLink: document.getElementById('signout-link')\r\n};\r\n\r\n// --- FONCTIONS DE NAVIGATION ---\r\n\r\nfunction showView(viewId) {\r\n    Object.values(views).forEach(view => {\r\n        if (view) view.classList.add('view-hidden');\r\n    });\r\n    if (views[viewId]) {\r\n        views[viewId].classList.remove('view-hidden');\r\n    } else {\r\n        console.error('‚ùå Vue non trouv√©e:', viewId);\r\n    }\r\n}\r\n\r\nfunction updateActiveNavLink(navId) {\r\n    document.querySelectorAll('.nav-link').forEach(link => {\r\n        link.classList.remove('bg-indigo-800', 'text-indigo-100');\r\n        link.classList.add('text-indigo-300');\r\n    });\r\n    const activeLink = document.getElementById(navId);\r\n    if (activeLink) {\r\n        activeLink.classList.add('bg-indigo-800', 'text-indigo-100');\r\n        activeLink.classList.remove('text-indigo-300');\r\n    }\r\n}\r\n\r\n// --- FONCTIONS DE G√âN√âRATION DE CARTES ---\r\n\r\nfunction createProgressRing(percentage) {\r\n    const r = 54;\r\n    const c = r * 2 * Math.PI;\r\n    const offset = c - (percentage / 100) * c;\r\n\r\n    let progressColorClass = 'text-green-600';\r\n    if (percentage < 80) progressColorClass = 'text-yellow-500';\r\n    if (percentage < 60) progressColorClass = 'text-red-600';\r\n    \r\n    return `\r\n        <svg class=\"w-32 h-32\" viewBox=\"0 0 120 120\">\r\n            <circle class=\"text-gray-200\" stroke-width=\"12\" stroke=\"currentColor\" fill=\"transparent\" r=\"${r}\" cx=\"60\" cy=\"60\" />\r\n            <circle\r\n                class=\"progress-circle ${progressColorClass} transition-all duration-500\"\r\n                stroke-width=\"12\"\r\n                stroke-dasharray=\"${c}\"\r\n                stroke-dashoffset=\"${offset}\"\r\n                stroke-linecap=\"round\"\r\n                stroke=\"currentColor\"\r\n                fill=\"transparent\"\r\n                r=\"${r}\"\r\n                cx=\"60\"\r\n                cy=\"60\"\r\n                transform=\"rotate(-90 60 60)\"\r\n                style=\"stroke-dashoffset: 283;\"\r\n            />\r\n            <text x=\"50%\" y=\"50%\" text-anchor=\"middle\" dy=\".3em\" class=\"text-3xl font-bold fill-current text-slate-800\">\r\n                ${percentage}%\r\n            </text>\r\n        </svg>\r\n    `;\r\n}\r\n\r\nfunction createCompletedCard(month, score) {\r\n    return `\r\n        <div class=\"card-hover bg-white p-5 rounded-xl shadow-lg border border-gray-200 flex flex-col items-center cursor-pointer\">\r\n            <h3 class=\"text-lg font-semibold text-slate-800 mb-3\">${month}</h3>\r\n            ${createProgressRing(score)}\r\n            <span class=\"mt-3 text-sm font-medium text-slate-500\">Score: ${score}%</span>\r\n            <a href=\"#\" class=\"mt-2 text-sm font-medium text-indigo-600 hover:text-indigo-800\">Voir les d√©tails</a>\r\n        </div>\r\n    `;\r\n}\r\n\r\nfunction createLockedCard(month) {\r\n    return `\r\n        <div class=\"bg-slate-50 p-5 rounded-xl border-2 border-dashed border-slate-300 flex flex-col items-center justify-center min-h-[260px] opacity-70\">\r\n            <svg class=\"h-12 w-12 text-slate-400 mb-3\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" /></svg>\r\n            <h3 class=\"text-lg font-semibold text-slate-500\">${month}</h3>\r\n            <span class=\"mt-1 text-sm text-slate-400 text-center\">Disponible le 1er du mois</span>\r\n        </div>\r\n    `;\r\n}\r\n\r\nfunction createIncompleteCard(month) {\r\n    return `\r\n        <div class=\"card-hover bg-gradient-to-br from-slate-100 to-slate-200 p-5 rounded-xl shadow-md border border-slate-300 flex flex-col items-center justify-center min-h-[260px] cursor-pointer transition-all duration-300 hover:shadow-lg\">\r\n            <svg class=\"h-12 w-12 text-slate-500 mb-3\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <h3 class=\"text-lg font-semibold text-slate-700\">${month}</h3>\r\n            <span class=\"mt-2 text-sm text-slate-500 text-center\">Pas encore compl√©t√©</span>\r\n            <div class=\"mt-3 w-full bg-slate-300 rounded-full h-2\">\r\n                <div class=\"bg-slate-400 h-2 rounded-full\" style=\"width: 0%\"></div>\r\n            </div>\r\n            <span class=\"mt-2 text-xs text-slate-400\">0% compl√©t√©</span>\r\n        </div>\r\n    `;\r\n}\r\n\r\nfunction createActiveCard(month) {\r\n    return `\r\n        <div class=\"card-hover relative bg-white p-5 rounded-xl shadow-2xl border-2 border-indigo-500 flex flex-col items-center justify-center min-h-[260px] ring-4 ring-indigo-500/20 cursor-pointer\">\r\n            <span class=\"absolute top-2 right-2 bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-0.5 rounded-full\">ACTIF</span>\r\n            <svg class=\"h-12 w-12 text-indigo-600 mb-3\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" /></svg>\r\n            <h3 class=\"text-xl font-bold text-slate-900\">${month}</h3>\r\n            <p class=\"text-slate-500 text-sm mb-4\">Pr√™t √† √™tre compl√©t√©</p>\r\n            <button class=\"start-quiz-button w-full bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg shadow-md hover:bg-indigo-700 transition-all\">\r\n                D√©marrer le quiz\r\n            </button>\r\n        </div>\r\n    `;\r\n}\r\n\r\n// --- INITIALISATION DU DASHBOARD ---\r\n\r\nfunction calculateStreak() {\r\n    let streak = 0;\r\n    for (let i = currentMonthIndex - 1; i >= 0; i--) {\r\n        if (monthsData[i].score !== null && monthsData[i].score >= 60) {\r\n            streak++;\r\n        } else {\r\n            break;\r\n        }\r\n    }\r\n    return streak;\r\n}\r\n\r\n// Charger les donn√©es Firebase pour le dashboard\r\nasync function loadDashboardData() {\r\n    try {\r\n        const user = getCurrentUserUnified();\r\n        if (!user) {\r\n            console.log('‚ÑπÔ∏è Aucun utilisateur - pas de donn√©es √† charger');\r\n            return;\r\n        }\r\n        \r\n        // En mode d√©mo, ne pas charger depuis Firestore\r\n        if (isDemoMode()) {\r\n            console.log('‚ÑπÔ∏è Mode d√©mo - affichage des donn√©es simul√©es');\r\n            return;\r\n        }\r\n        \r\n        console.log('üìä Chargement des donn√©es du dashboard...');\r\n        \r\n        // Charger le profil utilisateur\r\n        const userProfile = await getUserProfile(user.uid);\r\n        \r\n        // Afficher l'interface admin si l'utilisateur est admin\r\n        if (userProfile) {\r\n            await showAdminUIIfAdmin(userProfile);\r\n        }\r\n        \r\n        // Charger la progression annuelle\r\n        const progress = await getAnnualProgress(user.uid);\r\n        \r\n        // Mettre √† jour monthsData avec les vraies donn√©es\r\n        monthsData = monthsData.map((month, index) => {\r\n            const monthKey = `${month.name} ${new Date().getFullYear()}`;\r\n            if (progress[monthKey]) {\r\n                return {\r\n                    name: month.name,\r\n                    score: progress[monthKey].score\r\n                };\r\n            }\r\n            return month;\r\n        });\r\n        \r\n        // Mettre √† jour le streak\r\n        const streak = await updateStreak(user.uid);\r\n        const streakCountElement = document.getElementById('streak-count');\r\n        if (streakCountElement) {\r\n            streakCountElement.textContent = streak;\r\n        }\r\n        \r\n        console.log('‚úÖ Donn√©es du dashboard charg√©es');\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur chargement donn√©es:', error);\r\n    }\r\n}\r\n\r\nasync function initializeDashboard() {\r\n    if (!elements.modulesGrid) {\r\n        console.error(\"‚ùå L'√©l√©ment 'modules-grid' est introuvable.\");\r\n        return;\r\n    }\r\n    \r\n    // Charger les donn√©es Firebase en premier\r\n    await loadDashboardData();\r\n    \r\n    elements.modulesGrid.innerHTML = '';\r\n    let completedCount = 0;\r\n\r\n    monthsData.forEach((month, index) => {\r\n        let cardHtml = '';\r\n        if (index < currentMonthIndex) {\r\n            // Mois pass√©s : v√©rifier s'ils sont compl√©t√©s ou non\r\n            if (month.score !== null) {\r\n                cardHtml = createCompletedCard(month.name, month.score);\r\n                completedCount++;\r\n            } else {\r\n                // Mois pass√© mais non compl√©t√© - afficher comme \"√† compl√©ter\"\r\n                cardHtml = createIncompleteCard(month.name);\r\n            }\r\n        } else if (index === currentMonthIndex) {\r\n            cardHtml = createActiveCard(month.name);\r\n        } else {\r\n            cardHtml = createLockedCard(month.name);\r\n        }\r\n        elements.modulesGrid.innerHTML += cardHtml;\r\n    });\r\n\r\n    // Mettre √† jour la barre de progression annuelle\r\n    const annualProgressPercent = (completedCount / 12) * 100;\r\n    elements.annualProgressBar.style.width = `${annualProgressPercent}%`;\r\n    elements.annualProgressText.textContent = `${completedCount}/12`;\r\n\r\n    // Mettre √† jour le badge de s√©rie\r\n    const streak = calculateStreak();\r\n    const streakCountElement = document.getElementById('streak-count');\r\n    if (streakCountElement) {\r\n        streakCountElement.textContent = streak;\r\n    }\r\n    const streakBadge = document.getElementById('streak-badge');\r\n    if (streakBadge && streak === 0) {\r\n        streakBadge.style.display = 'none';\r\n    }\r\n\r\n    // Attacher les √©v√©nements\r\n    attachDashboardEvents();\r\n    \r\n    // Cr√©er les graphiques\r\n    setTimeout(() => {\r\n        createSkillsRadarChart();\r\n        createScoresTrendChart();\r\n        createActivityHeatmap();\r\n    }, 500);\r\n}\r\n\r\n// Cr√©er le graphique radar des comp√©tences\r\nfunction createSkillsRadarChart() {\r\n    const ctx = document.getElementById('skills-radar-chart');\r\n    if (!ctx) return;\r\n    \r\n    new Chart(ctx, {\r\n        type: 'radar',\r\n        data: {\r\n            labels: ['Proc√©dures', 'Garanties', 'Documentation', 'Inspection', 'Entretien', 'R√©glementation'],\r\n            datasets: [{\r\n                label: 'Vos Comp√©tences',\r\n                data: [92, 88, 85, 90, 87, 94],\r\n                backgroundColor: 'rgba(99, 102, 241, 0.2)',\r\n                borderColor: 'rgb(99, 102, 241)',\r\n                borderWidth: 2,\r\n                pointBackgroundColor: 'rgb(99, 102, 241)',\r\n                pointBorderColor: '#fff',\r\n                pointHoverBackgroundColor: '#fff',\r\n                pointHoverBorderColor: 'rgb(99, 102, 241)'\r\n            }]\r\n        },\r\n        options: {\r\n            responsive: true,\r\n            maintainAspectRatio: true,\r\n            scales: {\r\n                r: {\r\n                    beginAtZero: true,\r\n                    max: 100,\r\n                    ticks: {\r\n                        stepSize: 20\r\n                    }\r\n                }\r\n            },\r\n            plugins: {\r\n                legend: {\r\n                    display: false\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// Cr√©er le graphique de tendance des scores\r\nfunction createScoresTrendChart() {\r\n    const ctx = document.getElementById('scores-trend-chart');\r\n    if (!ctx) return;\r\n    \r\n    const completedMonths = monthsData.filter((m, i) => i < currentMonthIndex);\r\n    \r\n    new Chart(ctx, {\r\n        type: 'line',\r\n        data: {\r\n            labels: completedMonths.map(m => m.name),\r\n            datasets: [{\r\n                label: 'Score (%)',\r\n                data: completedMonths.map(m => m.score),\r\n                backgroundColor: 'rgba(99, 102, 241, 0.1)',\r\n                borderColor: 'rgb(99, 102, 241)',\r\n                borderWidth: 3,\r\n                fill: true,\r\n                tension: 0.4,\r\n                pointRadius: 5,\r\n                pointHoverRadius: 7,\r\n                pointBackgroundColor: 'rgb(99, 102, 241)',\r\n                pointBorderColor: '#fff',\r\n                pointBorderWidth: 2\r\n            }]\r\n        },\r\n        options: {\r\n            responsive: true,\r\n            maintainAspectRatio: true,\r\n            scales: {\r\n                y: {\r\n                    beginAtZero: true,\r\n                    max: 100,\r\n                    ticks: {\r\n                        callback: function(value) {\r\n                            return value + '%';\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            plugins: {\r\n                legend: {\r\n                    display: false\r\n                },\r\n                tooltip: {\r\n                    callbacks: {\r\n                        label: function(context) {\r\n                            return 'Score: ' + context.parsed.y + '%';\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// Cr√©er la heatmap d'activit√© (style GitHub)\r\nfunction createActivityHeatmap() {\r\n    const container = document.getElementById('activity-heatmap');\r\n    if (!container) return;\r\n    \r\n    const weeksInYear = 52;\r\n    const daysInWeek = 7;\r\n    \r\n    let heatmapHTML = '<div class=\"flex gap-1\">';\r\n    \r\n    for (let week = 0; week < weeksInYear; week++) {\r\n        heatmapHTML += '<div class=\"flex flex-col gap-1\">';\r\n        for (let day = 0; day < daysInWeek; day++) {\r\n            const dayIndex = week * daysInWeek + day;\r\n            let intensity = 0;\r\n            \r\n            // Simuler des donn√©es d'activit√©\r\n            if (dayIndex % 30 < 28) {\r\n                intensity = Math.floor(Math.random() * 4) + 1;\r\n            }\r\n            \r\n            const colors = [\r\n                'bg-slate-100',\r\n                'bg-green-200',\r\n                'bg-green-400',\r\n                'bg-green-600',\r\n                'bg-green-800'\r\n            ];\r\n            \r\n            heatmapHTML += `<div class=\"w-3 h-3 rounded-sm ${colors[intensity]}\" title=\"Activit√©\"></div>`;\r\n        }\r\n        heatmapHTML += '</div>';\r\n    }\r\n    \r\n    heatmapHTML += '</div>';\r\n    container.innerHTML = heatmapHTML;\r\n}\r\n\r\nfunction attachDashboardEvents() {\r\n    // Boutons \"D√©marrer le quiz\"\r\n    document.querySelectorAll('.start-quiz-button').forEach(button => {\r\n        button.addEventListener('click', (e) => {\r\n            e.preventDefault();\r\n            const activeMonth = monthsData[currentMonthIndex].name;\r\n            elements.moduleSelectionTitle.textContent = `Quiz de ${activeMonth}`;\r\n            showView('moduleSelection');\r\n        });\r\n    });\r\n\r\n    // Boutons \"Retour au dashboard\"\r\n    document.querySelectorAll('.back-to-dashboard').forEach(button => {\r\n        button.addEventListener('click', (e) => {\r\n            e.preventDefault();\r\n            showView('dashboard');\r\n            updateActiveNavLink('nav-dashboard');\r\n        });\r\n    });\r\n\r\n    // Cartes de s√©lection de module\r\n    document.querySelectorAll('.module-card').forEach(card => {\r\n        card.addEventListener('click', (e) => {\r\n            e.preventDefault();\r\n            const module = card.getAttribute('data-module');\r\n            console.log('üéØ Module s√©lectionn√©:', module);\r\n            // Lancer l'interface du quiz\r\n            startQuiz(module);\r\n        });\r\n    });\r\n\r\n    // Navigation\r\n    document.getElementById('nav-dashboard')?.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        showView('dashboard');\r\n        updateActiveNavLink('nav-dashboard');\r\n    });\r\n\r\n    // Navigation vers Quiz (ouvre la s√©lection de modules)\r\n    document.getElementById('nav-quiz')?.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        const activeMonth = monthsData[currentMonthIndex].name;\r\n        elements.moduleSelectionTitle.textContent = `Quiz de ${activeMonth}`;\r\n        showView('moduleSelection');\r\n        updateActiveNavLink('nav-quiz');\r\n    });\r\n\r\n    // Navigation vers Mes R√©sultats (demander confirmation si un quiz est en cours)\r\n    document.getElementById('nav-results')?.addEventListener('click', (e) => {\r\n        const target = e.currentTarget;\r\n        if (window.__QUIZ_ACTIVE) {\r\n            e.preventDefault();\r\n            const ok = confirm('Un quiz est en cours. Voulez-vous vraiment quitter ?');\r\n            if (ok && target && target.href) {\r\n                window.location.href = target.href;\r\n            }\r\n        } else {\r\n            console.log('Navigation vers R√©sultats...');\r\n        }\r\n    });\r\n\r\n    // Navigation vers Ressources (demander confirmation si un quiz est en cours)\r\n    document.getElementById('nav-resources')?.addEventListener('click', (e) => {\r\n        const target = e.currentTarget;\r\n        if (window.__QUIZ_ACTIVE) {\r\n            e.preventDefault();\r\n            const ok = confirm('Un quiz est en cours. Voulez-vous vraiment quitter ?');\r\n            if (ok && target && target.href) {\r\n                window.location.href = target.href;\r\n            }\r\n        } else {\r\n            console.log('Navigation vers Ressources...');\r\n        }\r\n    });\r\n}\r\n\r\n// --- GESTION DE L'AUTHENTIFICATION ---\r\n\r\nfunction updateUserProfile(user) {\r\n    if (user) {\r\n        elements.userName.textContent = user.displayName || 'Utilisateur';\r\n        elements.userAvatar.src = user.photoURL || 'https://placehold.co/100x100/667eea/e0e7ff?text=' + (user.displayName?.[0] || 'U');\r\n        \r\n        // Message de bienvenue personnalis√©\r\n        const firstName = user.displayName?.split(' ')[0] || 'Utilisateur';\r\n        elements.welcomeMessage.textContent = `Bonjour ${firstName}, pr√™t √† relever votre d√©fi de ${monthsData[currentMonthIndex].name} ?`;\r\n    }\r\n}\r\n\r\n// --- INITIALISATION PRINCIPALE ---\r\n\r\n// Gestion du th√®me (dark/light mode)\r\nfunction initializeTheme() {\r\n    const savedTheme = localStorage.getItem('theme') || 'light';\r\n    document.documentElement.classList.toggle('dark', savedTheme === 'dark');\r\n    updateThemeButton(savedTheme);\r\n}\r\n\r\nfunction updateThemeButton(theme) {\r\n    const sunIcon = document.getElementById('theme-icon-sun');\r\n    const moonIcon = document.getElementById('theme-icon-moon');\r\n    const themeText = document.getElementById('theme-text');\r\n    \r\n    if (theme === 'dark') {\r\n        sunIcon?.classList.remove('hidden');\r\n        moonIcon?.classList.add('hidden');\r\n        if (themeText) themeText.textContent = 'Mode Clair';\r\n    } else {\r\n        sunIcon?.classList.add('hidden');\r\n        moonIcon?.classList.remove('hidden');\r\n        if (themeText) themeText.textContent = 'Mode Sombre';\r\n    }\r\n}\r\n\r\nfunction toggleTheme() {\r\n    const currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';\r\n    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\r\n    \r\n    document.documentElement.classList.toggle('dark');\r\n    localStorage.setItem('theme', newTheme);\r\n    updateThemeButton(newTheme);\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    console.log('üöÄ Initialisation de QuizPro...');\r\n\r\n    // Initialiser le th√®me\r\n    initializeTheme();\r\n    \r\n    // Bouton toggle th√®me\r\n    document.getElementById('theme-toggle')?.addEventListener('click', toggleTheme);\r\n\r\n    // Gestion de la connexion Google\r\n    elements.googleSigninBtn?.addEventListener('click', signInWithGoogle);\r\n    \r\n    elements.signoutLink?.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        if (confirm('Voulez-vous vraiment vous d√©connecter ?')) {\r\n            // D√©sactiver le mode d√©mo si actif\r\n            if (isDemoMode()) {\r\n                deactivateDemoMode();\r\n                // Rester dans le SPA et afficher l'√©cran de connexion imm√©diatement\r\n                showView('login');\r\n                updateActiveNavLink('nav-dashboard');\r\n            } else {\r\n                signOutUser();\r\n            }\r\n        }\r\n    });\r\n\r\n    // V√©rifier si le mode d√©mo est actif\r\n    const demoModeActive = isDemoMode();\r\n    \r\n    if (demoModeActive) {\r\n        console.log('üé® MODE D√âMO ACTIF - Chargement du dashboard...');\r\n        const demoUser = getCurrentUserUnified();\r\n        if (demoUser) {\r\n            updateUserProfile(demoUser);\r\n            // Afficher l'UI admin en mode d√©mo (le user poss√®de role: 'admin')\r\n            try { showAdminUIIfAdmin(demoUser); } catch (e) { /* no-op */ }\r\n            showView('dashboard');\r\n            updateActiveNavLink('nav-dashboard');\r\n            initializeDashboard();\r\n        } else {\r\n            console.error('‚ùå Mode d√©mo actif mais pas d\\'utilisateur trouv√©');\r\n            showView('login');\r\n        }\r\n    } else {\r\n        // Mode normal - Afficher l'√©cran de connexion\r\n        showView('login');\r\n        \r\n        // √âcouter les changements d'authentification Firebase\r\n        onAuthChange((user) => {\r\n            if (user) {\r\n                console.log('‚úÖ Utilisateur connect√©:', user.displayName);\r\n                updateUserProfile(user);\r\n                showView('dashboard');\r\n                updateActiveNavLink('nav-dashboard');\r\n                initializeDashboard();\r\n            } else {\r\n                console.log('üë§ Aucun utilisateur connect√©');\r\n                showView('login');\r\n            }\r\n        });\r\n    }\r\n\r\n    console.log('‚úÖ QuizPro initialis√© avec succ√®s');\r\n});\r\n"],"names":["showToast","message","type","duration","container","getOrCreateToastContainer","toast","createToastElement","closeToast","config","getToastConfig","configs","showLoadingToast","updateLoadingToast","hadShow","styleElement","firebaseConfig","app","initializeApp","auth","getAuth","db","getFirestore","getDatabase","COLLECTIONS","createOrUpdateUser","user","userRef","doc","userData","Timestamp","getDoc","setDoc","error","getUserProfile","uid","userDoc","saveQuizResult","quizData","resultData","resultRef","addDoc","collection","updateUserStats","updateMonthlyProgress","getUserQuizResults","limitCount","q","query","where","orderBy","limit","querySnapshot","getDocs","results","month","score","progressRef","progressData","getAnnualProgress","year","progress","data","newScore","totalQuizzes","newAverage","updateDoc","updateStreak","currentStreak","monthsSet","result","months","i","longestStreak","provider","GoogleAuthProvider","signInWithGoogle","signInWithPopup","errorMessage","signOutUser","userName","signOut","onAuthChange","callback","onAuthStateChanged","getCurrentUser","showAdminUIIfAdmin","userProfile","navAdminItem","adminBadgeNav","activateDemoMode","demoUser","deactivateDemoMode","isDemoMode","getDemoUser","demoUserJson","getCurrentUserUnified","initIndexPage","googleBtn","handleGoogleSignIn","demoBtn","handleDemoMode","loadingToast","launchConfetti","canvas","ctx","particles","colors","animate","activeParticles","p","index","moduleConfig","currentQuiz","currentQuestionIndex","userAnswers","startTime","timerInterval","questionStartTime","isPaused","pausedTime","currentModule","currentMonth","currentYear","moduleColors","loadQuizFromFirestore","moduleId","monthNumber","toQuestionObjects","opt","saved","demoQuestions","parsed","matchModule","matchMonth","q1","snap","res","d","monthText","normalizedMonth","q2","loadDemoQuestions","resp","idx","e","startQuiz","showLoadingScreen","now","monthNames","questions","showQuizView","renderQuestion","startTimer","updateScoreDisplay","moduleName","quizView","getOrCreateQuizView","question","colorScheme","tag","option","attachQuestionEvents","button","handleAnswer","nextQuestion","returnToDashboard","toggleFocusMode","togglePause","optionId","selectedOption","timeSpent","btn","showAnswerFeedback","selectedId","isCorrect","correctOption","optId","explanationArea","showResults","stopTimer","a","totalTime","minutes","seconds","saveQuizToFirestore","answer","elapsed","timerElement","scoreElement","pauseBtn","link","currentMonthIndex","MONTH_NAMES","monthsData","name","views","elements","showView","viewId","view","updateActiveNavLink","navId","activeLink","createProgressRing","percentage","c","offset","progressColorClass","createCompletedCard","createLockedCard","createIncompleteCard","createActiveCard","calculateStreak","streak","loadDashboardData","monthKey","streakCountElement","initializeDashboard","completedCount","cardHtml","annualProgressPercent","streakBadge","attachDashboardEvents","createSkillsRadarChart","createScoresTrendChart","createActivityHeatmap","completedMonths","m","value","context","weeksInYear","daysInWeek","heatmapHTML","week","day","dayIndex","intensity","activeMonth","card","module","target","updateUserProfile","firstName","initializeTheme","savedTheme","updateThemeButton","theme","sunIcon","moonIcon","themeText","toggleTheme","newTheme"],"mappings":"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"}