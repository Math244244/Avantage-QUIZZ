import{initializeApp as R}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import{getAuth as N,GoogleAuthProvider as T,signInWithPopup as Q,signOut as O,onAuthStateChanged as $}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";import{getFirestore as P,doc as g,Timestamp as c,getDoc as p,setDoc as k,query as v,collection as m,where as f,getDocs as E,updateDoc as b,orderBy as A,limit as B,addDoc as x,deleteDoc as F}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";import{getDatabase as J}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();function w(e,o="info",t=3e3){const r=I(),s=_(e,o);return r.appendChild(s),setTimeout(()=>s.classList.add("show"),10),t>0&&setTimeout(()=>{y(s)},t),s}function I(){let e=document.getElementById("toast-container");return e||(e=document.createElement("div"),e.id="toast-container",e.className="fixed top-4 right-4 z-50 flex flex-col gap-3",document.body.appendChild(e)),e}function _(e,o){const t=document.createElement("div");t.className=`toast toast-${o} transform translate-x-full transition-all duration-300`;const r=M(o);return t.innerHTML=`
        <div class="flex items-center gap-3 bg-white rounded-lg shadow-lg border-l-4 ${r.borderColor} p-4 min-w-[320px] max-w-md">
            <div class="flex-shrink-0">
                ${r.icon}
            </div>
            <div class="flex-1">
                <p class="text-sm font-medium text-slate-900">${e}</p>
            </div>
            <button class="toast-close flex-shrink-0 text-slate-400 hover:text-slate-600 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    `,t.querySelector(".toast-close").addEventListener("click",()=>y(t)),t}function M(e){const o={success:{borderColor:"border-green-500",icon:`<div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>`},error:{borderColor:"border-red-500",icon:`<div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
                <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </div>`},warning:{borderColor:"border-yellow-500",icon:`<div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center">
                <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
            </div>`},info:{borderColor:"border-blue-500",icon:`<div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>`}};return o[e]||o.info}function y(e){e.classList.remove("show"),e.classList.add("translate-x-full"),setTimeout(()=>{e.remove();const o=document.getElementById("toast-container");o&&o.children.length===0&&o.remove()},300)}const ne={success:(e,o)=>w(e,"success",o),error:(e,o)=>w(e,"error",o),warning:(e,o)=>w(e,"warning",o),info:(e,o)=>w(e,"info",o)};function ie(e){const o=I(),t=document.createElement("div");return t.className="toast toast-loading transform translate-x-full transition-all duration-300",t.setAttribute("data-loading","true"),t.innerHTML=`
        <div class="flex items-center gap-3 bg-white rounded-lg shadow-lg border-l-4 border-indigo-500 p-4 min-w-[320px] max-w-md">
            <div class="flex-shrink-0">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
            </div>
            <div class="flex-1">
                <p class="text-sm font-medium text-slate-900">${e}</p>
            </div>
        </div>
    `,o.appendChild(t),setTimeout(()=>t.classList.add("show"),10),t}function ae(e,o,t="success"){if(!e||!e.getAttribute("data-loading"))return;const r=M(t),s=e.classList.contains("show");e.className=`toast toast-${t} transform transition-all duration-300${s?" show":""}`,e.innerHTML=`
        <div class="flex items-center gap-3 bg-white rounded-lg shadow-lg border-l-4 ${r.borderColor} p-4 min-w-[320px] max-w-md">
            <div class="flex-shrink-0">
                ${r.icon}
            </div>
            <div class="flex-1">
                <p class="text-sm font-medium text-slate-900">${o}</p>
            </div>
            <button class="toast-close flex-shrink-0 text-slate-400 hover:text-slate-600 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    `,e.removeAttribute("data-loading"),e.querySelector(".toast-close").addEventListener("click",()=>y(e)),setTimeout(()=>y(e),3e3)}if(typeof document<"u"){const e=document.createElement("style");e.textContent=`
        .toast.show {
            transform: translateX(0) !important;
        }
        
        @media (max-width: 640px) {
            #toast-container {
                left: 1rem;
                right: 1rem;
                top: 1rem;
            }
            
            .toast > div {
                min-width: auto !important;
                width: 100%;
            }
        }
    `,document.head.appendChild(e)}const h=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname==="192.168.1.1"||window.location.port==="3200",S={log:(...e)=>{h&&console.log(...e)},error:(...e)=>{console.error(...e)},warn:(...e)=>{h&&console.warn(...e)},info:(...e)=>{h&&console.info(...e)},group:(...e)=>{h&&console.group(...e)},groupEnd:()=>{h&&console.groupEnd()},table:(...e)=>{h&&console.table(...e)}};console.log(h?"üîß Mode d√©veloppement - Logs activ√©s":"üöÄ Mode production - Logs d√©sactiv√©s (sauf erreurs)");const q={apiKey:"AIzaSyD8w7Em_xdMGplscfGLrnM72vmm4z5ZTr0",authDomain:"avantage-quizz.firebaseapp.com",databaseURL:"https://avantage-quizz-default-rtdb.firebaseio.com",projectId:"avantage-quizz",storageBucket:"avantage-quizz.firebasestorage.app",messagingSenderId:"919472910099",appId:"1:919472910099:web:e17d4c1cdc7a04c6cab4e6"},L=R(q),d=N(L),a=P(L);J(L);S.log("‚úÖ Firebase initialis√© avec succ√®s");S.log("üìä Projet:",q.projectId);S.log("üîê Services: Authentication, Firestore, Realtime Database");const l={users:"users",quizResults:"quizResults",monthlyProgress:"monthlyProgress",questions:"questions"};async function j(e){try{const o=g(a,l.users,e.uid),t={uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,lastLogin:c.now(),updatedAt:c.now()};return(await p(o)).exists()||(t.createdAt=c.now(),t.totalQuizzes=0,t.averageScore=0,t.currentStreak=0,t.longestStreak=0,t.role="user",console.log("üë§ Cr√©ation du profil utilisateur:",e.email)),await k(o,t,{merge:!0}),console.log("‚úÖ Profil utilisateur sauvegard√©"),t}catch(o){throw console.error("‚ùå Erreur cr√©ation utilisateur:",o),o}}async function ce(e){try{const o=g(a,l.users,e),t=await p(o);return t.exists()?t.data():null}catch(o){throw console.error("‚ùå Erreur r√©cup√©ration profil:",o),o}}async function le(e){try{const o=d.currentUser;if(!o)throw new Error("Utilisateur non connect√©");const t={userId:o.uid,userEmail:o.email,moduleId:e.moduleId,moduleName:e.moduleName,score:e.score,correctAnswers:e.correctAnswers,totalQuestions:e.totalQuestions,timeElapsed:e.timeElapsed,answers:e.answers,date:c.now(),month:e.month||new Date().toLocaleDateString("fr-FR",{month:"long",year:"numeric"})},r=await x(m(a,l.quizResults),t);return console.log("‚úÖ R√©sultat de quiz sauvegard√©:",r.id),await Y(o.uid,e.score),await W(o.uid,e.month,e.score),r.id}catch(o){throw console.error("‚ùå Erreur sauvegarde r√©sultat:",o),o}}async function G(e,o=50){try{const t=v(m(a,l.quizResults),f("userId","==",e),A("date","desc"),B(o)),r=await E(t),s=[];return r.forEach(n=>{s.push({id:n.id,...n.data()})}),console.log(`üìä ${s.length} r√©sultats charg√©s`),s}catch(t){throw console.error("‚ùå Erreur r√©cup√©ration r√©sultats:",t),t}}async function W(e,o,t){try{const r=g(a,l.monthlyProgress,`${e}_${o}`),s={userId:e,month:o,score:t,completed:!0,completedAt:c.now(),updatedAt:c.now()};await k(r,s,{merge:!0}),console.log("‚úÖ Progression mensuelle mise √† jour")}catch(r){throw console.error("‚ùå Erreur mise √† jour progression:",r),r}}async function ue(e,o=new Date().getFullYear()){try{const t=v(m(a,l.monthlyProgress),f("userId","==",e)),r=await E(t),s={};return r.forEach(n=>{const i=n.data();s[i.month]=i}),console.log("üìÖ Progression annuelle charg√©e"),s}catch(t){throw console.error("‚ùå Erreur r√©cup√©ration progression:",t),t}}async function Y(e,o){try{const t=g(a,l.users,e),r=await p(t);if(r.exists()){const s=r.data(),n=(s.totalQuizzes||0)+1,u=((s.averageScore||0)*(n-1)+o)/n;await b(t,{totalQuizzes:n,averageScore:Math.round(u),lastQuizDate:c.now(),updatedAt:c.now()}),console.log("üìä Statistiques mises √† jour")}}catch(t){throw console.error("‚ùå Erreur mise √† jour statistiques:",t),t}}async function de(e){try{const o=await G(e,12);let t=0;const r=new Set;for(const u of o)u.score>=60&&r.add(u.month);const s=Array.from(r).sort().reverse();for(let u=0;u<s.length&&(t++,u<s.length-1);u++);const n=g(a,l.users,e),i=await p(n);if(i.exists()){const u=i.data(),C=Math.max(t,u.longestStreak||0);await b(n,{currentStreak:t,longestStreak:C,updatedAt:c.now()}),console.log(`üî• S√©rie mise √† jour: ${t} mois`)}return t}catch(o){throw console.error("‚ùå Erreur mise √† jour s√©rie:",o),o}}async function H(e={}){try{let o=m(a,l.questions);const t=[];e.module&&t.push(f("module","==",e.module)),e.month&&t.push(f("month","==",e.month)),e.year&&t.push(f("year","==",e.year)),t.push(A("createdAt","desc")),t.length>0&&(o=v(o,...t));const r=await E(o),s=[];return r.forEach(n=>{s.push({id:n.id,...n.data()})}),console.log(`üìö ${s.length} questions charg√©es`),s}catch(o){throw console.error("‚ùå Erreur r√©cup√©ration questions:",o),o}}async function D(e){try{const o=d.currentUser;if(!o)throw new Error("Utilisateur non connect√©");if(!e.question||e.question.length<10)throw new Error("La question doit contenir au moins 10 caract√®res");if(!e.options||e.options.length!==4)throw new Error("La question doit avoir exactement 4 options");if(e.correctAnswer===void 0||e.correctAnswer<0||e.correctAnswer>3)throw new Error("La r√©ponse correcte doit √™tre entre 0 et 3");if(!e.explanation||e.explanation.length<20)throw new Error("L'explication doit contenir au moins 20 caract√®res");if(!["auto","loisir","vr","tracteur"].includes(e.module))throw new Error("Module invalide");if(!e.month||e.month<1||e.month>12)throw new Error("Mois invalide");const t={question:e.question.trim(),options:e.options.map(s=>s.trim()),correctAnswer:parseInt(e.correctAnswer),explanation:e.explanation.trim(),module:e.module,month:parseInt(e.month),year:e.year||new Date().getFullYear(),createdAt:c.now(),createdBy:o.uid,updatedAt:c.now()},r=await x(m(a,l.questions),t);return console.log("‚úÖ Question cr√©√©e:",r.id),await U({action:"CREATE_QUESTION",questionId:r.id,adminId:o.uid,adminEmail:o.email}),r.id}catch(o){throw console.error("‚ùå Erreur cr√©ation question:",o),o}}async function me(e){try{const o=d.currentUser;if(!o)throw new Error("Utilisateur non connect√©");const t=g(a,l.questions,e),s=(await p(t)).data();return await F(t),console.log("üóëÔ∏è Question supprim√©e:",e),await U({action:"DELETE_QUESTION",questionId:e,adminId:o.uid,adminEmail:o.email,deletedData:s}),!0}catch(o){throw console.error("‚ùå Erreur suppression question:",o),o}}async function he(e){try{const o=d.currentUser;if(!o)throw new Error("Utilisateur non connect√©");if(!e.module||!e.month||!e.year||!e.questions)throw new Error("Format JSON invalide - champs obligatoires manquants");if(!Array.isArray(e.questions)||e.questions.length===0)throw new Error("Le fichier JSON doit contenir au moins une question");const t=[],r=[];for(let s=0;s<e.questions.length;s++){const n=e.questions[s];try{const i={question:n.question,options:n.options,correctAnswer:n.correctAnswer,explanation:n.explanation,module:e.module,month:e.month,year:e.year},u=await D(i);t.push(u)}catch(i){r.push({index:s,error:i.message}),console.error(`‚ùå Erreur question ${s+1}:`,i.message)}}return await V({importedBy:o.uid,module:e.module,month:e.month,year:e.year,totalQuestions:e.questions.length,successCount:t.length,errorCount:r.length,status:r.length===0?"success":"partial"}),console.log(`‚úÖ Import termin√©: ${t.length}/${e.questions.length} questions import√©es`),{success:t.length,total:e.questions.length,errors:r,ids:t}}catch(o){throw console.error("‚ùå Erreur import JSON:",o),o}}async function K(e={}){try{let o=m(a,l.users);const t=[];e.role&&t.push(f("role","==",e.role)),t.push(A("createdAt","desc")),t.length>0&&(o=v(o,...t));const r=await E(o),s=[];return r.forEach(n=>{s.push({id:n.id,...n.data()})}),console.log(`üë• ${s.length} utilisateurs charg√©s`),s}catch(o){throw console.error("‚ùå Erreur r√©cup√©ration utilisateurs:",o),o}}async function ge(e,o){try{const t=d.currentUser;if(!t)throw new Error("Utilisateur non connect√©");if(!["user","admin"].includes(o))throw new Error('R√¥le invalide - doit √™tre "user" ou "admin"');const r=g(a,l.users,e);return await b(r,{role:o,updatedAt:c.now()}),console.log(`‚úÖ R√¥le mis √† jour pour ${e}: ${o}`),await U({action:"UPDATE_USER_ROLE",targetUserId:e,newRole:o,adminId:t.uid,adminEmail:t.email}),!0}catch(t){throw console.error("‚ùå Erreur mise √† jour r√¥le:",t),t}}async function V(e){try{const o={...e,importedAt:c.now()};await x(m(a,"importLogs"),o),console.log("Log import cree")}catch(o){console.error("Erreur creation log import:",o)}}async function U(e){try{const o={...e,timestamp:c.now()};await x(m(a,"auditLogs"),o),console.log("Log audit cree")}catch(o){console.error("Erreur creation log audit:",o)}}async function fe(){try{const e=await H(),o={total:e.length,byModule:{},byMonth:{},byYear:{}};return e.forEach(t=>{o.byModule[t.module]=(o.byModule[t.module]||0)+1,o.byMonth[t.month]=(o.byMonth[t.month]||0)+1,o.byYear[t.year]=(o.byYear[t.year]||0)+1}),o}catch(e){throw console.error("‚ùå Erreur statistiques questions:",e),e}}async function pe(){try{const e=await K(),o={total:e.length,admins:e.filter(r=>r.role==="admin").length,regularUsers:e.filter(r=>r.role!=="admin").length,activeLastWeek:0,averageScore:0,totalQuizzes:0},t=new Date;return t.setDate(t.getDate()-7),e.forEach(r=>{r.lastLogin&&r.lastLogin.toDate()>t&&o.activeLastWeek++,o.totalQuizzes+=r.totalQuizzes||0,o.averageScore+=r.averageScore||0}),o.averageScore=o.total>0?Math.round(o.averageScore/o.total):0,o}catch(e){throw console.error("‚ùå Erreur statistiques utilisateurs:",e),e}}const z=new T;z.setCustomParameters({prompt:"select_account"});async function we(){try{console.log("üîê Tentative de connexion Google...");const o=(await Q(d,z)).user;return console.log("‚úÖ Authentification r√©ussie:",o.displayName),console.log("üìß Email:",o.email),await j(o),o}catch(e){console.error("‚ùå Erreur de connexion:",e);let o="Erreur lors de la connexion. Veuillez r√©essayer.";throw e.code==="auth/popup-closed-by-user"?o="Connexion annul√©e. Veuillez r√©essayer.":e.code==="auth/popup-blocked"?o="Pop-up bloqu√©e. Autorisez les pop-ups pour ce site.":e.code==="auth/unauthorized-domain"&&(o="Domaine non autoris√©. Configurez Firebase Authentication."),alert(o),e}}async function ye(){try{const e=d.currentUser?.displayName||"Utilisateur";await O(d),console.log("‚úÖ D√©connexion r√©ussie:",e)}catch(e){throw console.error("‚ùå Erreur de d√©connexion:",e),e}}function ve(e){return $(d,o=>{o?console.log("üë§ Utilisateur connect√©:",o.email):console.log("üë§ Aucun utilisateur connect√©"),e(o)})}function X(){return d.currentUser}async function Ee(e){if(!e)return;if(e.role==="admin"){const t=document.getElementById("nav-admin-item");t&&t.classList.remove("hidden");const r=document.getElementById("admin-badge-nav");r&&r.classList.remove("hidden"),console.log("Admin UI elements shown")}}async function xe(){try{console.log("üé≠ Activation du mode d√©mo...");const e={uid:"demo-user-"+Date.now(),email:"demo@avantage-quizz.local",displayName:"Utilisateur D√©mo",photoURL:null,isDemo:!0,role:"admin",createdAt:new Date().toISOString()};return localStorage.setItem("demoUser",JSON.stringify(e)),localStorage.setItem("authMode","demo"),console.log("‚úÖ Mode d√©mo activ√©:",e.displayName),console.log("üìß Email:",e.email),console.log("üëë R√¥le:",e.role),e}catch(e){throw console.error("‚ùå Erreur activation mode d√©mo:",e),e}}function be(){localStorage.removeItem("demoUser"),localStorage.removeItem("authMode"),console.log("‚úÖ Mode d√©mo d√©sactiv√©")}function Z(){return localStorage.getItem("authMode")==="demo"}function ee(){try{const e=localStorage.getItem("demoUser");return e?JSON.parse(e):null}catch(e){return console.error("‚ùå Erreur lecture utilisateur d√©mo:",e),null}}function Ae(){return Z()?ee():X()}export{X as A,we as a,xe as b,le as c,a as d,be as e,ye as f,Ae as g,Ee as h,Z as i,ce as j,ue as k,de as l,ee as m,d as n,ve as o,H as p,fe as q,D as r,ie as s,ne as t,ae as u,me as v,he as w,K as x,pe as y,ge as z};
//# sourceMappingURL=auth-BBQLVo24.js.map
