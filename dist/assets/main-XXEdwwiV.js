const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/auth-8l3HJMhR.js","assets/auth-Xk5lhQZg.css","assets/firestore-service-BEFRl7a-.js","assets/quiz-service-B5kuw85w.js","assets/question-service-C5SNoJR9.js"])))=>i.map(i=>d[i]);
import{p as ne,C as qe,A as R,v as D,w as g,_ as C,D as de,E as ue,F as S,x as v,n as oe,G as me,y as Le,t as De,g as Se,H as Te,a as $e}from"./auth-8l3HJMhR.js";import{getAnalytics as Be,setUserId as _e,setUserProperties as Re,logEvent as K}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";import{query as re,collection as se,where as A,getDocs as ie}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";import{s as ae,b as Oe,M as Qe,a as Pe,c as Ne,n as je}from"./quiz-service-B5kuw85w.js";import{s as d}from"./state-manager-w7-wWzCS.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";let y=null;function H(){try{return typeof window<"u"&&"serviceWorker"in navigator?(y=Be(qe),console.log("‚úÖ Firebase Analytics initialis√©"),y):(console.warn("‚ö†Ô∏è Firebase Analytics non disponible dans cet environnement"),null)}catch(e){return console.error("‚ùå Erreur initialisation Analytics:",e),null}}function Y(e,t={}){if(!y){console.log(`[Analytics] ${e}`,t);return}try{K(y,e,{...t,timestamp:Date.now(),page:window.location.pathname}),console.log(`üìä Event tracked: ${e}`,t)}catch(n){console.error("‚ùå Erreur tracking √©v√©nement:",n)}}function Ve(e,t={}){if(!y){console.error("[Analytics Error]",e,t);return}try{K(y,"exception",{description:e.message||"Unknown error",fatal:!1,error_type:e.name||"Error",error_stack:e.stack?.substring(0,500)||"",...t}),console.error("üìä Error tracked:",e.message)}catch(n){console.error("‚ùå Erreur tracking erreur:",n)}}function ge(e){if(y)try{_e(y,e),console.log("‚úÖ Analytics user set:",e)}catch(t){console.error("‚ùå Erreur d√©finition utilisateur Analytics:",t)}}function he(e){if(y)try{Re(y,e),console.log("‚úÖ Analytics user properties set:",e)}catch(t){console.error("‚ùå Erreur d√©finition propri√©t√©s utilisateur:",t)}}function pe(e,t=window.location.pathname){if(!y){console.log(`[Analytics PageView] ${e} - ${t}`);return}try{K(y,"page_view",{page_title:e,page_location:window.location.href,page_path:t}),console.log(`üìä Page view tracked: ${e}`)}catch(n){console.error("‚ùå Erreur tracking page view:",n)}}function fe(e,t){Y("quiz_start",{module_id:e,month:t,timestamp:Date.now()})}function ve(e,t,n,o){Y("quiz_complete",{module_id:e,score:t,time_elapsed:n,total_questions:o,passed:t>=60})}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{H()}):H(),ne&&ne.onAuthStateChanged(e=>{e&&(ge(e.uid),he({email:e.email||"",display_name:e.displayName||""}))}));const Ue=Object.freeze(Object.defineProperty({__proto__:null,initAnalytics:H,setAnalyticsUser:ge,setAnalyticsUserProperties:he,trackError:Ve,trackEvent:Y,trackPageView:pe,trackQuizComplete:ve,trackQuizStart:fe},Symbol.toStringTag,{value:"Module"})),f={NETWORK:"NETWORK",FIRESTORE:"FIRESTORE",AUTH:"AUTH",VALIDATION:"VALIDATION",UNKNOWN:"UNKNOWN"};class He{constructor(){this.errorLog=[],this.maxLogSize=100,this.setupGlobalHandlers()}setupGlobalHandlers(){window.addEventListener("error",t=>{this.handleError({message:t.message,filename:t.filename,lineno:t.lineno,colno:t.colno,error:t.error,type:f.UNKNOWN},"Global error handler")}),window.addEventListener("unhandledrejection",t=>{this.handleError({message:t.reason?.message||"Unhandled promise rejection",error:t.reason,type:f.UNKNOWN},"Unhandled promise rejection")})}handleError(t,n="Unknown",o={}){const r=this.normalizeError(t,n,o);return this.logError(r),o.showToUser!==!1&&this.showUserMessage(r,o),o.critical&&!R()&&this.sendToFirestore(r).catch(i=>{D.error("Impossible d'envoyer l'erreur √† Firestore:",i)}),r}normalizeError(t,n,o){const r={message:t?.message||String(t)||"Erreur inconnue",stack:t?.stack,context:n,type:this.detectErrorType(t),timestamp:new Date().toISOString(),url:window.location.href,userAgent:navigator.userAgent,...o.metadata};return t?.code&&(r.code=t.code),t?.name&&(r.name=t.name),r}detectErrorType(t){if(!t)return f.UNKNOWN;const n=(t.message||"").toLowerCase(),o=t.code||"";return o==="unavailable"||o==="deadline-exceeded"||n.includes("network")||n.includes("fetch")?f.NETWORK:o==="permission-denied"||o==="unauthenticated"||n.includes("auth")?f.AUTH:o==="invalid-argument"||o==="failed-precondition"||n.includes("validation")?f.VALIDATION:n.includes("firestore")||o.startsWith("firestore")?f.FIRESTORE:f.UNKNOWN}logError(t){this.errorLog.push(t),this.errorLog.length>this.maxLogSize&&this.errorLog.shift();const n=`[${t.type}] ${t.context}: ${t.message}`;t.type===f.NETWORK?D.warn(n,t):D.error(n,t)}showUserMessage(t,n){let o=n.userMessage;if(!o)switch(t.type){case f.NETWORK:o="Probl√®me de connexion. V√©rifiez votre connexion internet.";break;case f.AUTH:o="Erreur d'authentification. Veuillez vous reconnecter.";break;case f.VALIDATION:o="Donn√©es invalides. Veuillez v√©rifier vos informations.";break;case f.FIRESTORE:o="Erreur lors de l'acc√®s aux donn√©es. Veuillez r√©essayer.";break;default:o="Une erreur est survenue. Veuillez r√©essayer."}const r=n.duration||(t.type===f.NETWORK?8e3:5e3);g.error(o,r)}async sendToFirestore(t){try{const{trackError:n}=await C(async()=>{const{trackError:o}=await Promise.resolve().then(()=>Ue);return{trackError:o}},void 0);n(new Error(t.message),{error_type:t.type,error_source:t.source,user_id:t.userId||"anonymous"})}catch{console.warn("Analytics non disponible pour tracking erreur")}try{const{db:n}=await C(async()=>{const{db:a}=await import("./auth-8l3HJMhR.js").then(c=>c.I);return{db:a}},__vite__mapDeps([0,1])),{collection:o,addDoc:r,Timestamp:i}=await C(async()=>{const{collection:a,addDoc:c,Timestamp:u}=await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");return{collection:a,addDoc:c,Timestamp:u}},[]),{isCurrentUserAdmin:s}=await C(async()=>{const{isCurrentUserAdmin:a}=await import("./firestore-service-BEFRl7a-.js");return{isCurrentUserAdmin:a}},__vite__mapDeps([2,0,1,3,4]));if(!await s())return;await r(o(n,"errorLogs"),{...t,timestamp:i.now()})}catch(n){console.error("Impossible d'envoyer l'erreur √† Firestore:",n)}}getRecentErrors(t=10){return this.errorLog.slice(-t)}clearErrorLog(){this.errorLog=[]}}const Fe=new He,We={maxRetries:3,initialDelay:1e3,maxDelay:3e4,backoffMultiplier:2,retryableErrors:["unavailable","deadline-exceeded","internal","aborted"],onRetry:null};function le(e,t){if(!e)return!1;const n=e.code||"",o=(e.message||"").toLowerCase();return n==="unavailable"||n==="deadline-exceeded"||o.includes("network")||o.includes("fetch failed")?!0:t.some(r=>n===r||o.includes(r.toLowerCase()))}function Ge(e,t,n,o){const r=t*Math.pow(o,e);return Math.min(r,n)}function Ke(e){return new Promise(t=>setTimeout(t,e))}async function Ye(e,t={}){const n={...We,...t};let o;try{return await e()}catch(r){if(o=r,!le(r,n.retryableErrors))throw r}for(let r=0;r<n.maxRetries;r++){const i=Ge(r,n.initialDelay,n.maxDelay,n.backoffMultiplier);n.onRetry?n.onRetry(r+1,i,o):D.warn(`Nouvelle tentative ${r+1}/${n.maxRetries} dans ${i}ms...`),await Ke(i);try{return await e()}catch(s){if(o=s,!le(s,n.retryableErrors))throw s;if(r===n.maxRetries-1)throw Fe.handleError(s,"Retry handler - Max retries reached",{showToUser:!0,userMessage:`√âchec apr√®s ${n.maxRetries} tentatives. Veuillez r√©essayer plus tard.`}),s}}throw o}async function Ze(e,t={}){return Ye(e,{...t,retryableErrors:["unavailable","deadline-exceeded","internal","aborted","resource-exhausted"],onRetry:t.onRetry||((n,o)=>{D.warn(`Retry Firestore ${n}/${t.maxRetries||3} dans ${o}ms...`)})})}const Xe="avantage-quizz-sync",Je=1,p="sync-queue";let b=null;async function w(){return b||new Promise((e,t)=>{const n=indexedDB.open(Xe,Je);n.onerror=()=>t(n.error),n.onsuccess=()=>{b=n.result,e(b)},n.onupgradeneeded=o=>{const r=o.target.result;if(!r.objectStoreNames.contains(p)){const i=r.createObjectStore(p,{keyPath:"id",autoIncrement:!0});i.createIndex("timestamp","timestamp",{unique:!1}),i.createIndex("type","type",{unique:!1}),i.createIndex("status","status",{unique:!1})}}})}class et{constructor(){this.isProcessing=!1,this.listeners=new Set}async add(t,n,o={}){await w();const r={type:t,operation:this.serializeOperation(n),data:o,timestamp:Date.now(),status:"pending",retries:0,maxRetries:3};return new Promise((i,s)=>{const c=b.transaction([p],"readwrite").objectStore(p).add(r);c.onsuccess=()=>{const u=c.result;console.log(`üì• Op√©ration ajout√©e √† la file d'attente: ${t} (ID: ${u})`),this.notifyListeners("added",{id:u,type:t}),i(u)},c.onerror=()=>s(c.error)})}serializeOperation(t){return{name:t.name||"anonymous"}}async getAll(){return await w(),new Promise((t,n)=>{const s=b.transaction([p],"readonly").objectStore(p).index("status").getAll("pending");s.onsuccess=()=>t(s.result),s.onerror=()=>n(s.error)})}async markCompleted(t){return await w(),new Promise((n,o)=>{const i=b.transaction([p],"readwrite").objectStore(p),s=i.get(t);s.onsuccess=()=>{const l=s.result;if(l){l.status="completed";const a=i.put(l);a.onsuccess=()=>{console.log(`‚úÖ Op√©ration compl√©t√©e: ${l.type} (ID: ${t})`),this.notifyListeners("completed",{id:t,type:l.type}),n()},a.onerror=()=>o(a.error)}else n()},s.onerror=()=>o(s.error)})}async markFailed(t,n){return await w(),new Promise((o,r)=>{const s=b.transaction([p],"readwrite").objectStore(p),l=s.get(t);l.onsuccess=()=>{const a=l.result;if(a){a.retries++,a.retries>=a.maxRetries?(a.status="failed",a.error=n?.message||"Unknown error"):a.status="pending";const c=s.put(a);c.onsuccess=()=>{a.status==="failed"?(console.error(`‚ùå Op√©ration √©chou√©e d√©finitivement: ${a.type} (ID: ${t})`),this.notifyListeners("failed",{id:t,type:a.type,error:n})):console.warn(`‚ö†Ô∏è Op√©ration √©chou√©e, r√©essai ${a.retries}/${a.maxRetries}: ${a.type} (ID: ${t})`),o()},c.onerror=()=>r(c.error)}else o()},l.onerror=()=>r(l.error)})}async remove(t){return await w(),new Promise((n,o)=>{const s=b.transaction([p],"readwrite").objectStore(p).delete(t);s.onsuccess=()=>{console.log(`üóëÔ∏è Op√©ration supprim√©e: ID ${t}`),n()},s.onerror=()=>o(s.error)})}async processQueue(t={}){if(this.isProcessing){console.log("‚è≥ Traitement d√©j√† en cours...");return}if(!navigator.onLine){console.log("üì¥ Hors ligne, synchronisation report√©e");return}this.isProcessing=!0,console.log("üîÑ D√©but du traitement de la file d'attente...");try{const n=await this.getAll();if(n.length===0)return console.log("‚úÖ Aucune op√©ration en attente"),this.isProcessing=!1,{success:0,failed:0};console.log(`üìã ${n.length} op√©ration(s) en attente`);let o=0,r=0;for(const i of n)try{const s=t[i.type];if(!s){console.warn(`‚ö†Ô∏è Aucun handler pour le type: ${i.type}`),await this.markFailed(i.id,new Error(`No handler for type: ${i.type}`)),r++;continue}await s(i.data),await this.markCompleted(i.id),await this.remove(i.id),o++}catch(s){console.error(`‚ùå Erreur traitement op√©ration ${i.id}:`,s),await this.markFailed(i.id,s),r++}return console.log(`‚úÖ Traitement termin√©: ${o} r√©ussies, ${r} √©chou√©es`),this.notifyListeners("processed",{success:o,failed:r}),{success:o,failed:r}}catch(n){throw console.error("‚ùå Erreur traitement file d'attente:",n),n}finally{this.isProcessing=!1}}async getStats(){return await w(),new Promise((t,n)=>{const i=b.transaction([p],"readonly").objectStore(p).getAll();i.onsuccess=()=>{const s=i.result,l={total:s.length,pending:s.filter(a=>a.status==="pending").length,completed:s.filter(a=>a.status==="completed").length,failed:s.filter(a=>a.status==="failed").length};t(l)},i.onerror=()=>n(i.error)})}async cleanCompleted(){await w();const t=Date.now()-10080*60*1e3;return new Promise((n,o)=>{const l=b.transaction([p],"readwrite").objectStore(p).index("timestamp").openCursor();let a=0;l.onsuccess=c=>{const u=c.target.result;if(u){const m=u.value;m.status==="completed"&&m.timestamp<t&&(u.delete(),a++),u.continue()}else console.log(`üßπ ${a} op√©ration(s) compl√©t√©e(s) nettoy√©e(s)`),n(a)},l.onerror=()=>o(l.error)})}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notifyListeners(t,n){this.listeners.forEach(o=>{try{o(t,n)}catch(r){console.error("Erreur listener:",r)}})}}const F=new et;w().catch(e=>{console.error("‚ùå Erreur initialisation IndexedDB:",e)});const tt=Object.freeze(Object.defineProperty({__proto__:null,syncQueue:F},Symbol.toStringTag,{value:"Module"}));class nt{constructor(){this.isOnline=navigator.onLine,this.listeners=new Set,this.indicatorElement=null,this.setupEventListeners(),this.createIndicator()}setupEventListeners(){window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),setInterval(()=>this.checkConnection(),3e4)}async checkConnection(){try{const t=await fetch("https://firestore.googleapis.com",{method:"HEAD",mode:"no-cors",cache:"no-cache"});this.isOnline||this.handleOnline()}catch{this.isOnline&&this.handleOffline()}}async handleOnline(){if(!this.isOnline){this.isOnline=!0,console.log("üåê Connexion r√©tablie"),this.updateIndicator(),this.notifyListeners("online"),g.success("Connexion r√©tablie. Synchronisation en cours...",3e3);try{const{saveQuizResult:t}=await C(async()=>{const{saveQuizResult:o}=await import("./firestore-service-BEFRl7a-.js");return{saveQuizResult:o}},__vite__mapDeps([2,0,1,3,4])),n=await F.getStats();if(n.pending>0){console.log(`üì§ Synchronisation de ${n.pending} op√©ration(s) en attente...`);const o={quizResult:async i=>{await t(i)}},r=await F.processQueue(o);r.success>0&&g.success(`${r.success} op√©ration(s) synchronis√©e(s) avec succ√®s`,3e3),r.failed>0&&g.warning(`${r.failed} op√©ration(s) n'ont pas pu √™tre synchronis√©es`,3e3)}}catch(t){console.error("‚ùå Erreur synchronisation:",t),g.error("Erreur lors de la synchronisation",3e3)}}}handleOffline(){this.isOnline&&(this.isOnline=!1,console.log("üì¥ Connexion perdue"),this.updateIndicator(),this.notifyListeners("offline"),g.warning("Connexion perdue. Les donn√©es seront sauvegard√©es localement.",5e3))}createIndicator(){this.indicatorElement=document.createElement("div"),this.indicatorElement.id="offline-indicator",this.indicatorElement.className="fixed bottom-4 right-4 z-50 flex items-center gap-2 px-4 py-2 rounded-lg shadow-lg transition-all duration-300",this.indicatorElement.style.display="none",document.body.appendChild(this.indicatorElement),this.updateIndicator()}updateIndicator(){this.indicatorElement&&(this.isOnline?this.indicatorElement.style.display="none":(this.indicatorElement.style.display="flex",this.indicatorElement.className="fixed bottom-4 right-4 z-50 flex items-center gap-2 px-4 py-2 rounded-lg shadow-lg bg-yellow-500 text-white transition-all duration-300",this.indicatorElement.innerHTML=`
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414"></path>
                </svg>
                <span class="text-sm font-medium">Mode hors ligne</span>
            `))}getStatus(){return{isOnline:this.isOnline,timestamp:Date.now()}}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notifyListeners(t){this.listeners.forEach(n=>{try{n(t,this.getStatus())}catch(o){console.error("Erreur listener offline:",o)}})}}new nt;console.log("Initialisation de la page d accueil...");document.addEventListener("DOMContentLoaded",ot);function ot(){console.log("üìÑ DOM charg√© - configuration du bouton de connexion...");const e=document.getElementById("google-signin-btn");e?(e.addEventListener("click",rt),console.log("‚úÖ Bouton Google configur√©")):console.warn("‚ö†Ô∏è Bouton Google non trouv√©")}async function rt(){console.log("üîê Clic sur connexion Google...");const e=de("Connexion en cours...");try{const t=await ue();S(e,`Bienvenue ${t.displayName} !`,"success"),setTimeout(()=>{window.location.reload()},800)}catch(t){console.error("‚ùå Erreur connexion Google:",t);let n="Erreur lors de la connexion";t.code==="auth/popup-closed-by-user"?n="Connexion annul√©e":t.code==="auth/popup-blocked"?n="Pop-up bloqu√©e. Autorisez les pop-ups.":t.code==="auth/unauthorized-domain"?n="Domaine non autoris√© dans Firebase":t.code==="auth/network-request-failed"&&(n="Erreur r√©seau. V√©rifiez votre connexion."),S(e,n,"error")}}function st(){const e=document.createElement("canvas");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.pointerEvents="none",e.style.zIndex="9999",document.body.appendChild(e);const t=e.getContext("2d");e.width=window.innerWidth,e.height=window.innerHeight;const n=[],o=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F7DC6F","#BB8FCE","#85C1E2"];for(let i=0;i<150;i++)n.push({x:Math.random()*e.width,y:e.height+Math.random()*100,size:Math.random()*8+4,speedY:-(Math.random()*3+3),speedX:Math.random()*6-3,color:o[Math.floor(Math.random()*o.length)],rotation:Math.random()*360,rotationSpeed:Math.random()*10-5,gravity:.15,opacity:1});function r(){t.clearRect(0,0,e.width,e.height);let i=0;n.forEach((s,l)=>{s.speedY+=s.gravity,s.y+=s.speedY,s.x+=s.speedX,s.rotation+=s.rotationSpeed,s.y>e.height-100&&(s.opacity-=.02),s.opacity>0&&s.y<e.height+50&&(i++,t.save(),t.translate(s.x,s.y),t.rotate(s.rotation*Math.PI/180),t.globalAlpha=s.opacity,t.fillStyle=s.color,t.fillRect(-s.size/2,-s.size/2,s.size,s.size),t.restore())}),i>0?requestAnimationFrame(r):e.remove()}r()}const W={auto:{name:"AT-AVE-AVEX",color:"indigo",label:"Auto"},loisir:{name:"VTT, Motoneige, etc.",color:"cyan",label:"Loisir"},vr:{name:"V√©hicules R√©cr√©atifs",color:"orange",label:"VR"},tracteur:{name:"√âquipement Agricole",color:"green",label:"Tracteur"}},L=()=>d.get("currentQuiz"),it=e=>d.set("currentQuiz",e),_=()=>d.get("currentQuestionIndex"),xe=e=>d.set("currentQuestionIndex",e),I=()=>d.get("userAnswers"),ye=e=>d.set("userAnswers",e),G=()=>d.get("startTime"),at=e=>d.set("startTime",e),lt=()=>d.get("timerInterval"),be=e=>d.set("timerInterval",e),ct=()=>d.get("questionStartTime"),we=e=>d.set("questionStartTime",e),dt=()=>d.get("currentStreak"),Ee=e=>d.set("currentStreak",e),Z=()=>d.get("isPaused"),$=e=>d.set("isPaused",e),X=()=>d.get("pausedDuration"),O=e=>d.set("pausedDuration",e),J=()=>d.get("pauseStartedAt"),q=e=>d.set("pauseStartedAt",e),T=()=>d.get("currentModule"),ut=e=>d.set("currentModule",e),M=()=>d.get("currentMonth"),mt=e=>d.set("currentMonth",e),V=()=>d.get("currentYear"),gt=e=>d.set("currentYear",e),ht=()=>d.get("hasCurrentQuestionBeenAnswered"),Q=e=>d.set("hasCurrentQuestionBeenAnswered",e),pt=()=>d.get("quizEventDelegationInitialized"),ft=e=>d.set("quizEventDelegationInitialized",e),ee={indigo:{bg:"bg-indigo-600",text:"text-indigo-600",border:"border-indigo-600"},cyan:{bg:"bg-cyan-600",text:"text-cyan-600",border:"border-cyan-600"},orange:{bg:"bg-orange-600",text:"text-orange-600",border:"border-orange-600"},green:{bg:"bg-green-600",text:"text-green-600",border:"border-green-600"}};async function vt(e,t,n){console.log(`üì• Chargement des questions: module=${e}, mois=${t}, ann√©e=${n}`);const o=r=>{const i=r.data();return{id:r.id,question:i.question,options:i.options.map((s,l)=>({id:String.fromCharCode(65+l),text:s,correct:l===i.correctAnswer})),explanation:i.explanation||"Pas d'explication disponible",reference:i.reference||"",tags:i.tags||[]}};if(R()){console.log("üìù Mode d√©mo : Chargement des questions simul√©es pour le quiz...");const i=localStorage.getItem("avantage-quizz-demo-questions");let s=[];if(i)try{const l=JSON.parse(i);console.log(`üíæ ${l.length} questions charg√©es depuis localStorage`),s=l.map(a=>({id:a.id,question:a.question,options:a.options.map((c,u)=>({id:String.fromCharCode(65+u),text:c,correct:u===a.correctAnswer})),explanation:a.explanation||"Pas d'explication disponible",reference:a.reference||"",tags:a.tags||[]})),s=s.filter(a=>{const c=!e||l.find(m=>m.id===a.id)?.module===e,u=!t||l.find(m=>m.id===a.id)?.month===t;return c&&u})}catch{console.warn("‚ö†Ô∏è Erreur lecture localStorage, utilisation questions par d√©faut")}return s.length===0&&(console.log("üì¶ Utilisation questions par d√©faut (aucune en localStorage)"),s=[{id:"demo-1",question:"Quelle est la vitesse maximale autoris√©e sur une autoroute au Qu√©bec ?",options:[{id:"A",text:"100 km/h",correct:!1},{id:"B",text:"110 km/h",correct:!1},{id:"C",text:"120 km/h",correct:!1},{id:"D",text:"100 km/h (conditions normales)",correct:!0}],explanation:"La vitesse maximale sur autoroute au Qu√©bec est de 100 km/h, sauf indication contraire.",reference:"Code de la s√©curit√© routi√®re du Qu√©bec",tags:["vitesse","autoroute"]},{id:"demo-2",question:"√Ä quelle distance minimale devez-vous vous arr√™ter derri√®re un autobus scolaire dont les feux clignotent ?",options:[{id:"A",text:"3 m√®tres",correct:!1},{id:"B",text:"5 m√®tres",correct:!0},{id:"C",text:"10 m√®tres",correct:!1},{id:"D",text:"15 m√®tres",correct:!1}],explanation:"Vous devez vous arr√™ter √† au moins 5 m√®tres d'un autobus scolaire.",reference:"Article 460 CSR",tags:["autobus","s√©curit√©"]},{id:"demo-3",question:"Quel est le taux d'alcool√©mie maximal pour conduire au Qu√©bec ?",options:[{id:"A",text:"0.05",correct:!1},{id:"B",text:"0.08",correct:!0},{id:"C",text:"0.10",correct:!1},{id:"D",text:"0.00",correct:!1}],explanation:"Le taux maximal est de 0.08 pour conducteurs exp√©riment√©s.",reference:"Code criminel du Canada",tags:["alcool","s√©curit√©"]},{id:"demo-4",question:"Combien de points d'inaptitude entra√Æne un exc√®s de vitesse de 30 km/h ?",options:[{id:"A",text:"2 points",correct:!1},{id:"B",text:"3 points",correct:!0},{id:"C",text:"4 points",correct:!1},{id:"D",text:"5 points",correct:!1}],explanation:"Un exc√®s de 21 √† 30 km/h entra√Æne 3 points.",reference:"SAAQ",tags:["vitesse","points"]},{id:"demo-5",question:"Quelle est la distance de s√©curit√© recommand√©e entre v√©hicules ?",options:[{id:"A",text:"1 seconde",correct:!1},{id:"B",text:"2 secondes",correct:!0},{id:"C",text:"3 secondes",correct:!1},{id:"D",text:"5 secondes",correct:!1}],explanation:"La r√®gle des 2 secondes est recommand√©e.",reference:"Guide SAAQ",tags:["distance","s√©curit√©"]}]),console.log(`‚úÖ ${s.length} questions d√©mo charg√©es pour le quiz`),s}try{let r=re(se(oe,"questions"),A("module","==",e),A("month","==",t),A("year","==",n)),i=await ie(r);if(!i.empty){const u=[];return i.forEach(m=>u.push(o(m))),console.log(`‚úÖ ${u.length} questions (mois num√©rique)`),u}const l=["janvier","f√©vrier","mars","avril","mai","juin","juillet","ao√ªt","septembre","octobre","novembre","d√©cembre"][t-1],a=l.charAt(0).toUpperCase()+l.slice(1).toLowerCase();let c=re(se(oe,"questions"),A("module","==",e),A("month","==",a),A("year","==",n));if(i=await ie(c),!i.empty){const u=[];return i.forEach(m=>u.push(o(m))),console.log(`‚úÖ ${u.length} questions (mois texte)`),u}return console.warn("‚ö†Ô∏è Aucune question trouv√©e pour ces crit√®res (num√©rique/texte)"),[]}catch(r){throw console.error("‚ùå Erreur lors du chargement des questions:",r),r}}async function xt(e,t,n){try{const o=await fetch("/test-questions-valides.json");if(!o.ok)return[];const r=await o.json(),s=["janvier","f√©vrier","mars","avril","mai","juin","juillet","ao√ªt","septembre","octobre","novembre","d√©cembre"][t-1];return r.filter(a=>a.module===e&&a.year===n&&(a.month===s||a.month===t)).map((a,c)=>({id:`demo-${e}-${c}`,question:a.question,options:a.options.map((u,m)=>({id:String.fromCharCode(65+m),text:u,correct:m===a.correctAnswer})),explanation:a.explanation||"Pas d'explication disponible",reference:a.reference||"",tags:a.tags||[]}))}catch(o){return console.warn("Demo questions fallback error:",o),[]}}async function ke(e){const t=W[e];if(!t){console.error("Module de quiz non trouv√©:",e),g.error("Module non trouv√©. Veuillez r√©essayer.");return}const n=de(`Chargement du quiz ${t.label}...`);yt(t.label);try{const{getCurrentMonthNumber:o,getCurrentYear:r,normalizeMonthFormat:i}=await C(async()=>{const{getCurrentMonthNumber:m,getCurrentYear:P,normalizeMonthFormat:N}=await import("./quiz-service-B5kuw85w.js").then(j=>j.m);return{getCurrentMonthNumber:m,getCurrentYear:P,normalizeMonthFormat:N}},__vite__mapDeps([3,0,1])),s=o(),l=r(),a=i(s,l);mt(a),gt(l),ut(e);try{window.__QUIZ_ACTIVE=!0}catch{}let c=await vt(e,s,l);if(c.length===0&&R()&&(console.log("‚ÑπÔ∏è Mode D√©mo: chargement des questions locales de test"),c=await xt(e,s,l)),c.length===0){S(n,"Aucune question disponible","error");const m=M();g.error(`Aucune question trouv√©e pour ${t.label} en ${m}.

Contactez l'administrateur.`,5e3);return}const u=M();it({name:`Quiz ${t.label} - ${u}`,module:t.name,color:t.color,questions:c}),xe(0),ye([]),at(Date.now()),we(Date.now()),fe(e,M()),Ee(0),$(!1),O(0),q(null),Q(!1),bt(),ze(),It(),te(),S(n,`${c.length} questions charg√©es !`,"success")}catch(o){E(),console.error("‚ùå Erreur lors du d√©marrage du quiz:",o),S(n,"Erreur de chargement","error"),g.error("Erreur lors du chargement du quiz. Veuillez r√©essayer.",4e3)}}function yt(e){const t=Ce();t.innerHTML=`
        <div class="min-h-screen flex items-center justify-center">
            <div class="text-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-indigo-600 mx-auto mb-6"></div>
                        <h2 class="text-2xl font-bold text-slate-900 mb-2">Chargement du quiz ${v(e)}</h2>
                <p class="text-slate-600">R√©cup√©ration des questions...</p>
            </div>
        </div>
    `,t.classList.remove("view-hidden")}function bt(){document.getElementById("dashboard-view")?.classList.add("view-hidden"),document.getElementById("module-selection-view")?.classList.add("view-hidden"),document.getElementById("login-view")?.classList.add("view-hidden"),Ce().classList.remove("view-hidden")}function Ce(){let e=document.getElementById("quiz-view");return e||(e=document.createElement("div"),e.id="quiz-view",document.querySelector("main").appendChild(e)),wt(e),e}function wt(e){pt()||!e||(e.addEventListener("click",t=>{const n=t.target.closest(".option-button");if(n&&!n.disabled){const l=n.dataset.optionId;l&&Et(l);return}if(t.target.closest("#next-question-btn")){t.preventDefault(),Ct();return}if(t.target.closest("#quit-quiz-btn")){t.preventDefault(),confirm("Voulez-vous vraiment quitter le quiz ? Votre progression sera perdue.")&&Ae();return}if(t.target.closest("#focus-mode-btn")){t.preventDefault(),Mt();return}if(t.target.closest("#pause-btn")){t.preventDefault(),qt();return}}),ft(!0))}function ze(){const e=L(),t=_(),n=e.questions[t],o=document.getElementById("quiz-view"),r=ee[e.color];Q(!1),o.innerHTML=`
        <!-- En-t√™te du quiz -->
        <div class="bg-white border-b border-gray-200 shadow-sm">
            <div class="max-w-5xl mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-xl font-bold text-slate-900">${v(e.name)}</h1>
                        <p class="text-sm text-slate-500">Question ${t+1} sur ${e.questions.length}</p>
                    </div>
                    <div class="flex items-center gap-6">
                        <button id="focus-mode-btn" class="text-sm font-medium text-slate-600 hover:text-slate-900 flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                            Focus
                        </button>
                        <button id="pause-btn" class="text-sm font-medium text-slate-600 hover:text-slate-900 flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Pause
                        </button>
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span id="quiz-score" class="text-sm font-bold text-indigo-600">Score: 0%</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span id="quiz-timer" class="text-sm font-medium text-slate-600">0:00</span>
                        </div>
                        <button id="quit-quiz-btn" class="text-sm font-medium text-slate-600 hover:text-slate-900">
                            Quitter
                        </button>
                    </div>
                </div>
                
                <!-- Barre de progression -->
                <div class="mt-4 w-full bg-gray-200 rounded-full h-2">
                    <div class="${r.bg} h-2 rounded-full transition-all duration-300" style="width: ${(t+1)/e.questions.length*100}%"></div>
                </div>
            </div>
        </div>

        <!-- Contenu de la question -->
        <div class="max-w-5xl mx-auto px-6 py-8">
            <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
                
                <!-- En-t√™te de question -->
                <div class="px-8 py-6 bg-gradient-to-r from-slate-50 to-white border-b border-gray-100">
                    <div class="mb-4">
                        <span class="text-sm font-medium ${r.text}">Question ${t+1} sur ${e.questions.length}</span>
                    </div>
                    
                    <h2 class="text-2xl font-bold text-slate-900 leading-relaxed">
                        ${v(n.question)}
                    </h2>
                    
                    <!-- Tags -->
                    ${n.tags&&n.tags.length>0?`
                        <div class="flex flex-wrap gap-2 mt-4">
                            ${n.tags.map(i=>`
                                <span class="px-3 py-1 bg-slate-100 text-slate-600 text-xs font-medium rounded-full">
                                    ${v(i)}
                                </span>
                            `).join("")}
                        </div>
                    `:""}
                </div>

                <!-- Options de r√©ponse -->
                <div class="p-8">
                    <div class="space-y-3">
                        ${n.options.map(i=>`
                            <button data-option-id="${v(i.id)}" 
                                    class="option-button w-full text-left px-6 py-5 rounded-xl border-2 border-gray-200 hover:border-${e.color}-400 hover:bg-${e.color}-50 transition-all duration-200 group">
                                <div class="flex items-center gap-4">
                                    <div class="flex-shrink-0 w-10 h-10 rounded-lg ${r.bg} bg-opacity-10 flex items-center justify-center group-hover:bg-opacity-20 transition-colors">
                                        <span class="text-lg font-bold ${r.text}">${v(i.id)}</span>
                                    </div>
                                    <span class="text-lg text-slate-700 group-hover:text-slate-900 font-medium">
                                        ${v(i.text)}
                                    </span>
                                </div>
                            </button>
                        `).join("")}
                    </div>
                </div>

                <!-- Zone d'explication (cach√©e initialement) -->
                <div id="explanation-area" class="hidden px-8 py-6 bg-slate-50 border-t border-gray-200">
                    <!-- Sera rempli apr√®s la r√©ponse -->
                </div>

                <!-- Bouton suivant (cach√© initialement) -->
                <div id="next-button-area" class="hidden px-8 py-6 border-t border-gray-200">
                    <div class="flex justify-between items-center">
                        <p class="text-sm text-slate-500">Question suivante dans quelques secondes...</p>
                        <button id="next-question-btn" class="${r.bg} text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-all flex items-center gap-2">
                            Question suivante
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `,te()}function Et(e){if(ht())return;const t=L(),n=_(),o=ct(),r=t.questions[n],i=r.options.find(c=>c.id===e),s=Math.floor((Date.now()-o)/1e3);Q(!0);const l=I();l.push({questionId:r.id,question:r.question,selectedAnswer:e,correctAnswer:r.options.find(c=>c.correct).id,isCorrect:i.correct,timeSpent:s}),ye(l);let a=dt();i.correct?a++:a=0,Ee(a),document.querySelectorAll(".option-button").forEach(c=>{c.disabled=!0,c.classList.remove("hover:border-indigo-400","hover:bg-indigo-50")}),kt(e,i.correct,r),te(),setTimeout(()=>{document.getElementById("next-button-area")?.classList.remove("hidden")},1e3)}function kt(e,t,n){const o=L();ee[o.color];const r=n.options.find(s=>s.correct);document.querySelectorAll(".option-button").forEach(s=>{const l=s.dataset.optionId;l===r.id?(s.classList.add("border-green-500","bg-green-50"),s.classList.remove("border-gray-200")):l===e&&!t&&(s.classList.add("border-red-500","bg-red-50"),s.classList.remove("border-gray-200"))});const i=document.getElementById("explanation-area");i&&(i.innerHTML=`
            <div class="flex items-start gap-4">
                ${t?'<div class="flex-shrink-0 w-12 h-12 rounded-full bg-green-100 flex items-center justify-center"><svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div>':'<div class="flex-shrink-0 w-12 h-12 rounded-full bg-red-100 flex items-center justify-center"><svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></div>'}
                <div class="flex-1">
                    <h3 class="text-lg font-bold ${t?"text-green-700":"text-red-700"} mb-2">
                        ${t?"‚úÖ Bonne r√©ponse !":"‚ùå R√©ponse incorrecte"}
                    </h3>
                    <p class="text-slate-700 mb-2"><strong>Explication :</strong> ${v(n.explanation)}</p>
                    ${n.reference?`<p class="text-sm text-slate-500"><strong>R√©f√©rence :</strong> ${v(n.reference)}</p>`:""}
                </div>
            </div>
        `,i.classList.remove("hidden"))}function Ct(){we(Date.now());const e=_();xe(e+1);const t=L();_()<t.questions.length?ze():zt()}function zt(){E();try{window.__QUIZ_ACTIVE=!1}catch{}const e=I();if(e.length===0){console.error("‚ùå Aucune r√©ponse enregistr√©e - quiz invalide"),g.error("Aucune r√©ponse enregistr√©e. Le quiz ne peut pas √™tre compl√©t√©.");return}const t=e.filter(h=>h.isCorrect).length,n=Math.round(t/e.length*100);if(isNaN(n)||n<0||n>100){console.error("‚ùå Score invalide calcul√©:",n),g.error("Erreur de calcul du score. Contactez le support.");return}const o=X(),r=Z(),i=J();let s=o;r&&i&&(s+=Date.now()-i);const l=G(),a=Math.max(0,Math.floor((Date.now()-l-s)/1e3));$(!1),q(null),O(0);const c=Math.floor(a/60),u=a%60;At(n,a);const m=L();if(!m){console.error("‚ùå currentQuiz non d√©fini dans showResults"),g.error("Erreur: Impossible d'afficher les r√©sultats. Veuillez r√©essayer.");return}const P=ee[m.color],N=document.getElementById("quiz-view");N.innerHTML=`
        <div class="min-h-screen bg-gradient-to-br from-slate-50 to-indigo-50 py-12 px-4">
            <div class="max-w-4xl mx-auto">
                <!-- Carte de r√©sultat principale -->
                <div class="bg-white rounded-3xl shadow-2xl overflow-hidden mb-8">
                    <!-- Header avec score -->
                    <div class="bg-gradient-to-r from-${m.color}-500 to-${m.color}-700 px-8 py-12 text-center text-white">
                        <h1 class="text-4xl font-bold mb-4">Quiz Termin√© ! üéâ</h1>
                        <div class="text-8xl font-bold mb-4">${n}%</div>
                        <p class="text-xl opacity-90">${e.filter(h=>h.isCorrect).length} / ${e.length} bonnes r√©ponses</p>
                        <p class="text-lg opacity-75 mt-2">Temps total : ${c}:${u.toString().padStart(2,"0")}</p>
                    </div>
                    
                    <!-- Message de feedback -->
                    <div class="px-8 py-8 text-center border-b border-gray-200">
                        ${n>=90?'<h2 class="text-3xl font-bold text-green-600 mb-2">üèÜ Excellent !</h2><p class="text-slate-600 text-lg">Performance exceptionnelle ! Vous ma√Ætrisez parfaitement ce module.</p>':n>=75?'<h2 class="text-3xl font-bold text-blue-600 mb-2">üëè Tr√®s bien !</h2><p class="text-slate-600 text-lg">Bon travail ! Quelques r√©visions et vous serez au top.</p>':n>=60?`<h2 class="text-3xl font-bold text-yellow-600 mb-2">üìö Pas mal !</h2><p class="text-slate-600 text-lg">C'est un bon d√©but. Continuez √† r√©viser pour am√©liorer votre score.</p>`:'<h2 class="text-3xl font-bold text-red-600 mb-2">üí™ Continuez !</h2><p class="text-slate-600 text-lg">Ne vous d√©couragez pas. R√©visez les points faibles et r√©essayez !</p>'}
                    </div>
                    
                    <!-- D√©tails des r√©ponses -->
                    <div class="px-8 py-6">
                        <h3 class="text-xl font-bold text-slate-900 mb-4">D√©tails de vos r√©ponses :</h3>
                        <div class="space-y-3 max-h-96 overflow-y-auto">
                            ${e.map((h,Me)=>`
                                <div class="flex items-center justify-between p-4 rounded-lg ${h.isCorrect?"bg-green-50":"bg-red-50"}">
                                    <div class="flex items-center gap-3 flex-1">
                                        <span class="${h.isCorrect?"text-green-600":"text-red-600"} text-2xl">
                                            ${h.isCorrect?"‚úÖ":"‚ùå"}
                                        </span>
                                        <div class="flex-1">
                                            <p class="font-medium text-slate-900">Question ${Me+1}</p>
                                            <p class="text-sm text-slate-600">${h.question}</p>
                                            ${h.isCorrect?"":`<p class="text-xs text-slate-500 mt-1">Votre r√©ponse : ${h.selectedAnswer} | Correcte : ${h.correctAnswer}</p>`}
                                        </div>
                                    </div>
                                    <span class="text-sm text-slate-500">${h.timeSpent}s</span>
                                </div>
                            `).join("")}
                        </div>
                    </div>
                    
                    <!-- Boutons d'action -->
                    <div class="px-8 py-6 flex gap-4">
                        <button id="retry-quiz-btn" class="flex-1 ${P.bg} text-white px-6 py-3 rounded-xl font-semibold hover:opacity-90 transition-all">
                            Refaire le quiz
                        </button>
                        <button id="return-dashboard-btn" class="flex-1 border-2 border-gray-300 text-slate-700 px-6 py-3 rounded-xl font-semibold hover:bg-slate-50 transition-all">
                            Retour au tableau de bord
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `,n>=80&&setTimeout(()=>st(),500);const j=Math.floor((Date.now()-G())/1e3);ve(T(),n,j,m?.questions?.length||0),document.getElementById("retry-quiz-btn")?.addEventListener("click",()=>{const h=T();h?ke(h):g.error("Erreur: Impossible de red√©marrer le quiz.")}),document.getElementById("return-dashboard-btn")?.addEventListener("click",Ae)}async function At(e,t){try{if(!me()){console.log("Aucun utilisateur - r√©sultat non sauvegard√©"),E();return}if(R()){console.log("Mode d√©mo - r√©sultat non sauvegard√© dans Firestore"),g.info("Mode D√©mo : les r√©sultats ne sont pas sauvegard√©s"),E();return}const o=T(),r=M(),i=V(),s=L(),l=I(),a=W[o]||{},c={moduleId:o,moduleName:a.name||s.module||o,score:e,correctAnswers:l.filter(u=>u.isCorrect).length,totalQuestions:s.questions.length,timeElapsed:t,answers:l,month:r,year:i};await Ze(()=>ae(c),{maxRetries:3,onRetry:(u,m)=>{g.info(`Nouvelle tentative de sauvegarde ${u}/3...`,3e3)}}),g.success("R√©sultat sauvegard√© avec succ√®s !",3e3),console.log("‚úÖ R√©sultat sauvegard√© dans Firestore")}catch(n){console.error("‚ùå Erreur lors de la sauvegarde:",n),E(),g.error("Erreur lors de la sauvegarde. Le r√©sultat sera sauvegard√© localement et synchronis√© plus tard.",8e3);try{const o=T(),r=M(),i=V(),s=I(),l={moduleId:o,moduleName:W[o]?.name||o,score:e,correctAnswers:s.filter(c=>c.isCorrect).length,totalQuestions:s.length,timeElapsed:t,answers:s,month:r,year:i},{syncQueue:a}=await C(async()=>{const{syncQueue:c}=await Promise.resolve().then(()=>tt);return{syncQueue:c}},void 0);await a.add("quizResult",async c=>{await ae(c)},l),console.log("‚úÖ R√©sultat ajout√© √† la file d'attente de synchronisation")}catch(o){console.error("‚ùå Erreur ajout √† la file d'attente:",o);try{const r=`quiz_result_${Date.now()}`;localStorage.setItem(r,JSON.stringify({score:e,totalTime:t,moduleId:T(),month:M(),year:V(),userAnswers:I(),timestamp:Date.now()}))}catch(r){console.error("‚ùå Erreur sauvegarde locale de secours:",r)}}}}function It(){E();const e=setInterval(()=>{const t=G();if(t===null)return;const n=X(),o=Z(),r=J();let i=n;o&&r&&(i+=Date.now()-r);const s=Date.now()-t-i,l=Math.max(0,Math.floor(s/1e3)),a=Math.floor(l/60),c=l%60,u=document.getElementById("quiz-timer");u&&(u.textContent=`${a}:${c.toString().padStart(2,"0")}`)},1e3);be(e)}function E(){const e=lt();e&&(clearInterval(e),be(null)),q(null)}window.addEventListener("beforeunload",()=>{E()});document.addEventListener("visibilitychange",()=>{});function te(){const e=I();if(e.length===0)return;const t=Math.round(e.filter(o=>o.isCorrect).length/e.length*100),n=document.getElementById("quiz-score");n&&(n.textContent=`Score: ${t}%`)}function Mt(){document.body.classList.toggle("focus-mode")}function qt(){const e=document.getElementById("pause-btn");if(!e)return;if(!Z())$(!0),q(Date.now()),e.innerHTML='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Reprendre',g.warning('Quiz en pause. Cliquez sur "Reprendre" pour continuer.',3e3);else{$(!1);const n=J();if(n){const o=X();O(o+(Date.now()-n))}q(null),e.innerHTML='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Pause',g.success("Quiz repris !",2e3)}}function Ae(){E();try{window.__QUIZ_ACTIVE=!1}catch{}$(!1),O(0),q(null),Q(!1),document.getElementById("quiz-view")?.classList.add("view-hidden"),document.getElementById("dashboard-view")?.classList.remove("view-hidden"),document.querySelectorAll(".nav-link").forEach(e=>{e.classList.remove("bg-indigo-800","text-indigo-100"),e.classList.add("text-indigo-300")}),document.getElementById("nav-dashboard")?.classList.add("bg-indigo-800","text-indigo-100"),g.info("Retour au tableau de bord",2e3),setTimeout(()=>window.location.reload(),500)}const k=Oe(),Lt=Qe;d.set("monthsData",Lt.map(e=>({name:e,score:null})));d.set("currentMonthIndex",k);const U={login:document.getElementById("login-view"),dashboard:document.getElementById("dashboard-view"),moduleSelection:document.getElementById("module-selection-view")},x={modulesGrid:document.getElementById("modules-grid"),annualProgressBar:document.getElementById("annual-progress-bar"),annualProgressText:document.getElementById("annual-progress-text"),moduleSelectionTitle:document.getElementById("module-selection-title"),welcomeMessage:document.getElementById("welcome-message"),userAvatar:document.getElementById("user-avatar"),userName:document.getElementById("user-name"),googleSigninBtn:document.getElementById("google-signin-btn"),signoutLink:document.getElementById("signout-link")};d.set("dashboardEventDelegationAttached",!1);function z(e){Object.values(U).forEach(t=>{t&&t.classList.add("view-hidden")}),U[e]?U[e].classList.remove("view-hidden"):console.error("‚ùå Vue non trouv√©e:",e)}function B(e){document.querySelectorAll(".nav-link").forEach(n=>{n.classList.remove("bg-indigo-800","text-indigo-100"),n.classList.add("text-indigo-300")});const t=document.getElementById(e);t&&(t.classList.add("bg-indigo-800","text-indigo-100"),t.classList.remove("text-indigo-300"))}function Dt(e,t){const o=(s=>s>=90?{badgeText:"üèÜ Excellent"}:s>=75?{badgeText:"‚≠ê Tr√®s bien"}:s>=60?{badgeText:"‚úì Bien"}:{badgeText:"‚úì Passable"})(t),r=v(e),i=v(t);return`
        <div class="module-card module-card--completed">
            <div class="module-card-header">
                <div class="module-card-icon">
                    <svg fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="module-card-badge">${o.badgeText}</div>
            </div>
            <h3 class="module-card-title">${r}</h3>
            <p class="module-card-subtitle">Quiz compl√©t√©</p>
            <p class="module-card-progress-label">Score obtenu</p>
            <div class="module-card-progress-bar">
                <div class="module-card-progress-fill" style="width: ${i}%"></div>
            </div>
            <span class="text-sm font-semibold text-ap-red-dark">Score: ${i}%</span>
        </div>
    `}function St(e){return`
        <div class="module-card module-card--locked">
            <div class="module-card-header">
                <div class="module-card-icon">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </div>
                <div class="module-card-badge">üîí Verrouill√©</div>
            </div>
            <h3 class="module-card-title">${v(e)}</h3>
            <p class="module-card-subtitle">Disponible le 1er du mois</p>
            <p class="module-card-progress-label">Progression</p>
            <div class="module-card-progress-bar">
                <div class="module-card-progress-fill" style="width: 0%"></div>
            </div>
            <span class="text-sm text-ap-gray-600">Pas encore accessible</span>
        </div>
    `}function Tt(e){return`
        <div class="module-card module-card--incomplete">
            <div class="module-card-header">
                <div class="module-card-icon">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div class="module-card-badge">‚ö†Ô∏è √Ä compl√©ter</div>
            </div>
            <h3 class="module-card-title">${v(e)}</h3>
            <p class="module-card-subtitle">Mois manqu√© - Rattrapez-le !</p>
            <p class="module-card-progress-label">Progression</p>
            <div class="module-card-progress-bar">
                <div class="module-card-progress-fill" style="width: 0%"></div>
            </div>
            <span class="text-sm font-semibold text-ap-warning">0% compl√©t√©</span>
        </div>
    `}function $t(e){return`
        <div class="module-card module-card--active">
            <div class="module-card-header">
                <div class="module-card-icon">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                </div>
                <div class="module-card-badge">‚ö° Actif</div>
            </div>
            <h3 class="module-card-title">${v(e)}</h3>
            <p class="module-card-subtitle">Pr√™t √† √™tre compl√©t√© !</p>
            <p class="module-card-progress-label">Progression</p>
            <div class="module-card-progress-bar">
                <div class="module-card-progress-fill" style="width: 0%"></div>
            </div>
            <button class="start-quiz-button btn-primary w-full mt-2 flex items-center justify-center gap-2">
                <span>D√©marrer</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                </svg>
            </button>
        </div>
    `}function Bt(){const e=d.get("monthsData");let t=0;for(let n=k-1;n>=0&&(e[n].score!==null&&e[n].score>=60);n--)t++;return t}async function _t(){try{const e=me();if(!e){console.log("‚ÑπÔ∏è Aucun utilisateur - pas de donn√©es √† charger");return}console.log("üìä Chargement des donn√©es du dashboard...");const t=await Se(e.uid);t&&await Te(t);const n=await Pe(e.uid),o=Ne();let r=d.get("monthsData");r=r.map((l,a)=>{const c=je(l.name,o);return n[c]?{name:l.name,score:n[c].score}:l});const i=await $e(e.uid),s=document.getElementById("streak-count");s&&(s.textContent=i),console.log("‚úÖ Donn√©es du dashboard charg√©es")}catch(e){console.error("‚ùå Erreur chargement donn√©es:",e)}}async function Rt(){if(!x.modulesGrid){console.error("‚ùå L'√©l√©ment 'modules-grid' est introuvable.");return}await _t(),x.modulesGrid.innerHTML="";let e=0;d.get("monthsData").forEach((s,l)=>{let a="";l<k?s.score!==null?(a=Dt(s.name,s.score),e++):a=Tt(s.name):l===k?a=$t(s.name):a=St(s.name),x.modulesGrid.innerHTML+=a});const n=e/12*100;x.annualProgressBar.style.width=`${n}%`,x.annualProgressText.textContent=`${e}/12`;const o=Bt(),r=document.getElementById("streak-count");r&&(r.textContent=o);const i=document.getElementById("streak-badge");i&&o===0&&(i.style.display="none"),jt(),setTimeout(()=>{Ot(),Qt(),Pt()},500)}function Ot(){const e=document.getElementById("skills-radar-chart");e&&new Chart(e,{type:"radar",data:{labels:["Proc√©dures","Garanties","Documentation","Inspection","Entretien","R√©glementation"],datasets:[{label:"Vos Comp√©tences",data:[92,88,85,90,87,94],backgroundColor:"rgba(99, 102, 241, 0.2)",borderColor:"rgb(99, 102, 241)",borderWidth:2,pointBackgroundColor:"rgb(99, 102, 241)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(99, 102, 241)"}]},options:{responsive:!0,maintainAspectRatio:!0,scales:{r:{beginAtZero:!0,max:100,ticks:{stepSize:20}}},plugins:{legend:{display:!1}}}})}function Qt(){const e=document.getElementById("scores-trend-chart");if(!e)return;const n=d.get("monthsData").filter((o,r)=>r<k);new Chart(e,{type:"line",data:{labels:n.map(o=>o.name),datasets:[{label:"Score (%)",data:n.map(o=>o.score),backgroundColor:"rgba(99, 102, 241, 0.1)",borderColor:"rgb(99, 102, 241)",borderWidth:3,fill:!0,tension:.4,pointRadius:5,pointHoverRadius:7,pointBackgroundColor:"rgb(99, 102, 241)",pointBorderColor:"#fff",pointBorderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!0,scales:{y:{beginAtZero:!0,max:100,ticks:{callback:function(o){return o+"%"}}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(o){return"Score: "+o.parsed.y+"%"}}}}}})}function Pt(){const e=document.getElementById("activity-heatmap");if(!e)return;const t=52,n=7;let o='<div class="flex gap-1">';for(let r=0;r<t;r++){o+='<div class="flex flex-col gap-1">';for(let i=0;i<n;i++){const s=r*n+i;let l=0;s%30<28&&(l=Math.floor(Math.random()*4)+1),o+=`<div class="w-3 h-3 rounded-sm ${["bg-slate-100","bg-green-200","bg-green-400","bg-green-600","bg-green-800"][l]}" title="Activit√©"></div>`}o+="</div>"}o+="</div>",e.innerHTML=o}let ce=!1;function Nt(){ce||(ce=!0,console.log("üîß Attachement des listeners de navigation (une seule fois)..."),document.getElementById("nav-dashboard")?.addEventListener("click",e=>{e.preventDefault(),z("dashboard"),B("nav-dashboard")}),document.getElementById("nav-quiz")?.addEventListener("click",e=>{e.preventDefault();const n=d.get("monthsData")[k]?.name||"ce mois";x.moduleSelectionTitle.textContent=`Quiz de ${n}`,z("moduleSelection"),B("nav-quiz")}),document.getElementById("nav-results")?.addEventListener("click",e=>{e.preventDefault();const t=e.currentTarget;window.__QUIZ_ACTIVE?confirm("Un quiz est en cours. Voulez-vous vraiment quitter ?")&&t&&t.href&&(window.location.href=t.href):t&&t.href&&(window.location.href=t.href)}),document.getElementById("nav-resources")?.addEventListener("click",e=>{e.preventDefault();const t=e.currentTarget;window.__QUIZ_ACTIVE?confirm("Un quiz est en cours. Voulez-vous vraiment quitter ?")&&t&&t.href&&(window.location.href=t.href):t&&t.href&&(window.location.href=t.href)}),console.log("‚úÖ Listeners de navigation attach√©s"))}function jt(){d.get("dashboardEventDelegationAttached")||(document.addEventListener("click",e=>{if(e.target.closest(".start-quiz-button")){e.preventDefault();const i=d.get("monthsData")[k]?.name||"ce mois";x.moduleSelectionTitle.textContent=`Quiz de ${i}`,z("moduleSelection"),B("nav-quiz");return}if(e.target.closest(".back-to-dashboard")){e.preventDefault(),z("dashboard"),B("nav-dashboard");return}const o=e.target.closest(".module-card");if(o){e.preventDefault();const r=o.getAttribute("data-module");r&&ke(r)}}),d.set("dashboardEventDelegationAttached",!0))}function Vt(e){if(e){x.userName.textContent=e.displayName||"Utilisateur",x.userAvatar.src=e.photoURL||"https://placehold.co/100x100/667eea/e0e7ff?text="+(e.displayName?.[0]||"U");const t=d.get("monthsData"),n=e.displayName?.split(" ")[0]||"Utilisateur",o=t[k]?.name||"ce mois";x.welcomeMessage.textContent=`Bonjour ${n}, pr√™t √† relever votre d√©fi de ${o} ?`}}function Ut(){const e=localStorage.getItem("theme")||"light";document.documentElement.classList.toggle("dark",e==="dark"),Ie(e)}function Ie(e){const t=document.getElementById("theme-icon-sun"),n=document.getElementById("theme-icon-moon"),o=document.getElementById("theme-text");e==="dark"?(t?.classList.remove("hidden"),n?.classList.add("hidden"),o&&(o.textContent="Mode Clair")):(t?.classList.add("hidden"),n?.classList.remove("hidden"),o&&(o.textContent="Mode Sombre"))}function Ht(){const t=(document.documentElement.classList.contains("dark")?"dark":"light")==="dark"?"light":"dark";document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",t),Ie(t)}document.addEventListener("DOMContentLoaded",()=>{pe("Dashboard","/index.html"),console.log("üöÄ Initialisation de QuizPro..."),Ut(),Nt(),document.getElementById("theme-toggle")?.addEventListener("click",Ht),x.googleSigninBtn?.addEventListener("click",ue),x.signoutLink?.addEventListener("click",e=>{e.preventDefault(),confirm("Voulez-vous vraiment vous d√©connecter ?")&&Le()}),z("login"),De(e=>{e?(console.log("‚úÖ Utilisateur connect√©:",e.displayName),Vt(e),z("dashboard"),B("nav-dashboard"),Rt()):(console.log("üë§ Aucun utilisateur connect√©"),z("login"))}),console.log("‚úÖ QuizPro initialis√© avec succ√®s")});
//# sourceMappingURL=main-XXEdwwiV.js.map
