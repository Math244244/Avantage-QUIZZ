{"version":3,"file":"auth-VsLOkEMq.js","sources":["../../js/toast.js","../../js/logger.js","../../js/firebase-config.js","../../js/firestore-service.js","../../js/auth.js"],"sourcesContent":["// Syst√®me de Notifications Toast - Feedback utilisateur moderne\r\n// Utilisation: showToast('Message', 'success|error|warning|info')\r\n\r\n/**\r\n * Afficher une notification toast\r\n * @param {string} message - Le message √† afficher\r\n * @param {string} type - Type: 'success', 'error', 'warning', 'info'\r\n * @param {number} duration - Dur√©e en ms (d√©faut: 3000)\r\n */\r\nexport function showToast(message, type = 'info', duration = 3000) {\r\n    const container = getOrCreateToastContainer();\r\n    \r\n    const toast = createToastElement(message, type);\r\n    container.appendChild(toast);\r\n    \r\n    // Animation d'entr√©e\r\n    setTimeout(() => toast.classList.add('show'), 10);\r\n    \r\n    // Auto-fermeture\r\n    if (duration > 0) {\r\n        setTimeout(() => {\r\n            closeToast(toast);\r\n        }, duration);\r\n    }\r\n    \r\n    return toast;\r\n}\r\n\r\n/**\r\n * Cr√©er ou r√©cup√©rer le conteneur de toasts\r\n */\r\nfunction getOrCreateToastContainer() {\r\n    let container = document.getElementById('toast-container');\r\n    \r\n    if (!container) {\r\n        container = document.createElement('div');\r\n        container.id = 'toast-container';\r\n        container.className = 'fixed top-4 right-4 z-50 flex flex-col gap-3';\r\n        document.body.appendChild(container);\r\n    }\r\n    \r\n    return container;\r\n}\r\n\r\n/**\r\n * Cr√©er un √©l√©ment toast\r\n */\r\nfunction createToastElement(message, type) {\r\n    const toast = document.createElement('div');\r\n    toast.className = `toast toast-${type} transform translate-x-full transition-all duration-300`;\r\n    \r\n    const config = getToastConfig(type);\r\n    \r\n    toast.innerHTML = `\r\n        <div class=\"flex items-center gap-3 bg-white rounded-lg shadow-lg border-l-4 ${config.borderColor} p-4 min-w-[320px] max-w-md\">\r\n            <div class=\"flex-shrink-0\">\r\n                ${config.icon}\r\n            </div>\r\n            <div class=\"flex-1\">\r\n                <p class=\"text-sm font-medium text-slate-900\">${message}</p>\r\n            </div>\r\n            <button class=\"toast-close flex-shrink-0 text-slate-400 hover:text-slate-600 transition-colors\">\r\n                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                </svg>\r\n            </button>\r\n        </div>\r\n    `;\r\n    \r\n    // √âv√©nement de fermeture\r\n    const closeBtn = toast.querySelector('.toast-close');\r\n    closeBtn.addEventListener('click', () => closeToast(toast));\r\n    \r\n    return toast;\r\n}\r\n\r\n/**\r\n * Configuration par type de toast\r\n */\r\nfunction getToastConfig(type) {\r\n    const configs = {\r\n        success: {\r\n            borderColor: 'border-green-500',\r\n            icon: `<div class=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center\">\r\n                <svg class=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path>\r\n                </svg>\r\n            </div>`\r\n        },\r\n        error: {\r\n            borderColor: 'border-red-500',\r\n            icon: `<div class=\"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center\">\r\n                <svg class=\"w-5 h-5 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                </svg>\r\n            </div>`\r\n        },\r\n        warning: {\r\n            borderColor: 'border-yellow-500',\r\n            icon: `<div class=\"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center\">\r\n                <svg class=\"w-5 h-5 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"></path>\r\n                </svg>\r\n            </div>`\r\n        },\r\n        info: {\r\n            borderColor: 'border-blue-500',\r\n            icon: `<div class=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center\">\r\n                <svg class=\"w-5 h-5 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                </svg>\r\n            </div>`\r\n        }\r\n    };\r\n    \r\n    return configs[type] || configs.info;\r\n}\r\n\r\n/**\r\n * Fermer un toast\r\n */\r\nfunction closeToast(toast) {\r\n    toast.classList.remove('show');\r\n    toast.classList.add('translate-x-full');\r\n    \r\n    setTimeout(() => {\r\n        toast.remove();\r\n        \r\n        // Nettoyer le conteneur si vide\r\n        const container = document.getElementById('toast-container');\r\n        if (container && container.children.length === 0) {\r\n            container.remove();\r\n        }\r\n    }, 300);\r\n}\r\n\r\n/**\r\n * Raccourcis pour les types de toasts\r\n */\r\nexport const toast = {\r\n    success: (message, duration) => showToast(message, 'success', duration),\r\n    error: (message, duration) => showToast(message, 'error', duration),\r\n    warning: (message, duration) => showToast(message, 'warning', duration),\r\n    info: (message, duration) => showToast(message, 'info', duration)\r\n};\r\n\r\n/**\r\n * Toast avec action\r\n */\r\nexport function showToastWithAction(message, type, actionText, actionCallback) {\r\n    const container = getOrCreateToastContainer();\r\n    \r\n    const toast = document.createElement('div');\r\n    toast.className = `toast toast-${type} transform translate-x-full transition-all duration-300`;\r\n    \r\n    const config = getToastConfig(type);\r\n    \r\n    toast.innerHTML = `\r\n        <div class=\"flex items-center gap-3 bg-white rounded-lg shadow-lg border-l-4 ${config.borderColor} p-4 min-w-[320px] max-w-md\">\r\n            <div class=\"flex-shrink-0\">\r\n                ${config.icon}\r\n            </div>\r\n            <div class=\"flex-1\">\r\n                <p class=\"text-sm font-medium text-slate-900 mb-2\">${message}</p>\r\n                <button class=\"toast-action text-sm font-semibold text-indigo-600 hover:text-indigo-700 transition-colors\">\r\n                    ${actionText}\r\n                </button>\r\n            </div>\r\n            <button class=\"toast-close flex-shrink-0 text-slate-400 hover:text-slate-600 transition-colors\">\r\n                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                </svg>\r\n            </button>\r\n        </div>\r\n    `;\r\n    \r\n    container.appendChild(toast);\r\n    \r\n    // Animation d'entr√©e\r\n    setTimeout(() => toast.classList.add('show'), 10);\r\n    \r\n    // √âv√©nements\r\n    toast.querySelector('.toast-close').addEventListener('click', () => closeToast(toast));\r\n    toast.querySelector('.toast-action').addEventListener('click', () => {\r\n        actionCallback();\r\n        closeToast(toast);\r\n    });\r\n    \r\n    return toast;\r\n}\r\n\r\n/**\r\n * Toast de chargement\r\n */\r\nexport function showLoadingToast(message) {\r\n    const container = getOrCreateToastContainer();\r\n    \r\n    const toast = document.createElement('div');\r\n    toast.className = 'toast toast-loading transform translate-x-full transition-all duration-300';\r\n    toast.setAttribute('data-loading', 'true');\r\n    \r\n    toast.innerHTML = `\r\n        <div class=\"flex items-center gap-3 bg-white rounded-lg shadow-lg border-l-4 border-indigo-500 p-4 min-w-[320px] max-w-md\">\r\n            <div class=\"flex-shrink-0\">\r\n                <div class=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600\"></div>\r\n            </div>\r\n            <div class=\"flex-1\">\r\n                <p class=\"text-sm font-medium text-slate-900\">${message}</p>\r\n            </div>\r\n        </div>\r\n    `;\r\n    \r\n    container.appendChild(toast);\r\n    \r\n    // Animation d'entr√©e\r\n    setTimeout(() => toast.classList.add('show'), 10);\r\n    \r\n    return toast;\r\n}\r\n\r\n/**\r\n * Mettre √† jour un toast de chargement\r\n */\r\nexport function updateLoadingToast(toast, message, type = 'success') {\r\n    if (!toast || !toast.getAttribute('data-loading')) return;\r\n    \r\n    const config = getToastConfig(type);\r\n    // Mettre √† jour les classes pour refl√©ter le statut final (et √™tre d√©tectable par les tests)\r\n    const hadShow = toast.classList.contains('show');\r\n    toast.className = `toast toast-${type} transform transition-all duration-300${hadShow ? ' show' : ''}`;\r\n    \r\n    toast.innerHTML = `\r\n        <div class=\"flex items-center gap-3 bg-white rounded-lg shadow-lg border-l-4 ${config.borderColor} p-4 min-w-[320px] max-w-md\">\r\n            <div class=\"flex-shrink-0\">\r\n                ${config.icon}\r\n            </div>\r\n            <div class=\"flex-1\">\r\n                <p class=\"text-sm font-medium text-slate-900\">${message}</p>\r\n            </div>\r\n            <button class=\"toast-close flex-shrink-0 text-slate-400 hover:text-slate-600 transition-colors\">\r\n                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                </svg>\r\n            </button>\r\n        </div>\r\n    `;\r\n    \r\n    toast.removeAttribute('data-loading');\r\n    toast.querySelector('.toast-close').addEventListener('click', () => closeToast(toast));\r\n    \r\n    // Auto-fermeture apr√®s 3s\r\n    setTimeout(() => closeToast(toast), 3000);\r\n}\r\n\r\n/**\r\n * Fonctions helper pour faciliter l'utilisation\r\n */\r\nexport function showSuccessToast(message, duration = 3000) {\r\n    return showToast(message, 'success', duration);\r\n}\r\n\r\nexport function showErrorToast(message, duration = 3000) {\r\n    return showToast(message, 'error', duration);\r\n}\r\n\r\nexport function showWarningToast(message, duration = 3000) {\r\n    return showToast(message, 'warning', duration);\r\n}\r\n\r\nexport function showInfoToast(message, duration = 3000) {\r\n    return showToast(message, 'info', duration);\r\n}\r\n\r\n// CSS pour les animations (√† ajouter dans un <style> ou fichier CSS)\r\nexport const toastStyles = `\r\n    <style>\r\n        .toast.show {\r\n            transform: translateX(0) !important;\r\n        }\r\n        \r\n        @media (max-width: 640px) {\r\n            #toast-container {\r\n                left: 1rem;\r\n                right: 1rem;\r\n                top: 1rem;\r\n            }\r\n            \r\n            .toast > div {\r\n                min-width: auto !important;\r\n                width: 100%;\r\n            }\r\n        }\r\n    </style>\r\n`;\r\n\r\n// Injecter les styles au chargement\r\nif (typeof document !== 'undefined') {\r\n    const styleElement = document.createElement('style');\r\n    styleElement.textContent = `\r\n        .toast.show {\r\n            transform: translateX(0) !important;\r\n        }\r\n        \r\n        @media (max-width: 640px) {\r\n            #toast-container {\r\n                left: 1rem;\r\n                right: 1rem;\r\n                top: 1rem;\r\n            }\r\n            \r\n            .toast > div {\r\n                min-width: auto !important;\r\n                width: 100%;\r\n            }\r\n        }\r\n    `;\r\n    document.head.appendChild(styleElement);\r\n}\r\n","// Logger conditionnel - D√©sactive les logs en production\r\n// Garde seulement console.error actif pour d√©bogage critique\r\n\r\nconst isDevelopment = window.location.hostname === 'localhost' || \r\n                     window.location.hostname === '127.0.0.1' ||\r\n                     window.location.hostname === '192.168.1.1' ||\r\n                     window.location.port === '3200'; // Port Vite\r\n\r\n/**\r\n * Logger intelligent qui d√©sactive les logs en production\r\n * console.error reste toujours actif\r\n */\r\nexport const logger = {\r\n    /**\r\n     * Log d'information (d√©veloppement uniquement)\r\n     */\r\n    log: (...args) => {\r\n        if (isDevelopment) {\r\n            console.log(...args);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Log d'erreur (toujours actif)\r\n     */\r\n    error: (...args) => {\r\n        console.error(...args);\r\n    },\r\n    \r\n    /**\r\n     * Log d'avertissement (d√©veloppement uniquement)\r\n     */\r\n    warn: (...args) => {\r\n        if (isDevelopment) {\r\n            console.warn(...args);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Log d'information (d√©veloppement uniquement)\r\n     */\r\n    info: (...args) => {\r\n        if (isDevelopment) {\r\n            console.info(...args);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Log de groupe (d√©veloppement uniquement)\r\n     */\r\n    group: (...args) => {\r\n        if (isDevelopment) {\r\n            console.group(...args);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Fin de groupe (d√©veloppement uniquement)\r\n     */\r\n    groupEnd: () => {\r\n        if (isDevelopment) {\r\n            console.groupEnd();\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Table (d√©veloppement uniquement)\r\n     */\r\n    table: (...args) => {\r\n        if (isDevelopment) {\r\n            console.table(...args);\r\n        }\r\n    }\r\n};\r\n\r\n// Message de d√©marrage\r\nif (isDevelopment) {\r\n    console.log('üîß Mode d√©veloppement - Logs activ√©s');\r\n} else {\r\n    console.log('üöÄ Mode production - Logs d√©sactiv√©s (sauf erreurs)');\r\n}\r\n\r\nexport default logger;\r\n","// Import Firebase SDK modules\r\nimport { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';\r\nimport { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';\r\nimport { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';\r\nimport { getDatabase } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';\r\nimport { logger } from './logger.js';\r\n\r\n// Configuration Firebase - Avantage QUIZZ\r\n// Configuration compl√®te avec Firestore + Realtime Database\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyD8w7Em_xdMGplscfGLrnM72vmm4z5ZTr0\",\r\n  authDomain: \"avantage-quizz.firebaseapp.com\",\r\n  databaseURL: \"https://avantage-quizz-default-rtdb.firebaseio.com\",\r\n  projectId: \"avantage-quizz\",\r\n  storageBucket: \"avantage-quizz.firebasestorage.app\",\r\n  messagingSenderId: \"919472910099\",\r\n  appId: \"1:919472910099:web:e17d4c1cdc7a04c6cab4e6\"\r\n};\r\n\r\n// Initialize Firebase\r\nconst app = initializeApp(firebaseConfig);\r\n\r\n// Initialize Firebase services\r\nexport const auth = getAuth(app);\r\nexport const db = getFirestore(app);\r\nexport const realtimeDB = getDatabase(app);\r\n\r\nlogger.log('‚úÖ Firebase initialis√© avec succ√®s');\r\nlogger.log('üìä Projet:', firebaseConfig.projectId);\r\nlogger.log('üîê Services: Authentication, Firestore, Realtime Database');\r\n","// Module Firestore - Gestion des donn√©es\r\nimport { db, auth } from './firebase-config.js';\r\nimport { \r\n    collection, \r\n    doc, \r\n    getDoc, \r\n    getDocs, \r\n    setDoc, \r\n    updateDoc, \r\n    addDoc,\r\n    deleteDoc,\r\n    query,\r\n    where,\r\n    orderBy,\r\n    limit,\r\n    Timestamp\r\n} from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';\r\n\r\n// ===== COLLECTIONS =====\r\nconst COLLECTIONS = {\r\n    users: 'users',\r\n    quizResults: 'quizResults',\r\n    monthlyProgress: 'monthlyProgress',\r\n    questions: 'questions'\r\n};\r\n\r\n// Cache en m√©moire pour limiter les lectures Firestore r√©p√©t√©es\r\nconst cacheStore = new Map();\r\n\r\nfunction buildCacheKey(parts = []) {\r\n    return parts.filter(Boolean).join('::');\r\n}\r\n\r\nfunction getCachedValue(key) {\r\n    const entry = cacheStore.get(key);\r\n    if (!entry) {\r\n        return null;\r\n    }\r\n    if (Date.now() > entry.expireAt) {\r\n        cacheStore.delete(key);\r\n        return null;\r\n    }\r\n    return entry.value;\r\n}\r\n\r\nfunction setCachedValue(key, value, ttlMs = 5 * 60 * 1000) {\r\n    cacheStore.set(key, {\r\n        value,\r\n        expireAt: Date.now() + ttlMs\r\n    });\r\n}\r\n\r\nfunction invalidateCache(prefix) {\r\n    cacheStore.forEach((_, key) => {\r\n        if (key.startsWith(prefix)) {\r\n            cacheStore.delete(key);\r\n        }\r\n    });\r\n}\r\n\r\n// ===== GESTION DES UTILISATEURS =====\r\n\r\n/**\r\n * Cr√©er ou mettre √† jour le profil utilisateur\r\n */\r\nexport async function createOrUpdateUser(user) {\r\n    try {\r\n        const userRef = doc(db, COLLECTIONS.users, user.uid);\r\n        const userData = {\r\n            uid: user.uid,\r\n            email: user.email,\r\n            displayName: user.displayName,\r\n            photoURL: user.photoURL,\r\n            lastLogin: Timestamp.now(),\r\n            updatedAt: Timestamp.now()\r\n        };\r\n        \r\n        // V√©rifier si l'utilisateur existe\r\n        const userDoc = await getDoc(userRef);\r\n        \r\n        if (!userDoc.exists()) {\r\n            // Nouvel utilisateur\r\n            userData.createdAt = Timestamp.now();\r\n            userData.totalQuizzes = 0;\r\n            userData.averageScore = 0;\r\n            userData.currentStreak = 0;\r\n            userData.longestStreak = 0;\r\n            userData.role = 'user'; // ‚úÖ R√¥le par d√©faut pour nouveaux utilisateurs\r\n            console.log('üë§ Cr√©ation du profil utilisateur:', user.email);\r\n        }\r\n        \r\n        await setDoc(userRef, userData, { merge: true });\r\n        console.log('‚úÖ Profil utilisateur sauvegard√©');\r\n        return userData;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur cr√©ation utilisateur:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * R√©cup√©rer le profil utilisateur\r\n */\r\nexport async function getUserProfile(uid) {\r\n    try {\r\n        const userRef = doc(db, COLLECTIONS.users, uid);\r\n        const userDoc = await getDoc(userRef);\r\n        \r\n        if (userDoc.exists()) {\r\n            return userDoc.data();\r\n        }\r\n        return null;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur r√©cup√©ration profil:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// ===== GESTION DES R√âSULTATS DE QUIZ =====\r\n\r\n/**\r\n * Sauvegarder un r√©sultat de quiz\r\n */\r\nexport async function saveQuizResult(quizData) {\r\n    try {\r\n        const user = auth.currentUser;\r\n        if (!user) throw new Error('Utilisateur non connect√©');\r\n        \r\n        const resultData = {\r\n            userId: user.uid,\r\n            userEmail: user.email,\r\n            moduleId: quizData.moduleId,\r\n            moduleName: quizData.moduleName,\r\n            score: quizData.score,\r\n            correctAnswers: quizData.correctAnswers,\r\n            totalQuestions: quizData.totalQuestions,\r\n            timeElapsed: quizData.timeElapsed,\r\n            answers: quizData.answers,\r\n            // Champ historique (utilis√© par anciens √©crans / index existants)\r\n            date: Timestamp.now(),\r\n            // Nouveau champ normalis√© utilis√© pour les requ√™tes r√©centes\r\n            completedAt: Timestamp.now(),\r\n            month: quizData.month || new Date().toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' })\r\n        };\r\n        \r\n        // Ajouter le r√©sultat\r\n        const resultRef = await addDoc(collection(db, COLLECTIONS.quizResults), resultData);\r\n        console.log('‚úÖ R√©sultat de quiz sauvegard√©:', resultRef.id);\r\n        \r\n        // Mettre √† jour les statistiques utilisateur\r\n        await updateUserStats(user.uid, quizData.score);\r\n        \r\n        // Mettre √† jour la progression mensuelle\r\n        await updateMonthlyProgress(user.uid, quizData.month, quizData.score);\r\n\r\n    invalidateCache(buildCacheKey(['quizResults', user.uid]));\r\n    invalidateCache(buildCacheKey(['monthlyResults', user.uid]));\r\n    invalidateCache(buildCacheKey(['annualProgress', user.uid]));\r\n    invalidateCache('users');\r\n    invalidateCache('users-stats');\r\n        \r\n        return resultRef.id;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur sauvegarde r√©sultat:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * R√©cup√©rer tous les r√©sultats d'un utilisateur\r\n */\r\nexport async function getUserQuizResults(uid, limitCount = 50) {\r\n    const cacheKey = buildCacheKey(['quizResults', uid, limitCount]);\r\n    const cached = getCachedValue(cacheKey);\r\n    if (cached) {\r\n        return cached;\r\n    }\r\n\r\n    try {\r\n        const q = query(\r\n            collection(db, COLLECTIONS.quizResults),\r\n            where('userId', '==', uid),\r\n            orderBy('date', 'desc'),\r\n            limit(limitCount)\r\n        );\r\n        \r\n        const querySnapshot = await getDocs(q);\r\n        const results = [];\r\n        \r\n        querySnapshot.forEach((doc) => {\r\n            results.push({ id: doc.id, ...doc.data() });\r\n        });\r\n        \r\n        console.log(`üìä ${results.length} r√©sultats charg√©s`);\r\n        setCachedValue(cacheKey, results);\r\n        return results;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur r√©cup√©ration r√©sultats:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * R√©cup√©rer les r√©sultats d'un mois sp√©cifique\r\n */\r\nexport async function getMonthlyResults(uid, month) {\r\n    const cacheKey = buildCacheKey(['monthlyResults', uid, month]);\r\n    const cached = getCachedValue(cacheKey);\r\n    if (cached) {\r\n        return cached;\r\n    }\r\n\r\n    try {\r\n        const q = query(\r\n            collection(db, COLLECTIONS.quizResults),\r\n            where('userId', '==', uid),\r\n            where('month', '==', month),\r\n            orderBy('date', 'desc')\r\n        );\r\n        \r\n        const querySnapshot = await getDocs(q);\r\n        const results = [];\r\n        \r\n        querySnapshot.forEach((doc) => {\r\n            results.push({ id: doc.id, ...doc.data() });\r\n        });\r\n        \r\n        setCachedValue(cacheKey, results);\r\n        return results;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur r√©cup√©ration r√©sultats mensuels:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// ===== GESTION DE LA PROGRESSION MENSUELLE =====\r\n\r\n/**\r\n * Mettre √† jour la progression mensuelle\r\n */\r\nexport async function updateMonthlyProgress(uid, month, score) {\r\n    try {\r\n        const progressRef = doc(db, COLLECTIONS.monthlyProgress, `${uid}_${month}`);\r\n        \r\n        const progressData = {\r\n            userId: uid,\r\n            month: month,\r\n            score: score,\r\n            completed: true,\r\n            completedAt: Timestamp.now(),\r\n            updatedAt: Timestamp.now()\r\n        };\r\n        \r\n        await setDoc(progressRef, progressData, { merge: true });\r\n        console.log('‚úÖ Progression mensuelle mise √† jour');\r\n\r\n        invalidateCache(buildCacheKey(['monthlyResults', uid]));\r\n        invalidateCache(buildCacheKey(['annualProgress', uid]));\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur mise √† jour progression:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * R√©cup√©rer la progression annuelle\r\n */\r\nexport async function getAnnualProgress(uid, year = new Date().getFullYear()) {\r\n    const cacheKey = buildCacheKey(['annualProgress', uid, year]);\r\n    const cached = getCachedValue(cacheKey);\r\n    if (cached) {\r\n        return cached;\r\n    }\r\n\r\n    try {\r\n        const q = query(\r\n            collection(db, COLLECTIONS.monthlyProgress),\r\n            where('userId', '==', uid)\r\n        );\r\n        \r\n        const querySnapshot = await getDocs(q);\r\n        const progress = {};\r\n        \r\n        querySnapshot.forEach((doc) => {\r\n            const data = doc.data();\r\n            progress[data.month] = data;\r\n        });\r\n        \r\n        console.log('üìÖ Progression annuelle charg√©e');\r\n        setCachedValue(cacheKey, progress);\r\n        return progress;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur r√©cup√©ration progression:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// ===== STATISTIQUES UTILISATEUR =====\r\n\r\n/**\r\n * Mettre √† jour les statistiques utilisateur\r\n */\r\nasync function updateUserStats(uid, newScore) {\r\n    try {\r\n        const userRef = doc(db, COLLECTIONS.users, uid);\r\n        const userDoc = await getDoc(userRef);\r\n        \r\n        if (userDoc.exists()) {\r\n            const userData = userDoc.data();\r\n            const totalQuizzes = (userData.totalQuizzes || 0) + 1;\r\n            const currentAverage = userData.averageScore || 0;\r\n            const newAverage = ((currentAverage * (totalQuizzes - 1)) + newScore) / totalQuizzes;\r\n            \r\n            await updateDoc(userRef, {\r\n                totalQuizzes: totalQuizzes,\r\n                averageScore: Math.round(newAverage),\r\n                lastQuizDate: Timestamp.now(),\r\n                updatedAt: Timestamp.now()\r\n            });\r\n            \r\n            console.log('üìä Statistiques mises √† jour');\r\n\r\n            invalidateCache('users');\r\n            invalidateCache('users-stats');\r\n        }\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur mise √† jour statistiques:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Calculer et mettre √† jour la s√©rie (streak)\r\n */\r\nexport async function updateStreak(uid) {\r\n    try {\r\n        const results = await getUserQuizResults(uid, 12);\r\n        \r\n        // Calculer la s√©rie de mois cons√©cutifs avec score >= 60%\r\n        let currentStreak = 0;\r\n        const monthsSet = new Set();\r\n        \r\n        for (const result of results) {\r\n            if (result.score >= 60) {\r\n                monthsSet.add(result.month);\r\n            }\r\n        }\r\n        \r\n        // Compter les mois cons√©cutifs\r\n        const months = Array.from(monthsSet).sort().reverse();\r\n        for (let i = 0; i < months.length; i++) {\r\n            currentStreak++;\r\n            // V√©rifier si le mois suivant est cons√©cutif\r\n            if (i < months.length - 1) {\r\n                // Logique de v√©rification de cons√©cutivit√©\r\n                // (simplifi√©e ici)\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n        \r\n        const userRef = doc(db, COLLECTIONS.users, uid);\r\n        const userDoc = await getDoc(userRef);\r\n        \r\n        if (userDoc.exists()) {\r\n            const userData = userDoc.data();\r\n            const longestStreak = Math.max(currentStreak, userData.longestStreak || 0);\r\n            \r\n            await updateDoc(userRef, {\r\n                currentStreak: currentStreak,\r\n                longestStreak: longestStreak,\r\n                updatedAt: Timestamp.now()\r\n            });\r\n            \r\n            console.log(`üî• S√©rie mise √† jour: ${currentStreak} mois`);\r\n\r\n            invalidateCache('users');\r\n            invalidateCache('users-stats');\r\n        }\r\n        \r\n        return currentStreak;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur mise √† jour s√©rie:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// ===== LEADERBOARD =====\r\n\r\n/**\r\n * R√©cup√©rer le classement g√©n√©ral\r\n */\r\nexport async function getLeaderboard(limitCount = 10) {\r\n    try {\r\n        const q = query(\r\n            collection(db, COLLECTIONS.users),\r\n            orderBy('averageScore', 'desc'),\r\n            orderBy('totalQuizzes', 'desc'),\r\n            limit(limitCount)\r\n        );\r\n        \r\n        const querySnapshot = await getDocs(q);\r\n        const leaderboard = [];\r\n        \r\n        querySnapshot.forEach((doc) => {\r\n            const data = doc.data();\r\n            leaderboard.push({\r\n                uid: doc.id,\r\n                displayName: data.displayName,\r\n                photoURL: data.photoURL,\r\n                averageScore: data.averageScore,\r\n                totalQuizzes: data.totalQuizzes,\r\n                currentStreak: data.currentStreak\r\n            });\r\n        });\r\n        \r\n        console.log('üèÜ Classement charg√©');\r\n        return leaderboard;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur r√©cup√©ration classement:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// ===== FONCTIONS ADMINISTRATEUR =====\r\n\r\n/**\r\n * V√©rifier si l'utilisateur actuel est admin\r\n */\r\nexport async function isCurrentUserAdmin() {\r\n    try {\r\n        const user = auth.currentUser;\r\n        if (!user) return false;\r\n        \r\n        const userProfile = await getUserProfile(user.uid);\r\n        return userProfile?.role === 'admin';\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur v√©rification admin:', error);\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: R√©cup√©rer toutes les questions avec filtres optionnels\r\n */\r\nexport async function getQuestions(filters = {}) {\r\n    const cacheKey = buildCacheKey(['questions', JSON.stringify(filters || {})]);\r\n    const cached = getCachedValue(cacheKey);\r\n    if (cached) {\r\n        return cached;\r\n    }\r\n\r\n    try {\r\n        let q = collection(db, COLLECTIONS.questions);\r\n        const constraints = [];\r\n        \r\n        // Filtres optionnels\r\n        if (filters.module) {\r\n            constraints.push(where('module', '==', filters.module));\r\n        }\r\n        if (filters.month) {\r\n            constraints.push(where('month', '==', filters.month));\r\n        }\r\n        if (filters.year) {\r\n            constraints.push(where('year', '==', filters.year));\r\n        }\r\n        \r\n        // Tri par date de cr√©ation\r\n        constraints.push(orderBy('createdAt', 'desc'));\r\n        \r\n        if (constraints.length > 0) {\r\n            q = query(q, ...constraints);\r\n        }\r\n        \r\n        const querySnapshot = await getDocs(q);\r\n        const questions = [];\r\n        \r\n        querySnapshot.forEach((doc) => {\r\n            questions.push({ id: doc.id, ...doc.data() });\r\n        });\r\n        \r\n        console.log(`üìö ${questions.length} questions charg√©es`);\r\n        setCachedValue(cacheKey, questions);\r\n        return questions;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur r√©cup√©ration questions:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: Cr√©er une nouvelle question\r\n */\r\nexport async function createQuestion(questionData) {\r\n    try {\r\n        const user = auth.currentUser;\r\n        if (!user) throw new Error('Utilisateur non connect√©');\r\n        \r\n        // Validation\r\n        if (!questionData.question || questionData.question.length < 10) {\r\n            throw new Error('La question doit contenir au moins 10 caract√®res');\r\n        }\r\n        if (!questionData.options || questionData.options.length !== 4) {\r\n            throw new Error('La question doit avoir exactement 4 options');\r\n        }\r\n        if (questionData.correctAnswer === undefined || questionData.correctAnswer < 0 || questionData.correctAnswer > 3) {\r\n            throw new Error('La r√©ponse correcte doit √™tre entre 0 et 3');\r\n        }\r\n        if (!questionData.explanation || questionData.explanation.length < 20) {\r\n            throw new Error('L\\'explication doit contenir au moins 20 caract√®res');\r\n        }\r\n        if (!['auto', 'loisir', 'vr', 'tracteur'].includes(questionData.module)) {\r\n            throw new Error('Module invalide');\r\n        }\r\n        if (!questionData.month || questionData.month < 1 || questionData.month > 12) {\r\n            throw new Error('Mois invalide');\r\n        }\r\n        \r\n        const newQuestion = {\r\n            question: questionData.question.trim(),\r\n            options: questionData.options.map(opt => opt.trim()),\r\n            correctAnswer: parseInt(questionData.correctAnswer),\r\n            explanation: questionData.explanation.trim(),\r\n            module: questionData.module,\r\n            month: parseInt(questionData.month),\r\n            year: questionData.year || new Date().getFullYear(),\r\n            createdAt: Timestamp.now(),\r\n            createdBy: user.uid,\r\n            updatedAt: Timestamp.now()\r\n        };\r\n        \r\n        const questionRef = await addDoc(collection(db, COLLECTIONS.questions), newQuestion);\r\n        console.log('‚úÖ Question cr√©√©e:', questionRef.id);\r\n        \r\n        // Log d'audit\r\n        await createAuditLog({\r\n            action: 'CREATE_QUESTION',\r\n            questionId: questionRef.id,\r\n            adminId: user.uid,\r\n            adminEmail: user.email\r\n        });\r\n\r\n        invalidateCache('questions');\r\n        invalidateCache('questions-stats');\r\n        \r\n        return questionRef.id;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur cr√©ation question:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: Mettre √† jour une question existante\r\n */\r\nexport async function updateQuestion(questionId, questionData) {\r\n    try {\r\n        const user = auth.currentUser;\r\n        if (!user) throw new Error('Utilisateur non connect√©');\r\n        \r\n        const questionRef = doc(db, COLLECTIONS.questions, questionId);\r\n        \r\n        const updatedData = {\r\n            ...questionData,\r\n            updatedAt: Timestamp.now()\r\n        };\r\n        \r\n        // Ne pas permettre la modification de certains champs\r\n        delete updatedData.createdAt;\r\n        delete updatedData.createdBy;\r\n        \r\n        await updateDoc(questionRef, updatedData);\r\n        console.log('‚úÖ Question mise √† jour:', questionId);\r\n        \r\n        // Log d'audit\r\n        await createAuditLog({\r\n            action: 'UPDATE_QUESTION',\r\n            questionId: questionId,\r\n            adminId: user.uid,\r\n            adminEmail: user.email,\r\n            changes: questionData\r\n        });\r\n\r\n        invalidateCache('questions');\r\n        invalidateCache('questions-stats');\r\n        \r\n        return true;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur mise √† jour question:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: Supprimer une question\r\n */\r\nexport async function deleteQuestion(questionId) {\r\n    try {\r\n        const user = auth.currentUser;\r\n        if (!user) throw new Error('Utilisateur non connect√©');\r\n        \r\n        const questionRef = doc(db, COLLECTIONS.questions, questionId);\r\n        \r\n        // R√©cup√©rer les donn√©es avant suppression pour le log\r\n        const questionDoc = await getDoc(questionRef);\r\n        const questionData = questionDoc.data();\r\n        \r\n        await deleteDoc(questionRef);\r\n        console.log('üóëÔ∏è Question supprim√©e:', questionId);\r\n        \r\n        // Log d'audit\r\n        await createAuditLog({\r\n            action: 'DELETE_QUESTION',\r\n            questionId: questionId,\r\n            adminId: user.uid,\r\n            adminEmail: user.email,\r\n            deletedData: questionData\r\n        });\r\n\r\n        invalidateCache('questions');\r\n        invalidateCache('questions-stats');\r\n        \r\n        return true;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur suppression question:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: Importer des questions depuis JSON\r\n */\r\nexport async function importQuestionsFromJSON(jsonData) {\r\n    try {\r\n        const user = auth.currentUser;\r\n        if (!user) throw new Error('Utilisateur non connect√©');\r\n        \r\n        // Validation du JSON\r\n        if (!jsonData.module || !jsonData.month || !jsonData.year || !jsonData.questions) {\r\n            throw new Error('Format JSON invalide - champs obligatoires manquants');\r\n        }\r\n        \r\n        if (!Array.isArray(jsonData.questions) || jsonData.questions.length === 0) {\r\n            throw new Error('Le fichier JSON doit contenir au moins une question');\r\n        }\r\n        \r\n        const importedIds = [];\r\n        const errors = [];\r\n        \r\n        // Importer chaque question\r\n        for (let i = 0; i < jsonData.questions.length; i++) {\r\n            const question = jsonData.questions[i];\r\n            \r\n            try {\r\n                const questionData = {\r\n                    question: question.question,\r\n                    options: question.options,\r\n                    correctAnswer: question.correctAnswer,\r\n                    explanation: question.explanation,\r\n                    module: jsonData.module,\r\n                    month: jsonData.month,\r\n                    year: jsonData.year\r\n                };\r\n                \r\n                const questionId = await createQuestion(questionData);\r\n                importedIds.push(questionId);\r\n            } catch (err) {\r\n                errors.push({ index: i, error: err.message });\r\n                console.error(`‚ùå Erreur question ${i + 1}:`, err.message);\r\n            }\r\n        }\r\n        \r\n        // Log d'import\r\n        await createImportLog({\r\n            importedBy: user.uid,\r\n            module: jsonData.module,\r\n            month: jsonData.month,\r\n            year: jsonData.year,\r\n            totalQuestions: jsonData.questions.length,\r\n            successCount: importedIds.length,\r\n            errorCount: errors.length,\r\n            status: errors.length === 0 ? 'success' : 'partial'\r\n        });\r\n        \r\n        console.log(`‚úÖ Import termin√©: ${importedIds.length}/${jsonData.questions.length} questions import√©es`);\r\n\r\n        invalidateCache('questions');\r\n        invalidateCache('questions-stats');\r\n        \r\n        return {\r\n            success: importedIds.length,\r\n            total: jsonData.questions.length,\r\n            errors: errors,\r\n            ids: importedIds\r\n        };\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur import JSON:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: R√©cup√©rer tous les utilisateurs\r\n */\r\nexport async function getAllUsers(filters = {}) {\r\n    const cacheKey = buildCacheKey(['users', JSON.stringify(filters || {})]);\r\n    const cached = getCachedValue(cacheKey);\r\n    if (cached) {\r\n        return cached;\r\n    }\r\n\r\n    try {\r\n        let q = collection(db, COLLECTIONS.users);\r\n        const constraints = [];\r\n        \r\n        // Filtres optionnels\r\n        if (filters.role) {\r\n            constraints.push(where('role', '==', filters.role));\r\n        }\r\n        \r\n        // Tri\r\n        constraints.push(orderBy('createdAt', 'desc'));\r\n        \r\n        if (constraints.length > 0) {\r\n            q = query(q, ...constraints);\r\n        }\r\n        \r\n        const querySnapshot = await getDocs(q);\r\n        const users = [];\r\n        \r\n        querySnapshot.forEach((doc) => {\r\n            users.push({ id: doc.id, ...doc.data() });\r\n        });\r\n        \r\n        console.log(`üë• ${users.length} utilisateurs charg√©s`);\r\n        setCachedValue(cacheKey, users);\r\n        return users;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur r√©cup√©ration utilisateurs:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: Mettre √† jour le r√¥le d'un utilisateur\r\n */\r\nexport async function updateUserRole(userId, newRole) {\r\n    try {\r\n        const user = auth.currentUser;\r\n        if (!user) throw new Error('Utilisateur non connect√©');\r\n        \r\n        if (!['user', 'admin'].includes(newRole)) {\r\n            throw new Error('R√¥le invalide - doit √™tre \"user\" ou \"admin\"');\r\n        }\r\n        \r\n        const userRef = doc(db, COLLECTIONS.users, userId);\r\n        \r\n        await updateDoc(userRef, {\r\n            role: newRole,\r\n            updatedAt: Timestamp.now()\r\n        });\r\n        \r\n        console.log(`‚úÖ R√¥le mis √† jour pour ${userId}: ${newRole}`);\r\n        \r\n        // Log d'audit\r\n        await createAuditLog({\r\n            action: 'UPDATE_USER_ROLE',\r\n            targetUserId: userId,\r\n            newRole: newRole,\r\n            adminId: user.uid,\r\n            adminEmail: user.email\r\n        });\r\n\r\n        invalidateCache('users');\r\n        invalidateCache('users-stats');\r\n        \r\n        return true;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur mise √† jour r√¥le:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: Cr√©er un log d'import\r\n */\r\nasync function createImportLog(logData) {\r\n    try {\r\n        const log = {\r\n            ...logData,\r\n            importedAt: Timestamp.now()\r\n        };\r\n        \r\n        await addDoc(collection(db, 'importLogs'), log);\r\n        console.log('Log import cree');\r\n    } catch (error) {\r\n        console.error('Erreur creation log import:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: Cr√©er un log d'audit\r\n */\r\nasync function createAuditLog(logData) {\r\n    try {\r\n        const log = {\r\n            ...logData,\r\n            timestamp: Timestamp.now()\r\n        };\r\n        \r\n        await addDoc(collection(db, 'auditLogs'), log);\r\n        console.log('Log audit cree');\r\n    } catch (error) {\r\n        console.error('Erreur creation log audit:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: R√©cup√©rer les statistiques des questions\r\n */\r\nexport async function getQuestionsStats() {\r\n    const cacheKey = 'questions-stats';\r\n    const cached = getCachedValue(cacheKey);\r\n    if (cached) {\r\n        return cached;\r\n    }\r\n\r\n    try {\r\n        const questions = await getQuestions();\r\n        \r\n        const stats = {\r\n            total: questions.length,\r\n            byModule: {},\r\n            byMonth: {},\r\n            byYear: {}\r\n        };\r\n        \r\n        questions.forEach(q => {\r\n            // Par module\r\n            stats.byModule[q.module] = (stats.byModule[q.module] || 0) + 1;\r\n            \r\n            // Par mois\r\n            stats.byMonth[q.month] = (stats.byMonth[q.month] || 0) + 1;\r\n            \r\n            // Par ann√©e\r\n            stats.byYear[q.year] = (stats.byYear[q.year] || 0) + 1;\r\n        });\r\n        \r\n        setCachedValue(cacheKey, stats, 2 * 60 * 1000);\r\n        return stats;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur statistiques questions:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * ADMIN: R√©cup√©rer les statistiques des utilisateurs\r\n */\r\nexport async function getUsersStats() {\r\n    const cacheKey = 'users-stats';\r\n    const cached = getCachedValue(cacheKey);\r\n    if (cached) {\r\n        return cached;\r\n    }\r\n\r\n    try {\r\n        const users = await getAllUsers();\r\n        \r\n        const stats = {\r\n            total: users.length,\r\n            admins: users.filter(u => u.role === 'admin').length,\r\n            regularUsers: users.filter(u => u.role !== 'admin').length,\r\n            activeLastWeek: 0,\r\n            averageScore: 0,\r\n            totalQuizzes: 0\r\n        };\r\n        \r\n        const oneWeekAgo = new Date();\r\n        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\r\n        \r\n        users.forEach(u => {\r\n            if (u.lastLogin && u.lastLogin.toDate() > oneWeekAgo) {\r\n                stats.activeLastWeek++;\r\n            }\r\n            stats.totalQuizzes += (u.totalQuizzes || 0);\r\n            stats.averageScore += (u.averageScore || 0);\r\n        });\r\n        \r\n        stats.averageScore = stats.total > 0 ? Math.round(stats.averageScore / stats.total) : 0;\r\n        \r\n        setCachedValue(cacheKey, stats, 2 * 60 * 1000);\r\n        return stats;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur statistiques utilisateurs:', error);\r\n        throw error;\r\n    }\r\n}\r\n","// Module Authentication - Gestion de l'authentification Google\r\nimport { auth } from './firebase-config.js';\r\nimport { \r\n    GoogleAuthProvider, \r\n    signInWithPopup, \r\n    signOut, \r\n    onAuthStateChanged \r\n} from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';\r\nimport { createOrUpdateUser } from './firestore-service.js';\r\n\r\nconst provider = new GoogleAuthProvider();\r\nprovider.setCustomParameters({\r\n    prompt: 'select_account'\r\n});\r\n\r\n// Prevent multiple simultaneous sign-in attempts\r\nlet signInInProgress = false;\r\n\r\n// Sign in with Google\r\nexport async function signInWithGoogle() {\r\n    // Prevent multiple popup windows\r\n    if (signInInProgress) {\r\n        console.warn('‚ö†Ô∏è Connexion d√©j√† en cours, veuillez patienter...');\r\n        return null;\r\n    }\r\n    \r\n    signInInProgress = true;\r\n    \r\n    try {\r\n        console.log('üîê Tentative de connexion Google...');\r\n        const result = await signInWithPopup(auth, provider);\r\n        const user = result.user;\r\n        \r\n        console.log('‚úÖ Authentification r√©ussie:', user.displayName);\r\n        console.log('üìß Email:', user.email);\r\n        \r\n        // Cr√©er ou mettre √† jour le profil utilisateur dans Firestore\r\n        await createOrUpdateUser(user);\r\n        \r\n        return user;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur de connexion:', error);\r\n        \r\n        // Messages d'erreur personnalis√©s\r\n        let errorMessage = 'Erreur lors de la connexion. Veuillez r√©essayer.';\r\n        \r\n        if (error.code === 'auth/popup-closed-by-user') {\r\n            errorMessage = 'Connexion annul√©e. Veuillez r√©essayer.';\r\n        } else if (error.code === 'auth/popup-blocked') {\r\n            errorMessage = 'Pop-up bloqu√©e. Autorisez les pop-ups pour ce site.';\r\n        } else if (error.code === 'auth/unauthorized-domain') {\r\n            errorMessage = 'Domaine non autoris√©. Configurez Firebase Authentication.';\r\n        } else if (error.code === 'auth/cancelled-popup-request') {\r\n            // Silent error - user clicked too fast\r\n            console.warn('‚ö†Ô∏è Requ√™te de popup annul√©e (clic multiple)');\r\n            return null;\r\n        }\r\n        \r\n        if (error.code !== 'auth/cancelled-popup-request') {\r\n            alert(errorMessage);\r\n        }\r\n        throw error;\r\n    } finally {\r\n        // Reset flag after 2 seconds to allow retry\r\n        setTimeout(() => {\r\n            signInInProgress = false;\r\n        }, 2000);\r\n    }\r\n}\r\n\r\n// Sign out\r\nexport async function signOutUser() {\r\n    try {\r\n        const userName = auth.currentUser?.displayName || 'Utilisateur';\r\n        await signOut(auth);\r\n        console.log('‚úÖ D√©connexion r√©ussie:', userName);\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur de d√©connexion:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// Listen for auth state changes\r\nexport function onAuthChange(callback) {\r\n    return onAuthStateChanged(auth, (user) => {\r\n        if (user) {\r\n            console.log('üë§ Utilisateur connect√©:', user.email);\r\n        } else {\r\n            console.log('üë§ Aucun utilisateur connect√©');\r\n        }\r\n        callback(user);\r\n    });\r\n}\r\n\r\n// Get current user\r\nexport function getCurrentUser() {\r\n    return auth.currentUser;\r\n}\r\n\r\n// Check if user is authenticated\r\nexport function isAuthenticated() {\r\n    return auth.currentUser !== null;\r\n}\r\n\r\n// Show admin UI elements if user is admin\r\nexport async function showAdminUIIfAdmin(userProfile) {\r\n    if (!userProfile) return;\r\n    \r\n    const isAdmin = userProfile.role === 'admin';\r\n    \r\n    if (isAdmin) {\r\n        // Afficher l'onglet Admin dans la navigation\r\n        const navAdminItem = document.getElementById('nav-admin-item');\r\n        if (navAdminItem) {\r\n            navAdminItem.classList.remove('hidden');\r\n        }\r\n        \r\n        // Afficher le badge Admin\r\n        const adminBadgeNav = document.getElementById('admin-badge-nav');\r\n        if (adminBadgeNav) {\r\n            adminBadgeNav.classList.remove('hidden');\r\n        }\r\n        \r\n        console.log('Admin UI elements shown');\r\n    }\r\n}\r\n\r\n// ============================================\r\n// MODE D√âMO\r\n// ============================================\r\n\r\n/**\r\n * Activer le mode d√©mo sans authentification Firebase\r\n * Cr√©e un utilisateur fictif en localStorage\r\n */\r\nexport async function activateDemoMode() {\r\n    try {\r\n        console.log('üé≠ Activation du mode d√©mo...');\r\n        \r\n        // Cr√©er un utilisateur d√©mo\r\n        const demoUser = {\r\n            uid: 'demo-user-' + Date.now(),\r\n            email: 'demo@avantage-quizz.local',\r\n            displayName: 'Utilisateur D√©mo',\r\n            photoURL: null,\r\n            isDemo: true,\r\n            role: 'admin', // Admin par d√©faut pour tester toutes les fonctionnalit√©s\r\n            createdAt: new Date().toISOString()\r\n        };\r\n        \r\n        // Stocker en localStorage\r\n        localStorage.setItem('demoUser', JSON.stringify(demoUser));\r\n        localStorage.setItem('authMode', 'demo');\r\n        \r\n        console.log('‚úÖ Mode d√©mo activ√©:', demoUser.displayName);\r\n        console.log('üìß Email:', demoUser.email);\r\n        console.log('üëë R√¥le:', demoUser.role);\r\n        \r\n        return demoUser;\r\n        \r\n    } catch (error) {\r\n        console.error('‚ùå Erreur activation mode d√©mo:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * D√©sactiver le mode d√©mo\r\n */\r\nexport function deactivateDemoMode() {\r\n    localStorage.removeItem('demoUser');\r\n    localStorage.removeItem('authMode');\r\n    console.log('‚úÖ Mode d√©mo d√©sactiv√©');\r\n}\r\n\r\n/**\r\n * V√©rifier si le mode d√©mo est actif\r\n */\r\nexport function isDemoMode() {\r\n    return localStorage.getItem('authMode') === 'demo';\r\n}\r\n\r\n/**\r\n * R√©cup√©rer l'utilisateur d√©mo depuis localStorage\r\n */\r\nexport function getDemoUser() {\r\n    try {\r\n        const demoUserJson = localStorage.getItem('demoUser');\r\n        if (!demoUserJson) return null;\r\n        \r\n        const demoUser = JSON.parse(demoUserJson);\r\n        return demoUser;\r\n    } catch (error) {\r\n        console.error('‚ùå Erreur lecture utilisateur d√©mo:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\n/**\r\n * Obtenir l'utilisateur actuel (Firebase ou D√©mo)\r\n */\r\nexport function getCurrentUserUnified() {\r\n    // Mode d√©mo\r\n    if (isDemoMode()) {\r\n        return getDemoUser();\r\n    }\r\n    \r\n    // Mode Firebase normal\r\n    return getCurrentUser();\r\n}\r\n"],"names":["showToast","message","type","duration","container","getOrCreateToastContainer","toast","createToastElement","closeToast","config","getToastConfig","configs","showLoadingToast","updateLoadingToast","hadShow","styleElement","isDevelopment","logger","args","firebaseConfig","app","initializeApp","auth","getAuth","db","getFirestore","getDatabase","COLLECTIONS","cacheStore","buildCacheKey","parts","getCachedValue","key","entry","setCachedValue","value","ttlMs","invalidateCache","prefix","_","createOrUpdateUser","user","userRef","doc","userData","Timestamp","getDoc","setDoc","error","getUserProfile","uid","userDoc","saveQuizResult","quizData","resultData","resultRef","addDoc","collection","updateUserStats","updateMonthlyProgress","getUserQuizResults","limitCount","cacheKey","cached","q","query","where","orderBy","limit","querySnapshot","getDocs","results","month","score","progressRef","progressData","getAnnualProgress","year","progress","data","newScore","totalQuizzes","newAverage","updateDoc","updateStreak","currentStreak","monthsSet","result","months","i","longestStreak","getQuestions","filters","constraints","questions","createQuestion","questionData","newQuestion","opt","questionRef","createAuditLog","deleteQuestion","questionId","deleteDoc","importQuestionsFromJSON","jsonData","importedIds","errors","question","err","createImportLog","getAllUsers","users","updateUserRole","userId","newRole","logData","log","getQuestionsStats","stats","getUsersStats","u","oneWeekAgo","provider","GoogleAuthProvider","signInInProgress","signInWithGoogle","signInWithPopup","errorMessage","signOutUser","userName","signOut","onAuthChange","callback","onAuthStateChanged","getCurrentUser","showAdminUIIfAdmin","userProfile","navAdminItem","adminBadgeNav","isDemoMode","getDemoUser","demoUserJson","getCurrentUserUnified"],"mappings":"wyCASO,SAASA,EAAUC,EAASC,EAAO,OAAQC,EAAW,IAAM,CAC/D,MAAMC,EAAYC,IAEZC,EAAQC,EAAmBN,EAASC,CAAI,EAC9C,OAAAE,EAAU,YAAYE,CAAK,EAG3B,WAAW,IAAMA,EAAM,UAAU,IAAI,MAAM,EAAG,EAAE,EAG5CH,EAAW,GACX,WAAW,IAAM,CACbK,EAAWF,CAAK,CACpB,EAAGH,CAAQ,EAGRG,CACX,CAKA,SAASD,GAA4B,CACjC,IAAID,EAAY,SAAS,eAAe,iBAAiB,EAEzD,OAAKA,IACDA,EAAY,SAAS,cAAc,KAAK,EACxCA,EAAU,GAAK,kBACfA,EAAU,UAAY,+CACtB,SAAS,KAAK,YAAYA,CAAS,GAGhCA,CACX,CAKA,SAASG,EAAmBN,EAASC,EAAM,CACvC,MAAMI,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,UAAY,eAAeJ,CAAI,0DAErC,MAAMO,EAASC,EAAeR,CAAI,EAElC,OAAAI,EAAM,UAAY;AAAA,uFACiEG,EAAO,WAAW;AAAA;AAAA,kBAEvFA,EAAO,IAAI;AAAA;AAAA;AAAA,gEAGmCR,CAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAWlDK,EAAM,cAAc,cAAc,EAC1C,iBAAiB,QAAS,IAAME,EAAWF,CAAK,CAAC,EAEnDA,CACX,CAKA,SAASI,EAAeR,EAAM,CAC1B,MAAMS,EAAU,CACZ,QAAS,CACL,YAAa,mBACb,KAAM;AAAA;AAAA;AAAA;AAAA,mBAKlB,EACQ,MAAO,CACH,YAAa,iBACb,KAAM;AAAA;AAAA;AAAA;AAAA,mBAKlB,EACQ,QAAS,CACL,YAAa,oBACb,KAAM;AAAA;AAAA;AAAA;AAAA,mBAKlB,EACQ,KAAM,CACF,YAAa,kBACb,KAAM;AAAA;AAAA;AAAA;AAAA,mBAKlB,CACA,EAEI,OAAOA,EAAQT,CAAI,GAAKS,EAAQ,IACpC,CAKA,SAASH,EAAWF,EAAO,CACvBA,EAAM,UAAU,OAAO,MAAM,EAC7BA,EAAM,UAAU,IAAI,kBAAkB,EAEtC,WAAW,IAAM,CACbA,EAAM,OAAM,EAGZ,MAAMF,EAAY,SAAS,eAAe,iBAAiB,EACvDA,GAAaA,EAAU,SAAS,SAAW,GAC3CA,EAAU,OAAM,CAExB,EAAG,GAAG,CACV,CAKY,MAACE,GAAQ,CACjB,QAAS,CAACL,EAASE,IAAaH,EAAUC,EAAS,UAAWE,CAAQ,EACtE,MAAO,CAACF,EAASE,IAAaH,EAAUC,EAAS,QAASE,CAAQ,EAClE,QAAS,CAACF,EAASE,IAAaH,EAAUC,EAAS,UAAWE,CAAQ,EACtE,KAAM,CAACF,EAASE,IAAaH,EAAUC,EAAS,OAAQE,CAAQ,CACpE,EAkDO,SAASS,GAAiBX,EAAS,CACtC,MAAMG,EAAYC,IAEZC,EAAQ,SAAS,cAAc,KAAK,EAC1C,OAAAA,EAAM,UAAY,6EAClBA,EAAM,aAAa,eAAgB,MAAM,EAEzCA,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gEAM0CL,CAAO;AAAA;AAAA;AAAA,MAKnEG,EAAU,YAAYE,CAAK,EAG3B,WAAW,IAAMA,EAAM,UAAU,IAAI,MAAM,EAAG,EAAE,EAEzCA,CACX,CAKO,SAASO,GAAmBP,EAAOL,EAASC,EAAO,UAAW,CACjE,GAAI,CAACI,GAAS,CAACA,EAAM,aAAa,cAAc,EAAG,OAEnD,MAAMG,EAASC,EAAeR,CAAI,EAE5BY,EAAUR,EAAM,UAAU,SAAS,MAAM,EAC/CA,EAAM,UAAY,eAAeJ,CAAI,yCAAyCY,EAAU,QAAU,EAAE,GAEpGR,EAAM,UAAY;AAAA,uFACiEG,EAAO,WAAW;AAAA;AAAA,kBAEvFA,EAAO,IAAI;AAAA;AAAA;AAAA,gEAGmCR,CAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAUnEK,EAAM,gBAAgB,cAAc,EACpCA,EAAM,cAAc,cAAc,EAAE,iBAAiB,QAAS,IAAME,EAAWF,CAAK,CAAC,EAGrF,WAAW,IAAME,EAAWF,CAAK,EAAG,GAAI,CAC5C,CA4CA,GAAI,OAAO,SAAa,IAAa,CACjC,MAAMS,EAAe,SAAS,cAAc,OAAO,EACnDA,EAAa,YAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAkB3B,SAAS,KAAK,YAAYA,CAAY,CAC1C,CC1TA,MAAMC,EAAgB,OAAO,SAAS,WAAa,aAC9B,OAAO,SAAS,WAAa,aAC7B,OAAO,SAAS,WAAa,eAC7B,OAAO,SAAS,OAAS,OAMjCC,EAAS,CAIlB,IAAK,IAAIC,IAAS,CACVF,GACA,QAAQ,IAAI,GAAGE,CAAI,CAE3B,EAKA,MAAO,IAAIA,IAAS,CAChB,QAAQ,MAAM,GAAGA,CAAI,CACzB,EAKA,KAAM,IAAIA,IAAS,CACXF,GACA,QAAQ,KAAK,GAAGE,CAAI,CAE5B,EAKA,KAAM,IAAIA,IAAS,CACXF,GACA,QAAQ,KAAK,GAAGE,CAAI,CAE5B,EAKA,MAAO,IAAIA,IAAS,CACZF,GACA,QAAQ,MAAM,GAAGE,CAAI,CAE7B,EAKA,SAAU,IAAM,CACRF,GACA,QAAQ,SAAQ,CAExB,EAKA,MAAO,IAAIE,IAAS,CACZF,GACA,QAAQ,MAAM,GAAGE,CAAI,CAE7B,CACJ,EAII,QAAQ,IADRF,EACY,uCAEA,qDAFsC,ECpEtD,MAAMG,EAAiB,CACrB,OAAQ,0CACR,WAAY,iCACZ,YAAa,qDACb,UAAW,iBACX,cAAe,qCACf,kBAAmB,eACnB,MAAO,2CACT,EAGMC,EAAMC,EAAcF,CAAc,EAG3BG,EAAOC,EAAQH,CAAG,EAClBI,EAAKC,EAAaL,CAAG,EACRM,EAAYN,CAAG,EAEzCH,EAAO,IAAI,mCAAmC,EAC9CA,EAAO,IAAI,aAAcE,EAAe,SAAS,EACjDF,EAAO,IAAI,2DAA2D,ECVtE,MAAMU,EAAc,CAChB,MAAO,QACP,YAAa,cACb,gBAAiB,kBACjB,UAAW,WACf,EAGMC,EAAa,IAAI,IAEvB,SAASC,EAAcC,EAAQ,GAAI,CAC/B,OAAOA,EAAM,OAAO,OAAO,EAAE,KAAK,IAAI,CAC1C,CAEA,SAASC,EAAeC,EAAK,CACzB,MAAMC,EAAQL,EAAW,IAAII,CAAG,EAChC,OAAKC,EAGD,KAAK,MAAQA,EAAM,UACnBL,EAAW,OAAOI,CAAG,EACd,MAEJC,EAAM,MANF,IAOf,CAEA,SAASC,EAAeF,EAAKG,EAAOC,EAAQ,IAAS,IAAM,CACvDR,EAAW,IAAII,EAAK,CAChB,MAAAG,EACA,SAAU,KAAK,IAAG,EAAKC,CAC/B,CAAK,CACL,CAEA,SAASC,EAAgBC,EAAQ,CAC7BV,EAAW,QAAQ,CAACW,EAAGP,IAAQ,CACvBA,EAAI,WAAWM,CAAM,GACrBV,EAAW,OAAOI,CAAG,CAE7B,CAAC,CACL,CAOO,eAAeQ,EAAmBC,EAAM,CAC3C,GAAI,CACA,MAAMC,EAAUC,EAAInB,EAAIG,EAAY,MAAOc,EAAK,GAAG,EAC7CG,EAAW,CACb,IAAKH,EAAK,IACV,MAAOA,EAAK,MACZ,YAAaA,EAAK,YAClB,SAAUA,EAAK,SACf,UAAWI,EAAU,IAAG,EACxB,UAAWA,EAAU,IAAG,CACpC,EAKQ,OAFgB,MAAMC,EAAOJ,CAAO,GAEvB,WAETE,EAAS,UAAYC,EAAU,MAC/BD,EAAS,aAAe,EACxBA,EAAS,aAAe,EACxBA,EAAS,cAAgB,EACzBA,EAAS,cAAgB,EACzBA,EAAS,KAAO,OAChB,QAAQ,IAAI,qCAAsCH,EAAK,KAAK,GAGhE,MAAMM,EAAOL,EAASE,EAAU,CAAE,MAAO,EAAI,CAAE,EAC/C,QAAQ,IAAI,iCAAiC,EACtCA,CACX,OAASI,EAAO,CACZ,cAAQ,MAAM,iCAAkCA,CAAK,EAC/CA,CACV,CACJ,CAKO,eAAeC,GAAeC,EAAK,CACtC,GAAI,CACA,MAAMR,EAAUC,EAAInB,EAAIG,EAAY,MAAOuB,CAAG,EACxCC,EAAU,MAAML,EAAOJ,CAAO,EAEpC,OAAIS,EAAQ,SACDA,EAAQ,OAEZ,IACX,OAASH,EAAO,CACZ,cAAQ,MAAM,gCAAiCA,CAAK,EAC9CA,CACV,CACJ,CAOO,eAAeI,GAAeC,EAAU,CAC3C,GAAI,CACA,MAAMZ,EAAOnB,EAAK,YAClB,GAAI,CAACmB,EAAM,MAAM,IAAI,MAAM,0BAA0B,EAErD,MAAMa,EAAa,CACf,OAAQb,EAAK,IACb,UAAWA,EAAK,MAChB,SAAUY,EAAS,SACnB,WAAYA,EAAS,WACrB,MAAOA,EAAS,MAChB,eAAgBA,EAAS,eACzB,eAAgBA,EAAS,eACzB,YAAaA,EAAS,YACtB,QAASA,EAAS,QAElB,KAAMR,EAAU,IAAG,EAEnB,YAAaA,EAAU,IAAG,EAC1B,MAAOQ,EAAS,OAAS,IAAI,KAAI,EAAG,mBAAmB,QAAS,CAAE,MAAO,OAAQ,KAAM,SAAS,CAAE,CAC9G,EAGcE,EAAY,MAAMC,EAAOC,EAAWjC,EAAIG,EAAY,WAAW,EAAG2B,CAAU,EAClF,eAAQ,IAAI,iCAAkCC,EAAU,EAAE,EAG1D,MAAMG,EAAgBjB,EAAK,IAAKY,EAAS,KAAK,EAG9C,MAAMM,EAAsBlB,EAAK,IAAKY,EAAS,MAAOA,EAAS,KAAK,EAExEhB,EAAgBR,EAAc,CAAC,cAAeY,EAAK,GAAG,CAAC,CAAC,EACxDJ,EAAgBR,EAAc,CAAC,iBAAkBY,EAAK,GAAG,CAAC,CAAC,EAC3DJ,EAAgBR,EAAc,CAAC,iBAAkBY,EAAK,GAAG,CAAC,CAAC,EAC3DJ,EAAgB,OAAO,EACvBA,EAAgB,aAAa,EAElBkB,EAAU,EACrB,OAASP,EAAO,CACZ,cAAQ,MAAM,gCAAiCA,CAAK,EAC9CA,CACV,CACJ,CAKO,eAAeY,EAAmBV,EAAKW,EAAa,GAAI,CAC3D,MAAMC,EAAWjC,EAAc,CAAC,cAAeqB,EAAKW,CAAU,CAAC,EACzDE,EAAShC,EAAe+B,CAAQ,EACtC,GAAIC,EACA,OAAOA,EAGX,GAAI,CACA,MAAMC,EAAIC,EACNR,EAAWjC,EAAIG,EAAY,WAAW,EACtCuC,EAAM,SAAU,KAAMhB,CAAG,EACzBiB,EAAQ,OAAQ,MAAM,EACtBC,EAAMP,CAAU,CAC5B,EAEcQ,EAAgB,MAAMC,EAAQN,CAAC,EAC/BO,EAAU,CAAA,EAEhB,OAAAF,EAAc,QAAS1B,GAAQ,CAC3B4B,EAAQ,KAAK,CAAE,GAAI5B,EAAI,GAAI,GAAGA,EAAI,KAAI,CAAE,CAAE,CAC9C,CAAC,EAED,QAAQ,IAAI,MAAM4B,EAAQ,MAAM,oBAAoB,EACpDrC,EAAe4B,EAAUS,CAAO,EACzBA,CACX,OAASvB,EAAO,CACZ,cAAQ,MAAM,mCAAoCA,CAAK,EACjDA,CACV,CACJ,CAwCO,eAAeW,EAAsBT,EAAKsB,EAAOC,EAAO,CAC3D,GAAI,CACA,MAAMC,EAAc/B,EAAInB,EAAIG,EAAY,gBAAiB,GAAGuB,CAAG,IAAIsB,CAAK,EAAE,EAEpEG,EAAe,CACjB,OAAQzB,EACR,MAAOsB,EACP,MAAOC,EACP,UAAW,GACX,YAAa5B,EAAU,IAAG,EAC1B,UAAWA,EAAU,IAAG,CACpC,EAEQ,MAAME,EAAO2B,EAAaC,EAAc,CAAE,MAAO,EAAI,CAAE,EACvD,QAAQ,IAAI,qCAAqC,EAEjDtC,EAAgBR,EAAc,CAAC,iBAAkBqB,CAAG,CAAC,CAAC,EACtDb,EAAgBR,EAAc,CAAC,iBAAkBqB,CAAG,CAAC,CAAC,CAC1D,OAASF,EAAO,CACZ,cAAQ,MAAM,oCAAqCA,CAAK,EAClDA,CACV,CACJ,CAKO,eAAe4B,GAAkB1B,EAAK2B,EAAO,IAAI,KAAI,EAAG,YAAW,EAAI,CAC1E,MAAMf,EAAWjC,EAAc,CAAC,iBAAkBqB,EAAK2B,CAAI,CAAC,EACtDd,EAAShC,EAAe+B,CAAQ,EACtC,GAAIC,EACA,OAAOA,EAGX,GAAI,CACA,MAAMC,EAAIC,EACNR,EAAWjC,EAAIG,EAAY,eAAe,EAC1CuC,EAAM,SAAU,KAAMhB,CAAG,CACrC,EAEcmB,EAAgB,MAAMC,EAAQN,CAAC,EAC/Bc,EAAW,CAAA,EAEjB,OAAAT,EAAc,QAAS1B,GAAQ,CAC3B,MAAMoC,EAAOpC,EAAI,OACjBmC,EAASC,EAAK,KAAK,EAAIA,CAC3B,CAAC,EAED,QAAQ,IAAI,iCAAiC,EAC7C7C,EAAe4B,EAAUgB,CAAQ,EAC1BA,CACX,OAAS9B,EAAO,CACZ,cAAQ,MAAM,qCAAsCA,CAAK,EACnDA,CACV,CACJ,CAOA,eAAeU,EAAgBR,EAAK8B,EAAU,CAC1C,GAAI,CACA,MAAMtC,EAAUC,EAAInB,EAAIG,EAAY,MAAOuB,CAAG,EACxCC,EAAU,MAAML,EAAOJ,CAAO,EAEpC,GAAIS,EAAQ,SAAU,CAClB,MAAMP,EAAWO,EAAQ,OACnB8B,GAAgBrC,EAAS,cAAgB,GAAK,EAE9CsC,IADiBtC,EAAS,cAAgB,IACTqC,EAAe,GAAMD,GAAYC,EAExE,MAAME,EAAUzC,EAAS,CACrB,aAAcuC,EACd,aAAc,KAAK,MAAMC,CAAU,EACnC,aAAcrC,EAAU,IAAG,EAC3B,UAAWA,EAAU,IAAG,CACxC,CAAa,EAED,QAAQ,IAAI,8BAA8B,EAE1CR,EAAgB,OAAO,EACvBA,EAAgB,aAAa,CACjC,CACJ,OAASW,EAAO,CACZ,cAAQ,MAAM,qCAAsCA,CAAK,EACnDA,CACV,CACJ,CAKO,eAAeoC,GAAalC,EAAK,CACpC,GAAI,CACA,MAAMqB,EAAU,MAAMX,EAAmBV,EAAK,EAAE,EAGhD,IAAImC,EAAgB,EACpB,MAAMC,EAAY,IAAI,IAEtB,UAAWC,KAAUhB,EACbgB,EAAO,OAAS,IAChBD,EAAU,IAAIC,EAAO,KAAK,EAKlC,MAAMC,EAAS,MAAM,KAAKF,CAAS,EAAE,KAAI,EAAG,UAC5C,QAASG,EAAI,EAAGA,EAAID,EAAO,SACvBH,IAEII,EAAID,EAAO,OAAS,GAHOC,IAG/B,CAQJ,MAAM/C,EAAUC,EAAInB,EAAIG,EAAY,MAAOuB,CAAG,EACxCC,EAAU,MAAML,EAAOJ,CAAO,EAEpC,GAAIS,EAAQ,SAAU,CAClB,MAAMP,EAAWO,EAAQ,OACnBuC,EAAgB,KAAK,IAAIL,EAAezC,EAAS,eAAiB,CAAC,EAEzE,MAAMuC,EAAUzC,EAAS,CACrB,cAAe2C,EACf,cAAeK,EACf,UAAW7C,EAAU,IAAG,CACxC,CAAa,EAED,QAAQ,IAAI,yBAAyBwC,CAAa,OAAO,EAEzDhD,EAAgB,OAAO,EACvBA,EAAgB,aAAa,CACjC,CAEA,OAAOgD,CACX,OAASrC,EAAO,CACZ,cAAQ,MAAM,8BAA+BA,CAAK,EAC5CA,CACV,CACJ,CA4DO,eAAe2C,GAAaC,EAAU,GAAI,CAC7C,MAAM9B,EAAWjC,EAAc,CAAC,YAAa,KAAK,UAAU+D,GAAW,EAAE,CAAC,CAAC,EACrE7B,EAAShC,EAAe+B,CAAQ,EACtC,GAAIC,EACA,OAAOA,EAGX,GAAI,CACA,IAAIC,EAAIP,EAAWjC,EAAIG,EAAY,SAAS,EAC5C,MAAMkE,EAAc,CAAA,EAGhBD,EAAQ,QACRC,EAAY,KAAK3B,EAAM,SAAU,KAAM0B,EAAQ,MAAM,CAAC,EAEtDA,EAAQ,OACRC,EAAY,KAAK3B,EAAM,QAAS,KAAM0B,EAAQ,KAAK,CAAC,EAEpDA,EAAQ,MACRC,EAAY,KAAK3B,EAAM,OAAQ,KAAM0B,EAAQ,IAAI,CAAC,EAItDC,EAAY,KAAK1B,EAAQ,YAAa,MAAM,CAAC,EAEzC0B,EAAY,OAAS,IACrB7B,EAAIC,EAAMD,EAAG,GAAG6B,CAAW,GAG/B,MAAMxB,EAAgB,MAAMC,EAAQN,CAAC,EAC/B8B,EAAY,CAAA,EAElB,OAAAzB,EAAc,QAAS1B,GAAQ,CAC3BmD,EAAU,KAAK,CAAE,GAAInD,EAAI,GAAI,GAAGA,EAAI,KAAI,CAAE,CAAE,CAChD,CAAC,EAED,QAAQ,IAAI,MAAMmD,EAAU,MAAM,qBAAqB,EACvD5D,EAAe4B,EAAUgC,CAAS,EAC3BA,CACX,OAAS9C,EAAO,CACZ,cAAQ,MAAM,mCAAoCA,CAAK,EACjDA,CACV,CACJ,CAKO,eAAe+C,GAAeC,EAAc,CAC/C,GAAI,CACA,MAAMvD,EAAOnB,EAAK,YAClB,GAAI,CAACmB,EAAM,MAAM,IAAI,MAAM,0BAA0B,EAGrD,GAAI,CAACuD,EAAa,UAAYA,EAAa,SAAS,OAAS,GACzD,MAAM,IAAI,MAAM,kDAAkD,EAEtE,GAAI,CAACA,EAAa,SAAWA,EAAa,QAAQ,SAAW,EACzD,MAAM,IAAI,MAAM,6CAA6C,EAEjE,GAAIA,EAAa,gBAAkB,QAAaA,EAAa,cAAgB,GAAKA,EAAa,cAAgB,EAC3G,MAAM,IAAI,MAAM,4CAA4C,EAEhE,GAAI,CAACA,EAAa,aAAeA,EAAa,YAAY,OAAS,GAC/D,MAAM,IAAI,MAAM,oDAAqD,EAEzE,GAAI,CAAC,CAAC,OAAQ,SAAU,KAAM,UAAU,EAAE,SAASA,EAAa,MAAM,EAClE,MAAM,IAAI,MAAM,iBAAiB,EAErC,GAAI,CAACA,EAAa,OAASA,EAAa,MAAQ,GAAKA,EAAa,MAAQ,GACtE,MAAM,IAAI,MAAM,eAAe,EAGnC,MAAMC,EAAc,CAChB,SAAUD,EAAa,SAAS,KAAI,EACpC,QAASA,EAAa,QAAQ,IAAIE,GAAOA,EAAI,MAAM,EACnD,cAAe,SAASF,EAAa,aAAa,EAClD,YAAaA,EAAa,YAAY,KAAI,EAC1C,OAAQA,EAAa,OACrB,MAAO,SAASA,EAAa,KAAK,EAClC,KAAMA,EAAa,MAAQ,IAAI,KAAI,EAAG,YAAW,EACjD,UAAWnD,EAAU,IAAG,EACxB,UAAWJ,EAAK,IAChB,UAAWI,EAAU,IAAG,CACpC,EAEcsD,EAAc,MAAM3C,EAAOC,EAAWjC,EAAIG,EAAY,SAAS,EAAGsE,CAAW,EACnF,eAAQ,IAAI,oBAAqBE,EAAY,EAAE,EAG/C,MAAMC,EAAe,CACjB,OAAQ,kBACR,WAAYD,EAAY,GACxB,QAAS1D,EAAK,IACd,WAAYA,EAAK,KAC7B,CAAS,EAEDJ,EAAgB,WAAW,EAC3BA,EAAgB,iBAAiB,EAE1B8D,EAAY,EACvB,OAASnD,EAAO,CACZ,cAAQ,MAAM,8BAA+BA,CAAK,EAC5CA,CACV,CACJ,CA8CO,eAAeqD,GAAeC,EAAY,CAC7C,GAAI,CACA,MAAM7D,EAAOnB,EAAK,YAClB,GAAI,CAACmB,EAAM,MAAM,IAAI,MAAM,0BAA0B,EAErD,MAAM0D,EAAcxD,EAAInB,EAAIG,EAAY,UAAW2E,CAAU,EAIvDN,GADc,MAAMlD,EAAOqD,CAAW,GACX,OAEjC,aAAMI,EAAUJ,CAAW,EAC3B,QAAQ,IAAI,0BAA2BG,CAAU,EAGjD,MAAMF,EAAe,CACjB,OAAQ,kBACR,WAAYE,EACZ,QAAS7D,EAAK,IACd,WAAYA,EAAK,MACjB,YAAauD,CACzB,CAAS,EAED3D,EAAgB,WAAW,EAC3BA,EAAgB,iBAAiB,EAE1B,EACX,OAASW,EAAO,CACZ,cAAQ,MAAM,iCAAkCA,CAAK,EAC/CA,CACV,CACJ,CAKO,eAAewD,GAAwBC,EAAU,CACpD,GAAI,CACA,MAAMhE,EAAOnB,EAAK,YAClB,GAAI,CAACmB,EAAM,MAAM,IAAI,MAAM,0BAA0B,EAGrD,GAAI,CAACgE,EAAS,QAAU,CAACA,EAAS,OAAS,CAACA,EAAS,MAAQ,CAACA,EAAS,UACnE,MAAM,IAAI,MAAM,sDAAsD,EAG1E,GAAI,CAAC,MAAM,QAAQA,EAAS,SAAS,GAAKA,EAAS,UAAU,SAAW,EACpE,MAAM,IAAI,MAAM,qDAAqD,EAGzE,MAAMC,EAAc,CAAA,EACdC,EAAS,CAAA,EAGf,QAASlB,EAAI,EAAGA,EAAIgB,EAAS,UAAU,OAAQhB,IAAK,CAChD,MAAMmB,EAAWH,EAAS,UAAUhB,CAAC,EAErC,GAAI,CACA,MAAMO,EAAe,CACjB,SAAUY,EAAS,SACnB,QAASA,EAAS,QAClB,cAAeA,EAAS,cACxB,YAAaA,EAAS,YACtB,OAAQH,EAAS,OACjB,MAAOA,EAAS,MAChB,KAAMA,EAAS,IACnC,EAEsBH,EAAa,MAAMP,GAAeC,CAAY,EACpDU,EAAY,KAAKJ,CAAU,CAC/B,OAASO,EAAK,CACVF,EAAO,KAAK,CAAE,MAAOlB,EAAG,MAAOoB,EAAI,OAAO,CAAE,EAC5C,QAAQ,MAAM,qBAAqBpB,EAAI,CAAC,IAAKoB,EAAI,OAAO,CAC5D,CACJ,CAGA,aAAMC,GAAgB,CAClB,WAAYrE,EAAK,IACjB,OAAQgE,EAAS,OACjB,MAAOA,EAAS,MAChB,KAAMA,EAAS,KACf,eAAgBA,EAAS,UAAU,OACnC,aAAcC,EAAY,OAC1B,WAAYC,EAAO,OACnB,OAAQA,EAAO,SAAW,EAAI,UAAY,SACtD,CAAS,EAED,QAAQ,IAAI,qBAAqBD,EAAY,MAAM,IAAID,EAAS,UAAU,MAAM,sBAAsB,EAEtGpE,EAAgB,WAAW,EAC3BA,EAAgB,iBAAiB,EAE1B,CACH,QAASqE,EAAY,OACrB,MAAOD,EAAS,UAAU,OAC1B,OAAQE,EACR,IAAKD,CACjB,CACI,OAAS1D,EAAO,CACZ,cAAQ,MAAM,wBAAyBA,CAAK,EACtCA,CACV,CACJ,CAKO,eAAe+D,GAAYnB,EAAU,GAAI,CAC5C,MAAM9B,EAAWjC,EAAc,CAAC,QAAS,KAAK,UAAU+D,GAAW,EAAE,CAAC,CAAC,EACjE7B,EAAShC,EAAe+B,CAAQ,EACtC,GAAIC,EACA,OAAOA,EAGX,GAAI,CACA,IAAIC,EAAIP,EAAWjC,EAAIG,EAAY,KAAK,EACxC,MAAMkE,EAAc,CAAA,EAGhBD,EAAQ,MACRC,EAAY,KAAK3B,EAAM,OAAQ,KAAM0B,EAAQ,IAAI,CAAC,EAItDC,EAAY,KAAK1B,EAAQ,YAAa,MAAM,CAAC,EAEzC0B,EAAY,OAAS,IACrB7B,EAAIC,EAAMD,EAAG,GAAG6B,CAAW,GAG/B,MAAMxB,EAAgB,MAAMC,EAAQN,CAAC,EAC/BgD,EAAQ,CAAA,EAEd,OAAA3C,EAAc,QAAS1B,GAAQ,CAC3BqE,EAAM,KAAK,CAAE,GAAIrE,EAAI,GAAI,GAAGA,EAAI,KAAI,CAAE,CAAE,CAC5C,CAAC,EAED,QAAQ,IAAI,MAAMqE,EAAM,MAAM,uBAAuB,EACrD9E,EAAe4B,EAAUkD,CAAK,EACvBA,CACX,OAAShE,EAAO,CACZ,cAAQ,MAAM,sCAAuCA,CAAK,EACpDA,CACV,CACJ,CAKO,eAAeiE,GAAeC,EAAQC,EAAS,CAClD,GAAI,CACA,MAAM1E,EAAOnB,EAAK,YAClB,GAAI,CAACmB,EAAM,MAAM,IAAI,MAAM,0BAA0B,EAErD,GAAI,CAAC,CAAC,OAAQ,OAAO,EAAE,SAAS0E,CAAO,EACnC,MAAM,IAAI,MAAM,6CAA6C,EAGjE,MAAMzE,EAAUC,EAAInB,EAAIG,EAAY,MAAOuF,CAAM,EAEjD,aAAM/B,EAAUzC,EAAS,CACrB,KAAMyE,EACN,UAAWtE,EAAU,IAAG,CACpC,CAAS,EAED,QAAQ,IAAI,0BAA0BqE,CAAM,KAAKC,CAAO,EAAE,EAG1D,MAAMf,EAAe,CACjB,OAAQ,mBACR,aAAcc,EACd,QAASC,EACT,QAAS1E,EAAK,IACd,WAAYA,EAAK,KAC7B,CAAS,EAEDJ,EAAgB,OAAO,EACvBA,EAAgB,aAAa,EAEtB,EACX,OAASW,EAAO,CACZ,cAAQ,MAAM,6BAA8BA,CAAK,EAC3CA,CACV,CACJ,CAKA,eAAe8D,GAAgBM,EAAS,CACpC,GAAI,CACA,MAAMC,EAAM,CACR,GAAGD,EACH,WAAYvE,EAAU,IAAG,CACrC,EAEQ,MAAMW,EAAOC,EAAWjC,EAAI,YAAY,EAAG6F,CAAG,EAC9C,QAAQ,IAAI,iBAAiB,CACjC,OAASrE,EAAO,CACZ,QAAQ,MAAM,8BAA+BA,CAAK,CACtD,CACJ,CAKA,eAAeoD,EAAegB,EAAS,CACnC,GAAI,CACA,MAAMC,EAAM,CACR,GAAGD,EACH,UAAWvE,EAAU,IAAG,CACpC,EAEQ,MAAMW,EAAOC,EAAWjC,EAAI,WAAW,EAAG6F,CAAG,EAC7C,QAAQ,IAAI,gBAAgB,CAChC,OAASrE,EAAO,CACZ,QAAQ,MAAM,6BAA8BA,CAAK,CACrD,CACJ,CAKO,eAAesE,IAAoB,CACtC,MAAMxD,EAAW,kBACXC,EAAShC,EAAe+B,CAAQ,EACtC,GAAIC,EACA,OAAOA,EAGX,GAAI,CACA,MAAM+B,EAAY,MAAMH,KAElB4B,EAAQ,CACV,MAAOzB,EAAU,OACjB,SAAU,CAAA,EACV,QAAS,CAAA,EACT,OAAQ,CAAA,CACpB,EAEQ,OAAAA,EAAU,QAAQ9B,GAAK,CAEnBuD,EAAM,SAASvD,EAAE,MAAM,GAAKuD,EAAM,SAASvD,EAAE,MAAM,GAAK,GAAK,EAG7DuD,EAAM,QAAQvD,EAAE,KAAK,GAAKuD,EAAM,QAAQvD,EAAE,KAAK,GAAK,GAAK,EAGzDuD,EAAM,OAAOvD,EAAE,IAAI,GAAKuD,EAAM,OAAOvD,EAAE,IAAI,GAAK,GAAK,CACzD,CAAC,EAED9B,EAAe4B,EAAUyD,EAAO,IAAS,GAAI,EACtCA,CACX,OAASvE,EAAO,CACZ,cAAQ,MAAM,mCAAoCA,CAAK,EACjDA,CACV,CACJ,CAKO,eAAewE,IAAgB,CAClC,MAAM1D,EAAW,cACXC,EAAShC,EAAe+B,CAAQ,EACtC,GAAIC,EACA,OAAOA,EAGX,GAAI,CACA,MAAMiD,EAAQ,MAAMD,KAEdQ,EAAQ,CACV,MAAOP,EAAM,OACb,OAAQA,EAAM,OAAOS,GAAKA,EAAE,OAAS,OAAO,EAAE,OAC9C,aAAcT,EAAM,OAAOS,GAAKA,EAAE,OAAS,OAAO,EAAE,OACpD,eAAgB,EAChB,aAAc,EACd,aAAc,CAC1B,EAEcC,EAAa,IAAI,KACvB,OAAAA,EAAW,QAAQA,EAAW,QAAO,EAAK,CAAC,EAE3CV,EAAM,QAAQS,GAAK,CACXA,EAAE,WAAaA,EAAE,UAAU,OAAM,EAAKC,GACtCH,EAAM,iBAEVA,EAAM,cAAiBE,EAAE,cAAgB,EACzCF,EAAM,cAAiBE,EAAE,cAAgB,CAC7C,CAAC,EAEDF,EAAM,aAAeA,EAAM,MAAQ,EAAI,KAAK,MAAMA,EAAM,aAAeA,EAAM,KAAK,EAAI,EAEtFrF,EAAe4B,EAAUyD,EAAO,IAAS,GAAI,EACtCA,CACX,OAASvE,EAAO,CACZ,cAAQ,MAAM,sCAAuCA,CAAK,EACpDA,CACV,CACJ,CCv3BA,MAAM2E,EAAW,IAAIC,EACrBD,EAAS,oBAAoB,CACzB,OAAQ,gBACZ,CAAC,EAGD,IAAIE,EAAmB,GAGhB,eAAeC,IAAmB,CAErC,GAAID,EACA,eAAQ,KAAK,mDAAmD,EACzD,KAGXA,EAAmB,GAEnB,GAAI,CACA,QAAQ,IAAI,qCAAqC,EAEjD,MAAMpF,GADS,MAAMsF,EAAgBzG,EAAMqG,CAAQ,GAC/B,KAEpB,eAAQ,IAAI,8BAA+BlF,EAAK,WAAW,EAC3D,QAAQ,IAAI,YAAaA,EAAK,KAAK,EAGnC,MAAMD,EAAmBC,CAAI,EAEtBA,CACX,OAASO,EAAO,CACZ,QAAQ,MAAM,yBAA0BA,CAAK,EAG7C,IAAIgF,EAAe,mDAEnB,GAAIhF,EAAM,OAAS,4BACfgF,EAAe,iDACRhF,EAAM,OAAS,qBACtBgF,EAAe,8DACRhF,EAAM,OAAS,2BACtBgF,EAAe,oEACRhF,EAAM,OAAS,+BAEtB,eAAQ,KAAK,6CAA6C,EACnD,KAGX,MAAIA,EAAM,OAAS,gCACf,MAAMgF,CAAY,EAEhBhF,CACV,QAAC,CAEG,WAAW,IAAM,CACb6E,EAAmB,EACvB,EAAG,GAAI,CACX,CACJ,CAGO,eAAeI,IAAc,CAChC,GAAI,CACA,MAAMC,EAAW5G,EAAK,aAAa,aAAe,cAClD,MAAM6G,EAAQ7G,CAAI,EAClB,QAAQ,IAAI,yBAA0B4G,CAAQ,CAClD,OAASlF,EAAO,CACZ,cAAQ,MAAM,2BAA4BA,CAAK,EACzCA,CACV,CACJ,CAGO,SAASoF,GAAaC,EAAU,CACnC,OAAOC,EAAmBhH,EAAOmB,GAAS,CAClCA,EACA,QAAQ,IAAI,2BAA4BA,EAAK,KAAK,EAElD,QAAQ,IAAI,+BAA+B,EAE/C4F,EAAS5F,CAAI,CACjB,CAAC,CACL,CAGO,SAAS8F,IAAiB,CAC7B,OAAOjH,EAAK,WAChB,CAQO,eAAekH,GAAmBC,EAAa,CAClD,GAAI,CAACA,EAAa,OAIlB,GAFgBA,EAAY,OAAS,QAExB,CAET,MAAMC,EAAe,SAAS,eAAe,gBAAgB,EACzDA,GACAA,EAAa,UAAU,OAAO,QAAQ,EAI1C,MAAMC,EAAgB,SAAS,eAAe,iBAAiB,EAC3DA,GACAA,EAAc,UAAU,OAAO,QAAQ,EAG3C,QAAQ,IAAI,yBAAyB,CACzC,CACJ,CAqDO,SAASC,IAAa,CACzB,OAAO,aAAa,QAAQ,UAAU,IAAM,MAChD,CAKO,SAASC,IAAc,CAC1B,GAAI,CACA,MAAMC,EAAe,aAAa,QAAQ,UAAU,EACpD,OAAKA,EAEY,KAAK,MAAMA,CAAY,EAFd,IAI9B,OAAS9F,EAAO,CACZ,eAAQ,MAAM,qCAAsCA,CAAK,EAClD,IACX,CACJ,CAKO,SAAS+F,IAAwB,CAEpC,OAAIH,GAAU,EACHC,GAAW,EAIfN,GAAc,CACzB"}